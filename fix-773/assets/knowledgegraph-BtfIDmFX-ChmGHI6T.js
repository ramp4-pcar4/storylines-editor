const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-bSKUKu5m-BfCIJxUi.js","./main-D8UjLOIQ.js","./main-D2F5QhFW.css","./normalizeUtils-u00NGW3M-B_ZR-NxM.js","./normalizeUtilsCommon-ClagynAA-C5v37AXV.js","./utils-BO8hgPs3-CT_Uv3UC.js","./utils-DpLVEUvg-DN_Ioqdv.js","./Field-BIQ-quF4-BPjMRpni.js","./fieldType-PhcL4ff8-B7j5aTWg.js","./networkEnums-DHCOt6o_-Bl0h-BNQ.js","./FeatureSet-BVGGhhH9-ySvRiShi.js","./GPMessage-KKjIcGuy-_-PHQ8N3.js","./Relationship-CQMFhJpR-wT-0qwHY.js"])))=>i.map(i=>d[i]);
import{bp as _,k as w,_ as D,j as x,l as E,aE as I,db as V,f as j,aL as b,z,aQ as Y}from"./main-D8UjLOIQ.js";import{t as J}from"./arcade-BoHTeCSG-BxKTtX2e.js";import{a as P,p as T,x as L,q as k,j as W,i as Q,y as q,z as B,A as K,E as M,H as F}from"./aiServices-u5nRiq9H-Dfd8u3BD.js";import{l,r as u}from"./enum-g1DWyQyu-C22wI6Gv.js";import{n as U}from"./portalUtils-COohlq76-CL5gSea4.js";import{k as C,K as H,O as Z}from"./projectionUtils-B-CplN3q-DU9g_puo.js";import X from"./PortalItem-BP-IQXnZ-JqWrKaVu.js";import{o as $,O as ee}from"./project-TZjL1vJA-CSCVV3K_.js";import{s as ne,n as te,d as ie,a as ae,u as oe}from"./Relationship-CQMFhJpR-wT-0qwHY.js";import"./TimeOnly-CGkId3bj-BgQ9WVmM.js";import"./UnknownTimeZone-DxjyzFvs-DtNVLQoo.js";import"./featureConversionUtils-Bjjlcfdo-BL25e0Vn.js";import"./OptimizedFeature-mIz_HhJg-D48m52Jl.js";import"./memoryEstimations-DeWfxwaV-DpFMiS4z.js";import"./OptimizedGeometry-pzfNw1AT-BMGedq_M.js";import"./OptimizedFeatureSet-Dz5hF8Qm-CgsRgxJh.js";import"./FieldsIndex-Bt0Y8aWr-DcDROz7E.js";import"./timeZoneUtils-d5p0Jda1-BeP90iup.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-DttuBH5Z-B1MkhdGZ.js";import"./Field-BIQ-quF4-BPjMRpni.js";import"./fieldType-PhcL4ff8-B7j5aTWg.js";import"./WhereClause-D4rZJkVN-Bi-135nj.js";import"./unitConversion-BxD3RA9Y--0IbSiek.js";import"./number-mnL_JN3f-OAAcMkOv.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import"./utils-BO8hgPs3-CT_Uv3UC.js";import"./utils-DpLVEUvg-DN_Ioqdv.js";let c=null;async function re(e){const n=j.geometryServiceUrl??"";if(!n){C()||await H();for(const t of e)t.container[t.indexer]=Z(t.container[t.indexer],b.WGS84);return}const i=e.map(t=>t.container[t.indexer]),o=new $({geometries:i,outSpatialReference:b.WGS84}),s=await ee(n,o);for(let t=0;t<s.length;t++){const a=e[t];a.container[a.indexer]=s[t]}}async function A(e,n){const i=new X({portal:e,id:n});return await i.load(),c===null&&(c=await D(()=>import("./knowledgeGraphService-bSKUKu5m-BfCIJxUi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url).then(o=>o.k)),await c.fetchKnowledgeGraph(i.url)}function R(e,n,i,o,s){if(e===null)return null;if(w(e)||E(e))return e;if(q(e)||q(e))return e.toJSDate();if(B(e))return e.toStorageFormat();if(K(e))return e.toStorageString();if(M(e)){const t={};for(const a of e.keys())t[a]=R(e.field(a),n,i,o,s),t[a]instanceof I&&s.push({container:t,indexer:a});return t}if(x(e)){const t=e.map(a=>R(a,n,i,o,s));for(let a=0;a<t.length;a++)t[a]instanceof I&&s.push({container:t,indexer:a});return t}return F(e)?e.spatialReference.isWGS84?e:e.spatialReference.isWebMercator&&n?V(e):e:void 0}function se(e,n){if(!e)return e;if(e.spatialReference.isWGS84&&n.spatialReference.isWebMercator)return Y(e);if(e.spatialReference.equals(n.spatialReference))return e;throw new l(n,u.WrongSpatialReference,null)}function v(e,n){if(!e)return null;const i={};for(const o in e)i[o]=m(e[o],n);return i}function m(e,n){return e===null?null:x(e)?e.map(i=>m(i,n)):e instanceof te?{graphTypeName:e.typeName,id:e.id,graphType:"entity",properties:v(e.properties,n)}:e instanceof ie?{graphType:"object",properties:v(e.properties,n)}:e instanceof ae?{graphTypeName:e.typeName,id:e.id,graphType:"relationship",originId:e.originId??null,destinationId:e.destinationId??null,properties:v(e.properties,n)}:e instanceof oe?{graphType:"path",path:e.path?e.path.map(i=>m(i,n)):null}:F(e)?se(e,n):w(e)||E(e)||z(e)?e:null}function Ne(e){e.mode==="async"&&(e.functions.knowledgegraphbyportalitem=function(n,i){return e.standardFunctionAsync(n,i,(o,s,t)=>{if(P(t,2,2,n,i),t[0]===null)throw new l(n,u.PortalRequired,i);if(t[0]instanceof J){const d=T(t[1]);let f;return f=n.services?.portal?n.services.portal:_.getDefault(),A(U(t[0],f),d)}if(w(t[0])===!1)throw new l(n,u.InvalidParameter,i);const a=T(t[0]);return A(n.services?.portal??_.getDefault(),a)})},e.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),e.functions.querygraph=function(n,i){return e.standardFunctionAsync(n,i,async(o,s,t)=>{P(t,2,4,n,i);const a=t[0];if(!L(a))throw new l(n,u.InvalidParameter,i);const d=t[1];if(!w(d))throw new l(n,u.InvalidParameter,i);c===null&&(c=await D(()=>import("./knowledgeGraphService-bSKUKu5m-BfCIJxUi.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url).then(r=>r.k));let f=null;const h=k(t[2],null);if(!(h instanceof W||h===null))throw new l(n,u.InvalidParameter,i);if(h){let r=[];f=R(h,!0,!1,n,r),r=r.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),r.length>0&&await re(r)}const G=k(t[3],!1),S=new ne({openCypherQuery:d,bindParameters:f,provenanceBehavior:G?"include":"exclude"});(a?.serviceDefinition?.currentVersion??11.3)>11.2&&(S.outputSpatialReference=n.spatialReference);const O=(await c.executeQueryStreaming(a,S)).resultRowsStream.getReader(),y=[];try{for(;;){const{done:r,value:p}=await O.read();if(r)break;if(x(p))for(const g of p)y.push(m(g,n));else{const g=[];for(const N of p)g.push(m(p[N],n));y.push(g)}}}catch(r){throw r}return W.convertJsonToArcade(y,Q(n),!1,!0)})},e.signatures.push({name:"querygraph",min:2,max:4}))}export{Ne as registerFunctions};
