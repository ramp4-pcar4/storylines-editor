import{f7 as y,f8 as p}from"./main-D8UjLOIQ.js";import{V as S}from"./CIMSymbolHelper-34UsTwam-DsoE60e2.js";import{CIMSymbolRasterizer as R}from"./CIMSymbolRasterizer-CHPajZH1-kh-s9O7s.js";import{OverrideHelper as U}from"./OverrideHelper-DgyARgwI-WIt7IAz1.js";import{k as C}from"./utils-BfXZnjCE-YHhxTa7x.js";import{P as j,S as v}from"./symbolUtils-D5Wjfwrf-DTApHOIz.js";import"./BidiEngine-DusKzrO8-C5hGnKo9.js";import"./fontUtils-C37p4Hgq-DTfz-aQG.js";import"./OptimizedGeometry-pzfNw1AT-BMGedq_M.js";import"./memoryEstimations-DeWfxwaV-DpFMiS4z.js";import"./GeometryUtils-B8e3Iwyx-BmJcrNF9.js";import"./enums-a_LDTPYU-CBIcy3mM.js";import"./defaultCIMValues-BcSaJjm--aGYX5ruf.js";import"./definitions-MCCItX4r-o3EUznKY.js";import"./rasterizingUtils-1wASRzSP-BfffggHQ.js";import"./floatRGBA-DRFmbkvz-CxBD2kJ3.js";import"./mat2d-BQA-1WB--Pnyy0dhf.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./mat2df32-fg3OHsAI-BF2V2zqo.js";import"./vec2-BnynUbeJ-Bdx0nwES.js";import"./vec2f32-hTAvipMV-C0AQcwEv.js";import"./Rect-DD6XS68q-D_hsV3ag.js";import"./BoundingBox-DlCd_wcU-DBB4UfPl.js";import"./CIMResourceManager-DyRf92xI-CUWHi1Ww.js";import"./imageUtils-D3tfFRL_-C5bg-i4h.js";import"./colorUtils-Eg6lOlXm-DMJZAu4r.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./vec4f64-DD-nkcCV-CSNWKRqG.js";import"./FieldsIndex-Bt0Y8aWr-DcDROz7E.js";import"./UnknownTimeZone-DxjyzFvs-DtNVLQoo.js";import"./timeZoneUtils-d5p0Jda1-BeP90iup.js";import"./ArcadeExpression-XjY3x7KV-CPieOIwH.js";import"./TimeOnly-CGkId3bj-BgQ9WVmM.js";import"./enum-g1DWyQyu-C22wI6Gv.js";import"./callExpressionWithFeature-Bk8k1lJI-BsNYGGFF.js";import"./quantizationUtils-D907S7Bm-eKXd3Pim.js";import"./utils-Cb2uXNfG-B-A6TaGy.js";import"./asyncUtils-BPUlNCrX-Cy1oR89x.js";import"./jsonUtils-BwLwuQj7-DO8qEfLg.js";import"./parser-CWccHtwJ-C5mBXbmo.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-OOmHNWi7-Bnj6TIOE.js";import"./cimSymbolUtils-DCedSSCN-96mz_RZu.js";import"./LRUCache-DPWdPNTF-Du_Z0yHt.js";import"./MemCache-qDGoejB7-9IozotvY.js";import"./jsxFactory-Cua8zWVZ-C0LIGF4Z.js";import"./intl-BAA1onnp-D6KfQGxz.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./sanitizerUtils-B1yRmbO2-CZFW4p9I.js";import"./webStyleSymbolUtils-r0H5toyk-BjcT4kLN.js";import"./devEnvironmentUtils-CxrVv3RG-CX5aoxVE.js";import"./styleUtils-DBPDLVBX-N7De7npm.js";const u=new R(null),g=p(v.size),x=p(v.maxSize),M=p(v.lineWidth),q=1;async function D(m,t,l){const r=t?.size;let i=r!=null&&typeof r=="object"&&"width"in r?r.width:r,o=r!=null&&typeof r=="object"&&"height"in r?r.height:r;if(!i||!o)if(l==="esriGeometryPolygon")i=o=t.maxSize?Math.min(t.maxSize,g):g;else{const n=await E(m,t,l);n&&(i=n.width,o=n.height),l==="esriGeometryPolyline"&&(i=t.maxSize?Math.min(t.maxSize,M):M),i=i!=null&&isFinite(i)?Math.min(i,x):g,o=o!=null&&isFinite(o)?Math.max(Math.min(o,x),q):g}return t.style==="legend"&&l==="esriGeometryPolyline"&&(i=M),{width:i,height:o}}async function E(m,t={},l){const r=t.cimOptions||t;l??=r.geometryType||C(m?.data?.symbol);const{feature:i,fieldMap:o,viewParams:n}=r,a=await U.resolveSymbolOverrides(m.data,i,null,o,l,null,n);if(!a)return null;(m=m.clone()).data={type:"CIMSymbolReference",symbol:a},m.data.primitiveOverrides=void 0;const e=[];return S.fetchResources(a,u.resourceManager,e),S.fetchFonts(a,u.resourceManager,e),e.length>0&&await Promise.all(e),S.getEnvelope(a,null,u.resourceManager)}async function Dt(m,t={}){const{node:l,opacity:r,symbolConfig:i}=t,o=i!=null&&typeof i=="object"&&"isSquareFill"in i&&i.isSquareFill,n=t.cimOptions||t,a=n.geometryType||C(m?.data?.symbol),e=await D(m,t,a),{feature:I,fieldMap:G}=n,O=t?.geometry||o||a!=="esriGeometryPolygon"?"preview":"legend";let P=e;const z=e;if(t?.geometry&&(a==="esriGeometryPolygon"||a==="esriGeometryPolyline")&&(y(e.width)<200||y(e.height)<200)){const b=e.width>e.height?p(200)*e.height/e.width:p(200);P={width:e.width>e.height?p(200):p(200)*e.width/e.height,height:b}}const d=await u.rasterizeCIMSymbolAsync(m,I,P,O,G,a,null,n.viewParams,n.allowScalingUp,t?.geometry?.toJSON());if(!d)return null;const{width:F,height:L}=d,h=document.createElement("canvas");h.width=F,h.height=L,h.getContext("2d").putImageData(d,0,0);const f=y(z.width),w=y(z.height),s=new Image(f,w);s.src=h.toDataURL(),s.ariaLabel=t.ariaLabel??null,s.alt=t.ariaLabel??"",r!=null&&(s.style.opacity=`${r}`);let c=s;if(t.effectView!=null){const b={shape:{type:"image",x:0,y:0,width:f,height:w,src:s.src},fill:null,stroke:null,offset:[0,0]};c=j([[b]],[f,w],t)}return l&&c&&l.appendChild(c),c}export{E as getCIMSymbolPreviewSize,Dt as previewCIMSymbol};
