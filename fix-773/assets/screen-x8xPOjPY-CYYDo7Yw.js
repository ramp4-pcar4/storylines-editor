import{fv as $,fC as C,fZ as G,h5 as M,fB as x,f_ as O,fJ as R,fQ as K,fM as a,fV as P,f$ as o,fN as S,fR as _,fL as r,fK as k,fU as Q,g4 as y,fY as p,h4 as T,fO as z,fP as V,hC as Z,hD as D,hE as J,hF as I,hG as q,fz as F,hm as H,hA as j,fS as X,hB as N,fA as A,fE as Y,g0 as W,fG as U,fD as ee,fw as ae,g1 as te}from"./main-D8UjLOIQ.js";const re={class:"rv-geosearch-bar relative h-26 mx-8 mb-8"},le=["placeholder","value","aria-label"],se={class:"absolute inset-y-0 right-8 grid w-10 place-content-center"},oe=["aria-label","content"],ne=$({__name:"search-bar",setup(E){const{t:n}=C(),i=M(),c=F(),g=x(()=>i.searchVal),b=x(()=>['"',"$","!","*","+","?","^","{","}","(",")","|","[","]"].filter(d=>i.searchVal.includes(d)).join("")),m=d=>{i.setSearchTerm(d),i.setSearchRegex(d)},f=H(500,d=>{m(d)});return(d,e)=>{const u=R("tippy");return a(),r("div",re,[o("input",{type:"text",class:X(["border-b w-full text-base py-8 outline-none focus:shadow-outline border-gray-600 h-full min-w-0",{"border-yellow-500":b.value}]),placeholder:p(n)("geosearch.searchText"),value:g.value,onInput:e[0]||(e[0]=t=>p(f)(t.target.value)),onKeyup:e[1]||(e[1]=j(t=>{p(c).mobileView&&t.target.blur()},["enter"])),"aria-label":p(n)("geosearch.searchText"),onKeypress:e[2]||(e[2]=j(N(()=>{},["prevent"]),["enter"])),enterkeyhint:"done"},null,42,le),o("span",se,[b.value?k((a(),r("button",{key:0,class:"cursor-default","aria-label":p(n)("geosearch.badChars",{chars:b.value}),content:p(n)("geosearch.badChars",{chars:b.value})},e[3]||(e[3]=[T(" âš  ")]),8,oe)),[[u]]):_("",!0)])])}}}),ce={class:"rv-geosearch-top-filters sm:flex items-center w-full ml-8 mb-14"},ie={class:"w-fit inline-block sm:w-1/2 h-26 mb-8 sm:mb-0 pr-16 sm:pr-0"},ue=["value","aria-label"],pe={value:"",disabled:"",hidden:""},ve={class:"sm:w-1/2 h-26 sm:mx-16 flex"},be=["value","aria-label"],fe={value:"",disabled:"",hidden:""},de=["disabled","content","aria-label"],he=$({__name:"top-filters",setup(E){const{t:n}=C(),i=G("iApi"),c=M(),g=A([]),b=A([]),m=A([]),f=x(()=>c.queryParams),d=x(()=>i.language),e=v=>c.setProvince(v),u=v=>c.setType(v),t=()=>{e({}),u({})},w=()=>{c.initService(i.language,i.fixture.get("geosearch").config);const v=g.value.find(s=>f.value.province===s.name)?.code,h=b.value.find(s=>f.value.type===s.name)?.code;c.getProvinces.then(s=>{g.value=s,e({province:s.find(L=>L.code===v)?.name,forceReRun:!0})}),c.getTypes.then(s=>{b.value=s,u({type:s.find(L=>L.code===h)?.name,forceReRun:!0})})};return Y(()=>{w(),m.value.push(W(d,w))}),U(()=>{m.value.forEach(v=>v())}),(v,h)=>{const s=R("truncate"),L=R("tippy");return a(),r("div",ce,[o("div",ie,[k((a(),r("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer",value:f.value.province,"aria-label":p(n)("geosearch.filters.province"),onChange:h[0]||(h[0]=l=>e({province:l.target.value}))},[k((a(),r("option",pe,[T(y(p(n)("geosearch.filters.province")),1)])),[[s]]),(a(!0),r(z,null,V(g.value,l=>k((a(),r("option",{key:l.code},[T(y(l.name),1)])),[[s]])),128))],40,ue)),[[s]])]),o("div",ve,[k((a(),r("select",{class:"border-b border-b-gray-600 w-full h-full py-0 cursor-pointer max-w-150",value:f.value.type,"aria-label":p(n)("geosearch.filters.type"),onChange:h[1]||(h[1]=l=>u({type:l.target.value}))},[o("option",fe,y(p(n)("geosearch.filters.type")),1),(a(!0),r(z,null,V(b.value,l=>(a(),r("option",{key:l.code},y(l.name),1))),128))],40,be)),[[s]]),k((a(),r("button",{type:"button",class:"text-gray-500 w-1/8 h-24 pl-8 pr-16 sm:pr-8 hover:text-black disabled:cursor-default disabled:text-gray-400",disabled:!f.value.type&&!f.value.province,onClick:t,content:p(n)("geosearch.filters.clear"),"aria-label":p(n)("geosearch.filters.clear")},h[2]||(h[2]=[o("div",{class:"rv-geosearch-icon"},[o("svg",{class:"fill-current w-18 h-18",viewBox:"0 0 23 21"},[o("path",{d:"M 14.7574,20.8284L 17.6036,17.9822L 14.7574,15.1716L 16.1716,13.7574L 19.0178,16.568L 21.8284,13.7574L 23.2426,15.1716L 20.432,17.9822L 23.2426,20.8284L 21.8284,22.2426L 19.0178,19.3964L 16.1716,22.2426L 14.7574,20.8284 Z M 2,2L 19.9888,2.00001L 20,2.00001L 20,2.01122L 20,3.99999L 19.9207,3.99999L 13,10.9207L 13,22.909L 8.99999,18.909L 8.99999,10.906L 2.09405,3.99999L 2,3.99999L 2,2 Z "})])],-1)]),8,de)),[[L,{placement:"bottom"}]])])])}}}),ge={class:"rv-geosearch-bottom-filters"},me={class:"bg-white"},ye={class:"ml-8 cursor-pointer font-normal"},xe=["checked"],we=$({__name:"bottom-filters",setup(E){const{t:n}=C(),i=G("iApi"),c=M(),g=x(()=>c.resultsVisible),b=H(300,e=>{f(e).then(u=>{m({extent:u,visible:g.value})})}),m=e=>{c.setMapExtent(e)},f=async e=>e.sr.wkid===4326?e:await i.geo.proj.projectGeometry(4326,e),d=e=>{f(i.geo.map.getExtent()).then(u=>{m({extent:u,visible:e})})};return ee(()=>{i.event.on(ae.MAP_EXTENTCHANGE,b,"geosearch_map_extent")}),U(()=>{i.event.off("geosearch_map_extent")}),(e,u)=>(a(),r("div",ge,[o("div",me,[o("label",ye,[o("input",{type:"checkbox",class:"border-2 mx-8 border-gray-600 cursor-pointer",checked:g.value,onChange:u[0]||(u[0]=t=>d(t.target.checked)),onKeypress:u[1]||(u[1]=j(N(()=>{},["prevent"]),["enter"]))},null,40,xe),T(y(p(n)("geosearch.visible")),1)])])]))}}),Le={},ke={class:"w-full h-6 relative overflow-hidden rounded-full indeterminate mb-14"},_e={class:"h-full progressbar bg-blue-800 rounded-full top-0","aria-valuemin":"0","aria-valuemax":"100"},Te={class:"flex items-center h-full"};function Ee(E,n){return a(),r("div",ke,[o("div",_e,[o("span",Te,[te(E.$slots,"default",{},void 0,!0)])])])}const Re=Q(Le,[["render",Ee],["__scopeId","data-v-0a8d1c36"]]),$e={class:"flex flex-col h-full"},Ce={key:1,class:"text-red-900 text-xs px-8 mb-10"},Me={key:2,class:"px-8 mb-10 py-8 flex-grow text-wrap border-y border-gray-600 overflow-y-auto"},Se={class:"relative h-48"},Ae={class:"font-bold text-blue-600"},ze={key:3,class:"rv-results-list flex-grow mb-5 border-t border-b border-gray-600 overflow-y-auto"},Ve=["onClick"],je={class:"rv-result-description px-8"},Ge={class:"flex-1 text-left truncate font-bold leading-tight"},Ke=["innerHTML"],Pe={key:0,class:"text-gray-600 text-sm"},Ie={key:1,class:"hidden"},qe={key:2,class:"text-sm font-normal"},Ue=$({__name:"screen",props:{panel:{type:Object}},setup(E){const{t:n}=C(),i=G("iApi"),c=M(),g=x(()=>c.searchVal.replace(/["!*$+?^{}()|[\]\\]/g,"").trim()),b=x(()=>c.searchResults),m=x(()=>c.loadingResults),f=x(()=>c.failedServices),d=x(()=>c.GSservice.config.fsaUrl),e=async t=>{if(t.flav==="fsa"&&d.value){const v=d.value.replace(Z,t.name),[h,s]=await D(J(v));if(!h){const L=new I("fsazoom",s.features[0].geometry.rings,q.fromConfig(s.spatialReference),!0);i.geo.map.zoomMapTo(L);return}}const w=new I("zoomies",[[[t.bbox[0],t.bbox[1]],[t.bbox[0],t.bbox[3]],[t.bbox[2],t.bbox[3]],[t.bbox[2],t.bbox[1]],[t.bbox[0],t.bbox[1]]]],q.latLongSR(),!0);i.geo.map.zoomMapTo(w)},u=(t,w)=>{const v=t.replace(new RegExp(`${c.searchRegex}`,"gi"),h=>'<span class="font-bold text-blue-600">'+h+"</span>");return w?v+",":v};return(t,w)=>{const v=O("panel-screen"),h=R("truncate"),s=R("focus-item"),L=R("focus-list");return a(),K(v,{panel:E.panel},{header:P(()=>[T(y(p(n)("geosearch.title")),1)]),content:P(()=>[o("div",$e,[S(ne),S(he),m.value?(a(),K(Re,{key:0,class:"flex-none"})):_("",!0),f.value.length>0&&!m.value?(a(),r("div",Ce,y(p(n)("geosearch.serviceError",{services:f.value.join(", ")})),1)):_("",!0),g.value&&b.value.length===0&&!m.value?(a(),r("div",Me,[o("span",Se,[T(y(p(n)("geosearch.noResults")),1),o("span",Ae,'"'+y(g.value)+'"',1)])])):_("",!0),b.value.length>0?k((a(),r("ul",ze,[(a(!0),r(z,null,V(b.value,(l,B)=>(a(),r("li",{class:"relative h-56",key:B},[k((a(),r("button",{type:"button",class:"absolute inset-0 h-full w-full hover:bg-gray-300 default-focus-style",onClick:He=>e(l),style:{"border-bottom":"1px solid lightgray"},"truncate-trigger":""},[o("div",je,[k((a(),r("div",Ge,[o("span",{innerHTML:u(l.name,l.location.province)},null,8,Ke),l.location.province?(a(),r("span",Pe,y(l.location.city?" "+l.location.city+", "+l.location.province.abbr:" "+l.location.province.abbr),1)):_("",!0),l.type?(a(),r("span",Ie,"; ")):_("",!0),l.type?(a(),r("span",qe,[w[0]||(w[0]=o("br",null,null,-1)),T(y(l.type),1)])):_("",!0)])),[[h,{externalTrigger:!0,options:{placement:"top-start"}}]])])],8,Ve)),[[s,"show-truncate"]])]))),128))])),[[L]]):_("",!0),S(we,{class:"mt-auto"})])]),_:1},8,["panel"])}}});export{Ue as default};
