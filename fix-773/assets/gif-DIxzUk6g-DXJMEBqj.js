import{$ as J}from"./main-D8UjLOIQ.js";var D,w={},G={},x={};function $(){if(D)return x;D=1,Object.defineProperty(x,"__esModule",{value:!0}),x.loop=x.conditional=x.parse=void 0;var g=function a(s,o){var u=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},c=arguments.length>3&&arguments[3]!==void 0?arguments[3]:u;if(Array.isArray(o))o.forEach(function(h){return a(s,h,u,c)});else if(typeof o=="function")o(s,u,c,a);else{var l=Object.keys(o)[0];Array.isArray(o[l])?(c[l]={},a(s,o[l],u,c[l])):c[l]=o[l](s,u,c,a)}return u};x.parse=g;var d=function(a,s){return function(o,u,c,l){s(o,u,c)&&l(o,a,u,c)}};x.conditional=d;var t=function(a,s){return function(o,u,c,l){for(var h=[],e=o.pos;s(o,u,c);){var r={};if(l(o,a,u,r),o.pos===e)break;e=o.pos,h.push(r)}return h}};return x.loop=t,x}var O,T,v={};function H(){if(O)return v;O=1,Object.defineProperty(v,"__esModule",{value:!0}),v.readBits=v.readArray=v.readUnsigned=v.readString=v.peekBytes=v.readBytes=v.peekByte=v.readByte=v.buildStream=void 0;var g=function(e){return{data:e,pos:0}};v.buildStream=g;var d=function(){return function(e){return e.data[e.pos++]}};v.readByte=d;var t=function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;return function(r){return r.data[r.pos+e]}};v.peekByte=t;var a=function(e){return function(r){return r.data.subarray(r.pos,r.pos+=e)}};v.readBytes=a;var s=function(e){return function(r){return r.data.subarray(r.pos,r.pos+e)}};v.peekBytes=s;var o=function(e){return function(r){return Array.from(a(e)(r)).map(function(n){return String.fromCharCode(n)}).join("")}};v.readString=o;var u=function(e){return function(r){var n=a(2)(r);return e?(n[1]<<8)+n[0]:(n[0]<<8)+n[1]}};v.readUnsigned=u;var c=function(e,r){return function(n,i,f){for(var y=typeof r=="function"?r(n,i,f):r,p=a(e),m=new Array(y),B=0;B<y;B++)m[B]=p(n);return m}};v.readArray=c;var l=function(e,r,n){for(var i=0,f=0;f<n;f++)i+=e[r+f]&&Math.pow(2,n-f-1);return i},h=function(e){return function(r){for(var n=d()(r),i=new Array(8),f=0;f<8;f++)i[7-f]=!!(n&1<<f);return Object.keys(e).reduce(function(y,p){var m=e[p];return m.length?y[p]=l(i,m.index,m.length):y[p]=i[m.index],y},{})}};return v.readBits=h,v}function L(){return T||(T=1,function(g){Object.defineProperty(g,"__esModule",{value:!0}),g.default=void 0;var d=$(),t=H(),a={blocks:function(e){for(var r=0,n=[],i=e.data.length,f=0,y=(0,t.readByte)()(e);y!==r&&y;y=(0,t.readByte)()(e)){if(e.pos+y>=i){var p=i-e.pos;n.push((0,t.readBytes)(p)(e)),f+=p;break}n.push((0,t.readBytes)(y)(e)),f+=y}for(var m=new Uint8Array(f),B=0,b=0;b<n.length;b++)m.set(n[b],B),B+=n[b].length;return m}},s=(0,d.conditional)({gce:[{codes:(0,t.readBytes)(2)},{byteSize:(0,t.readByte)()},{extras:(0,t.readBits)({future:{index:0,length:3},disposal:{index:3,length:3},userInput:{index:6},transparentColorGiven:{index:7}})},{delay:(0,t.readUnsigned)(!0)},{transparentColorIndex:(0,t.readByte)()},{terminator:(0,t.readByte)()}]},function(e){var r=(0,t.peekBytes)(2)(e);return r[0]===33&&r[1]===249}),o=(0,d.conditional)({image:[{code:(0,t.readByte)()},{descriptor:[{left:(0,t.readUnsigned)(!0)},{top:(0,t.readUnsigned)(!0)},{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{lct:(0,t.readBits)({exists:{index:0},interlaced:{index:1},sort:{index:2},future:{index:3,length:2},size:{index:5,length:3}})}]},(0,d.conditional)({lct:(0,t.readArray)(3,function(e,r,n){return Math.pow(2,n.descriptor.lct.size+1)})},function(e,r,n){return n.descriptor.lct.exists}),{data:[{minCodeSize:(0,t.readByte)()},a]}]},function(e){return(0,t.peekByte)()(e)===44}),u=(0,d.conditional)({text:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{preData:function(e,r,n){return(0,t.readBytes)(n.text.blockSize)(e)}},a]},function(e){var r=(0,t.peekBytes)(2)(e);return r[0]===33&&r[1]===1}),c=(0,d.conditional)({application:[{codes:(0,t.readBytes)(2)},{blockSize:(0,t.readByte)()},{id:function(e,r,n){return(0,t.readString)(n.blockSize)(e)}},a]},function(e){var r=(0,t.peekBytes)(2)(e);return r[0]===33&&r[1]===255}),l=(0,d.conditional)({comment:[{codes:(0,t.readBytes)(2)},a]},function(e){var r=(0,t.peekBytes)(2)(e);return r[0]===33&&r[1]===254}),h=[{header:[{signature:(0,t.readString)(3)},{version:(0,t.readString)(3)}]},{lsd:[{width:(0,t.readUnsigned)(!0)},{height:(0,t.readUnsigned)(!0)},{gct:(0,t.readBits)({exists:{index:0},resolution:{index:1,length:3},sort:{index:4},size:{index:5,length:3}})},{backgroundColorIndex:(0,t.readByte)()},{pixelAspectRatio:(0,t.readByte)()}]},(0,d.conditional)({gct:(0,t.readArray)(3,function(e,r){return Math.pow(2,r.lsd.gct.size+1)})},function(e,r){return r.lsd.gct.exists}),{frames:(0,d.loop)([s,c,l,o,u],function(e){var r=(0,t.peekByte)()(e);return r===33||r===44})}];g.default=h}(G)),G}var P,I={};function N(){if(P)return I;P=1,Object.defineProperty(I,"__esModule",{value:!0}),I.deinterlace=void 0;var g=function(d,t){for(var a=new Array(d.length),s=d.length/t,o=function(r,n){var i=d.slice(n*t,(n+1)*t);a.splice.apply(a,[r*t,t].concat(i))},u=[0,4,2,1],c=[8,8,4,2],l=0,h=0;h<4;h++)for(var e=u[h];e<s;e+=c[h])o(e,l),l++;return a};return I.deinterlace=g,I}var R,E,S={};function Q(){if(R)return S;R=1,Object.defineProperty(S,"__esModule",{value:!0}),S.lzw=void 0;var g=function(d,t,a){var s,o,u,c,l,h,e,r,n,i,f,y,p,m,B,b,k=4096,C=-1,j=a,F=new Array(a),M=new Array(k),A=new Array(k),U=new Array(k+1);for(l=(o=1<<(i=d))+1,s=o+2,e=C,u=(1<<(c=i+1))-1,r=0;r<o;r++)M[r]=0,A[r]=r;for(f=y=p=m=B=b=0,n=0;n<j;){if(m===0){if(y<c){f+=t[b]<<y,y+=8,b++;continue}if(r=f&u,f>>=c,y-=c,r>s||r==l)break;if(r==o){u=(1<<(c=i+1))-1,s=o+2,e=C;continue}if(e==C){U[m++]=A[r],e=r,p=r;continue}for(h=r,r==s&&(U[m++]=p,r=e);r>o;)U[m++]=A[r],r=M[r];p=255&A[r],U[m++]=p,s<k&&(M[s]=e,A[s]=p,!(++s&u)&&s<k&&(c++,u+=s)),e=h}m--,F[B++]=U[m],n++}for(n=B;n<j;n++)F[n]=0;return F};return S.lzw=g,S}function W(){if(E)return w;E=1,Object.defineProperty(w,"__esModule",{value:!0}),w.decompressFrames=w.decompressFrame=w.parseGIF=void 0;var g=o(L()),d=$(),t=H(),a=N(),s=Q();function o(e){return e&&e.__esModule?e:{default:e}}var u=function(e){var r=new Uint8Array(e);return(0,d.parse)((0,t.buildStream)(r),g.default)};w.parseGIF=u;var c=function(e){for(var r=e.pixels.length,n=new Uint8ClampedArray(4*r),i=0;i<r;i++){var f=4*i,y=e.pixels[i],p=e.colorTable[y]||[0,0,0];n[f]=p[0],n[f+1]=p[1],n[f+2]=p[2],n[f+3]=y!==e.transparentIndex?255:0}return n},l=function(e,r,n){if(e.image){var i=e.image,f=i.descriptor.width*i.descriptor.height,y=(0,s.lzw)(i.data.minCodeSize,i.data.blocks,f);i.descriptor.lct.interlaced&&(y=(0,a.deinterlace)(y,i.descriptor.width));var p={pixels:y,dims:{top:e.image.descriptor.top,left:e.image.descriptor.left,width:e.image.descriptor.width,height:e.image.descriptor.height}};return i.descriptor.lct&&i.descriptor.lct.exists?p.colorTable=i.lct:p.colorTable=r,e.gce&&(p.delay=10*(e.gce.delay||10),p.disposalType=e.gce.extras.disposal,e.gce.extras.transparentColorGiven&&(p.transparentIndex=e.gce.transparentColorIndex)),n&&(p.patch=c(p)),p}console.warn("gif frame does not have associated image.")};w.decompressFrame=l;var h=function(e,r){return e.frames.filter(function(n){return n.image}).map(function(n){return l(n,e.gct,r)})};return w.decompressFrames=h,w}var q=W();let _,z,V;function X(g,d){return _??=document.createElement("canvas"),_.width=g,_.height=d,_.getContext("2d",{willReadFrequently:!0})}async function re(g,d){const t=q.parseGIF(g),a=q.decompressFrames(t,!0),{width:s,height:o}=t.lsd,u=X(s,o),c=[],l=[];let h=0;for(const e of a){const r=J(e.delay||100);l.push(r),h+=r;const n=Y(new ImageData(e.patch,e.dims.width,e.dims.height)),i=e.disposalType===3?u.getImageData(e.dims.left,e.dims.top,e.dims.width,e.dims.height):void 0;u.drawImage(n,e.dims.left,e.dims.top);const f=u.getImageData(0,0,s,o);c.push(f),e.disposalType===1||(e.disposalType===2?u.clearRect(e.dims.left,e.dims.top,e.dims.width,e.dims.height):e.disposalType===3&&u.putImageData(i,e.dims.left,e.dims.top))}return{frameCount:a.length,duration:h,frameDurations:l,getFrame:e=>c[e],width:s,height:o}}function Y(g){return z??=document.createElement("canvas"),V??=z.getContext("2d",{willReadFrequently:!0}),z.width=g.width,z.height=g.height,V.putImageData(g,0,0),z}const Z=[71,73,70];function K(g){const d=new Uint8Array(g);return!Z.some((t,a)=>t!==d[a])}function te(g){if(!K(g))return!1;const d=new DataView(g),t=d.getUint8(10);let a=13+(128&t?3*2**(1+(7&t)):0),s=0,o=!1;for(;!o;){switch(d.getUint8(a++)){case 33:if(!u())return!1;break;case 44:c();break;case 59:o=!0;break;default:return!1}if(s>1)return!0}function u(){switch(d.getUint8(a++)){case 249:l();break;case 1:h();break;case 254:e();break;case 255:r();break;default:return!1}return!0}function c(){s++,a+=8;const i=d.getUint8(a++);a+=128&i?3*2**(1+(7&i)):0,a++,n()}function l(){a++,a+=4,n()}function h(){s++,a++,a+=12,n()}function e(){n()}function r(){a++,a+=8,a+=3,n()}function n(){let i;for(;i=d.getUint8(a++);)a+=i}return!1}export{te as isAnimatedGIF,K as isGIF,re as parseGif};
