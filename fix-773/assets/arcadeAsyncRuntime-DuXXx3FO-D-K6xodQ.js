import{n as W,v as g,_ as U,U as q,G as b,P as m,Y as N,e as Z,t as w,I as p,a as _,j as v,d as j,b as k,Q as E,K as Y,H as T,N as f,p as $,m as pt,c as wt,$ as H,r as dt,f as P,s as K,g as ht,h as gt}from"./aiServices-u5nRiq9H-Dfd8u3BD.js";import{s as Q,o as mt,D as J,x as yt,E as bt,j as vt,p as St,C as xt,f as It,y as Ft,a as X,d as G,b as Mt}from"./arcade-BoHTeCSG-BxKTtX2e.js";import{l as i,r as l,b as tt}from"./enum-g1DWyQyu-C22wI6Gv.js";import{registerFunctions as Ot}from"./geomasync-NLITDMmB-B-VPC_Eh.js";import{aL as et,cd as $t,G as F,j as C,k as d,aE as V,l as O}from"./main-D8UjLOIQ.js";import"./TimeOnly-CGkId3bj-BgQ9WVmM.js";import"./UnknownTimeZone-DxjyzFvs-DtNVLQoo.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-DttuBH5Z-B1MkhdGZ.js";import"./Field-BIQ-quF4-BPjMRpni.js";import"./fieldType-PhcL4ff8-B7j5aTWg.js";import"./number-mnL_JN3f-OAAcMkOv.js";import"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import"./utils-BO8hgPs3-CT_Uv3UC.js";import"./featureConversionUtils-Bjjlcfdo-BL25e0Vn.js";import"./OptimizedFeature-mIz_HhJg-D48m52Jl.js";import"./memoryEstimations-DeWfxwaV-DpFMiS4z.js";import"./OptimizedGeometry-pzfNw1AT-BMGedq_M.js";import"./OptimizedFeatureSet-Dz5hF8Qm-CgsRgxJh.js";import"./FieldsIndex-Bt0Y8aWr-DcDROz7E.js";import"./timeZoneUtils-d5p0Jda1-BeP90iup.js";import"./WhereClause-D4rZJkVN-Bi-135nj.js";import"./unitConversion-BxD3RA9Y--0IbSiek.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./portalUtils-COohlq76-CL5gSea4.js";import"./operatorsWorkerConnection-TmW3NQ3Q-BOhyH2qJ.js";import"./workers-CeRXsnNJ-D6z4uDiD.js";import"./Queue-DV3gpSdl-Dg8OZOjE.js";import"./intl-BAA1onnp-D6KfQGxz.js";async function rt(e,t){const r=[];for(let a=0;a<t.arguments.length;a++)r.push(await u(e,t.arguments[a]));return r}async function I(e,t,r){return t.preparsed===!0?r(e,null,t.arguments):r(e,t,await rt(e,t))}class kt extends dt{constructor(t,r){super(),this.definition=null,this.context=null,this.definition=t,this.context=r}createFunction(t){return(...r)=>{const a={spatialReference:this.context.spatialReference,console:this.context.console,lrucache:this.context.lrucache,timeZone:this.context.timeZone??null,exports:this.context.exports,libraryResolver:this.context.libraryResolver,interceptor:this.context.interceptor,services:this.context.services,abortSignal:this.context.abortSignal,localScope:{},depthCounter:{depth:t.depthCounter+1},globalScope:this.context.globalScope};if(a.depthCounter.depth>64)throw new i(t,l.MaximumCallDepth,null);return A(this.definition,a,r,null)}}call(t,r){return B(t,r,(a,o,n)=>{const s={spatialReference:t.spatialReference,services:t.services,console:t.console,libraryResolver:t.libraryResolver,exports:t.exports,lrucache:t.lrucache,timeZone:t.timeZone??null,interceptor:t.interceptor,localScope:{},abortSignal:t.abortSignal,globalScope:t.globalScope,depthCounter:{depth:t.depthCounter.depth+1}};if(s.depthCounter.depth>64)throw new i(t,l.MaximumCallDepth,r);return A(this.definition,s,n,r)})}marshalledCall(t,r,a,o){return o(t,r,async(n,s,c)=>{const S={spatialReference:t.spatialReference,services:t.services,globalScope:a.globalScope,depthCounter:{depth:t.depthCounter.depth+1},libraryResolver:t.libraryResolver,exports:t.exports,console:t.console,abortSignal:t.abortSignal,lrucache:t.lrucache,timeZone:t.timeZone??null,interceptor:t.interceptor,localScope:{}};return c=c.map(y=>!b(y)||y instanceof K?y:P(y,t,o)),P(await A(this.definition,S,c,r),a,o)})}}async function A(e,t,r,a){const o=e.body;if(r.length!==e.params.length)throw new i(t,l.WrongNumberOfParameters,null);for(let s=0;s<r.length;s++){const c=e.params[s];c.type==="Identifier"&&t.localScope!=null&&(t.localScope[w(c)]={value:r[s]})}const n=await h(t,o);if(n instanceof g)return n.value;if(n===m)throw new i(t,l.UnexpectedToken,a);if(n===N)throw new i(t,l.UnexpectedToken,a);return n instanceof U?n.value:n}class M extends ht{constructor(t){super(),this.source=t}global(t){const r=this.executingContext.globalScope[w(t)];if(b(r.value)&&!(r.value instanceof K)){const a=new K;return a.fn=r.value,a.parameterEvaluator=B,a.context=this.executingContext,this.executingContext.globalScope[w(t)]={value:a},a}return r.value}setGlobal(t,r){if(b(r))throw new i(null,l.AssignModuleFunction,null);this.executingContext.globalScope[w(t)]={value:r}}hasGlobal(t){return this.executingContext.exports[t]===void 0&&(t=w(t)),this.executingContext.exports[t]!==void 0}async loadModule(t){const r=t.spatialReference??et.WebMercator;this.moduleScope=ut(null,null,t.timeZone),this.executingContext={spatialReference:r,services:t.services,libraryResolver:new Q(t.libraryResolver._moduleSingletons,this.source.syntax.loadedModules),exports:{},abortSignal:t.abortSignal??W,globalScope:this.moduleScope,console:t.console??ft,lrucache:t.lrucache,timeZone:t.timeZone??null,interceptor:t.interceptor,localScope:null,depthCounter:{depth:1}},await D(this.executingContext,this.source.syntax)}}async function B(e,t,r){return t.preparsed===!0?r(e,null,t.arguments):r(e,t,await rt(e,t))}async function u(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case"UpdateExpression":return await Kt(e,t);case"AssignmentExpression":return await Gt(e,t);case"TemplateLiteral":return await Qt(e,t);case"Identifier":return L(e,t);case"MemberExpression":return await zt(e,t);case"Literal":return t.value;case"CallExpression":return await Ht(e,t);case"UnaryExpression":return await Wt(e,t);case"BinaryExpression":return await Yt(e,t);case"LogicalExpression":return await Tt(e,t);case"ArrayExpression":return await _t(e,t);case"ObjectExpression":return await Ct(e,t);default:throw new i(e,l.Unrecognized,t)}}catch(r){throw tt(e,t,r)}}async function h(e,t){t.breakpoint&&await t.breakpoint();try{switch(t.type){case"ImportDeclaration":return await qt(e,t);case"ExportNamedDeclaration":return await Pt(e,t);case"VariableDeclaration":return await it(e,t,0);case"BlockStatement":return await D(e,t);case"FunctionDeclaration":return await Lt(e,t);case"ReturnStatement":return await Dt(e,t);case"IfStatement":return await Zt(e,t);case"ExpressionStatement":return await Ut(e,t);case"ForStatement":return await Et(e,t);case"WhileStatement":return await Rt(e,t);case"ForInStatement":return await At(e,t);case"ForOfStatement":return await jt(e,t);case"BreakStatement":return m;case"EmptyStatement":return p;case"ContinueStatement":return N;default:throw new i(e,l.Unrecognized,t)}}catch(r){throw tt(e,t,r)}}async function Ct(e,t){const r=[];for(let s=0;s<t.properties.length;s++){const c=t.properties[s],S=await u(e,c.value),y=c.key.type==="Identifier"?c.key.name:await u(e,c.key);r[s]={key:y,value:S}}const a=Object.create(null),o=new Map;for(let s=0;s<r.length;s++){const c=r[s];if(b(c.value))throw new i(e,l.NoFunctionInDictionary,t);if(d(c.key)===!1)throw new i(e,l.KeyMustBeString,t);let S=c.key.toString();const y=S.toLowerCase();o.has(y)?S=o.get(y):o.set(y,S),c.value===p?a[S]=null:a[S]=c.value}const n=new v(a);return n.immutable=!1,n}async function Rt(e,t){let r=await u(e,t.test);if(r===!1)return p;if(r!==!0)throw new i(e,l.BooleanConditionRequired,t);for(;r===!0;){const a=await h(e,t.body);if(a===m)break;if(a instanceof g)return a;if(r=await u(e,t.test),r!==!0&&r!==!1)throw new i(e,l.BooleanConditionRequired,t)}return p}async function Et(e,t){try{for(t.init!==null&&(t.init.type==="VariableDeclaration"?await h(e,t.init):await u(e,t.init));;){if(t.test!==null){const a=await u(e,t.test);if(e.abortSignal?.aborted===!0)throw new i(e,l.Cancelled,t);if(a===!1)break;if(a!==!0)throw new i(e,l.BooleanConditionRequired,t)}const r=await h(e,t.body);if(r===m)break;if(r instanceof g)return r;t.update!==null&&await u(e,t.update)}return p}catch(r){throw r}}async function R(e,t,r,a,o="i"){const n=r.length;for(let s=0;s<n;s++){if(o==="k"){if(s>=r.length)throw new i(e,l.OutOfBounds,t);a.value=r[s]}else a.value=s;const c=await h(e,t.body);if(c===m)break;if(c instanceof g)return c}return p}async function at(e,t,r,a,o="i"){const n=r.length();for(let s=0;s<n;s++){a.value=o==="k"?r.get(s):s;const c=await h(e,t.body);if(c===m)break;if(c instanceof g)return c}return p}async function ot(e,t,r,a){const o=r.iterator(e.abortSignal);let n;for(;(n=await o.next())!=null;){const s=J.createFromGraphicLikeObject(n.geometry,n.attributes,r,e.timeZone);s._underlyingGraphic=n,a.value=s;const c=await h(e,t.body);if(c===m)break;if(c instanceof g)return c}return p}async function Nt(e,t,r,a){for(const o of r.keys()){const n=r.field(o);a.value=v.containerEntry(o,n);const s=await h(e,t.body);if(s===m)break;if(s instanceof g)return s}return p}async function Bt(e,t,r,a){for(const o of X(r)){const n=G(r,o,e,t,1);a.value=v.containerEntry(o,n);const s=await h(e,t.body);if(s===m)break;if(s instanceof g)return s}return p}async function At(e,t){const r=await u(e,t.right);t.left.type==="VariableDeclaration"&&await h(e,t.left);const a=w(t.left.type==="VariableDeclaration"?t.left.declarations[0].id:t.left);let o=null;if(e.localScope!=null&&e.localScope[a]!==void 0&&(o=e.localScope[a]),o===null&&e.globalScope[a]!==void 0){const n=e.globalScope[a].value;o=e.globalScope[a]={value:n}}if(o===null)throw new i(e,l.InvalidIdentifier,t);return C(r)||d(r)?await R(e,t,r,o):k(r)?await at(e,t,r,o):r instanceof v||E(r)?await R(e,t,r.keys(),o,"k"):Y(r)?await ot(e,t,r,o):T(r)?await R(e,t,X(r),o,"k"):p}async function jt(e,t){const r=await u(e,t.right);t.left.type==="VariableDeclaration"&&await h(e,t.left);const a=w(t.left.type==="VariableDeclaration"?t.left.declarations[0].id:t.left);let o=null;if(e.localScope!=null&&e.localScope[a]!==void 0&&(o=e.localScope[a]),o===null&&e.globalScope[a]!==void 0){const n=e.globalScope[a].value;o=e.globalScope[a]={value:n}}if(o===null)throw new i(e,l.InvalidIdentifier,t);return C(r)||d(r)?await R(e,t,r,o,"k"):k(r)?await at(e,t,r,o,"k"):r instanceof v||E(r)?await Nt(e,t,r,o):Y(r)?await ot(e,t,r,o):T(r)?await Bt(e,t,r,o):p}async function Kt(e,t){const r=t.argument;if(r.type==="CallExpression")throw new i(e,l.NeverReach,t);if(r.type==="MemberExpression"){const n=await u(e,r.object);let s,c;if(r.computed===!0)s=await u(e,r.property);else{if(r.property.type!=="Identifier")throw new i(e,l.Unrecognized,t);s=r.property.name}if(C(n)){if(!O(s))throw new i(e,l.ArrayAccessorMustBeNumber,t);if(s<0&&(s=n.length+s),s<0||s>=n.length)throw new i(e,l.OutOfBounds,t);c=f(n[s]),n[s]=t.operator==="++"?c+1:c-1}else if(n instanceof v){if(d(s)===!1)throw new i(e,l.KeyAccessorMustBeString,t);if(n.hasField(s)!==!0)throw new i(e,l.FieldNotFound,t,{key:s});c=f(n.field(s)),n.setField(s,t.operator==="++"?c+1:c-1)}else if(n instanceof M){if(d(s)===!1)throw new i(e,l.ModuleAccessorMustBeString,t);if(n.hasGlobal(s)!==!0)throw new i(e,l.ModuleExportNotFound,t);c=f(n.global(s)),n.setGlobal(s,t.operator==="++"?c+1:c-1)}else{if(!H(n))throw k(n)?new i(e,l.Immutable,t):new i(e,l.InvalidParameter,t);if(d(s)===!1)throw new i(e,l.KeyAccessorMustBeString,t);if(n.hasField(s)!==!0)throw new i(e,l.FieldNotFound,t,{key:s});c=f(n.field(s)),n.setField(s,t.operator==="++"?c+1:c-1)}return t.prefix===!1?c:t.operator==="++"?c+1:c-1}const a=w(r);let o;if(e.localScope!=null&&e.localScope[a]!==void 0)return o=f(e.localScope[a].value),e.localScope[a]={value:t.operator==="++"?o+1:o-1},t.prefix===!1?o:t.operator==="++"?o+1:o-1;if(e.globalScope[a]!==void 0)return o=f(e.globalScope[a].value),e.globalScope[a]={value:t.operator==="++"?o+1:o-1},t.prefix===!1?o:t.operator==="++"?o+1:o-1;throw new i(e,l.InvalidIdentifier,t)}function x(e,t,r,a,o){switch(t){case"=":return e===p?null:e;case"/=":return f(r)/f(e);case"*=":return f(r)*f(e);case"-=":return f(r)-f(e);case"+=":return d(r)||d(e)?$(r)+$(e):f(r)+f(e);case"%=":return f(r)%f(e);default:throw new i(o,l.UnsupportedOperator,a)}}async function Gt(e,t){const r=t.left;if(r.type==="MemberExpression"){const o=await u(e,r.object);let n;if(r.computed===!0)n=await u(e,r.property);else{if(r.property.type!=="Identifier")throw new i(e,l.InvalidIdentifier,t);n=r.property.name}const s=await u(e,t.right);if(C(o)){if(!O(n))throw new i(e,l.ArrayAccessorMustBeNumber,t);if(n<0&&(n=o.length+n),n<0||n>o.length)throw new i(e,l.OutOfBounds,t);if(n===o.length){if(t.operator!=="=")throw new i(e,l.OutOfBounds,t);o[n]=x(s,t.operator,o[n],t,e)}else o[n]=x(s,t.operator,o[n],t,e)}else if(o instanceof v){if(d(n)===!1)throw new i(e,l.KeyAccessorMustBeString,t);if(o.hasField(n)===!0)o.setField(n,x(s,t.operator,o.field(n),t,e));else{if(t.operator!=="=")throw new i(e,l.FieldNotFound,t,{key:n});o.setField(n,x(s,t.operator,null,t,e))}}else if(o instanceof M){if(d(n)===!1)throw new i(e,l.KeyAccessorMustBeString,t);if(o.hasGlobal(n)!==!0)throw new i(e,l.ModuleExportNotFound,t);o.setGlobal(n,x(s,t.operator,o.global(n),t,e))}else{if(!H(o))throw k(o)?new i(e,l.Immutable,t):new i(e,l.InvalidParameter,t);if(d(n)===!1)throw new i(e,l.KeyAccessorMustBeString,t);if(o.hasField(n)===!0)o.setField(n,x(s,t.operator,o.field(n),t,e));else{if(t.operator!=="=")throw new i(e,l.FieldNotFound,t,{key:n});o.setField(n,x(s,t.operator,null,t,e))}}return p}const a=w(r);if(e.localScope!=null&&e.localScope[a]!==void 0){const o=await u(e,t.right);return e.localScope[a]={value:x(o,t.operator,e.localScope[a].value,t,e)},p}if(e.globalScope[a]!==void 0){const o=await u(e,t.right);return e.globalScope[a]={value:x(o,t.operator,e.globalScope[a].value,t,e)},p}throw new i(e,l.InvalidIdentifier,t)}async function Ut(e,t){const r=await u(e,t.expression);return r===p?p:new U(r)}async function Zt(e,t){const r=await u(e,t.test);if(r===!0)return h(e,t.consequent);if(r===!1)return t.alternate!==null?h(e,t.alternate):p;throw new i(e,l.BooleanConditionRequired,t)}async function D(e,t){return nt(e,t,0)}async function nt(e,t,r){if(r>=t.body.length)return p;const a=await h(e,t.body[r]);return a instanceof g||a===m||a===N||r===t.body.length-1?a:nt(e,t,r+1)}async function Dt(e,t){if(t.argument===null)return new g(p);const r=await u(e,t.argument);return new g(r)}async function Lt(e,t){const r=w(t.id);return e.globalScope[r]={value:new kt(t,e)},p}async function qt(e,t){const r=w(t.specifiers[0].local),a=e.libraryResolver.loadLibrary(r);let o;return e.libraryResolver._moduleSingletons?.has(a.uri)?o=e.libraryResolver._moduleSingletons.get(a.uri):(o=new M(a),await o.loadModule(e),e.libraryResolver._moduleSingletons?.set(a.uri,o)),e.globalScope[r]={value:o},p}async function Pt(e,t){if(await h(e,t.declaration),t.declaration.type==="FunctionDeclaration")e.exports[w(t.declaration.id)]="function";else if(t.declaration.type==="VariableDeclaration")for(const r of t.declaration.declarations)e.exports[w(r.id)]="variable";return p}async function it(e,t,r){return r>=t.declarations.length?p:(await Vt(e,t.declarations[r]),r===t.declarations.length-1||await it(e,t,r+1),p)}async function Vt(e,t){let r=null;if(r=t.init===null?null:await u(e,t.init),e.localScope!==null){if(r===p&&(r=null),t.id.type!=="Identifier")throw new i(e,l.InvalidIdentifier,t);const o=w(t.id);return void(e.localScope!=null&&(e.localScope[o]={value:r}))}if(t.id.type!=="Identifier")throw new i(e,l.InvalidIdentifier,t);const a=w(t.id);r===p&&(r=null),e.globalScope[a]={value:r}}async function zt(e,t){const r=await u(e,t.object);if(r===null)throw new i(e,l.MemberOfNull,t);if(t.computed===!1){if(t.property.type==="Identifier"){if(r instanceof v||E(r))return r.field(t.property.name);if(r instanceof V)return G(r,t.property.name,e,t);if(r instanceof M){if(!r.hasGlobal(t.property.name))throw new i(e,l.InvalidIdentifier,t);return r.global(t.property.name)}throw new i(e,l.InvalidMemberAccessKey,t)}throw new i(e,l.InvalidMemberAccessKey,t)}let a=await u(e,t.property);if(r instanceof v||E(r)){if(d(a))return r.field(a);throw new i(e,l.InvalidMemberAccessKey,t)}if(r instanceof M){if(d(a))return r.global(a);throw new i(e,l.InvalidMemberAccessKey,t)}if(r instanceof V){if(d(a))return G(r,a,e,t);throw new i(e,l.InvalidMemberAccessKey,t)}if(C(r)){if(O(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=r.length+a),a>=r.length||a<0)throw new i(e,l.OutOfBounds,t);return r[a]}throw new i(e,l.InvalidMemberAccessKey,t)}if(k(r)){if(O(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=r.length()+a),a>=r.length()||a<0)throw new i(e,l.OutOfBounds,t);return r.get(a)}throw new i(e,l.InvalidMemberAccessKey,t)}if(d(r)){if(O(a)&&isFinite(a)&&Math.floor(a)===a){if(a<0&&(a=r.length+a),a>=r.length||a<0)throw new i(e,l.OutOfBounds,t);return r[a]}throw new i(e,l.InvalidMemberAccessKey,t)}throw new i(e,l.InvalidMemberAccessKey,t)}async function Wt(e,t){const r=await u(e,t.argument);if(F(r)){if(t.operator==="!")return!r;if(t.operator==="-")return-1*f(r);if(t.operator==="+")return 1*f(r);if(t.operator==="~")return~f(r);throw new i(e,l.UnsupportedUnaryOperator,t)}if(t.operator==="-")return-1*f(r);if(t.operator==="+")return 1*f(r);if(t.operator==="~")return~f(r);throw new i(e,l.UnsupportedUnaryOperator,t)}async function _t(e,t){const r=[];for(let a=0;a<t.elements.length;a++)r.push(await u(e,t.elements[a]));for(let a=0;a<r.length;a++){if(b(r[a]))throw new i(e,l.NoFunctionInArray,t);r[a]===p&&(r[a]=null)}return r}async function Yt(e,t){const r=await u(e,t.left),a=await u(e,t.right);switch(t.operator){case"|":case"<<":case">>":case">>>":case"^":case"&":return wt(f(r),f(a),t.operator);case"==":return j(r,a);case"!=":return!j(r,a);case"<":case">":case"<=":case">=":return pt(r,a,t.operator);case"+":return d(r)||d(a)?$(r)+$(a):f(r)+f(a);case"-":return f(r)-f(a);case"*":return f(r)*f(a);case"/":return f(r)/f(a);case"%":return f(r)%f(a);default:throw new i(e,l.UnsupportedOperator,t)}}async function Tt(e,t){const r=await u(e,t.left);if(!F(r))throw new i(e,l.LogicalExpressionOnlyBoolean,t);switch(t.operator){case"||":{if(r===!0)return r;const a=await u(e,t.right);if(F(a))return a;throw new i(e,l.LogicExpressionOrAnd,t)}case"&&":{if(r===!1)return r;const a=await u(e,t.right);if(F(a))return a;throw new i(e,l.LogicExpressionOrAnd,t)}default:throw new i(e,l.LogicExpressionOrAnd,t)}}function L(e,t){const r=w(t);if(e.localScope!=null&&e.localScope[r]!==void 0)return e.localScope[r].value;if(e.globalScope[r]!==void 0)return e.globalScope[r].value;throw new i(e,l.InvalidIdentifier,t)}async function Ht(e,t){if(t.callee.type==="MemberExpression"){const a=await u(e,t.callee.object);if(!(a instanceof M))throw new i(e,l.FunctionNotFound,t);const o=t.callee.computed===!1?t.callee.property.name:await u(e,t.callee.property);if(!a.hasGlobal(o))throw new i(e,l.FunctionNotFound,t);const n=a.global(o);if(!b(n))throw new i(e,l.CallNonFunction,t);return n.call(e,t)}if(t.callee.type!=="Identifier")throw new i(e,l.FunctionNotFound,t);const r=w(t.callee);if(e.localScope!=null&&e.localScope[r]!==void 0){const a=e.localScope[r];if(b(a.value))return a.value.call(e,t);throw new i(e,l.CallNonFunction,t)}if(e.globalScope[r]!==void 0){const a=e.globalScope[r];if(b(a.value))return a.value.call(e,t);throw new i(e,l.CallNonFunction,t)}throw new i(e,l.FunctionNotFound,t)}async function Qt(e,t){let r="",a=0;for(const o of t.quasis)if(r+=o.value?o.value.cooked:"",o.tail===!1){if(t.expressions[a]){const n=await u(e,t.expressions[a]);if(b(n))throw new i(e,l.NoFunctionInTemplateLiteral,t);r+=$(n)}a++}return r}async function Jt(e,t){_(t.arguments===null?[]:t.arguments,3,3,e,t);const r=await u(e,t.arguments[0]);if(F(r)===!1)throw new i(e,l.BooleanConditionRequired,t);return u(e,r?t.arguments[1]:t.arguments[2])}async function Xt(e,t){_(t.arguments===null?[]:t.arguments,2,3,e,t);const r=await u(e,t.arguments[0]);if(t.arguments.length===3){const a=await u(e,t.arguments[1]),o=Ft(r,a);return o!=null&&o!==""?o:u(e,t.arguments[2])}return r==null||r===""?u(e,t.arguments[1]):r}async function te(e,t){if(t.arguments.length<2)throw new i(e,l.WrongNumberOfParameters,t);if(t.arguments.length===2)return u(e,t.arguments[1]);if((t.arguments.length-1)%2==0)throw new i(e,l.WrongNumberOfParameters,t);return lt(e,t,1,await u(e,t.arguments[0]))}async function lt(e,t,r,a){const o=await u(e,t.arguments[r]);if(j(o,a))return u(e,t.arguments[r+1]);const n=t.arguments.length-r;return n===1?u(e,t.arguments[r]):n===2?null:n===3?u(e,t.arguments[r+2]):lt(e,t,r+2,a)}async function ee(e,t){if(t.arguments.length<3)throw new i(e,l.WrongNumberOfParameters,t);if(t.arguments.length%2==0)throw new i(e,l.WrongNumberOfParameters,t);const r=await u(e,t.arguments[0]);if(F(r)===!1)throw new i(e,l.BooleanConditionRequired,t.arguments[0]);return st(e,t,0,r)}async function st(e,t,r,a){if(a===!0)return u(e,t.arguments[r+1]);if(t.arguments.length-r===3)return u(e,t.arguments[r+2]);const o=await u(e,t.arguments[r+2]);if(F(o)===!1)throw new i(e,l.ModuleExportNotFound,t.arguments[r+2]);return st(e,t,r+2,o)}function re(){const e=Object.create(null);yt(e,I),bt(e,I),vt(e,I,L),St(e,I),xt(e,I),It(e,I),Ot({functions:e,compiled:!1,signatures:null,evaluateIdentifier:null,mode:"async",standardFunction:I,standardFunctionAsync:B}),e.iif=Jt,e.defaultvalue=Xt,e.decode=te,e.when=ee;const t=function(){this.textformatting={value:v.textFormatting()}};t.prototype=Object.create(null),t.prototype.infinity=Object.freeze({value:Number.POSITIVE_INFINITY}),t.prototype.pi=Object.freeze({value:Math.PI});for(const[r,a]of Object.entries(e))t.prototype[r]=Object.freeze({value:new Z(a)});return t}const ct=re();function z(e){const t={mode:"async",compiled:!1,functions:Object.create(null),signatures:[],standardFunction:I,standardFunctionAsync:B,evaluateIdentifier:L};for(let r=0;r<e.length;r++)e[r].registerFunctions(t);for(const[r,a]of Object.entries(t.functions))ct.prototype[r]=Object.freeze({value:new Z(a)});for(let r=0;r<t.signatures.length;r++)mt(t.signatures[r],"async")}function ut(e,t,r){const a=new ct;e==null&&(e={}),t==null&&(t={});for(const o in t)a[o]={value:new Z(t[o])};for(const o in e)a[o]={value:$t(e[o])?J.createFromGraphic(e[o],r):e[o]};return a}function ft(e){console.log(e)}async function Ne(e,t){const r=t.spatialReference??et.WebMercator;let a=null;e.usesModules&&(a=new Q(new Map,e.loadedModules));const o=ut(t.vars,t.customfunctions,t.timeZone),n={spatialReference:r,services:t.services,exports:{},libraryResolver:a,abortSignal:t.abortSignal??W,globalScope:o,console:t.console??ft,timeZone:t.timeZone??null,lrucache:t.lrucache,interceptor:t.interceptor,localScope:null,depthCounter:{depth:1}},s=await D(n,e);if(s instanceof g||s instanceof U){const c=s.value;if(q(c))return null;if(b(c))throw new i(n,l.IllegalResult,null);return c}if(q(s))return null;throw s===m?new i(n,l.IllegalResult,null):s===N?new i(n,l.IllegalResult,null):new i(n,l.NeverReach,null)}z([Mt]),z([gt]);export{Ne as executeScript,z as extend};
