import{a as $,N as m,v as P,G,o as k,Q as W,ba as O,S as J,g as Q}from"./Point2D-CaHJVGk1-DPGpS6fb.js";class T{constructor(t,s,i){if(t instanceof T)return this.data=t.data,this.N=t.N,this.M=t.M,t.data=null,t.N=0,void(t.M=0);this.data=t,this.N=s,this.M=i}assignCopy(t){return this===t||(m(this.N*this.M===t.N*t.M),this.data.set(t.data),this.N=t.N,this.M=t.M),this}setZero(){return this.data?.fill(0),this}setIdentity(){for(let t=0;t<this.N;t++)for(let s=0;s<this.M;s++)this.setRowCol(t,s,t===s?1:0);return this}rows(){return this.N}cols(){return this.M}row(t){return m(0),{}}set(t,s){return this.data[t]=s,this}setRowCol(t,s,i){return this.data[t*this.M+s]=i,this}at(t){return this.data[t]}atRowCol(t,s){return this.data[t*this.M+s]}mulScalar(t,s){m(0)}mul(t,s){if(m(this.M===t.rows()),m(this.N===s.rows()),m(t.cols()===s.cols()),s===this){const o=new Float64Array(this.N*this.M),e=new T(o,this.N,this.M);return this.mul(t,e),void s.assignCopy(e)}if(s===t){const o=new Float64Array(t.N*t.M),e=new T(o,t.N,t.M);return this.mul(t,e),void s.assignCopy(e)}const i=t.cols();for(let o=0;o<this.N;o++)for(let e=0;e<i;e++){let a=0;for(let l=0;l<this.M;l++)a+=this.atRowCol(o,l)*t.atRowCol(l,e);s.setRowCol(o,e,a)}}mulTranspose(t,s){if(m(this.M===t.cols()),m(this.N===s.rows()),m(t.rows()===s.cols()),s===this){const o=new Float64Array(this.N*this.M),e=new T(o,this.N,this.M);return this.mulTranspose(t,e),void s.assignCopy(e)}if(s===t){const o=new Float64Array(t.N*t.M),e=new T(o,t.N,t.M);return this.mulTranspose(t,e),void s.assignCopy(e)}const i=t.rows();for(let o=0;o<this.N;o++)for(let e=0;e<i;e++){let a=0;for(let l=0;l<this.M;l++)a+=this.atRowCol(o,l)*t.atRowCol(e,l);s.setRowCol(o,e,a)}}mulLeft(t,s){m(0)}mulLeftTranspose(t,s){m(0)}mulDiag(t,s){if(m(this.M===t.N*t.M),m(this.N===s.rows()),m(this.M===s.cols()),s===this){const o=new Float64Array(this.N*this.M),e=new T(o,this.N,this.M);return this.mulDiag(t,e),void s.assignCopy(e)}const i=this.M;for(let o=0;o<this.N;o++)for(let e=0;e<i;e++)s.setRowCol(o,e,this.atRowCol(o,e)*t.at(e))}transposeInPlace(){if(this.N===this.M){for(let i=0;i<this.N;i++)for(let o=i+1;o<this.M;o++){const e=this.atRowCol(i,o);this.setRowCol(i,o,this.atRowCol(o,i)),this.setRowCol(o,i,e)}return this}const t=new Float64Array(this.N*this.M),s=new T(t,this.N,this.M);return s.assignCopy(this),this.M=Q(this.N,this.N=this.M),s.transpose(this),this}transpose(t){if(this!==t){T.checkDims(t,this.M,this.N);for(let s=0;s<this.N;s++)for(let i=0;i<this.M;i++)t.setRowCol(i,s,this.atRowCol(s,i))}else t.transposeInPlace()}add(t,s){}svd(t,s,i,o=!1){if(T.checkDims(t,this.N,this.M),T.checkDims(s,this.M,1),T.checkDims(i,this.M,this.M),o){if(m(this.N===this.M),!this.symmetricEigen(s,i))return!1;for(let h=0;h<this.M;++h)s.at(h)<0&&s.set(h,0);return t.assignCopy(i),!0}let e,a,l,n,R,M,w,x=0,b=0,c=0,u=0,d=0;const f=this.M,N=this.N;t.assignCopy(this);const g=new Float64Array(f),D=new T(g,f,1),S=(h,C)=>C>=0?Math.abs(h):-Math.abs(h),q=(h,C)=>{if((h=Math.abs(h))>(C=Math.abs(C))){const r=C/h;return h*Math.sqrt(r*r+1)}if(C>0){const r=h/C;return C*Math.sqrt(r*r+1)}return 0};for(let h=0;h<f;h++){if(x=h+1,D.set(h,u*c),c=n=u=0,h<N){for(let r=h;r<N;r++)u+=Math.abs(t.atRowCol(r,h));if(u){for(let r=h;r<N;r++)t.setRowCol(r,h,t.atRowCol(r,h)/u),n+=t.atRowCol(r,h)*t.atRowCol(r,h);a=t.atRowCol(h,h),c=-S(Math.sqrt(n),a),l=a*c-n,t.setRowCol(h,h,a-c);for(let r=x;r<f;r++){n=0;for(let y=h;y<N;y++)n+=t.atRowCol(y,h)*t.atRowCol(y,r);a=n/l;for(let y=h;y<N;y++)t.setRowCol(y,r,t.atRowCol(y,r)+a*t.atRowCol(y,h))}for(let r=h;r<N;r++)t.setRowCol(r,h,t.atRowCol(r,h)*u)}}if(s.set(h,u*c),c=n=u=0,h<N&&h!==f-1){for(let r=x;r<f;r++)u+=Math.abs(t.atRowCol(h,r));if(u){for(let r=x;r<f;r++)t.setRowCol(h,r,t.atRowCol(h,r)/u),n+=t.atRowCol(h,r)*t.atRowCol(h,r);a=t.atRowCol(h,x),c=-S(Math.sqrt(n),a),l=a*c-n,t.setRowCol(h,x,a-c);for(let r=x;r<f;r++)D.set(r,t.atRowCol(h,r)/l);for(let r=x;r<N;r++){n=0;for(let y=x;y<f;y++)n+=t.atRowCol(r,y)*t.atRowCol(h,y);for(let y=x;y<f;y++)t.setRowCol(r,y,t.atRowCol(r,y)+n*D.at(y))}for(let r=x;r<f;r++)t.setRowCol(h,r,t.atRowCol(h,r)*u)}}const C=Math.abs(s.at(h))+Math.abs(D.at(h));d=C>d?C:d}for(let h=f-1;h>=0;h--){if(h<f-1){if(c){for(let C=x;C<f;C++)i.setRowCol(C,h,t.atRowCol(h,C)/t.atRowCol(h,x)/c);for(let C=x;C<f;C++){n=0;for(let r=x;r<f;r++)n+=t.atRowCol(h,r)*i.atRowCol(r,C);for(let r=x;r<f;r++)i.setRowCol(r,C,i.atRowCol(r,C)+n*i.atRowCol(r,h))}}for(let C=x;C<f;C++)i.setRowCol(h,C,0),i.setRowCol(C,h,0)}i.setRowCol(h,h,1),c=D.at(h),x=h}for(let h=(N<f?N:f)-1;h>=0;h--){x=h+1,c=s.at(h);for(let C=x;C<f;C++)t.setRowCol(h,C,0);if(c){c=1/c;for(let C=x;C<f;C++){n=0;for(let r=x;r<N;r++)n+=t.atRowCol(r,h)*t.atRowCol(r,C);a=n/t.atRowCol(h,h)*c;for(let r=h;r<N;r++)t.setRowCol(r,C,t.atRowCol(r,C)+a*t.atRowCol(r,h))}for(let C=h;C<N;C++)t.setRowCol(C,h,t.atRowCol(C,h)*c)}else for(let C=h;C<N;C++)t.setRowCol(C,h,0);t.setRowCol(h,h,t.atRowCol(h,h)+1)}for(let h=f-1;h>=0;h--)for(let C=1;;C++){let r=1;for(x=h;x>=0;x--){if(b=x-1,Math.abs(D.at(x))+d===d){r=0;break}if(Math.abs(s.at(b))+d===d)break}if(r){e=0,n=1;for(let y=x;y<=h&&(a=n*D.at(y),D.set(y,D.at(y)*e),Math.abs(a)+d!==d);y++){c=s.at(y),l=q(a,c),s.set(y,l),l=1/l,e=c*l,n=-a*l;for(let I=0;I<N;I++)M=t.atRowCol(I,b),w=t.atRowCol(I,y),t.setRowCol(I,b,M*e+w*n),t.setRowCol(I,y,w*e-M*n)}}if(w=s.at(h),x===h){if(w<0){s.set(h,-w);for(let y=0;y<f;y++)i.setRowCol(y,h,-i.atRowCol(y,h))}break}if(C===100)return!1;R=s.at(x),b=h-1,M=s.at(b),c=D.at(b),l=D.at(h),a=((M-w)*(M+w)+(c-l)*(c+l))/(2*l*M),c=q(a,1),a=((R-w)*(R+w)+l*(M/(a+S(c,a))-l))/R,e=n=1;for(let y=x;y<=b;y++){const I=y+1;c=D.at(I),M=s.at(I),l=n*c,c*=e,w=q(a,l),D.set(y,w),e=a/w,n=l/w,a=R*e+c*n,c=c*e-R*n,l=M*n,M*=e;for(let Z=0;Z<f;Z++)R=i.atRowCol(Z,y),w=i.atRowCol(Z,I),i.setRowCol(Z,y,R*e+w*n),i.setRowCol(Z,I,w*e-R*n);w=q(a,l),s.set(y,w),w&&(w=1/w,e=a*w,n=l*w),a=e*c+n*M,R=e*M-n*c;for(let Z=0;Z<N;Z++)M=t.atRowCol(Z,y),w=t.atRowCol(Z,I),t.setRowCol(Z,y,M*e+w*n),t.setRowCol(Z,I,w*e-M*n)}D.set(x,0),D.set(h,a),s.set(h,R)}const p=new Float64Array(this.N),z=new Float64Array(this.M),X=new T(p,this.N,1),Y=new T(z,this.M,1);let F=1;do F*=3,F++;while(F<=this.M);do{F/=3,F=Math.trunc(F);for(let h=F;h<this.M;h++){const C=s.at(h);for(let y=0;y<this.N;y++)X.set(y,t.atRowCol(y,h));for(let y=0;y<this.M;y++)Y.set(y,i.atRowCol(y,h));let r=h;for(;s.at(r-F)<C;){s.set(r,s.at(r-F));for(let y=0;y<this.N;y++)t.setRowCol(y,r,t.atRowCol(y,r-F));for(let y=0;y<this.M;y++)i.setRowCol(y,r,i.atRowCol(y,r-F));if(r-=F,r<F)break}s.set(r,C);for(let y=0;y<this.N;y++)t.setRowCol(y,r,X.at(y));for(let y=0;y<this.M;y++)i.setRowCol(y,r,Y.at(y))}}while(F>1);for(let h=0;h<this.M;h++){let C=0;for(let r=0;r<this.N;r++)t.atRowCol(r,h)<0&&C++;for(let r=0;r<this.M;r++)i.atRowCol(r,h)<0&&C++;if(C>Math.trunc((this.N+this.M)/2)){for(let r=0;r<this.N;r++)t.setRowCol(r,h,-t.atRowCol(r,h));for(let r=0;r<this.M;r++)i.setRowCol(r,h,-i.atRowCol(r,h))}}return!0}isSymmetric(){if(this.N!==this.M)return!1;for(let t=0;t<this.N;t++)for(let s=t+1;s<this.M;s++)if(this.atRowCol(t,s)!==this.atRowCol(s,t))return!1;return!0}isZero(){return m(0),!1}isIdentity(){return m(0),!1}equals(t,s){if(s!==void 0&&m(0),this.N!==t.N||this.M!==t.M)return!1;for(let i=0;i<this.N*this.M;i++)if(this.data[i]!==t.data[i])return!1;return!0}maxElement(){return m(0),0}minElement(){return m(0),0}determinant(){if(m(this.N===this.M),this.N===1)return this.data[0];if(this.N===2)return this.data[0]*this.data[3]-this.data[1]*this.data[2];if(this.N===3){const e=this;return e.atRowCol(0,0)*(e.atRowCol(1,1)*e.atRowCol(2,2)-e.atRowCol(1,2)*e.atRowCol(2,1))-e.atRowCol(0,1)*(e.atRowCol(1,0)*e.atRowCol(2,2)-e.atRowCol(2,0)*e.atRowCol(1,2))+e.atRowCol(0,2)*(e.atRowCol(1,0)*e.atRowCol(2,1)-e.atRowCol(1,1)*e.atRowCol(2,0))}const t=new Float64Array(this.N*this.N),s=new T(t,this.N,this.N),i=new Float64Array(this.N);if(!this.luDecomposition(s,i))return 0;let o=1;for(let e=0;e<this.N;e++)o*=s.atRowCol(e,e),i[e]!==e&&(o=-o);return o}submatrix(t,s,i){m(0)}inverse(t){m(0)}pseudoInverse(t,s=!1,i=2220446049250313e-31){if(t.setZero(),this.N===1&&this.M===1)return this.atRowCol(0,0)!==0?t.setRowCol(0,0,1/this.atRowCol(0,0)):t.setRowCol(0,0,0),!0;if(this.N===2&&this.M===2){const x=this.atRowCol(0,0)*this.atRowCol(1,1)-this.atRowCol(0,1)*this.atRowCol(1,0),b=1e-5*(Math.abs(this.atRowCol(0,0)*this.atRowCol(1,1))+Math.abs(this.atRowCol(0,1)*this.atRowCol(1,0)));if(Math.abs(x)>b)return t.setRowCol(0,0,this.atRowCol(1,1)/x),t.setRowCol(0,1,-this.atRowCol(0,1)/x),t.setRowCol(1,0,-this.atRowCol(1,0)/x),t.setRowCol(1,1,this.atRowCol(0,0)/x),!0}const o=new Float64Array(this.N*this.M),e=new T(o,this.N,this.M),a=new Float64Array(this.M),l=new T(a,this.M,1),n=new Float64Array(this.M*this.M),R=new T(n,this.M,this.M);if(!this.svd(e,l,R,s))return!1;const M=Math.max(this.N,this.M),w=i*Math.abs(l.at(0))*M;for(let x=0;x<this.M;x++)l.at(x)>w?l.set(x,1/l.at(x)):l.set(x,0);return R.mulDiag(l,t),t.mulTranspose(e,t),!0}luDecomposition(t,s){return m(0),!1}symmetricEigen(t,s){m(this.rows()===this.cols()),m(this.rows()===t.rows()),m(s.rows()===s.cols()&&s.rows()===this.rows()),m(this.isSymmetric());const i=new Float64Array(this.N*this.M),o=new T(i,this.N,this.M);o.assignCopy(this);const e=100/Number.EPSILON,a=this.rows(),l=new Float64Array(a),n=new Float64Array(a),R=new T(l,a,1),M=new T(n,a,1);for(let x=0;x<a;x++)R.set(x,o.atRowCol(x,x)),t.set(x,o.atRowCol(x,x)),M.set(x,0);s.setIdentity();const w=()=>{const x=R;s.transposeInPlace();let b=1;do b*=3,b++;while(b<=a);do{b/=3,b=Math.trunc(b);for(let c=b;c<a;c++){const u=t.at(c),d=Math.abs(u);for(let N=0;N<this.M;N++)x.set(N,s.atRowCol(N,c));let f=c;for(;Math.abs(t.at(f-b))<d;){t.set(f,t.at(f-b));for(let N=0;N<this.M;N++)s.setRowCol(N,f,s.atRowCol(N,f-b));if(f-=b,f<b)break}if(f!==c){t.set(f,u);for(let N=0;N<this.M;N++)s.setRowCol(N,f,x.at(N))}}}while(b>1)};for(let x=1;;x++){let b=0;for(let u=1;u<a;u++)for(let d=0;d<u;d++)b+=Math.abs(o.atRowCol(u,d));if(b===0)return w(),!0;const c=x<4?.2*b/(a*a):0;for(let u=0;u<a;u++)for(let d=u+1;d<a;d++){let f=e*Math.abs(o.atRowCol(d,u));if(x>4&&f<=Math.abs(t.at(u))&&f<=Math.abs(t.at(d)))o.setRowCol(d,u,0);else if(Math.abs(o.atRowCol(d,u))>c){let N,g=t.at(d)-t.at(u);if(f<Math.abs(g))N=o.atRowCol(d,u)/g;else{const z=.5*g/o.atRowCol(d,u);N=1/(Math.abs(z)+Math.sqrt(1+z*z)),z<0&&(N=-N)}const D=1/Math.sqrt(1+N*N),S=N*D,q=S/(1+D);g=N*o.atRowCol(d,u),M.set(u,M.at(u)-g),M.set(d,M.at(d)+g),t.set(u,t.at(u)-g),t.set(d,t.at(d)+g),o.setRowCol(d,u,0);let p=0;for(;p<u;p++)f=o.atRowCol(u,p),g=o.atRowCol(d,p),o.setRowCol(u,p,f-S*(g+f*q)),o.setRowCol(d,p,g+S*(f-g*q));for(p++;p<d;p++)f=o.atRowCol(p,u),g=o.atRowCol(d,p),o.setRowCol(p,u,f-S*(g+f*q)),o.setRowCol(d,p,g+S*(f-g*q));for(p++;p<a;p++)f=o.atRowCol(p,u),g=o.atRowCol(p,d),o.setRowCol(p,u,f-S*(g+f*q)),o.setRowCol(p,d,g+S*(f-g*q));for(p=0;p<a;p++)f=s.atRowCol(u,p),g=s.atRowCol(d,p),s.setRowCol(u,p,f-S*(g+f*q)),s.setRowCol(d,p,g+S*(f-g*q))}}for(let u=0;u<a;u++)R.set(u,R.at(u)+M.at(u)),t.set(u,R.at(u)),M.set(u,0)}}static checkDims(t,s,i){m(t.rows()===s&&t.cols()===i)}}class L extends T{constructor(t){if(t.copy){const i=new Float64Array(t.copy.N*t.copy.M);return super(i,t.copy.N,t.copy.M),this.buffer=i,void this.assignCopy(t.copy)}const s=new Float64Array(t.NN*t.MM);super(s,t.NN,t.MM),this.buffer=s,t.initializerList&&J(this.buffer,t.initializerList,0,0,t.initializerList.length)}assignCopy(t){return this===t||super.assignCopy(t),this}}class A{constructor(t){this.m_TransformationType=1,t===void 0?this.setIdentity():t instanceof A?this.set(t):this.setScale(t)}set(t){return this.xx=t.xx,this.xy=t.xy,this.xd=t.xd,this.yx=t.yx,this.yy=t.yy,this.yd=t.yd,this}clone(){return new A().set(this)}setZero(){this.xx=0,this.yy=0,this.xy=0,this.yx=0,this.xd=0,this.yd=0}isEqual(t){return this===t||this.xx===t.xx&&this.xy===t.xy&&this.xd===t.xd&&this.yx===t.yx&&this.yy===t.yy&&this.yd===t.yd}transformInPlace(t){const s=this.xx*t.x+this.xy*t.y+this.xd,i=this.yx*t.x+this.yy*t.y+this.yd;t.x=s,t.y=i}transform(t){const s=t.clone();return this.transformInPlace(s),s}queryTransform(t,s){const i=this.xx*t.x+this.xy*t.y+this.xd,o=this.yx*t.x+this.yy*t.y+this.yd;s.setCoords(i,o)}transformEnvInPlace(t){if(t.isEmpty())return;const s=$(P,4);t.queryCorners(s),this.transformPoints2D(s,4,s),t.setFromPoints(s,4)}queryTransformEnv(t,s){m(0)}transformPoints2D(t,s,i){for(let o=0;o<s;++o)this.queryTransform(t[o],i[o])}transformInterleavedPoints(t,s,i){s*=2;const o=P.getNAN();for(let e=0;e<s;e+=2)o.x=t[e],o.y=t[e+1],this.transformInPlace(o),i[e]=o.x,i[e+1]=o.y}multiply(t){return A.st_multiply(this,t,this),this}mulLeft(t){return m(0),this}static st_multiply(t,s,i){const o=t.xx*s.xx+t.yx*s.xy,e=t.xy*s.xx+t.yy*s.xy,a=t.xd*s.xx+t.yd*s.xy+s.xd,l=t.xx*s.yx+t.yx*s.yy,n=t.xy*s.yx+t.yy*s.yy,R=t.xd*s.yx+t.yd*s.yy+s.yd;i.xx=o,i.xy=e,i.xd=a,i.yx=l,i.yy=n,i.yd=R}getCoefficients(t){m(t.length>=6),t[0]=this.xx,t[1]=this.xy,t[2]=this.xd,t[3]=this.yx,t[4]=this.yy,t[5]=this.yd}setCoefficients(t){m(t.length>=6),this.xx=t[0],this.xy=t[1],this.xd=t[2],this.yx=t[3],this.yy=t[4],this.yd=t[5]}copyTo(t){m(0)}initializeFromRect(t,s){t.isEmpty()||s.isEmpty()||!t.width()||!t.height()?this.setZero():(this.xy=this.yx=0,this.xx=s.width()/t.width(),this.yy=s.height()/t.height(),this.xd=s.xmin-t.xmin*this.xx,this.yd=s.ymin-t.ymin*this.yy)}initializeFromRectIsotropic(t,s){if(t.isEmpty()||!t.width()||!t.height()||s.isEmpty())this.setZero();else{this.yx=0,this.xy=0,this.xx=s.width()/t.width(),this.yy=s.height()/t.height(),this.xx>this.yy?this.xx=this.yy:this.yy=this.xx;const i=s.getCenter(),o=t.getCenter();this.xd=i.x-o.x*this.xx,this.yd=i.y-o.y*this.yy}}initializeFromTwoPointsArray(t,s){if(t[0].equals(s[0])&&t[1].equals(s[1]))return void this.setIdentity();if(t[0].equals(t[1])){if(s[0].equals(s[1]))return void this.setShift(s[0].sub(t[0]));G("")}if(!t[0].equals(t[1])&&s[0].equals(s[1]))return this.setZero(),void this.shift(s[0]);this.setShiftCoords(-t[0].x,-t[0].y);const i=P.distance(t[0],t[1]),o=P.distance(s[0],s[1]),e=o/i;this.scale(e,e);const a=t[1].sub(t[0]);a.divThis(i);const l=s[1].sub(s[0]);l.divThis(o);const n=a.crossProduct(l),R=a.dotProduct(l);this.rotate(R,n),this.shiftCoords(s[0].x,s[0].y)}initializeFromTwoPoints(t,s,i,o){const e=[t,s],a=[i,o];this.initializeFromTwoPointsArray(e,a)}transformSizeInPlace(t){m(0)}transformSize(t,s){m(0)}transformTol(t){return m(0),0}transformWithoutTranslateArray(t,s,i){for(let o=0;o<s;++o)this.transformWithoutTranslate(t[o],i[o])}transformWithoutTranslateInPlace(t){const s=this.xx*t.x+this.xy*t.y,i=this.yx*t.x+this.yy*t.y;t.setCoords(s,i)}transformWithoutTranslate(t,s){const i=this.xx*t.x+this.xy*t.y,o=this.yx*t.x+this.yy*t.y;s.setCoords(i,o)}setIdentity(){this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=1,this.yd=0}isIdentity(){return!(this.xx!==1||this.yy!==1||this.xy||this.xd||this.yx||this.yd)}isIdentityTol(t){const s=t*t;return!(k(this.xd)+k(this.yd)>s)&&!(k(this.xy+this.xd)+k(this.yy+this.yd-1)>s)&&!(k(this.xx+this.xd-1)+k(this.yx+this.yd)>s)}isReflective(){return this.xx*this.yy-this.yx*this.xy<0}isUniform(t){const s=this.xx*this.xx+this.yx*this.yx,i=this.xy*this.xy+this.yy*this.yy,o=(s+i)*t;return Math.abs(s-i)<=o&&Math.abs(this.xx*this.xy+this.yx*this.yy)<=o}isUniformNoRotation(){return this.xx!==0&&Math.abs(this.xx)===Math.abs(this.yy)&&this.xy===0&&this.yx===0}isTranslate(){return this.xx===1&&this.yy===1&&!this.xy&&!this.yx}isTranslateTol(t){const s=new P;return s.setCoords(0,1),this.transformWithoutTranslateInPlace(s),s.y-=1,!(s.sqrLength()>t*t)&&(s.setCoords(1,0),this.transformWithoutTranslateInPlace(s),s.x-=1,s.sqrLength()<=t*t)}isOrthonormal(t){const s=new A;return s.xx=this.xx*this.xx+this.xy*this.xy,s.xy=this.xx*this.yx+this.xy*this.yy,s.yx=this.yx*this.xx+this.yy*this.xy,s.yy=this.yx*this.yx+this.yy*this.yy,s.xd=0,s.yd=0,s.isIdentityTol(t)}isDegenerate(t){return Math.abs(this.xx*this.yy-this.yx*this.xy)<=2*t*(Math.abs(this.xx*this.yy)+Math.abs(this.yx*this.xy))}isZero(){return this.xx===0&&this.yy===0&&this.xy===0&&this.yx===0&&this.xd===0&&this.yd===0}isScaleAndTranslateTol(t){return this.xy*this.xy+this.yx*this.yx<=(this.xx*this.xx+this.yy*this.yy)*t}setTranslate(t,s){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=s,this}setShiftCoords(t,s){return this.xx=1,this.xy=0,this.xd=t,this.yx=0,this.yy=1,this.yd=s,this}setShift(t){return this.xx=1,this.xy=0,this.xd=t.x,this.yx=0,this.yy=1,this.yd=t.y,this}setScaleCoords(t,s){return this.xx=t,this.xy=0,this.xd=0,this.yx=0,this.yy=s,this.yd=0,this}setScale(t){return this.setScaleCoords(t,t),this}setFlipX(t,s){return this.xx=-1,this.xy=0,this.xd=t+s,this.yx=0,this.yy=1,this.yd=0,this}setFlipY(t,s){return this.xx=1,this.xy=0,this.xd=0,this.yx=0,this.yy=-1,this.yd=t+s,this}setShear(t,s){return this.xx=1,this.xy=t,this.xd=0,this.yx=s,this.yy=1,this.yd=0,this}scale(t,s){return this.xx*=t,this.xy*=t,this.xd*=t,this.yx*=s,this.yy*=s,this.yd*=s,this}setRotateAngle(t){return this.setRotate(Math.cos(t),Math.sin(t))}setRotate(t,s){return this.xx=t,this.xy=-s,this.xd=0,this.yx=s,this.yy=t,this.yd=0,this}setRotateAngleAbout(t,s){return this.setRotateAbout(Math.cos(t),Math.sin(t),s)}setRotateAbout(t,s,i){return this.setTranslate(-i.x,-i.y),this.rotate(t,s),this.translate(i.x,i.y)}setSwapCoordinates(){return this.xx=0,this.xy=1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}setRotateCw90(){return this.xx=0,this.xy=1,this.xd=0,this.yx=-1,this.yy=0,this.yd=0,this}setRotateCcw90(){return this.xx=0,this.xy=-1,this.xd=0,this.yx=1,this.yy=0,this.yd=0,this}shiftCoords(t,s){return this.xd+=t,this.yd+=s,this}shift(t){return this.xd+=t.x,this.yd+=t.y,this}translate(t,s){return this.xd+=t,this.yd+=s,this}flipX(t,s){return this.xx=-this.xx,this.xy=-this.xy,this.xd=t+s-this.xd,this}flipY(t,s){return this.yx=-this.yx,this.yy=-this.yy,this.yd=t+s-this.yd,this}shear(t,s){const i=new A;return i.setShear(t,s),this.multiply(i)}rotateAngle(t){const s=new A;return s.setRotateAngle(t),this.multiply(s)}rotate(t,s){const i=new A;return i.setRotate(t,s),this.multiply(i)}rotateAbout(t,s,i){return this.translate(-i.x,-i.y),this.rotate(t,s),this.translate(i.x,i.y)}rotateAngleAbout(t,s){return this.rotateAbout(Math.cos(t),Math.sin(t),s)}setInvert(t){return this.set(t),this.invertThis()}invertThis(){let t=this.xx*this.yy-this.xy*this.yx;if(t===0)return this.setZero(),this;t=1/t;const s=(this.xy*this.yd-this.xd*this.yy)*t,i=(this.xd*this.yx-this.xx*this.yd)*t,o=this.yy*t,e=-this.xy*t,a=-this.yx*t,l=this.xx*t;return this.xd=s,this.yd=i,this.xx=o,this.yy=l,this.xy=e,this.yx=a,this}invertPrecise(t){return this.set(t),this.invertPreciseThis()}invertPreciseThis(){const t=W.constructDouble(this.xy),s=W.constructDouble(this.xx),i=s.mulDouble(this.yy).sub(t.mulDouble(this.yx));if(i.isZero())return this.setZero(),this;const o=i.clone();o.invertThis();const e=W.constructDouble(this.xd),a=t.mulDouble(this.yd).sub(e.mulDouble(this.yy)).mul(o).toDouble(),l=e.mulDouble(this.yx).sub(s.mulDouble(this.yd)).mul(o).toDouble(),n=o.mulDouble(this.yy).toDouble(),R=o.mulDouble(-this.xy).toDouble(),M=o.mulDouble(-this.yx).toDouble(),w=o.mulDouble(this.xx).toDouble();return this.xd=a,this.yd=l,this.xx=n,this.yy=w,this.xy=R,this.yx=M,this}extractScaleTransform(t,s){const i=Math.sqrt(this.xx*this.xx+this.xy*this.xy),o=Math.sqrt(this.yx*this.yx+this.yy*this.yy);s.setScaleCoords(1/i,1/o),s.multiply(this),t.setScaleCoords(i,o)}setFromTwoTriangles(t,s){let i=!0;for(let M=0;M<3;++M)i=i&&t[M].equals(s[M]);if(i)return this.setIdentity(),!0;const o=new P;o.setSub(t[0],t[1]);const e=new P;e.setSub(t[0],t[2]);const a=new P;a.setSub(s[0],s[1]);const l=new P;l.setSub(s[0],s[2]);const n=4*Number.EPSILON*(Math.abs(o.x*e.y)+Math.abs(e.x*o.y));let R=o.x*e.y-o.y*e.x;return Math.abs(R)>n?(R=1/R,this.xx=(a.x*e.y-o.y*l.x)*R,this.xy=(o.x*l.x-a.x*e.x)*R,this.yx=(a.y*e.y-o.y*l.y)*R,this.yy=(o.x*l.y-a.y*e.x)*R,this.xd=s[0].x-(this.xx*t[0].x+this.xy*t[0].y),this.yd=s[0].y-(this.yx*t[0].x+this.yy*t[0].y),!0):(this.setZero(),!1)}initializeFromControlPoints(t,s,i,o,e=null){return s===0?(this.setIdentity(),void(e&&e.setIdentity())):s===1?(this.setShift(o[0].sub(i[0])),void(e&&e.setShift(i[0].sub(o[0])))):(s<3&&(t=1),void(t===4&&s>2?V(this,s,i,o,e):j(t,this,s,i,o,e)))}calculateErrors(t,s,i,o){m(t>0&&s!==null&&i!==null);let e=0;for(let a=0;a<t;++a){const l=this.transform(s[a]),n=P.sqrDistance(i[a],l);e+=n,o&&(o[a]=Math.sqrt(n))}return Math.sqrt(e/t)}}const E=[43,11,41,9,61];function U(v,t){m(!(t.rows()!==2&&t.rows()!==3||t.cols()!==2&&t.rows()!==3)),v.xx=t.atRowCol(0,0),v.xy=t.atRowCol(0,1),v.yx=t.atRowCol(1,0),v.yy=t.atRowCol(1,1),t.cols()===3?(v.xd=t.atRowCol(0,2),v.yd=t.atRowCol(1,2)):(v.xd=0,v.yd=0)}function V(v,t,s,i,o){const e=P.average(s,t),a=P.average(i,t),l=new L({NN:2,MM:2});l.setZero();const n=new L({NN:2,MM:2});n.setZero();for(let w=0;w<t;++w)l.setRowCol(0,0,l.atRowCol(0,0)+(s[w].x-e.x)*(s[w].x-e.x)),l.setRowCol(0,1,l.atRowCol(0,1)+(s[w].x-e.x)*(s[w].y-e.y)),l.setRowCol(1,1,l.atRowCol(1,1)+(s[w].y-e.y)*(s[w].y-e.y)),n.setRowCol(0,0,n.atRowCol(0,0)+(i[w].x-a.x)*(s[w].x-e.x)),n.setRowCol(0,1,n.atRowCol(0,1)+(i[w].x-a.x)*(s[w].y-e.y)),n.setRowCol(1,0,n.atRowCol(1,0)+(i[w].y-a.y)*(s[w].x-e.x)),n.setRowCol(1,1,n.atRowCol(1,1)+(i[w].y-a.y)*(s[w].y-e.y));l.setRowCol(1,0,l.atRowCol(0,1));const R=new L({NN:2,MM:2});l.pseudoInverse(R,!0)||O("Failed to compute pseudo inverse"),n.mul(R,n),U(v,n);const M=e.clone();v.transformInPlace(M),v.xd=a.x-M.x,v.yd=a.y-M.y,o&&(n.pseudoInverse(R,!1)||O("Failed to compute pseudo inverse"),U(o,R),o.transformInPlace(a),o.xd=e.x-a.x,o.yd=e.y-a.y)}function j(v,t,s,i,o,e){m(v===1||v===0||v===2||v===3),t.setIdentity();const a=P.average(i,s),l=P.average(o,s);if(m(v<E.length&&v>0),8&E[v]){const R=new L({NN:2,MM:2});R.setZero();for(let d=0;d<s;++d)R.setRowCol(0,0,R.atRowCol(0,0)+(o[d].x-l.x)*(i[d].x-a.x)),R.setRowCol(1,0,R.atRowCol(1,0)+(o[d].x-l.x)*(i[d].y-a.y)),R.setRowCol(0,1,R.atRowCol(0,1)+(o[d].y-l.y)*(i[d].x-a.x)),R.setRowCol(1,1,R.atRowCol(1,1)+(o[d].y-l.y)*(i[d].y-a.y));const M=new L({NN:2,MM:2}),w=new L({NN:2,MM:1}),x=new L({NN:2,MM:2});R.svd(M,w,x)||O("Failed to compute svd");const b=new L({NN:2,MM:2});M.transpose(b);const c=new L({NN:2,MM:2});x.mul(b,c),!(32&E[v])&&c.determinant()<0&&(b.setRowCol(1,0,-b.atRowCol(1,0)),b.setRowCol(1,1,-b.atRowCol(1,1)),x.mul(b,c));const u=new A;U(u,c),t.set(u)}if(2&E[v]){let R=0,M=0;for(let w=0;w<s;++w){const x=i[w].sub(a);R+=x.sqrLength(),t.transformInPlace(x),M+=x.dotProduct(o[w].sub(l))}if(R===0)M===0?t.setIdentity():t.setZero();else{const w=M/R;t.scale(w,w)}}else m(!(4&E[v]));const n=a.clone();t.transformInPlace(n),t.xd=l.x-n.x,t.yd=l.y-n.y,e&&(e.set(t),e.invertThis(),e.isZero()&&(e.xd=a.x,e.yd=a.y))}export{A as E};
