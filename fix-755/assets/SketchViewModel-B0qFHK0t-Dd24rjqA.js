const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SelfSnappingEngine-CXO0G0NU-Cq92qfS9.js","./main-BwrA98zM.js","./main-Co9L6i41.css","./Cyclical-DgD7_U1C-CUQYX7EX.js","./quantityUtils-B1Ov7DZK-Ct5fMyM2.js","./elevationInfoUtils-Ccn2Wfoe-CUPonxzP.js","./ElevationInfo-DE5to86a-BP3iYVui.js","./lengthUtils-C61nRlXw-Dob_XEh_.js","./vec2-BnynUbeJ-CKtGJQAy.js","./common-CYWrYyJl-E8-sukrT.js","./vec2f64-CkowXrDb-3zFQ3LNH.js","./vec32-Cj8pVsU0-B1j-O7Zo.js","./UpdatingHandles-Bd2FQ26N-CbV3hzQf.js","./projectionUtils-B-CplN3q-DxIO03Jo.js","./GraphicsLayer-BiEC2-gS-CZpeSxuq.js","./GraphicsCollection-uWAVmks7-Bl0VRym2.js","./Layer-DvVVmz9x-SxsuM8AS.js","./TimeExtent-Cf2Pienb-CwVjhCH7.js","./BlendLayer-DjW_5k0v-BGgBD2VW.js","./layerContainerType-ChWdCT09-G5sdAsSy.js","./jsonUtils-BwLwuQj7-Dz3pr5Nc.js","./parser-CWccHtwJ-B0j4YZRx.js","./mat4f32-BdRMyjXW-CWt6U0BP.js","./mat4-OOmHNWi7-CjSS9WE9.js","./ScaleRangeLayer-x42fwED3-j9XWTMoE.js","./editableLayers-DFUBlMJy-Ch1GV9oQ.js","./utils-Dd8gTonD-QkV3yg0-.js","./Queue-DV3gpSdl-CbVdS62U.js","./Version-CnwD6MZa-CKHDqXFg.js","./projectVectorToVector-DcyiGOWJ-R8cg3Z2R.js","./projectPointToVector-BZJhoF_5-CnEaWRCH.js","./geodesicUtils-DKS2UG72-DiH81x-a.js","./asyncUtils-BPUlNCrX-D9-2F_OI.js","./Query-n1aoaaFC-CxDHBCLC.js","./Field-BIQ-quF4-2jecDKOo.js","./fieldType-PhcL4ff8-DkDi8HIE.js","./vec42-D8CJyqHG-DnfLTeQH.js","./vec4f64-DD-nkcCV-CSNWKRqG.js","./plane-Cf3Koz3c-nQG-lKBC.js","./vectorStacks-5ZZtmT9E-DwcfzudV.js","./mat3f64-BnNZDR5l-Bz3OL2oI.js","./mat4f64-xsZDPPj0-Dq35B4BL.js","./quatf64-C16JxGFv-BKWK1F8U.js","./sphere-zPMQWhGG-B-gHxcPh.js","./mat3-DOnW3DjW-C3hbW9XY.js","./geodeticLengthOperator-DHGBHzf3-B4bRixeF.js","./geodeticCurveType-D_etKnbP-CirnHLSB.js","./earcut-C6NeZYSh-Da0ULCQ5.js","./triangle-BM89wdHY-hQvJuo3g.js","./lineSegment-BAWQVP9P-D_srrCK-.js","./spatialReferenceEllipsoidUtils-BK0OQJn2-C9OSBBFv.js","./GridSnappingEngine-DCu-2xRk-ClMZeM8v.js","./normalizeUtils-u00NGW3M-DihROgJ8.js","./normalizeUtilsCommon-ClagynAA-C6e-nxGB.js","./utils-BO8hgPs3-B93N9jv9.js","./utils-DpLVEUvg-_OMf49aP.js","./scaleUtils-Br-smv3A-DAk47sdW.js","./gridUtils-ZkKc2j-y-DH3AR45_.js","./FeatureSnappingEngine-D6B44S6e-Cf9AtUda.js","./FeatureFilter-DXpQKGs4-BkwO1nPY.js","./floorFilterUtils-4r-vVdzs-C43jLoAE.js","./layerViewUtils-DLIaYA64-CqaMd9sG.js","./geometryEngine-C83waDS7-CFUox9UW.js","./geometryEngineBase-BcMV6k0z-BPq48LKe.js","./_commonjsHelpers-BITg13Vk-KnjfkSck.js","./hydrated-CNNw1XFI-Bi66Bp44.js","./editingTools-7dqMzBcg-96bUlo8v.js","./SnappingVisualizer2D-Di4uotAR-D7MM0BlR.js","./enums-a_LDTPYU-CBIcy3mM.js","./TooltipInfoWithCoordinates-Xxefy9Or-Co9KqJjl.js","./PointSnappingHint-OKXicQ1z-DZxrafu9.js","./SketchTooltipInfo-CkyYTifq-Cng-_xrF.js","./intl-BAA1onnp-D3jP1AIh.js","./MeshTransform-ByFk-Izc-BZBzzvTY.js","./quat-DQgq9Ar5-D1jEEYxV.js","./axisAngleDegrees-BTSCyz4U-CNIMPAtr.js","./meshVertexSpaceUtils-CCr86FVF-CxYswA8Z.js","./MeshLocalVertexSpace-Cfxtmv6L-kp4IXPPI.js","./modeUtils-deizL-Tg-C4WiXKJs.js","./jsxFactory-Cua8zWVZ-BDFn0EFT.js","./uuid-Dj9mdEVg-BaKSCiyT.js","./sanitizerUtils-B1yRmbO2-B7KG_jBT.js","./a11yUtils-CoCwThtH-JbzKdQYJ.js","./memoize-DvEt8OkT-Cy_RrfpZ.js","./unitFormatUtils-FAypDaT5-DqukTyj9.js","./ByteSizeUnit-DL8UhsB0-B2-AmVRx.js","./index-kib5quT9-DcUPqBQp.js","./draw-store-DnCf4IRI-PchBjZSm.js","./drapedUtils-DARF9dbf-3zCMnrFw.js","./utils-C0LvbFCo-RMQaTNpt.js","./widget-p2YDjs4S-9KCUDe_H.js","./substitute-B3zxyWVi-Dl7fthcX.js","./editPlaneUtils-DmK-4boe-Cx6bfOF5.js","./drawSurfaces-DQUGW1oK-BJSyccs8.js","./distanceOperator-CZDvZf3O-ClxUJjvA.js","./Point2D-CaHJVGk1-JqvJXjLr.js","./ProjectionTransformation-DQ4GElxa-C50Hc25_.js","./Envelope2D-DlBzXkgv-eKRxGysX.js","./Transformation2D-CXWnDKXs-CjsleQQw.js","./SimpleGeometryCursor-DSF_YyIm-TAMgMsbK.js","./OperatorDefinitions-DJdq_wrt-DP7_WWTp.js","./apiConverter-CSuukuP9-D1xmoQcb.js","./jsonConverter-tsQ40CV0-CvQ2rsDQ.js","./simplifyOperator-BW9Vrh-l-CDfOEeI9.js","./operatorSimplify-CjcRb60U-DXI5En75.js","./mat2d-BQA-1WB--Pnyy0dhf.js","./mat2df64-DDXwUeaJ-Tu7q-7Mk.js","./ReactiveSet-CRNikQMW-BmrXcaIU.js","./diffUtils-BxG8DCnW-DPd0tD6Z.js","./ViewingMode-CdRKcXnc-Dab70bGf.js","./SnappingContext-OY7xJ98b-DW9IlWxN.js","./hydratedFeatures-oobA80ei-De1Vo7qL.js","./Scheduler-BV4C4cVP-DWRbN6yI.js","./debugFlags-8tOwPnHK-CgOlZyIE.js","./boundedPlane-QDtjx5eO-XZ_q5bkH.js","./cimSymbolUtils-DCedSSCN-D_BxXcsb.js","./utils-BfXZnjCE-C0n5baVn.js","./defaultCIMValues-BcSaJjm--58G-soMN.js","./GraphicManipulator-D_ewLKOT-CdfaDSjw.js","./colorUtils-Eg6lOlXm-CsYuSdEi.js","./drawUtils-pJlGx3nm-BHOrwo1c.js","./ImageMaterial.glsl-4GA395N2-DLXcrhAI.js","./TextOverlayItem-BwTcOTWP-WY6NFurH.js","./Octree-B7mLL9lS-DwraR6UJ.js","./BufferView-wDxx79o3-0Lk1NQU5.js","./RibbonLine.glsl-B_euRL9h-BHryPvts.js","./orientedBoundingBox-CSC169JG-DXiJN-8f.js","./computeTranslationToOriginAndRotation-e-ft1lOz-qU1TWHGs.js","./OutputColorHighlightOID.glsl-BdXTjs7_-I83DsyNn.js","./videoUtils-Scb4DgCQ-Cak_3zBk.js","./requestImageUtils-B2YN5Eb9-QsXQXuC7.js","./basicInterfaces-Dsf65ICa-DkQ9Rsnx.js","./TextureFormat-Cl0ugX3E-DD0Aw8RG.js","./enums-wEDHPbCF-Cf76M5_x.js","./Texture-D5XWO2GQ-DCbjvR6W.js","./getDataTypeBytes-DYbftOSj-BNZIboqJ.js","./Indices-BuIC5D20-BReJPc43.js","./VertexAttribute-hUz6pozM-Bx3V-z96.js","./glsl-Z5uYj8ka-BRgh2Cgo.js","./BindType-CKbZk6AG-Bqvzo9NX.js","./ShaderOutput-CUn9tpiG-CW1Nc608.js","./renderState-BM-MCKUz-CkGIEsl7.js","./InterleavedLayout-C2YUDwKf-C7IhUlF4.js","./types-l27bT09Q-DE0QfIFp.js","./dehydratedFeatureUtils-OR1UjA48-BuQ4cdRG.js","./vec3f32-GX_cKsFD-UJPpzdNc.js","./floatRGBA-DRFmbkvz-D7QpkArO.js","./ShaderBuilder-CU5v4tk1-CxGg53H1.js","./DefaultLayouts-Dxx39D6p-BQ_UTbKY.js","./triangulationUtils--8_1p-hL-BaBt_CtU.js","./deduplicate-DRKoZSEv-D6YVfGcK.js","./VertexElementDescriptor-DLvjNrmQ-BHK9ksow.js","./VertexArrayObject-CieliEx4-De0kP_0q.js","./memoryEstimations-DeWfxwaV-CXRMQIi5.js","./NestedMap-DL9KstBd-DcOmdaty.js","./glUtil-0ZzWJjlL-BbuN-tVo.js","./HUDMaterial.glsl-9ciK4G-4-KC8ntN01.js","./SelectedVertexTooltipInfo-4SubR9ql-BFjfuF8Q.js","./IntersectorType-D6ZupXNg-DQZQEhlR.js","./TranslateTooltipInfo-A8pO5CNj-DSXDCJJR.js","./utils-Cb2uXNfG-BWObhpcN.js","./LRUCache-DPWdPNTF-Du_Z0yHt.js","./MemCache-qDGoejB7-9IozotvY.js","./IViewEvents-BE10MM98-CvMfjolG.js","./ExtentScaleTooltipInfo-BgG7HiRF-DRrxyMVa.js","./LineCallout.glsl-0Cou_Qxw-BwXS-52F.js","./projectionUtils-Dt6hj1Xh-HdHGqYS4.js","./HeightModelInfo-C4voFc4k-CfyynqRj.js","./visualVariableUtils-BTS148WR-Ccl5my0y.js","./dehydratedFeatures-CE8L86IW-qJ-nzTyK.js","./UniqueValueRenderer-CLXHFtg9-w5cuBULK.js","./commonProperties-CJLeiNuA-B7gcOW0k.js","./colorRamps-trM-CPFS-C6eI-xyy.js","./ColorStop-CL7v3R-A-BOr-ujFM.js","./RendererLegendOptions-Bil_IDab-CQA1E0Im.js","./styleUtils-DBPDLVBX-DZFRyEvV.js","./rendererConversion-koUEkXyy-CqjEe-_O.js","./RealisticTree.glsl-DzbI6Sba-aJRcZ9LC.js","./DefaultMaterial-7UvmJfZD-DFvUXqUK.js","./NormalAttribute.glsl-BnbqDItl-CYwdqHAv.js","./edgeUtils-Dic9zHbc-CNIZYraj.js","./OptimizedFeature-mIz_HhJg-BNs0KtVS.js","./OptimizedGeometry-pzfNw1AT-u8izTill.js","./optimizedFeatureQueryEngineAdapter-LiTJLGWN-BFkUb54l.js","./vec2f32-hTAvipMV-C0AQcwEv.js","./featureConversionUtils-Bjjlcfdo-eSkJjzzV.js","./OptimizedFeatureSet-Dz5hF8Qm-B1brSkRC.js","./PooledRBush-DfSXIoUa-naUFAGkQ.js","./quickselect-DHTstthl-Ds_Aj0x5.js","./popupUtils-B9dNptlM-USn-CtN8.js","./LayerView-DdANuT-Y-Ys35lafe.js","./GraphicMover-BruWidUQ-Bcgxq08f.js","./Box-C1MLNNLE-BmzT5GFC.js","./settings-Dt5EB2Ay-wARvzWqP.js","./Reshape-Zlegijc9-D-KrlgZo.js","./symbolUtils-D5Wjfwrf-h3UX7vu7.js","./mat2df32-fg3OHsAI-BF2V2zqo.js","./webStyleSymbolUtils-r0H5toyk-LqVIoJb2.js","./devEnvironmentUtils-CxrVv3RG-CX5aoxVE.js"])))=>i.map(i=>d[i]);
import{v as c,S as h,a0 as Ae,du as m,gD as Se,a8 as Zn,K as si,ac as ce,a1 as Pe,_ as I,u as Vt,Y as Wn,ci as Kn,eu as Ri,eK as Xn,eJ as Jn,gE as Qn,gF as eo,a3 as Mi,ak as rt,ai as to,ao as $t,s as Gi,ap as Je,gG as io,gH as no,gI as ie,gJ as Pi,a6 as Qi,h as oo,ah as Ai,aU as ro,n as H,a7 as so,gr as ao,gK as lo,gL as mt,X as en,ad as _t,a9 as po,bJ as co,gM as ho,aj as Be,eW as uo,cf as yo,aG as go,gN as vo,ag as fo,b3 as Li,ef as $e,df as ai,dC as mo,gO as _o,gP as Eo,dr as tn,gQ as bo,gR as nn,B as wo,gS as To,dq as So,ds as Oo,dp as Ro}from"./main-BwrA98zM.js";import{i as Mo}from"./UpdatingHandles-Bd2FQ26N-CbV3hzQf.js";import{O as Jt,Q as Go,L as Po,k as Ao,K as Lo,i as Co}from"./projectionUtils-B-CplN3q-DxIO03Jo.js";import Do from"./GraphicsLayer-BiEC2-gS-CZpeSxuq.js";import{b as Ne,c as on,$ as xo,R as No,k as Io,q as rn,d as ko}from"./elevationInfoUtils-Ccn2Wfoe-CUPonxzP.js";import{c as Ho}from"./editableLayers-DFUBlMJy-Ch1GV9oQ.js";import{g as A,w as Ci,V as G,$ as Di,v as Uo,d as Vo}from"./utils-Dd8gTonD-QkV3yg0-.js";import{l as $o,a as Fo}from"./Cyclical-DgD7_U1C-CUQYX7EX.js";import{t as Ke,g as li,i as _e,s as pi}from"./quantityUtils-B1Ov7DZK-Ct5fMyM2.js";import{i as U,l as Ce,P as He,y as ae,f as zo,D as qo,b as jo,h as sn,M as an,v as Yo,k as Bo,A as Zo,m as ln,E as xi}from"./vec2-BnynUbeJ-CKtGJQAy.js";import{o as Z,O as Wo,r as gt,l as Ko}from"./vec2f64-CkowXrDb-3zFQ3LNH.js";import{N,p as Qt,R,k as F,v as pn,y as $,S as Et,l as Xo,r as At,P as Jo,X as Qo,_ as Lt,A as q,T as er,g as Ze,U as ei}from"./vec32-Cj8pVsU0-B1j-O7Zo.js";import{s as Qe,p as we,f as cn}from"./projectVectorToVector-DcyiGOWJ-R8cg3Z2R.js";import{u as ti,D as Ct,$ as bt,C as Dt,I as hn,c as tr,h as ir}from"./geodesicUtils-DKS2UG72-DiH81x-a.js";import{g as nr}from"./asyncUtils-BPUlNCrX-D9-2F_OI.js";import{z as or}from"./TimeExtent-Cf2Pienb-CwVjhCH7.js";import{R as rr}from"./Query-n1aoaaFC-CxDHBCLC.js";import{y as sr,w as ar}from"./vec42-D8CJyqHG-DnfLTeQH.js";import{o as lr}from"./vec4f64-DD-nkcCV-CSNWKRqG.js";import{y as W,n as dn,O as pr,i as un,e as cr,z as xt,u as yn,N as ii,$ as ci,G as gn,K as hr,r as dr}from"./plane-Cf3Koz3c-nQG-lKBC.js";import{G as ur,F as yr,B as gr,w as vr,U as fr}from"./sphere-zPMQWhGG-B-gHxcPh.js";import{n as Xe}from"./common-CYWrYyJl-E8-sukrT.js";import{m as mr,l as vn}from"./geodeticLengthOperator-DHGBHzf3-B4bRixeF.js";import{m as _r}from"./earcut-C6NeZYSh-Da0ULCQ5.js";import{_ as Er}from"./triangle-BM89wdHY-hQvJuo3g.js";import{m as br,q as wr}from"./spatialReferenceEllipsoidUtils-BK0OQJn2-C9OSBBFv.js";let me=class extends ce{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};c([h()],me.prototype,"length",void 0),c([h()],me.prototype,"verticalLength",void 0),c([h()],me.prototype,"area",void 0),me=c([H("esri.views.interactive.sketch.Units")],me);var V;function Tr(e,t){if(e==null||t==null)return;const i=ni(e,t);return i!=null?Ke(i,"radians","geographic"):void 0}(function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"})(V||(V={}));const ni=(()=>{const e=m(),t=m();return(i,n)=>(q(e,i.x,i.y,i.z??0),q(t,n.x,n.y,n.z??0),Sr(e,t,i.spatialReference,n.spatialReference))})(),Sr=(()=>{const e=Z(),t=m(),i=m();return(n,o,r,a)=>{if(R(n,o))return;const s=ti(r),p=ti(a);if(s&&p&&Je(s,p)&&we(n,r,t,s)&&we(o,a,i,p)){const{azimuth:d}=Ct(Rr,t,i,s);return d!=null?ai(d,"degrees","radians"):void 0}e[0]=o[0]-n[0],e[1]=o[1]-n[1];let l=qo(Wo,e);return e[0]<0&&(l=Mr-l),l}})();function za(e,t,i,n=V.Absolute){if(t&&i)switch(n){case V.Absolute:return Tr(t,i);case V.Relative:return Ii(Ni(e,t,i),V.Relative);case V.RelativeBilateral:return Ii(Ni(e,t,i),V.RelativeBilateral)}}function Ni(e,t,i){if(!e||!t||!i)return;const n=ni(e,t),o=ni(t,i);return n!=null&&o!=null?Ke(o-n,"radians","geographic"):void 0}function Ii(e,t){if(e!=null)switch(t){case V.Absolute:return Or(e);case V.Relative:{const i=wt(e);let n=ki.normalize(i,0,!0);return n===-180&&(n=180),Ke(n,"degrees","geographic")}case V.RelativeBilateral:{const i=wt(e),n=Math.abs(ki.normalize(i,0,!0));return Ke(n,"degrees","geographic")}}}function Or(e){const t=wt(e),i=Gr.normalize(t,0,!0);return Ke(i,"degrees","geographic")}const qa=(()=>{const e=m();return(t,i,n,o,r,a="geodesic")=>{Lt(e,i);const s=wt(r);if(a==="geodesic"){const y=ti(n);if(y&&we(e,n,e,y))return bt(t,e,s,o,y),t[2]=i[2],!!we(t,y,t,n)}const p=li(s,"geographic","arithmetic"),l=ai(p,"degrees","radians"),d=i[0]+o*Math.cos(l),u=i[1]+o*Math.sin(l),f=i[2];return q(t,d,u,f),!0}})();function wt(e){if(e!=null)return li(fn(e),e.rotationType,"geographic")}function ja(e){if(e!=null)return li(fn(e),e.rotationType,"arithmetic")}function fn(e){return ai(e.value,e.unit,"degrees")}const Rr=new Dt,Mr=2*Math.PI,Gr=$o,ki=new Fo(-180,180);let se=class extends ce{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?V.RelativeBilateral:V.Relative;case"absolute":return V.Absolute}}get displayUnits(){return this._get("displayUnits")??new me}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new me}set inputUnits(e){this._set("inputUnits",e)}};c([h({type:String,nonNullable:!0})],se.prototype,"directionMode",void 0),c([h({type:Boolean,nonNullable:!0})],se.prototype,"relativeDirectionIsBilateral",void 0),c([h()],se.prototype,"effectiveDirectionMode",null),c([h({type:me,nonNullable:!0})],se.prototype,"displayUnits",null),c([h({type:me,nonNullable:!0})],se.prototype,"inputUnits",null),se=c([H("esri.views.interactive.sketch.SketchValueOptions")],se);function Hi(e){switch(e){case b.SUPPORTED:break;case b.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case b.GEOMETRY_MISSING:return"no geometry";case b.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case b.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case b.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var b;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(b||(b={}));function Pr(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return b.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const i=e.elevationInfo;return on(i)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function Ar(e){return Lr(e).result}function Lr(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:b.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:b.GEOMETRY_MISSING};if(on(e.elevationInfo))return{result:b.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,i=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:b.SUPPORTED,geometry:i}:{result:b.GEOMETRY_TYPE_UNSUPPORTED}}function Cr(e){if(e.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return b.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return b.SUPPORTED;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some(i=>i.type==="object")?b.SYMBOL_TYPE_UNSUPPORTED:xo(e)!=="on-the-ground"&&No(e)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function Ui(e,t,i){if(!t||!e?.map)return;const{map:n}=e;n.layers.find(o=>o===t)||n.add(t,i)}function Ya(e,t){const i=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(n=>{const o=n.layer;return o===i||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(i)})}function Ba(e){return Ho(e)||so(e)||ao(e)||lo(e)}let xe=class extends ce{constructor(e){super(e),this.enabled=!1}};c([h({type:Boolean,nonNullable:!0})],xe.prototype,"enabled",void 0),xe=c([H("esri.views.interactive.sketch.SketchLabelOptions")],xe);let We=class extends ce{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([h({type:String,nonNullable:!0})],We.prototype,"mode",void 0),We=c([H("esri.views.interactive.sketch.SketchTooltipElevationOptions")],We);let C=class extends ce{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([h({type:Boolean,nonNullable:!0})],C.prototype,"area",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"coordinates",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"direction",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"distance",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"elevation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"header",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"helpMessage",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"orientation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"radius",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"rotation",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"scale",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"size",void 0),c([h({type:Boolean,nonNullable:!0})],C.prototype,"totalLength",void 0),C=c([H("esri.views.interactive.sketch.SketchTooltipVisibleElements")],C);let x=class extends ce{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new We,this.placement="auto",this.offset=null,this.visibleElements=new C,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([h({type:Boolean,nonNullable:!0})],x.prototype,"enabled",void 0),c([h()],x.prototype,"forceEnabled",void 0),c([h()],x.prototype,"effectiveEnabled",null),c([h()],x.prototype,"helpMessage",void 0),c([h()],x.prototype,"helpMessageIcon",void 0),c([h({type:Boolean,nonNullable:!0})],x.prototype,"inputEnabled",void 0),c([h({type:We,nonNullable:!0})],x.prototype,"elevation",void 0),c([h()],x.prototype,"placement",void 0),c([h()],x.prototype,"offset",void 0),c([h({type:C,nonNullable:!0})],x.prototype,"visibleElements",void 0),c([h()],x.prototype,"visualVariables",void 0),c([h()],x.prototype,"xyMode",void 0),x=c([H("esri.views.interactive.sketch.SketchTooltipOptions")],x);let Ge=class extends ce{constructor(e){super(e),this.labels=new xe,this.tooltips=new x,this.values=new se}};c([h({nonNullable:!0,type:xe})],Ge.prototype,"labels",void 0),c([h({nonNullable:!0,type:x})],Ge.prototype,"tooltips",void 0),c([h({nonNullable:!0,type:se})],Ge.prototype,"values",void 0),Ge=c([H("esri.views.interactive.sketch.SketchOptions")],Ge);var De;function mn(e,t,i){return j(e,t,i)}function j(e=0,t=0,i=0){return mt(e,t,i)}function Za(e){return e}function Wa(e){return e}function Oe(e,t,i){return mt(e,t,i)}function Ie(e){const[t,i,n]=e;return e.length>3?[t,i,n,e[3]]:[t,i,n]}function Ft(e){return e[3]=((e.length>3?e[3]:void 0)??De.NONE)|De.TARGET,e}function Ka(e){return!!(((e.length>3?e[3]:void 0)??De.NONE)&De.TARGET)}function Vi(e,t,{coordinateHelper:i,elevationInfo:n},o){return e?Ye(i.vectorToDehydratedPoint(e,Dr),t,n,o):null}function Ye(e,t,i,n=j()){return n[0]=e.x,n[1]=e.y,n[2]=e.z??0,t==null||(t.type==="2d"?n[2]=0:n[2]=Io(t,e,i,Ne)??0),n}function Xa(e,t,i){return i?(cn(i,e[0],e[1],e[2],t),i):Qe(e[0],e[1],e[2],t)}function $i(e,t,{z:i,m:n},o,r){const{spatialReference:a,elevationInfo:s}=o;let p;i==null&&n==null?p=void 0:t==null||t.type==="2d"?p=i??void 0:p=rn(t,e,a,Ne,s)??0;const[l,d]=e;return r?cn(r,l,d,p,a):r=Qe(l,d,p,a),n!=null&&(r.m=n,r.hasM=!0),r}function Ja(e,t,i,n,o=j()){const[r,a]=e;return o[0]=r,o[1]=a,e.length>3&&(o[3]=e[3]??De.NONE),i?.type!=="3d"?(o[2]=t.value,o):(o[2]=ko(i,r,a,t.value,n,t.elevationInfo,Ne)??0,o)}(function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"})(De||(De={}));const Dr=Qe(0,0,0,null);let ee=class extends en{constructor(){super(...arguments),this.enabled=!0}};c([h({type:Boolean})],ee.prototype,"enabled",void 0),ee=c([H("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],ee);let T=class extends en{constructor(e){super(e),this.lineSnapper=new ee,this.parallelLineSnapper=new ee,this.rightAngleSnapper=new ee,this.rightAngleTriangleSnapper=new ee,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new _t([255,127,0]),this.orangeTransparent=new _t([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([h({type:ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"lineSnapper",void 0),c([h({type:ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"parallelLineSnapper",void 0),c([h({type:ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"rightAngleSnapper",void 0),c([h({type:ee,constructOnly:!0,nonNullable:!0,json:{write:!0}})],T.prototype,"rightAngleTriangleSnapper",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],T.prototype,"shortLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],T.prototype,"distance",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"pointThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"intersectionParallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"parallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T.prototype,"verticalLineThresholdMeters",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"touchSensitivityMultiplier",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],T.prototype,"pointOnLineThreshold",void 0),c([h({type:_t,nonNullable:!0})],T.prototype,"orange",void 0),c([h({type:_t,nonNullable:!0})],T.prototype,"orangeTransparent",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"lineHintWidthReference",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"lineHintWidthTarget",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],T.prototype,"lineHintFadedExtensions",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],T.prototype,"parallelLineHintWidth",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],T.prototype,"parallelLineHintLength",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],T.prototype,"parallelLineHintOffset",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],T.prototype,"rightAngleHintSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],T.prototype,"rightAngleHintOutlineSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],T.prototype,"satisfiesConstraintScreenThreshold",void 0),T=c([H("esri.views.interactive.snapping.Settings.Defaults")],T);const Tt=new T;var k;(function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"})(k||(k={}));let ge=class extends ce{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new Ae}};c([h({constructOnly:!0})],ge.prototype,"layer",void 0),c([h()],ge.prototype,"enabled",void 0),c([h()],ge.prototype,"updating",void 0),c([h()],ge.prototype,"availability",void 0),c([h()],ge.prototype,"sublayerSources",void 0),ge=c([H("esri.views.interactive.snapping.FeatureSnappingLayerSource")],ge);let L=class extends ce{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new Ae,this.distance=Tt.distance,this.touchSensitivityMultiplier=Tt.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(Fi)&&Qi.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(Nr),i=this._get("_effectiveFeatureSources")?.filter(Fi)??new Ae;for(const s of t){const p=i.find(l=>l.layer===s.layer.parent);if(p)p.sublayerSources.includes(s)||p.sublayerSources.add(s);else if(s.layer.parent){const l=new ge({layer:s.layer.parent});l.sublayerSources.add(s),i.add(l)}}for(const s of i){const p=s.sublayerSources.filter(l=>!t.includes(l));s.sublayerSources.removeMany(p)}i.removeMany(i.filter(s=>s.sublayerSources.length===0));const n=e.filter(xr),o=this._get("_effectiveFeatureSources")??new Ae,{added:r,removed:a}=po(o.toArray(),[...n,...i]);return o.removeMany(a),o.addMany(r),o}};function Fi(e){return e.layer.type==="subtype-group"}function xr(e){return e.layer.type!=="subtype-group"}function Nr(e){return e.layer.type==="subtype-sublayer"}c([h()],L.prototype,"enabled",void 0),c([h()],L.prototype,"enabledToggled",void 0),c([h()],L.prototype,"forceDisabled",void 0),c([h()],L.prototype,"selfEnabled",void 0),c([h()],L.prototype,"featureEnabled",void 0),c([h()],L.prototype,"gridEnabled",void 0),c([h()],L.prototype,"attributeRulesEnabled",void 0),c([h({type:Ae.ofType(ge)})],L.prototype,"featureSources",void 0),c([h()],L.prototype,"distance",void 0),c([h()],L.prototype,"touchSensitivityMultiplier",void 0),c([h({readOnly:!0})],L.prototype,"effectiveEnabled",null),c([h({readOnly:!0})],L.prototype,"effectiveGridEnabled",null),c([h({readOnly:!0})],L.prototype,"effectiveSelfEnabled",null),c([h({readOnly:!0})],L.prototype,"effectiveFeatureEnabled",null),c([h({readOnly:!0})],L.prototype,"_effectiveFeatureSources",null),L=c([H("esri.views.interactive.snapping.SnappingOptions")],L);const Qa=Symbol("grid-placement-graphic");function _n(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function el(e,t){return Math.sqrt(_n(e,t))}function Ir(e,t){t.sort((i,n)=>Qt(i.targetPoint,e)-Qt(n.targetPoint,e))}var K;function tl({parameters:{point:e,distance:t,returnEdge:i,vertexMode:n,coordinateHelper:{spatialReference:o},filter:r},mode:a,returnZ:s,filter:p}){const l=p?.clone()??new rr({where:"1=1"});return l.returnZ=s??a==="3d",r&&(l.geometry=r.geometry,l.distance=r.distance,l.spatialRelationship=r.spatialRelationship,l.where=co(l.where,r.where),l.timeExtent=or(l.timeExtent,r.timeExtent),l.objectIds=kr(l.objectIds,r.objectIds)),{point:Qe(e[0],e[1],e[2],o.toJSON()),mode:a,distance:t,returnEdge:i,vertexMode:n,query:l.toJSON()}}function kr(e,t){return e||t?t?e?Array.from(ho(new Set(e),new Set(t))):t:e:null}function il(e,t,i){return{left:Vi(e.leftVertex.pos,t,i),right:Vi(e.rightVertex.pos,t,i)}}(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(K||(K={}));const zi=Symbol("snapping-toggle");function Hr(e,t=()=>{}){const i=Pe(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:n,snappingOptions:o})=>{if(e.removeHandles(zi),!n||!o)return;const r=A.TOOL,a=[n.on("key-down",s=>{s.key!==Di.toggle||s.repeat||(o.enabledToggled=!0,t())},r),n.on("key-up",s=>{s.key===Di.toggle&&(o.enabledToggled=!1,t())},r),n.on("pointer-move",s=>{const p=s.native.ctrlKey;o.enabledToggled!==p&&(o.enabledToggled=p,t())},r)];e.addHandles(a,zi)},Be);e.addHandles(i)}function nl(e){return Uo(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}function zt(e,t){return e[0]*t[1]-e[1]*t[0]}function Ur(e,t,i){const n=He(i,t)/Ce(i);return Yo(e,i,n)}function ol(e,t,i,n,o=i){return U(Le,n,i),U(St,t,o),Ur(ke,St,Le),jo(e,o,ke)}function rl(e,t,i,n){U(Le,t,i);const o=n/sn(Le);return ae(e,i,Le,o)}function sl(e,t){const i=e.start,n=e.end,o=t.start,r=t.end,a=U(Le,n,i),s=U(En,r,o),p=zt(a,s);if(Math.abs(p)<=$r)return[];const l=U(St,i,o),d=zt(s,l)/p,u=zt(a,l)/p;if(d>=0){if(u>=0||t.type===M.LINE)return[ae(ke,i,a,d)]}else if(e.type===M.LINE&&(u>=0||t.type===M.LINE))return[ae(ke,i,a,d)];return[]}function Vr(e,t,i){const n=[],o=U(Le,e.end,e.start),r=U(En,e.start,t),a=Ce(o),s=2*He(o,r),p=s*s-4*a*(Ce(r)-i*i);if(p===0){const l=-s/(2*a);(e.type===M.LINE||l>=0)&&n.push(ae(ke,e.start,o,l))}else if(p>0){const l=Math.sqrt(p),d=(-s+l)/(2*a);(e.type===M.LINE||d>=0)&&n.push(ae(ke,e.start,o,d));const u=(-s-l)/(2*a);(e.type===M.LINE||u>=0)&&n.push(ae(St,e.start,o,u))}return n}var M;(function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"})(M||(M={}));const $r=1e-6,Le=Z(),En=Z(),St=Z(),ke=Z();function hi({start:e,end:t,type:i},n,o){const r=[],a=U(et,t,e),s=U(Nt,e,n),p=Ce(a),l=2*He(a,s),d=l*l-4*p*(Ce(s)-o*o);if(d===0){const u=-l/(2*p);(i===z.PLANE||u>=0)&&r.push(ae(Z(),e,a,u))}else if(d>0){const u=Math.sqrt(d),f=(-l+u)/(2*p);(i===z.PLANE||f>=0)&&r.push(ae(Z(),e,a,f));const y=(-l-u)/(2*p);(i===z.PLANE||y>=0)&&r.push(ae(Z(),e,a,y))}return r}function bn(e,t){const i=e.start,n=e.end,o=U(et,n,i),r=q(kt,-o[1],o[0],0),a=t.start,s=t.end,p=F(ui,s,a),l=$(p,r),d=q(Pn,i[0],i[1],0),u=F(An,d,a),f=$(u,r),y=Xe();if(Math.abs(l)<y)return[];const v=N(Ln,a,p,f/l);if(t.type===M.RAY){const g=F(oi,v,a);if($(g,p)<-y)return[]}if(e.type===z.HALF_PLANE){const g=Bo(Nt,v,i);if(He(g,o)<-y)return[]}return[Se(v)]}function Fr(e,t){return qr(Ot(yi,t[2],e),t)}function wn(e,t){return Mn(Ot(yi,0,e),Ot(Zr,0,t)).map(([i,n])=>gt(i,n))}function Tn(e,t,i){return On(e,Ot(yi,e[2],t),i)}function Sn(e,t,i,n=m()){const o=U(et,e,t),r=sn(o);return ae(n,t,o,r===0?1:i/r),n[2]=e[2],n}function On(e,{start:t,end:i,type:n},o=m()){const r=F(It,e,t),a=F(kt,i,t),s=$(r,a)/$(a,a);return N(o,t,a,n===M.RAY?Math.max(s,0):s)}const zr=(()=>{const e=m(),t=m(),i=m();return({start:n,end:o},{center:r,radius:a,normal:s,slicePlane:p})=>{const l=xt(r,s,Br);if(w(ii(l,n),0)&&w(ii(l,o),0)){yn(s,e,t);const u=(v,g)=>(At(i,g,r),ln(v,$(i,e),$(i,t)),v),f=Vr({start:u(et,n),end:u(Nt,o),type:M.LINE},Ko,a),y=[];for(const[v,g]of f){const _=Lt(m(),r);N(_,_,e,v),N(_,_,t,g),p&&!Te(p,_)||y.push(_)}return y}const d=m();return dn(l,n,o,d)?!w(Ze(d,r),a)||p&&!Te(p,d)?[]:[d]:[]}})();function Rn({start:e,end:t,type:i},n,o){const r=[],a=At(It,t,e),s=U(Nt,e,n),p=Ce(a),l=2*He(a,s),d=l*l-4*p*(Ce(s)-o*o);if(d===0){const u=-l/(2*p);(i===M.LINE||u>=0)&&r.push(N(m(),e,a,u))}else if(d>0){const u=Math.sqrt(d),f=(-l+u)/(2*p);(i===M.LINE||f>=0)&&r.push(N(m(),e,a,f));const y=(-l-u)/(2*p);(i===M.LINE||y>=0)&&r.push(N(m(),e,a,y))}return r}function Mn(e,t){const i=e.start,n=e.end,o=t.start,r=t.end,a=F(It,n,i),s=F(kt,r,o),p=F(ui,o,i),l=Et(Pn,a,s);if(!w($(p,l),0))return[];const d=ei(l);if(w(d,0))return[];const u=Et(An,p,s),f=$(u,l)/d,y=N(Ln,i,a,f);if(e.type===M.RAY){const v=F(oi,y,i);if($(a,v)<-Xe())return[]}if(t.type===M.RAY){const v=F(oi,y,o);if($(s,v)<-Xe())return[]}return[Se(y)]}function qr({start:e,end:t,type:i},n){const o=F(It,n,e),r=F(kt,t,e),a=Et(ui,r,o),s=ei(a)/ei(r),p=Xe();if(s<p)switch(i){case M.LINE:return[Se(n)];case M.RAY:return $(r,o)<-p?[]:[Se(n)]}return[]}function di(e,t,i,n){const[o,r]=e,[a,s]=i,p=a-o,l=s-r,d=p*p+l*l,u=Math.sqrt(d);if(u>t+n)return[];if(u<Math.abs(t-n))return[];if(w(u,0)&&w(t,n))return[];const f=(t*t-n*n+d)/(2*u),y=Math.sqrt(t*t-f*f),v=y*l/u,g=y*p/u,[_,O]=Zo(et,e,i,f/u);return w(v,g)?[gt(_,O)]:[gt(_+v,O-g),gt(_-v,O+g)]}function Ot(e,t,{start:i,end:n,type:o}){return q(e.start,i[0],i[1],t),q(e.end,n[0],n[1],t),e.type=Yr[o],e}function Gn(e,t){return w(e[2],t[2])}function w(e,t){return uo(Math.abs(e-t),0,Xe())}function jr(e,t){return t.filter(i=>Te(e,i))}function Te(e,t){return cr(e,t)}var z;(function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"})(z||(z={}));const Yr={[z.PLANE]:M.LINE,[z.HALF_PLANE]:M.RAY},et=Z(),Nt=Z(),It=m(),kt=m(),ui=m(),Pn=m(),An=m(),Ln=m(),oi=m(),Br=W(),yi={start:m(),end:m(),type:M.LINE},Zr={start:m(),end:m(),type:M.LINE};class X{intersect(t){return he(this,t)}closestPoints(t){return[this.closestTo(t)]}}class Ue extends X{constructor(t){super(),this.point=t}equals(t){return this===t||J(t)&&R(this.point,t.point)}closestTo(){return Ie(this.point)}}class gi extends X{constructor(t,i,n){super(),this.start=t,this.end=i,this.lineLike={start:t,end:i,type:n}}equals(t){return this===t||ne(t)&&this.lineLike.type===t.lineLike.type&&R(this.start,t.start)&&R(this.end,t.end)}closestTo(t){const i=j();return On(t,this.lineLike,i),i}}class vi extends gi{constructor(t,i){super(t,i,M.LINE)}}class Wr extends gi{constructor(t,i){super(t,i,M.RAY)}}class Cn extends X{constructor(t){super(),this.constraints=t}equals(t){return this===t||ri(t)&&yo(this.constraints,t.constraints,(i,n)=>i.equals(n))}closestTo(t){let i,n=1/0;for(const o of this.constraints){const r=o.closestTo(t),a=Qt(t,r);a<n&&(n=a,i=r)}return Ie(i??t)}closestPoints(t){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(t))}}class Dn extends X{constructor(t,i){super(),this.center=t,this.radius=i}equals(t){return this===t||re(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const i=j();return Sn(t,this.center,this.radius,i),i}}class fi extends X{constructor(t,i){super(),this.center=t,this.radius=i}equals(t){return this===t||ue(t)&&R(this.center,t.center)&&this.radius===t.radius}closestTo(t){const i=j();return Sn(t,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new mi(Ie(this.center),this.radius,Oe(0,0,1))}}class mi extends X{constructor(t,i,n,o=void 0){super(),this.center=t,this.radius=i,this.normal=n,this.slicePlane=o}equals(t){return this===t||be(t)&&R(this.center,t.center)&&R(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:i,radius:n}=this;un(this.getPlane(Kr),t,qt);const o=F(qt,qt,i),r=pn(o);if(w(r,0))return Ie(t);const a=n/Math.sqrt(r),s=j();N(s,i,o,a);const{slicePlane:p}=this;return p&&!Te(p,s)?Ei(p,this)?.closestTo(t)??Ie(t):s}getPlane(t=W()){return xt(this.center,this.normal,t)}}const qt=m(),Kr=W();class Xr extends X{constructor(t){super(),this.z=t}equals(t){return this===t||de(t)&&this.z===t.z}closestTo(t){return Oe(t[0],t[1],this.z)}getPlane(t=W()){return q(qi,0,0,this.z),xt(qi,Eo,t)}}const qi=m();class _i extends X{constructor(t,i,n){super(),this.start=t,this.end=i,this.planeLike={start:t,end:i,type:n}}equals(t){return this===t||oe(t)&&this.planeLike.type===t.planeLike.type&&R(this.start,t.start)&&R(this.end,t.end)}closestTo(t){const i=j();return Tn(t,this.planeLike,i),i}closestEndTo(t){const{start:i,end:n}=this.planeLike;return Math.sign(He(U(Jr,n,i),U(Qr,t,i)))>0?this.end:this.start}getPlane(t=W()){const i=Lt(ji,this.end);return i[2]+=1,gn(this.start,this.end,i,t)}getSlicePlane(t=W()){const{start:i,end:n,type:o}=this.planeLike;if(o===z.PLANE)return;const r=q(ji,i[0],i[1],0),a=q(Yi,n[0],n[1],0),s=At(Yi,a,r);return xt(r,s,t),t}}const Jr=Z(),Qr=Z(),ji=m(),Yi=m();class al extends _i{constructor(t,i){super(t,i,z.HALF_PLANE)}}class xn extends _i{constructor(t,i){super(t,i,z.PLANE)}}class es extends X{constructor(t,i){super(),this.sphere=yr(t,i)}equals(t){return this===t||ye(t)&&gr(this.sphere,t.sphere)}closestTo(t){const i=j();return vr(this.sphere,t,i),i}get center(){return fr(this.sphere)}get radius(){return this.sphere[3]}}class Nn extends X{constructor(t,i,n){super(),this.start=t,this.end=i,this.getZ=n,this.planeLike={start:t,end:i,type:z.PLANE}}equals(t){return this===t||Rt(t)&&R(this.start,t.start)&&R(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return ss(this,t)}addIfOnTheGround(t,i){for(const n of i){const o=this.getZ(n[0],n[1])??0;w(n[2],o)&&(n[2]=o,t.push(n))}}}class ts extends X{constructor(t,i,n){super(),this._x=t,this._y=i,this._z=n}equals(t){return this===t||ws(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,i,n]){return mn(this._x??t,this._y??i,this._z??n)}}class is extends X{constructor(t,i,n,o,r){super(),this._origin=t,this._spatialReference=i,this._distanceMeters=n,this._z=o,this._directionDegrees=r}equals(t){return this===t||bs(t)&&xi(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,i,n]){return ln(Fe,t,i),xi(Fe,this._origin)||this._applyDirectionAndDistance(Fe),mn(Fe[0],Fe[1],this._z??n)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)bt(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)os(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=Ct(ns,this._origin,t,this._spatialReference);bt(t,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const Fe=[0,0],ns=new Dt;function os(e,t,i,n,o){let{azimuth:r,distance:a}=Ct(rs,t,n,o);r??=0;let s=a*Math.cos((r-i)*Co);s=Math.max(0,s),bt(e,t,i,s,o)}const rs=new Dt;function ss(e,t){const i=j();return Tn(t,e.planeLike,i),i[2]=e.getZ(i[0],i[1])??kn,i}function he(e,t){if(ri(e)){const i=[];for(const n of e.constraints){const o=n.intersect(t);o&&i.push(o)}return bi(i)}if(ri(t))return he(t,e);if(Rt(e))return Bi(e,t);if(Rt(t))return Bi(t,e);if(J(e)){const{point:i}=e;if(J(t))return R(i,t.point)?e:void 0;const n=t.closestTo(i);return er(n,i)?e:void 0}if(ne(e)){if(J(t))return he(t,e);if(ne(t))return te(Mn(e.lineLike,t.lineLike));if(de(t))return as(e,t);if(oe(t))return te(bn(t.planeLike,e.lineLike));if(re(t))return te(Rn(e.lineLike,t.center,t.radius));if(be(t))return te(zr(e.lineLike,t));if(ue(t))return ls(e,t);if(ye(t))return ps(e,t)}else if(de(e)){if(J(t)||ne(t))return he(t,e);if(de(t))return cs(e,t);if(oe(t))return hs(e,t);if(re(t))return ds(e,t);if(be(t))return ys(e,t);if(ue(t))return us(e,t);if(ye(t))return gs(e,t)}else if(oe(e)){if(J(t)||ne(t)||de(t))return he(t,e);if(oe(t))return jt(wn(e.planeLike,t.planeLike));if(re(t))return jt(hi(e.planeLike,t.center,t.radius));if(be(t))return fs(e,t);if(ue(t))return vs(e,t);if(ye(t))return ms(e,t)}else if(re(e)){if(J(t)||ne(t)||de(t)||oe(t))return he(t,e);if(re(t))return jt(di(e.center,e.radius,t.center,t.radius));if(be(t))return;if(ue(t))return _s(e,t);if(ye(t))return}else if(be(e)){if(J(t)||ne(t)||de(t)||oe(t)||re(t))return he(t,e);if(be(t))return;if(ue(t))return t.asCircle(),void 0;if(ye(t))return}else if(ue(e)){if(J(t)||ne(t)||de(t)||oe(t)||re(t)||be(t))return he(t,e);if(ue(t))return Es(t,e);if(ye(t))return}else if(ye(e)){if(J(t)||ne(t)||de(t)||oe(t)||re(t)||ue(t))return he(t,e);if(ye(t))return}}const as=(()=>{const e=W();return(t,i)=>{const{start:n,end:o}=t;if(Gn(n,o)&&w(n[2],i.z))return t;const r=j();return dn(i.getPlane(e),n,o,r)?new Ue(r):void 0}})();function ls({lineLike:e},{center:t,radius:i}){const n=t[2];return te(Rn(e,t,i).filter(o=>w(o[2],n)))}function ps({lineLike:e},{sphere:t}){return te(ur(t,e.start,e.end))}const Ei=(()=>{const e=lr(),t=m(),i=m();return(n,o,r)=>{const{normal:a,center:s,radius:p}=o;yn(a,t,i);const l=ci(n),d=p*$(l,t),u=p*$(l,i);sr(e,s[0],s[1],s[2],1);const f=ar(n,e),y=Math.hypot(d,u),v=w(y,0);if(w(ii(n,s),0)){if(v)return o;if(w(p,0))return!r||Te(r,s)?new Ue(Ie(s)):void 0;Et(t,l,a),Xo(t,t);const Ut=new Array,nt=Se(s);N(nt,nt,t,p),r&&!Te(r,nt)||Ut.push(nt);const ot=Se(s);return N(ot,ot,t,-p),r&&!Te(r,ot)||Ut.push(ot),te(Ut)}if(v)return;const g=-f/y;if(Math.abs(g)>1||w(g,1))return;const _=Math.atan(d/u),O=mo(g)-_,S=Math.PI-O,Re=new Array,tt=m();N(tt,s,t,p*Math.cos(O)),N(tt,tt,i,p*Math.sin(O)),Re.push(tt);const it=m();return N(it,s,t,p*Math.cos(S)),N(it,it,i,p*Math.sin(S)),Re.push(it),te(r?jr(r,Re):Re)}})();function cs(e,t){return w(e.z,t.z)?e:void 0}function hs({z:e},{planeLike:t}){const[i,n]=t.start,[o,r]=t.end,a=Oe(i,n,e),s=Oe(o,r,e);return t.type===z.PLANE?new vi(a,s):new Wr(a,s)}function ds(e,t){const[i,n]=t.center;return new fi(Oe(i,n,e.z),t.radius)}function us(e,t){return w(t.center[2],e.z)?t:void 0}const ys=(()=>{const e=W();return(t,i)=>Ei(t.getPlane(e),i,i.slicePlane)})();function gs(e,{center:t,radius:i}){const n=Math.abs(t[2]-e.z);if(n>i&&!w(n,i))return;const o=Oe(t[0],t[1],e.z),r=Math.sqrt(i**2-n**2);return w(r,0)?void 0:new fi(o,r)}const vs=(()=>{const e=W();return(t,{center:i,radius:n})=>{const o=hi(t.planeLike,i,n),r=i[2];t.getSlicePlane(e);const a=new Array;for(const[s,p]of o){const l=[s,p,r];Te(e,l)&&a.push(l)}return te(a)}})(),fs=(()=>{const e=W(),t=W();return(i,n)=>Ei(i.getPlane(e),n,i.getSlicePlane(t))})(),ms=(()=>{const e=W();return(t,{center:i,radius:n})=>{const o=t.getPlane(e),r=pr(o,i),a=Math.abs(r);if(a>n&&!w(a,n))return;const s=Math.sqrt(n**2-r**2);if(w(s,0)){const d=j();return un(o,i,d),new Ue(d)}const p=j(),l=Se(ci(o));return N(p,i,l,r),new mi(p,s,l,t.getSlicePlane())}})();function _s(e,t){const i=an(e.center,t.center);return w(i,0)&&w(e.radius,t.radius)?t:In(di(e.center,e.radius,t.center,t.radius),t.center[2])}function Es(e,t){if(!Gn(e.center,t.center))return;const i=an(e.center,t.center);return w(i,0)&&w(e.radius,t.radius)?e:In(di(e.center,e.radius,t.center,t.radius),e.center[2])}function Bi(e,t){const{planeLike:i,getZ:n}=e,o=new Array;if(J(t))e.addIfOnTheGround(o,Fr(i,t.point));else if(ne(t))e.addIfOnTheGround(o,bn(i,t.lineLike));else if(re(t))for(const[r,a]of hi(i,t.center,t.radius)){const s=n(r,a);s!=null&&o.push(mt(r,a,s))}else if(oe(t)||Rt(t))for(const[r,a]of wn(i,t.planeLike)){const s=n(r,a)??kn;o.push(mt(r,a,s))}return te(o)}function jt(e){return bi(e.map(([t,i])=>{const n=Oe(t,i,0),o=Oe(t,i,1);return new vi(n,o)}))}function te(e){return bi(e.map(t=>t?new Ue(t):void 0))}function In(e,t){return te(e.map(([i,n])=>[i,n,t]))}function bi(e){if(e.length!==0)return e.length===1?e[0]??void 0:new Cn(e.filter(Zn))}function ri(e){return e instanceof Cn}function J(e){return e instanceof Ue}function ne(e){return e instanceof gi}function de(e){return e instanceof Xr}function oe(e){return e instanceof _i}function re(e){return e instanceof Dn}function ue(e){return e instanceof fi}function be(e){return e instanceof mi}function ye(e){return e instanceof es}function Rt(e){return e instanceof Nn}function bs(e){return e instanceof is}function ws(e){return e instanceof ts}const kn=0;let Ve=class{constructor(e,t,i,n){this.targetPoint=e,this.constraint=t,this.isDraped=i,this.domain=n}},Hn=class extends Ve{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:n}){super(e,i,n,k.FEATURE),this.objectId=t}},Ht=class{constructor(e,t){this.isDraped=e,this.domain=t}},pe=class Un extends Ht{constructor(t,i,n,o,r=k.ALL,a=!0,s=!0){super(o,r),this.type=t,this.lineStart=i,this.lineEnd=n,this.fadeLeft=a,this.fadeRight=s}equals(t){return t instanceof Un&&this.type===t.type&&R(this.lineStart,t.lineStart)&&R(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return Ze(this.lineStart,this.lineEnd)}},Ts=class extends Hn{constructor(e){super({...e,isDraped:!0,constraint:new Nn(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new pe(K.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Ss=class extends Hn{constructor(e){super({...e,constraint:new vi(e.edgeStart,e.edgeEnd)})}get hints(){return[new pe(K.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},Os=class Vn extends Ht{constructor(t,i,n=k.ALL){super(i,n),this.intersectionPoint=t}equals(t){return t instanceof Vn&&R(this.intersectionPoint,t.intersectionPoint)}},vt=class extends Ve{constructor(e,t,i,n){super(e,new Ue(e),n,k.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new Os(this.targetPoint,this.isDraped,this.domain)]}},Rs=class extends Ve{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:n}){super(i,new xn(e,t),n,k.SELF),this._referenceLineHint=new pe(K.REFERENCE_EXTENSION,e,t,n,this.domain)}get hints(){return[this._referenceLineHint,new pe(K.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},Ms=class $n extends Ht{constructor(t,i,n,o=k.ALL){super(n,o),this.lineStart=t,this.lineEnd=i}equals(t){return t instanceof $n&&R(this.lineStart,t.lineStart)&&R(this.lineEnd,t.lineEnd)}},Gs=class extends Ve{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:n}){const o=Se(t),{left:r,right:a}=e;At(o,Jo(o,o,a),r),super(i,new xn(t,o),n,k.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new pe(K.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new Ms(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new pe(K.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{R(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),R(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),R(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),R(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}},Fn=class zn extends Ht{constructor(t,i,n,o,r=k.ALL){super(o,r),this.previousVertex=t,this.centerVertex=i,this.nextVertex=n}equals(t){return t instanceof zn&&R(this.previousVertex,t.previousVertex)&&R(this.centerVertex,t.centerVertex)&&R(this.nextVertex,t.nextVertex)}},Ps=class extends Ve{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:n,otherVertexType:o,isDraped:r,selfSnappingType:a,objectId:s,domain:p}){super(e,t,r,p??k.SELF),this.previousVertex=i,this.otherVertex=n,this.otherVertexType=o,this.selfSnappingType=a??Gt.None,this.objectId=s??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===Mt.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===Mt.CENTER?this.targetPoint:this.otherVertex;return[new pe(K.TARGET,t,i,this.isDraped,this.domain),new pe(K.REFERENCE,e,t,this.isDraped,this.domain),new Fn(this.previousVertex,t,i,this.isDraped,this.domain)]}};var Mt,Gt;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(Mt||(Mt={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(Gt||(Gt={}));let As=class extends Ve{constructor({targetPoint:e,point1:t,point2:i,isDraped:n}){super(e,new Dn(Qo(m(),t,i,.5),.5*zo(t,i)),n,k.SELF),this._p1=t,this._p2=i}get hints(){return[new pe(K.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new pe(K.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new Fn(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}};function Ls(e,t,i,n,o=m()){const r=Lt(Cs,e);return r[2]=rn(n,r,t,i)||0,n.renderCoordsHelper.toRenderCoords(r,t,o),o}const Cs=m();function Ds(e,t,i,n){return n.type==="2d"?(st.x=e[0],st.y=e[1],st.spatialReference=t,n.toScreen(st)):(Ls(e,t,i,n,Zi),n.state.camera.projectToScreen(Zi,Yt),go(Yt[0],Yt[1]))}const st=Qe(0,0,0,null),Zi=m(),Yt=vo();function ll(e){return hn(e)||tn(e)}function wi(e,t,i,...n){return hn(e)?t.apply(void 0,n):e.isWebMercator?i.apply(void 0,n):null}function xs(e){const{spatialReference:t}=e;return wi(t,Us,Vs,e)}function Ns(e,t){if(!Je(e.spatialReference,t.spatialReference))return null;const{spatialReference:i}=e;return at[0]=e.x,at[1]=e.y,at[2]=e.hasZ?e.z:0,lt[0]=t.x,lt[1]=t.y,lt[2]=t.hasZ?t.z:0,qn(at,lt,i)}function qn(e,t,i){return wi(i,ks,Hs,e,t,i)}const Is={geodesicLength:xs,geodesicDistanceBetweenPoints:Ns,geodesicDistance:qn};async function jn(){return await mr(),Is}function ks(e,t,i){return _e(Ct(Fs,e,t,i).distance,"meters")}function Hs(e,t,i){return _e(vn($s(e,t,i),{unit:"meters"}),"meters")}function Us(e){return _e(tr([e],"meters")[0],"meters")}function Vs(e){return _e(vn(e,{unit:"meters"}),"meters")}function $s(e,t,i){return new wo({spatialReference:i,paths:[[[...e],[...t]]]})}const Fs=new Dt,at=m(),lt=m();let Q=class extends si.EventedMixin(ce){constructor(e){super(e),this.options=new L,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ve.MAIN}initialize(){this.addHandles([Pe(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:i,effectiveFeatureEnabled:n,effectiveGridEnabled:o}=this.options;return{selfEnabled:i,featureEnabled:n,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=nr(i=>this._updateEngines(e,t,i))},Be),Pe(()=>this.options,e=>{for(const t of this._engines)t.options=e},fo)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,i){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const n=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!n.has("feature")?this._createFeatureSnappingEngine(i):void 0,e.selfEnabled&&!n.has("self")?this._createSelfSnappingEngine(i):void 0,e.gridEnabled&&!n.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(const r of o)r.status==="fulfilled"&&r.value?.engine.destroy();else{for(const r of o)r.status==="fulfilled"&&r.value&&n.set(r.value.type,r.value.engine);this._engines=Array.from(n.values())}}async _createSelfSnappingEngine(e){const[{SelfSnappingEngine:t},i]=await Promise.all([I(()=>import("./SelfSnappingEngine-CXO0G0NU-Cq92qfS9.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]),import.meta.url),jn()]);return Vt(e),{type:"self",engine:new t({view:this.view,options:this.options,geodesicLengthMeasurementUtils:i})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:i}=await I(()=>import("./GridSnappingEngine-DCu-2xRk-ClMZeM8v.js"),__vite__mapDeps([51,1,2,11,9,13,52,53,54,55,56,57,31,12,14,15,16,17,18,19,20,21,22,23,24,6,7,5,25,26,27,28,3,4,8,10,29,30,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]),import.meta.url);return Vt(e),{type:"grid",engine:new i({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await I(()=>import("./FeatureSnappingEngine-D6B44S6e-Cf9AtUda.js"),__vite__mapDeps([58,1,2,32,8,9,11,12,5,6,7,59,33,34,35,17,60,61,13,14,15,16,18,19,20,21,22,23,24,25,26,27,28,3,4,10,29,30,31,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]),import.meta.url);Vt(e);const{view:i,options:n}=this,{spatialReference:o}=i;return{type:"feature",engine:new t({view:i,options:n,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}snap(e){return js(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const n=this._currentMainCandidate;if(n==null)return t;const o=this._selectUpdateInput(e);if(o==null)return t;const{spatialReference:r}=i,a=Jt(o,r);if(a==null)return t;const{view:s}=this,{elevationInfo:p,visualizer:l}=i,d=[],u=Ye(a,s,p),f=n.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,f,i)||!Zt(n,i.drawConstraints))return this._resetSnappingState(),t;n.targetPoint=Ft(f),d.push(...n.hints);for(const y of this._currentOtherActiveCandidates)Zt(y,i.drawConstraints)&&(y.targetPoint=Ft(f),d.push(...y.hints));return l!=null&&this.addHandles(l.draw(d,{spatialReference:r,elevationInfo:Ys(i),view:s,selfSnappingZ:i.selfSnappingZ}),Bt),$i(f,s,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case ve.MAIN:return e;case ve.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ve.MAIN}_removeVisualization(){this.removeHandles(Bt)}async _snapSinglePoint({point:e,context:t,signal:i}){const{view:n}=this,{elevationInfo:o}=t,r=Ye(e,n,o),a=await this._fetchCandidates(r,k.ALL,t,i);return this._createSnapResult(r,ve.MAIN,a,n,e,t,i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:n}){const{view:o}=this,{coordinateHelper:r,elevationInfo:a,spatialReference:s}=i;await Go(t.spatialReference,s);const p=Jt(t,s),l=Ye(p,o,a),d=await this._fetchCandidates(l,k.FEATURE,i,n);if(d.length>0){const y=await this._fetchCandidates(l,k.SELF,i,n);return this._createSnapResult(l,ve.SCENE,[...d,...y],o,p,i,n)}const u=Ye(e,o,a),f=await this._fetchCandidates(u,k.SELF,i,n);return this._createSnapResult(u,ve.MAIN,f,o,{z:r.hasZ()&&e.hasZ?e.z??0:void 0,m:r.hasM()&&e.hasM?e.m??0:void 0},i,n)}async _fetchCandidates(e,t,i,n){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,i,n)))).flat()}_createSnapResult(e,t,i,n,o,r,a){return{get valid(){return!Wn(a)},apply:()=>{const{spatialReference:s}=r,{snappedPoint:p,hints:l}=this._processCandidates(e,t,i,r);return this._removeVisualization(),r.visualizer!=null&&this.addHandles(r.visualizer.draw(l,{spatialReference:s,elevationInfo:Ne,view:n,selfSnappingZ:r.selfSnappingZ}),Bt),$i(p,n,o,r)}}}_processCandidates(e,t,i,n){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),Ir(e,i);const o=this._currentMainCandidate;if(o!=null){const r=qs(o,i);if(r>=0){if(!(i[r]instanceof vt))return this._intersectWithOtherCandidates(r,i,e,t,n);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,n))return this._updateSnappingCandidate(o,t,i,n)}}return this._intersectWithOtherCandidates(0,i,e,t,n)}_intersectWithOtherCandidates(e,t,i,n,o){const{coordinateHelper:r}=o,a=t[e],s=[];for(let p=0;p<t.length;++p){if(p===e)continue;const l=t[p],d=a.constraint.intersect(l.constraint);if(d)for(const u of d.closestPoints(a.targetPoint))s.push([new vt(Ft(u),a,l,l.isDraped),this._squaredScreenDistance(i,u,r)])}return s.length>0&&(s.sort((p,l)=>p[1]-l[1]),s[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(s[0][0],n,t,o):Zt(a,o.drawConstraints)?this._updateSnappingCandidate(a,n,t,o):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(e,t,i,n){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,r=[];r.push(...e.hints);for(const a of i){if(e instanceof vt){if(a.constraint.equals(e.first.constraint)||a.constraint.equals(e.second.constraint))continue}else if(a.constraint.equals(e.constraint))continue;const s=a.constraint.closestTo(o);this._squaredScreenDistance(s,o,n.coordinateHelper)<zs()&&(a.targetPoint=o,this._currentOtherActiveCandidates.push(a),r.push(...a.hints))}return{snappedPoint:o,hints:r}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return _n(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return Ds(e,t.spatialReference,Ne,this.view)}get test(){}};var ve;c([h({constructOnly:!0})],Q.prototype,"view",void 0),c([h()],Q.prototype,"options",void 0),c([h({readOnly:!0})],Q.prototype,"updating",null),c([h()],Q.prototype,"_loadTask",void 0),c([h()],Q.prototype,"_engines",void 0),c([h()],Q.prototype,"_squaredMouseProximityThreshold",null),c([h()],Q.prototype,"_squaredTouchProximityThreshold",null),Q=c([H("esri.views.interactive.snapping.SnappingManager")],Q),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(ve||(ve={}));const Bt="visualization-handle";function zs(){return Tt.satisfiesConstraintScreenThreshold*Tt.satisfiesConstraintScreenThreshold}function Zt(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof Ts||e instanceof Ss||e instanceof Rs||e instanceof Gs||e instanceof As)&&(!(e instanceof Ps)||t.direction==null&&e.selfSnappingType===Gt.LastVertex)}function qs(e,t){return e instanceof vt?Wt(t,e.first)>=0&&Wt(t,e.second)>=0?0:-1:Wt(t,e)}function Wt(e,t){let i=-1;for(let n=0;n<e.length;++n)if(t.constraint.equals(e[n].constraint)){i=n;break}return i}function js(e){return e.scenePoint!=null}function Ys({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Ne:t}function Ti(e){return To(e)?So(e)||tn(e)||Oo(e)||Ro(e)?br:e:wr(e)}function Bs(e,t=Pt()){return Yn(e,t)}function Zs(e,t=Pt()){return Yn(e,t,!1)}function Yn(e,t,i=e.hasZ){const n=Ti(e.spatialReference),o=bo(n);if(o==null)return null;const r=(s,p)=>!(p.length<2)&&(q(s,p[0],p[1],i&&p[2]||0),!0);let a=0;for(const s of e.rings){const p=s.length;if(p<3)continue;const{positionsWorldCoords:l}=t;for(;l.length<p;)l.push(m());const d=Ws,u=q(Ks,0,0,0),f=1/p;for(let g=0;g<p;g++){if(!r(d,s[g])||!we(d,e.spatialReference,l[g],n))return null;N(u,u,l[g],f)}const y=gn(l[0],l[1],u,hr());if(pn(ci(y))===0)continue;for(let g=0;g<p;g++)dr(y,u,l[g],l[g]);const v=Xs(l);for(let g=0;g<v.length;g+=3)a+=Er(l[v[g]],l[v[g+1]],l[v[g+2]])}return pi(a,o)}const Ws=m(),Ks=m();function Pt(){return{positionsWorldCoords:[]}}function Xs(e){return _r(Js(e),[],2)}function Js(e){const t=new Float64Array(2*e.length);for(let i=0;i<e.length;++i){const n=e[i],o=2*i;t[o]=n[0],t[o+1]=n[1]}return t}const Qs=e=>({geodesicArea(t){const{spatialReference:i}=t;return wi(i,ta,n=>ia(e,n),t)}});async function ea(){const e=await I(()=>import("./geometryEngine-C83waDS7-CFUox9UW.js"),__vite__mapDeps([62,1,2,63,64,65]),import.meta.url);return Qs(e)}function ta(e){return pi(Math.abs(ir([e],"square-meters")[0]),"square-meters")}function ia(e,t){try{return pi(Math.abs(e.geodesicArea(t,"square-meters")),"square-meters")}catch{return null}}const na=e=>({autoAreaByElevationMode(t,i,n=Pt()){return i==="on-the-ground"?e.geodesicArea(t)??Zs(t,n):Bs(t,n)},autoArea2D(t,i=Pt()){return this.autoAreaByElevationMode(t,"on-the-ground",i)}});let Kt=null;async function pt(){return Kt||(Kt=na(await ea())),Kt}var le;function oa(e){return ra(e,le.Horizontal)}function ra(e,t){const{hasZ:i,spatialReference:n}=e,o=Ti(n);let r=0;const a=nn(o);if(a==null)return null;const s=t===le.Direct?la:Si;for(const p of e.paths){if(p.length<2)continue;const l=p.length-1;for(let d=0;d<l;++d){const u=p[d];Y[0]=u[0],Y[1]=u[1],Y[2]=i?u[2]:0;const f=p[d+1];B[0]=f[0],B[1]=f[1],B[2]=i?f[2]:0;const y=s(Y,B,n);if(y==null)return null;r+=y.value}}return _e(r,a)}function sa(e,t){const{spatialReference:i}=e;return Je(i,t.spatialReference)?(Y[0]=e.x,Y[1]=e.y,Y[2]=e.hasZ?e.z:0,B[0]=t.x,B[1]=t.y,B[2]=t.hasZ?t.z:0,Si(Y,B,i)):null}function pl(e,t){const{spatialReference:i}=e;return Je(i,t.spatialReference)?(Y[0]=e.x,Y[1]=e.y,Y[2]=e.hasZ?e.z:0,B[0]=t.x,B[1]=t.y,B[2]=t.hasZ?t.z:0,pa(Y,B,i)):null}function cl(e){return e!=null?aa(e.hasZ?e.z:0,e.spatialReference):null}function aa(e,t){const i=_o(t);return i!=null?_e(e??0,i):null}function la(e,t,i){const n=Oi(e,t,i,le.Direct);return n!=null?_e(n.direct,n.unit):null}function Si(e,t,i){const n=Oi(e,t,i,le.Horizontal);return n!=null?_e(n.horizontal,n.unit):null}function pa(e,t,i){const n=Oi(e,t,i,le.Vertical);return n!=null?_e(n.verticalSigned,n.unit):null}function Oi(e,t,i,n){const o=Ti(i),r=nn(o);if(r==null)return null;const a=t[2]-e[2];if(n===le.Vertical)return{verticalSigned:a,unit:r};if(!we(e,i,Xt,o)||!we(t,i,ct,o))return null;if(n===le.Direct)return{direct:Ze(ct,Xt),unit:r};if(q(ht,e[0],e[1],t[2]),!we(ht,i,ht,o))return null;const s=Ze(ht,ct);return n===le.Horizontal?{horizontal:s,unit:r}:{direct:Ze(ct,Xt),horizontal:s,vertical:Math.abs(a),unit:r}}(function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"})(le||(le={}));const Y=m(),B=m(),Xt=m(),ct=m(),ht=m();function ca(e){return{autoLength2D:t=>e.geodesicLength(t)??oa(t),autoDistanceBetweenPoints2D:(t,i)=>e.geodesicDistanceBetweenPoints(t,i)??sa(t,i),autoDistance2D:(t,i,n)=>(ze[0]=t[0],ze[1]=t[1],ze[2]=t.length===3?t[2]:0,qe[0]=i[0],qe[1]=i[1],qe[2]=i.length===3?i[2]:0,e.geodesicDistance(ze,qe,n)??Si(ze,qe,n))}}async function Me(){return ca(await jn())}const ze=m(),qe=m();function ha(e){return e?.type==="graphic"}function da(e){return e.find(ha)??null}let D=class extends si.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:Kn(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};c([h()],D.prototype,"activeComponent",void 0),c([h()],D.prototype,"cancelled",void 0),c([h()],D.prototype,"history",void 0),c([h()],D.prototype,"tool",null),c([h()],D.prototype,"type",void 0),c([h()],D.prototype,"canUndo",null),c([h()],D.prototype,"canRedo",null),c([h()],D.prototype,"onEnd",void 0),c([h()],D.prototype,"undo",null),c([h()],D.prototype,"redo",null),c([h()],D.prototype,"toggleTool",void 0),c([h()],D.prototype,"addToSelection",void 0),c([h()],D.prototype,"removeFromSelection",void 0),D=c([H("esri.widgets.Sketch.support.OperationHandle")],D);let ft=class extends D{};c([h()],ft.prototype,"activeComponent",void 0),ft=c([H("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],ft);let fe=class extends D{};c([h()],fe.prototype,"activeComponent",void 0),fe=c([H("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],fe);function ua(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function ya(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var Wi;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(Wi||(Wi={}));const Ki={defaultZ:0},je={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0,name:Vo},tool:"transform"};let E=class extends si.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new Mo,this._internalGraphicsLayer=new Do({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new Ri({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Xn({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Jn({color:[130,130,130,1],width:2}),this.meshSymbol=new Qn({symbolLayers:new Ae([new eo])}),this.updateGraphics=new Ae,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new Ri({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new Ge,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=Ki,this.defaultUpdateOptions=je,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new L}initialize(){this.addHandles([Mi(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),Mi(()=>this.layer?.graphics,"change",e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),Pe(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},Be),Pe(()=>this.view,e=>{this._defaultSnappingManager=rt(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new Q({view:e,options:this.snappingOptions})),e.type==="2d"?I(()=>import("./editingTools-7dqMzBcg-96bUlo8v.js"),__vite__mapDeps([66,1,2,67,8,9,10,68,69,70,11,4,71,32,72,73,23,41,74,40,42,36,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,6,7,61,88,89,90,91,12,13,5,25,29,30,31,33,34,35,37,38,39,43,44,45,46,47,48,49,50,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120]),import.meta.url):e.type==="3d"&&(I(()=>import("./ImageMaterial.glsl-4GA395N2-DLXcrhAI.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(t=>t.e),I(()=>import("./LineCallout.glsl-0Cou_Qxw-BwXS-52F.js"),__vite__mapDeps([165,1,2,166,167,13,30,29,5,6,7,125,23,9,41,8,10,11,36,37,123,43,44,40,39,42,38,124,109,126,74,50,127,128,129,130,131,132,133,134,135,136,48,49,137,138,139,140,141,114,142,143,144,76,77,111,145,146,147,108,12,16,17,168,33,34,35,162,169,153,112,113,170,171,172,173,174,175,176,22,72,177,158,178,179,180,181,182,183,32,184,185,186,187,188,189,26,27,28,61,190]),import.meta.url).then(t=>t.G)))},Be),Pe(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),Hr(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=rt(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,i=!t&&e&&"tooltip"in e?e.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Ki,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...je,...e,reshapeOptions:{...je.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...je.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=rt(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new Q({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:n,map:o}=t;n&&(t.cursor=null),o?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),e&&this.addHandles(to(()=>e.ready,n=>{this.removeHandles(this._viewHandlesKey),n&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},Be),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=$t(this._moduleLoaderAbortController),this._viewReadyAbortController=$t(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:i,layer:n}=this,o=t.toArray();n.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:i,layer:n}=this;if(!i||this.state==="disabled")throw n||this._logMissingLayer(),Gi();if(i.activeTool!=null&&(i.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");Ui(i,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(o==null||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);const r=()=>{if(o===this._operationHandle){const a=this.createGraphic,s=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||a==null||n.add(a),this._sketchContinuationFlag=!1,this.emit("create",{graphic:a,state:s?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),s||this._sketchContinuationFlag)return;const{creationMode:p}=this;if(p==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(Li(this.create(e,t)))}else p==="update"&&a&&this._updatingHandles.addPromise(Li(this.update([a])))}};o.on("complete",r),this._operationHandle=o,i.ready&&i.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:n,state:o}=this;if(!n||o==="disabled")throw i||this._logMissingLayer(),Gi();n.activeTool!=null&&(n.activeTool=null);const r=Array.isArray(e)?e:[e];if(e==null||!r?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(r.some(s=>s.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):s.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const a=await this._updatingHandles.addPromise(this._setupUpdateOperation(r,t));this.destroyed||a==null||P(a)||(Ui(n,this._internalGraphicsLayer),this._setUpdateOperationHandle(a,t),this.emit("update",{graphics:r,state:"start",aborted:!1,tool:a.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const i of e)i.geometry==null||i.geometry.type==="mesh"||Je(i.geometry.spatialReference,t.spatialReference)||(Po(i.geometry.spatialReference,t.spatialReference)||Ao()||await Lo(),i.geometry=Jt(i.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const o=[];t.map.allLayers.forEach(a=>{a.type!=="vector-tile"&&a.type!=="imagery"||o.push(a)});const r=await t.hitTest(e,{exclude:o});return da(r.results)}const i=[t.map.ground];t.map.allLayers.forEach(o=>{io(o.type)&&i.push(o)});const n=await t.hitTest(e,{exclude:i});if(n.results.length>0){const o=n.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!n.ground.mapPoint||t.map.ground.opacity<1||n.ground.distance-(o.distance??0)>-Math.min(3*n.ground.distance,t.viewingMode==="global"?no(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const i=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},A.WIDGET)]}async _handleImmediateClick(e){const t=await e.defer(()=>this._getFirstHit(Ci(e)));let i=null;if(t!=null){const n=t.graphic;this.updateGraphics.includes(n)||n.layer===this.layer?(e.stopPropagation(),i=n):this.view?.type!=="2d"||this._isComponentGraphic(n)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const i=this.view;if(!i)return this._logMissingView(),null;const n={hasZ:i.type==="3d",...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,i,n);return o==null?null:(i.tools.add(o),i.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,i){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:n,defaultZ:o,hasZ:r,geometryToPlace:a,graphicProperties:s,mode:p,preserveAspectRatio:l}=i,d=ua(p,e),u=ya(e),f=i?.optionsPerTool?.has(e)?i.optionsPerTool.get(e):{},y=f?.preserveAspectRatio??l??e!=="rectangle",v={centered:e!=="rectangle"&&!(e==="circle"&&!y),cursor:n,defaultZ:o,forceUniformSize:y,graphicProperties:{...s,attributes:{...s?.attributes}},geometryToPlace:a,geometryType:u,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:r,snappingManager:this.snappingManager,snapToScene:!1,view:t,...f};return t.type==="2d"?this._makeDrawGraphicTool2D(v):this._makeDrawGraphicTool3D(v)}async _makeDrawGraphicTool2D(e){const[t,i,n]=await Promise.all([this._requireModule(I(()=>import("./editingTools-7dqMzBcg-96bUlo8v.js"),__vite__mapDeps([66,1,2,67,8,9,10,68,69,70,11,4,71,32,72,73,23,41,74,40,42,36,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,6,7,61,88,89,90,91,12,13,5,25,29,30,31,33,34,35,37,38,39,43,44,45,46,47,48,49,50,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120]),import.meta.url)),pt(),Me()]);return P(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:va(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n})}async _makeDrawGraphicTool3D(e){const[t,i,n]=await Promise.all([this._requireModule(I(()=>import("./ImageMaterial.glsl-4GA395N2-DLXcrhAI.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(r=>r.e)),pt(),Me()]);if(P(t)||this.destroyed)return null;const{elevationInfo:o}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:o,snapToScene:!0,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:i,automaticLengthMeasurementUtils:n})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let i=null;const n=e.forceUniformSize,o=e.centered,r=[t.on("key-down",s=>{if(s.key===G.pan)s.stopPropagation(),s.repeat||(e.enabled=!1);else if(s.key===G.complete)s.stopPropagation(),e.completeCreateOperation();else if(s.key!==G.vertexAdd||s.repeat)s.key===G.undo?(s.stopPropagation(),a.undo()):s.key===G.redo?(s.stopPropagation(),a.redo()):s.key!==G.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||s.repeat?s.key===G.center&&(s.repeat||(e.centered=!o,s.stopPropagation())):(e.forceUniformSize=!n,s.stopPropagation());else{const p=e.drawOperation.geometryType;p!=="polyline"&&p!=="polygon"&&p!=="multipoint"||(s.stopPropagation(),e.drawOperation.commitStagedVertex())}},A.WIDGET),t.on("key-up",s=>{s.key===G.pan?e.enabled=!0:s.key!==G.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?s.key===G.center&&(e.centered=o,s.stopPropagation()):(e.forceUniformSize=n,s.stopPropagation())},A.WIDGET),e.on("vertex-add",s=>{switch(i=i==null?"start":"active",s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",s=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:s.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",s=>{switch(s.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:s,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",s=>{this._set("createGraphic",s.graphic),i="complete",s.aborted?a&&a.cancel():a&&a.complete()}),Pe(()=>this._getGraphicSymbolFromTool(e.geometryType),s=>{e.graphicSymbol=s})],a=new ft({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{ie(r),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return a}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:i,view:n}=this;if(!n)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let r=o.tool??je.tool;for(const a of e)i.remove(a),i.add(a);if(n.type==="3d"){if(e.length===0)return null;switch(r){case"move":return this._setupMove3DOperation(e,o,n,r);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,n);case"transform":return this._setupGraphicTransform3DOperation(e,o,n)}}switch(r){case"move":return this._setupMove2DOperation(e,o,n);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,r,o,n);case"transform":if(e.length===1){const a=e[0].geometry?.type;a!=="point"&&a!=="multipoint"||(r="reshape")}return this._setupTransformOrReshape2DOperation(e,r,o,n)}}async _setupMove3DOperation(e,t,i,n,o=!1){const[r,a]=await Promise.all([this._requireModule(I(()=>import("./ImageMaterial.glsl-4GA395N2-DLXcrhAI.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(v=>v.e)),Me()]);if(P(r))return r;const{ManipulatedObject3DGraphic:s,MoveTool3D:p}=r.module,l=new Map,d=()=>{l.forEach(v=>v.destroy()),l.clear()};for(const v of e){const g=new s({view:i,graphic:v}),_=Pr(g);if(_!==b.SUPPORTED)return d(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Hi(_)}).`),null;l.set(v,g)}const u=new p({view:i,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,autoLengthMeasurementUtils:a});i.tools.add(u),u.objects.addMany(Array.from(l.values())),o||this.updateGraphics.addMany(e);const f=[],y=new fe({activeComponent:u,tool:n,type:"update",onEnd:()=>{ie(f),yt(i,u),d()},undo:()=>{Ji(this.view,u),dt(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{ut(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:v=>{this.updateGraphics.push(v);const g=new s({view:i,graphic:v});l.set(v,g),u.objects.push(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[v],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:v=>{const g=this.updateGraphics.indexOf(v);if(y.history.undo.forEach(O=>O.updates.splice(g,1)),y.history.redo.forEach(O=>O.updates.splice(g,1)),this.updateGraphics.remove(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[v],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void y.complete();const _=l.get(v);_&&(u.objects.remove(_),_.destroy(),l.delete(v))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||n!=="transform")return;const v=this.updateGraphics.at(0),g=await this._setupReshape3DOperation(v,t,i,!0);g&&!P(g)&&(y.onEnd(),y.destroy(),this._setUpdateOperationHandle(g,t))}});return f.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",v=>this._getCommonUpdateOperationClickHandlers(y,v,t),A.WIDGET),i.on("key-down",v=>{this._getCommonUpdateOperationKeyDownHandlers(y,v)},A.WIDGET)),y}_setupGraphicTransform3DOperation(e,t,i,n=!1){if(e.length===1&&Cr(e[0])===b.SUPPORTED){const o=e[0],r=o.geometry;if(r!=null&&(r.type==="point"||r.type==="mesh"))return this._setupPointTransform3DOperation(o,t,i);if(r!=null&&(r.type==="polygon"||r.type==="polyline"))return this._setupPolyTransform3DOperation(o,t,i,n)}return this._setupMove3DOperation(e,t,i,"transform",n)}async _setupPointTransform3DOperation(e,t,i){const n="transform",{enableRotation:o,enableScaling:r,enableZ:a}=t,s=await this._requireModule(I(()=>import("./ImageMaterial.glsl-4GA395N2-DLXcrhAI.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(v=>v.e));if(P(s))return s;const{TransformTool3D:p,ManipulatedObject3DGraphic:l}=s.module,d=new l({graphic:e,view:i}),u=new p({object:d,view:i,enableRotation:o,enableScaling:r,enableZ:a,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(u),this.updateGraphics.add(e);const f=[],y=new fe({activeComponent:u,tool:n,type:"update",onEnd:()=>{ie(f),yt(i,u),d.destroy()},undo:()=>{Ji(this.view,u),dt(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{ut(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async v=>{this.updateGraphics.add(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[v],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const g=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);P(g)||this._setUpdateOperationHandle(g,t)},removeFromSelection:v=>{this.updateGraphics.remove(v),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[v],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return f.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",v=>this._getCommonUpdateOperationClickHandlers(y,v,t),A.WIDGET),i.on("key-down",v=>{this._getCommonUpdateOperationKeyDownHandlers(y,v)},A.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,i,n=!1){const o="transform",{enableRotation:r,enableScaling:a,enableZ:s,preserveAspectRatio:p}=t,[l,d]=await Promise.all([this._requireModule(I(()=>import("./ImageMaterial.glsl-4GA395N2-DLXcrhAI.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(S=>S.e)),Me()]);if(P(l))return l;const{ManipulatedObject3DGraphic:u,ExtentTransformTool:f}=l.module,y=this.view?.inputManager?.isModifierKeyDown(G.constraint),v=new u({view:i,graphic:e}),g=new f({object:v,view:i,enableRotation:r,enableScaling:a,enableZ:s,preserveAspectRatio:!!p!=!!y,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:d});i.tools.add(g),n||this.updateGraphics.add(e);const _=[],O=new fe({activeComponent:g,tool:o,type:"update",onEnd:()=>{ie(_),yt(i,g),v.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async S=>{this.updateGraphics.add(S),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[S],removed:[],type:"selection-change"},type:"update"}),O.onEnd(),O.destroy();const Re=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);P(Re)||this._setUpdateOperationHandle(Re,t)},removeFromSelection:S=>{this.updateGraphics.remove(S),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[S],type:"selection-change"},type:"update"}),O.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const S=await this._setupReshape3DOperation(e,t,i,!0);S&&!P(S)&&(O.onEnd(),O.destroy(),this._setUpdateOperationHandle(S,t))}});return _.push(...this._getHandlesForComponent(O,t),i.on("immediate-click",S=>this._getCommonUpdateOperationClickHandlers(O,S,t),A.WIDGET),i.on("key-down",S=>this._getCommonUpdateOperationKeyDownHandlers(O,S),A.WIDGET),i.on("key-down",S=>{S.key!==G.constraint||S.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,S.stopPropagation())},A.WIDGET),i.on("key-up",S=>{S.key===G.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,S.stopPropagation())},A.WIDGET)),O}async _setupMove2DOperation(e,t,i){const n="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,i);if(P(o))return o;const r=new fe({activeComponent:o,tool:n,type:"update",onEnd:()=>{this._displayDefaultCursor(),ie(p),ie(s),o.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const l=this.updateGraphics.toArray();dt(r,l),r.refreshComponent(),this._emitUndoEvent({graphics:l,tool:n})},redo:()=>{const l=this.updateGraphics.toArray();ut(r,l),r.refreshComponent(),this._emitRedoEvent({graphics:l,tool:n})},addToSelection:async l=>{await this._updatingHandles.addPromise(this._updateSpatialReference(l)),this.updateGraphics.push(l),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:l=>{const d=this.updateGraphics.indexOf(l);r.history.undo.forEach(f=>f.updates.splice(d,1)),r.history.redo.forEach(f=>f.updates.splice(d,1)),this.updateGraphics.remove(l);const u=this.updateGraphics.toArray();this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=u:r.complete()}});let a=!1;const s=[i.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(r,l,t),A.WIDGET),i.on("key-down",l=>{this._getCommonUpdateOperationKeyDownHandlers(r,l),l.key!==G.constraint||l.repeat||(a=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},A.WIDGET),i.on("key-up",l=>{l.key===G.constraint&&a&&(a=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},A.WIDGET)],p=this._getHandlesForComponent(r,t);return r}async _setupReshape3DOperation(e,t,i,n=!1){const o="reshape",[r,a,s]=await Promise.all([this._requireModule(I(()=>import("./ImageMaterial.glsl-4GA395N2-DLXcrhAI.js"),__vite__mapDeps([121,1,2,119,36,9,37,11,5,6,7,72,32,71,4,73,23,41,74,40,42,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,14,15,16,17,18,19,20,21,22,24,61,88,89,90,91,12,13,25,8,10,29,30,31,33,34,35,38,39,43,44,45,46,47,48,49,50,122,123,124,125,109,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,114,142,143,144,111,145,146,147,148,149,150,151,152,153,154,112,113,155,156,69,70,157,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,110,158,159,160,115,116,117,68,161,162,163,164,118]),import.meta.url).then(_=>_.e)),pt(),Me()]);if(P(r))return r;const{ManipulatedObject3DGraphic:p,ReshapeTool3D:l}=r.module,d=new p({view:i,graphic:e}),u=Ar(d);if(u!==b.SUPPORTED)return d.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Hi(u)}).`),null;const f=t.reshapeOptions,y=new l({view:i,object:d,enableZVertex:t.enableZ&&f?.vertexOperation==="move",enableZShape:t.enableZ&&f?.shapeOperation==="move",enableMoveObject:f?.shapeOperation==="move"||f?.shapeOperation==="move-xy",enableMidpoints:f?.edgeOperation==="split",enableEdgeOffset:f?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:a,automaticLengthMeasurementUtils:s});i.tools.add(y),n||this.updateGraphics.add(d.graphic);const v=[],g=new fe({activeComponent:y,tool:o,type:"update",onEnd:()=>{ie(v),yt(i,y),d.destroy()},canUndo:()=>!y.destroyed&&y.canUndo,undo:()=>{y.destroyed||(y.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!y.destroyed&&y.canRedo,redo:()=>{y.destroyed||(y.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async _=>{this.updateGraphics.add(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[_],removed:[],type:"selection-change"},type:"update"}),g.onEnd(),g.destroy();const O=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);P(O)||this._setUpdateOperationHandle(O,t)},removeFromSelection:_=>{this.updateGraphics.remove(_),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[_],type:"selection-change"},type:"update"}),g.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;g.onEnd(),g.destroy();const _=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);P(_)||this._setUpdateOperationHandle(_,t)}});return v.push(...this._getHandlesForComponent(g,t),i.on("immediate-click",_=>this._getCommonUpdateOperationClickHandlers(g,_,t),A.WIDGET),i.on("key-down",_=>{this._getCommonUpdateOperationKeyDownHandlers(g,_)},A.WIDGET)),g}async _setupTransformOrReshape2DOperation(e,t,i,n){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=t==="transform"?await this._getBox(e,i,n):await this._getReshape(e,i,n);if(P(o))return o;const r=new fe({activeComponent:o,type:"update",onEnd:()=>{ie(s),ie(a),r.activeComponent&&!r.activeComponent.destroyed&&r.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{dt(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},redo:()=>{ut(r,this.updateGraphics.toArray()),r.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:r.tool})},addToSelection:async p=>{let l=r.activeComponent;if(l?.type==="reshape"){const d=[...this.updateGraphics,p];this.updateGraphics.removeAll(),r.onEnd(),r.destroy();const u=await this._setupTransformOrReshape2DOperation(d,"transform",i,n);if(P(u))return;this._setUpdateOperationHandle(u,i)}else this.updateGraphics.add(p),l.graphics=this.updateGraphics.toArray(),l.refresh(),r.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async p=>{const l=this.updateGraphics.indexOf(p);r.history.undo.forEach(u=>u.updates.splice(l,1)),r.history.redo.forEach(u=>u.updates.splice(l,1)),this.updateGraphics.remove(p);const d=this.updateGraphics.toArray();if(d.length===0)r.complete();else{const u=d[0].geometry;d.length!==1||u==null||u.type!=="point"&&u.type!=="multipoint"?r.activeComponent.graphics=d:r.toggleTool()}this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const p=this.updateGraphics.at(0),l=p.geometry;if(l!=null&&(r.tool==="reshape"&&(l.type==="point"||l.type==="multipoint")||r.tool==="transform"&&l.type==="extent"))return;let d=null;r.tool==="transform"?d=await this._getReshape([p],i,n):r.tool==="reshape"&&(d=await this._getBox([p],i,n)),P(d)||(r.activeComponent?.destroy(),r.activeComponent=d,r.activeComponent&&(ie(s),s=this._getHandlesForComponent(r,i)))}}),a=[n.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(r,p,i),A.WIDGET),n.on("key-down",p=>{if(this._getCommonUpdateOperationKeyDownHandlers(r,p),p.key===G.constraint&&!p.repeat&&r){const l=r.activeComponent;l&&l.type==="box"&&(l.preserveAspectRatio=!l.preserveAspectRatio)}},A.WIDGET),n.on("key-up",p=>{if(p.key===G.constraint&&r){const l=r.activeComponent;l&&l.type==="box"&&(l.preserveAspectRatio=!l.preserveAspectRatio)}},A.WIDGET)];let s=this._getHandlesForComponent(r,i);return r}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:n,highlightOptions:o}=t,r=await this._requireModule(I(()=>import("./GraphicMover-BruWidUQ-Bcgxq08f.js"),__vite__mapDeps([191,1,2,14,15,16,17,18,19,20,21,22,23,9,24,6,7,120,26,27,28,61,118,8,11,13,30,5,88,12,25,3,4,10,29,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50]),import.meta.url).then(a=>a.G));return P(r)?r:new r.module.default({enableMoveAllGraphics:n,highlightName:o?.name,highlightsEnabled:!!o?.enabled,indicatorsEnabled:!1,graphics:e,view:i,callbacks:{onGraphicMoveStart:({dx:a,dy:s,graphic:p})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:s,mover:p,type:"move-start"},type:"update"})},onGraphicMove:({dx:a,dy:s,graphic:p})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:s,mover:p,type:"move"},type:"update"}),onGraphicMoveStop:({dx:a,dy:s,graphic:p})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:s,mover:p,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayMoveCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,i){const{enableRotation:n,enableScaling:o,highlightOptions:r,preserveAspectRatio:a}=t,[s,p]=await Promise.all([this._requireModule(I(()=>import("./Box-C1MLNNLE-BmzT5GFC.js"),__vite__mapDeps([192,1,2,4,120,191,14,15,16,17,18,19,20,21,22,23,9,24,6,7,26,27,28,61,118,8,11,13,30,5,88,12,25,3,10,29,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,193,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,89,90,91,164,159]),import.meta.url)),Me()]);if(P(s))return s;const l=this.view?.inputManager?.isModifierKeyDown(G.constraint);return new s.module.default({graphics:e,enableRotation:n,enableScaling:o,highlightName:r?.name,highlightsEnabled:!!r?.enabled,preserveAspectRatio:!!a!=!!l,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,automaticLengthMeasurementUtils:p,callbacks:{onMoveStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onMove:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onMoveStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScaleStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScale:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onScaleStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotateStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotate:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onRotateStop:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"})}})}async _getReshape(e,t,i){const{highlightOptions:n,reshapeOptions:o}=t,r=o?.edgeOperation==="split",a=o?.shapeOperation==="move",[s,p,l]=await Promise.all([this._requireModule(I(()=>import("./Reshape-Zlegijc9-D-KrlgZo.js"),__vite__mapDeps([194,1,2,32,14,15,16,17,18,19,20,21,22,23,9,24,6,7,109,67,8,10,68,69,70,11,4,71,72,73,41,74,40,42,36,75,76,77,26,27,28,78,79,80,81,82,83,84,85,3,86,87,61,88,89,90,91,12,13,5,25,29,30,31,33,34,35,37,38,39,43,44,45,46,47,48,49,50,195,160,115,116,117,161,162,119,196,105,197,198,175,157,120,191,118,159,193,110]),import.meta.url)),pt(),Me()]);return P(s)?s:new s.module.default({enableMidpoints:r,enableMovement:a,graphic:e[0],highlightName:n?.name,highlightsEnabled:!!n?.enabled,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,automaticAreaMeasurementUtils:p,automaticLengthMeasurementUtils:l,view:i,callbacks:{onReshapeStart:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshape:d=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...d},type:"update"}),onReshapeStop:({mover:d,type:u})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:d,type:u},type:"update"}),onMoveStart:({dx:d,dy:u,mover:f,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:f,type:y},type:"update"}),onMove:({dx:d,dy:u,mover:f,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:f,type:y},type:"update"}),onMoveStop:({dx:d,dy:u,mover:f,type:y})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:d,dy:u,mover:f,type:y},type:"update"}),onVertexAdd:({added:d,type:u,vertices:f})=>{const y=d.map(v=>Pi(v.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:y,vertices:f,type:u},type:"update"})},onVertexRemove:({removed:d,type:u,vertices:f})=>{const y=d.map(v=>Pi(v.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:y,vertices:f,type:u},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:n,viewEvent:o})=>{o.native?.shiftKey&&t.multipleSelectionEnabled&&(o.stopPropagation(),e.removeFromSelection(n))}),i.on("graphic-move-start",n=>e.addToHistory(Ee(n.allGraphics)))];case"box":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),i.on("move-start",n=>e.addToHistory(Ee(n.graphics))),i.on("rotate-start",n=>e.addToHistory(Ee(n.graphics))),i.on("scale-start",n=>e.addToHistory(Ee(n.graphics)))];case"reshape":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),i.on("move-start",n=>e.addToHistory(Ee([n.mover]))),i.on("reshape-start",n=>e.addToHistory(Ee([n.graphic]))),i.on("vertex-add",n=>e.addToHistory(Ee([n.oldGraphic]))),i.on("vertex-remove",n=>e.addToHistory(Ee([n.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:n})=>{e.addToHistory({updates:n})}),i.events.on("move-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n.dx,dy:n.dy,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:n})=>{e.addToHistory({updates:n})}),i.events.on("translate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate"},type:"update"})}),i.events.on("scale",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("vertex-add",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("vertex-remove",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,i){const{graphic:n,viewEvent:o}=i;return o.native?.shiftKey&&n.layer===this.layer?(o.stopPropagation(),e.removeFromSelection(n)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view?.map;this._disablePopup(t);const n=()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),r=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:r,toolEventInfo:null,type:"update"})}};e.on("complete",n)}async _getCommonUpdateOperationClickHandlers(e,t,i){const n=Ci(t),o=await t.defer(()=>this._getFirstHit(n));if(o==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([o.graphic],e,i))return void t.stopPropagation();this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const n=!!i.multipleSelectionEnabled;return e.some(o=>o!=null&&!(!n||o.layer!==this.layer)&&(this.updateGraphics.includes(o)?t.removeFromSelection(o):t.addToSelection(o),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===G.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===G.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===G.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&G.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,i=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||i.length===1&&i[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=rt(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayMoveCursor(){this.view?.container&&this.view.cursor!=="move"&&(this.view.cursor="move")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,i){Qi.getLogger(this).error(new oo(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return Ai(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?($t(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await ro(Ai(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Xi("view"))}_logMissingLayer(){this._logError(ga,Xi("layer"))}};c([h()],E.prototype,"_defaultSnappingManager",void 0),c([h()],E.prototype,"updating",null),c([h({readOnly:!0})],E.prototype,"_updatingHandles",void 0),c([h()],E.prototype,"_operationHandle",void 0),c([h({readOnly:!0})],E.prototype,"activeTool",null),c([h({readOnly:!0})],E.prototype,"activeCreateToolDrawMode",null),c([h()],E.prototype,"activeTooltip",null),c([h({types:$e})],E.prototype,"activeFillSymbol",void 0),c([h()],E.prototype,"activeLineSymbol",void 0),c([h()],E.prototype,"activeVertexSymbol",void 0),c([h()],E.prototype,"allowDeleteKey",void 0),c([h({readOnly:!0})],E.prototype,"createGraphic",null),c([h()],E.prototype,"defaultCreateOptions",null),c([h()],E.prototype,"defaultUpdateOptions",null),c([h({type:xe,nonNullable:!0})],E.prototype,"labelOptions",null),c([h()],E.prototype,"layer",void 0),c([h({types:$e})],E.prototype,"pointSymbol",void 0),c([h({types:$e})],E.prototype,"polygonSymbol",void 0),c([h({types:$e})],E.prototype,"polylineSymbol",void 0),c([h()],E.prototype,"meshSymbol",void 0),c([h({type:L,nonNullable:!0})],E.prototype,"snappingOptions",null),c([h()],E.prototype,"snappingManager",null),c([h({readOnly:!0})],E.prototype,"state",null),c([h({type:x,nonNullable:!0})],E.prototype,"tooltipOptions",null),c([h({readOnly:!0})],E.prototype,"updateGraphics",void 0),c([h()],E.prototype,"updateOnGraphicClick",void 0),c([h()],E.prototype,"creationMode",void 0),c([h({type:se,nonNullable:!0})],E.prototype,"valueOptions",null),c([h({types:$e})],E.prototype,"vertexSymbol",void 0),c([h({value:null})],E.prototype,"view",null),c([h({constructOnly:!0,type:Ge})],E.prototype,"sketchOptions",void 0),E=c([H("esri.widgets.Sketch.SketchViewModel")],E);const ga="sketch:missing-property",Xi=e=>`Property '${e}' is missing on SketchViewModel.`;function va(e){return e==="polygon"||e==="rectangle"||e==="circle"}function dt(e,t){Bn("undo",e.history.undo,e.history.redo,t)}function ut(e,t){Bn("redo",e.history.redo,e.history.undo,t)}function Bn(e,t,i,n){const o=t.pop();if(!o)return;const r=o.updates,a=[];n.forEach((s,p)=>{const l=r[p];l!=null&&("geometry"in l&&l.geometry!=null&&(a.push({geometry:s.geometry}),s.geometry=l.geometry),"symbol"in l&&l.symbol!=null&&(a.push({symbol:s.symbol}),s.symbol=l.symbol),"undo"in l&&(a.push(l),l[e](s)))}),i.push({updates:a})}function Ji(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function Ee(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function yt(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function P(e){return"requireError"in e&&e.requireError==="aborted"}export{se as $,cl as A,Ds as B,al as C,k as D,E,is as F,bi as G,Ye as H,il as I,Tt as J,J as K,xe as L,Vi as M,Ue as N,Me as O,L as P,Ya as Q,Ft as R,Za as S,_n as T,ts as U,j as V,wt as W,Rs as X,qa as Y,ja as Z,Sr as _,Hr as a,On as a0,ol as a1,Oe as a2,Gs as a3,Gt as a4,Ps as a5,Mt as a6,rl as a7,As as a8,mn as a9,vt as aa,Hn as ab,Ss as ac,Ts as ad,el as ae,nl as af,Pr as ag,b as ah,Ls as ai,Xa as aj,Ka as ak,Ja as al,K as am,pl as an,pa as ao,Ui as ap,Ba as aq,tl as ar,V as b,M as c,Qa as d,da as e,Dn as f,Ii as g,Os as h,pt as i,Ms as j,Wi as k,Fn as l,sl as m,Wa as n,aa as o,Tr as p,za as q,ge as r,$i as s,pe as t,Or as u,ll as v,Ge as w,Xr as x,Ht as y,Ir as z};
