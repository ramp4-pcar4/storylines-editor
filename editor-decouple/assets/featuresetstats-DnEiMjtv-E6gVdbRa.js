import{i as d}from"./TimeOnly-CGkId3bj-CeAoADoj.js";import{l as y,r as F}from"./enum-g1DWyQyu--Id_tOZY.js";import{a as A,K as u,b as f,q as s,i as h}from"./aiServices-u5nRiq9H-C96iTRgn.js";import{l as c}from"./arcade-BoHTeCSG-C4GGPlAz.js";import{R as l,i as v}from"./WhereClause-D4rZJkVN-D9LO6nna.js";import{i as m,j as w}from"./main-ChKuQKYp.js";import"./UnknownTimeZone-DxjyzFvs-BlAvi_Hx.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-DttuBH5Z-2WNOsTy0.js";import"./Field-BIQ-quF4-DvF40xdk.js";import"./fieldType-PhcL4ff8-DLG1MNZJ.js";import"./number-mnL_JN3f-But7ou94.js";import"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import"./utils-BO8hgPs3-_DUZDIc2.js";import"./featureConversionUtils-Bjjlcfdo-GVbFC4VR.js";import"./OptimizedFeature-mIz_HhJg-CrhhDbiT.js";import"./memoryEstimations-DeWfxwaV-DSj9O3Gi.js";import"./OptimizedGeometry-pzfNw1AT-B4rMOtrl.js";import"./OptimizedFeatureSet-Dz5hF8Qm-B1brSkRC.js";import"./FieldsIndex-Bt0Y8aWr-CEBAV-TJ.js";import"./timeZoneUtils-d5p0Jda1-DavuYAbk.js";import"./unitConversion-BxD3RA9Y-lUIYj-qe.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";async function e(t,n,r,o){if(r.length===1){if(m(r[0]))return c(t,r[0],s(r[1],-1));if(f(r[0]))return c(t,r[0].toArray(),s(r[1],-1))}else if(r.length===2){if(m(r[0]))return c(t,r[0],s(r[1],-1));if(f(r[0]))return c(t,r[0].toArray(),s(r[1],-1));if(u(r[0])){const i=await r[0].load(),a=await g(l.create(r[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),o,n);return p(n,await r[0].calculateStatistic(t,a,s(r[2],1e3),n.abortSignal))}}else if(r.length===3&&u(r[0])){const i=await r[0].load(),a=await g(l.create(r[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),o,n);return p(n,await r[0].calculateStatistic(t,a,s(r[2],1e3),n.abortSignal))}return c(t,r,-1)}function p(t,n){return n instanceof v?d.fromReaderAsTimeStampOffset(n.toStorageFormat()):n instanceof Date?d.dateJSAndZoneToArcadeDate(n,h(t)):n}async function g(t,n,r){const o=t.getVariables();if(o.length>0){const i={};for(const a of o)i[a]=n.evaluateIdentifier(r,{name:a});t.parameters=i}return t}function E(t){t.mode==="async"&&(t.functions.stdev=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("stdev",n,a,t))},t.functions.variance=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("variance",n,a,t))},t.functions.average=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("mean",n,a,t))},t.functions.mean=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("mean",n,a,t))},t.functions.sum=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("sum",n,a,t))},t.functions.min=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("min",n,a,t))},t.functions.max=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("max",n,a,t))},t.functions.count=function(n,r){return t.standardFunctionAsync(n,r,async(o,i,a)=>{if(A(a,1,1,n,r),u(a[0]))return a[0].count(o.abortSignal);if(m(a[0])||w(a[0]))return a[0].length;if(f(a[0]))return a[0].length();throw new y(n,F.InvalidParameter,r)})})}export{E as registerFunctions};
