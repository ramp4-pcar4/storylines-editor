const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-bSKUKu5m-Dd0T_lH6.js","./main-BGmgFd6s.js","./main-CKU5OmdG.css","./normalizeUtils-u00NGW3M-4OAJexx3.js","./normalizeUtilsCommon-ClagynAA-DSALn0p5.js","./utils-BO8hgPs3-CgKb3JBi.js","./utils-DpLVEUvg-Dj3oQ-9J.js","./Field-BIQ-quF4-C_jM9II1.js","./fieldType-PhcL4ff8-B7HopnNh.js","./networkEnums-DHCOt6o_-DocS5fUb.js","./FeatureSet-BVGGhhH9-pd1Momip.js","./GPMessage-KKjIcGuy-qrv0Zdar.js","./Relationship-CQMFhJpR-BhHxvhga.js"])))=>i.map(i=>d[i]);
import{bq as _,j as w,_ as D,i as x,f as V,ar as b,k as F,b8 as I,db as j,z,a_ as Y}from"./main-BGmgFd6s.js";import{t as J}from"./arcade-BoHTeCSG-C5Xlq1GD.js";import{a as P,p as T,x as B,q as k,j as W,i as K,y as q,z as L,A as M,E as Q,H as G}from"./aiServices-u5nRiq9H-BxJjynOz.js";import{l,r as c}from"./enum-g1DWyQyu-BHqQXo0p.js";import{n as U}from"./portalUtils-COohlq76-DyiDoh_m.js";import{k as C,K as H,O as Z}from"./projectionUtils-B-CplN3q-CqjpFw1H.js";import X from"./PortalItem-BP-IQXnZ-ULU5w4Q1.js";import{o as $,O as ee}from"./project-TZjL1vJA-CLGMLl_A.js";import{s as ne,n as te,d as ie,a as oe,u as ae}from"./Relationship-CQMFhJpR-BhHxvhga.js";import"./TimeOnly-CGkId3bj-C8qShfgI.js";import"./UnknownTimeZone-DxjyzFvs-CZ1q5sKf.js";import"./featureConversionUtils-Bjjlcfdo-DxiG-730.js";import"./OptimizedFeature-mIz_HhJg-BMeWjnyB.js";import"./memoryEstimations-DeWfxwaV-D97OP2XM.js";import"./OptimizedGeometry-pzfNw1AT-D10lvvW_.js";import"./OptimizedFeatureSet-Dz5hF8Qm-B1brSkRC.js";import"./FieldsIndex-Bt0Y8aWr-Dc7pHl3t.js";import"./timeZoneUtils-d5p0Jda1-D5oyf1EA.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-DttuBH5Z-CMUTBzE0.js";import"./Field-BIQ-quF4-C_jM9II1.js";import"./fieldType-PhcL4ff8-B7HopnNh.js";import"./WhereClause-D4rZJkVN-C9ioxgtE.js";import"./unitConversion-BxD3RA9Y-Chltp1VH.js";import"./number-mnL_JN3f-Ck6mmaQP.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import"./utils-BO8hgPs3-CgKb3JBi.js";import"./utils-DpLVEUvg-Dj3oQ-9J.js";let u=null;async function re(e){const n=V.geometryServiceUrl??"";if(!n){C()||await H();for(const t of e)t.container[t.indexer]=Z(t.container[t.indexer],b.WGS84);return}const i=e.map(t=>t.container[t.indexer]),a=new $({geometries:i,outSpatialReference:b.WGS84}),s=await ee(n,a);for(let t=0;t<s.length;t++){const o=e[t];o.container[o.indexer]=s[t]}}async function A(e,n){const i=new X({portal:e,id:n});return await i.load(),u===null&&(u=await D(()=>import("./knowledgeGraphService-bSKUKu5m-Dd0T_lH6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url).then(a=>a.k)),await u.fetchKnowledgeGraph(i.url)}function R(e,n,i,a,s){if(e===null)return null;if(w(e)||F(e))return e;if(q(e)||q(e))return e.toJSDate();if(L(e))return e.toStorageFormat();if(M(e))return e.toStorageString();if(Q(e)){const t={};for(const o of e.keys())t[o]=R(e.field(o),n,i,a,s),t[o]instanceof I&&s.push({container:t,indexer:o});return t}if(x(e)){const t=e.map(o=>R(o,n,i,a,s));for(let o=0;o<t.length;o++)t[o]instanceof I&&s.push({container:t,indexer:o});return t}return G(e)?e.spatialReference.isWGS84?e:e.spatialReference.isWebMercator&&n?j(e):e:void 0}function se(e,n){if(!e)return e;if(e.spatialReference.isWGS84&&n.spatialReference.isWebMercator)return Y(e);if(e.spatialReference.equals(n.spatialReference))return e;throw new l(n,c.WrongSpatialReference,null)}function v(e,n){if(!e)return null;const i={};for(const a in e)i[a]=m(e[a],n);return i}function m(e,n){return e===null?null:x(e)?e.map(i=>m(i,n)):e instanceof te?{graphTypeName:e.typeName,id:e.id,graphType:"entity",properties:v(e.properties,n)}:e instanceof ie?{graphType:"object",properties:v(e.properties,n)}:e instanceof oe?{graphTypeName:e.typeName,id:e.id,graphType:"relationship",originId:e.originId??null,destinationId:e.destinationId??null,properties:v(e.properties,n)}:e instanceof ae?{graphType:"path",path:e.path?e.path.map(i=>m(i,n)):null}:G(e)?se(e,n):w(e)||F(e)||z(e)?e:null}function Ne(e){e.mode==="async"&&(e.functions.knowledgegraphbyportalitem=function(n,i){return e.standardFunctionAsync(n,i,(a,s,t)=>{if(P(t,2,2,n,i),t[0]===null)throw new l(n,c.PortalRequired,i);if(t[0]instanceof J){const d=T(t[1]);let f;return f=n.services?.portal?n.services.portal:_.getDefault(),A(U(t[0],f),d)}if(w(t[0])===!1)throw new l(n,c.InvalidParameter,i);const o=T(t[0]);return A(n.services?.portal??_.getDefault(),o)})},e.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),e.functions.querygraph=function(n,i){return e.standardFunctionAsync(n,i,async(a,s,t)=>{P(t,2,4,n,i);const o=t[0];if(!B(o))throw new l(n,c.InvalidParameter,i);const d=t[1];if(!w(d))throw new l(n,c.InvalidParameter,i);u===null&&(u=await D(()=>import("./knowledgeGraphService-bSKUKu5m-Dd0T_lH6.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12]),import.meta.url).then(r=>r.k));let f=null;const h=k(t[2],null);if(!(h instanceof W||h===null))throw new l(n,c.InvalidParameter,i);if(h){let r=[];f=R(h,!0,!1,n,r),r=r.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),r.length>0&&await re(r)}const O=k(t[3],!1),S=new ne({openCypherQuery:d,bindParameters:f,provenanceBehavior:O?"include":"exclude"});(o?.serviceDefinition?.currentVersion??11.3)>11.2&&(S.outputSpatialReference=n.spatialReference);const E=(await u.executeQueryStreaming(o,S)).resultRowsStream.getReader(),y=[];try{for(;;){const{done:r,value:p}=await E.read();if(r)break;if(x(p))for(const g of p)y.push(m(g,n));else{const g=[];for(const N of p)g.push(m(p[N],n));y.push(g)}}}catch(r){throw r}return W.convertJsonToArcade(y,K(n),!1,!0)})},e.signatures.push({name:"querygraph",min:2,max:4}))}export{Ne as registerFunctions};
