!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=425)}({425:function(t,e){window.CoordinateInfo=function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=0)}([function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=n(1),i=function(){function t(){this.urls={nts:"https://geogratis.gc.ca/services/delimitation/en/nts?",utm:"https://geogratis.gc.ca/services/delimitation/en/utmzone?",alti:"https://geogratis.gc.ca/services/elevation/cdem/altitude?",decli:"https://ngdc.noaa.gov/geomag-web/calculators/calculateDeclination?"}}return t.prototype.init=function(e){this.api=e,this.button=this.api.mapI.addPluginButton(t.prototype.translations[this._RV.getCurrentLang()].coordButtonLabel,this.onMenuItemClick()),null!==this.api.mapDiv[0].getAttributeNode("coord-info-active")&&(this.api.layers.identifyMode="none",void 0!==this.panel&&(this.panel.close({destroy:!0}),this.panel=void 0),this.toggleActive())},t.prototype.onMenuItemClick=function(){var t,e=this;return function(){if(void 0===e.handler){t=e.toggleActive();var n=document.createAttribute("coord-info-active");e.api.mapDiv[0].setAttributeNode(n)}else e.handler.unsubscribe(),e.handler=void 0,e._RV.setMapCursor(""),e.button.isActive=!1,e.api.layers.identifyMode=t,n=e.api.mapDiv[0].getAttributeNode("coord-info-active"),e.api.mapDiv[0].removeAttributeNode(n)}},t.prototype.toggleActive=function(){var t=this;this.handler=this.api.click.subscribe((function(e){return t.clickHandler(e)})),this.button.isActive=!0,this._RV.setMapCursor("crosshair");var e=this.api.layers.identifyMode;return this.api.layers.identifyMode="none",e},t.prototype.clickHandler=function(t){var e=this,n=(this._RV.getCurrentLang(),t.xy);n.spatialReference=4326;var o=this._RV.convertDDToDMS(n.y,n.x),i=(new Date).toISOString().substr(0,10),r=i.split("-"),a=parseInt(r[0]),s=parseInt(r[1]),c=parseInt(r[2]),l=[];l.push(new Promise((function(t){$.ajax({url:e.urls.nts,cache:!1,data:{bbox:n.x+","+n.y+","+n.x+","+n.y},dataType:"jsonp",success:function(n){return t(e.parseNTS(n.features))}})}))),l.push(new Promise((function(t){$.ajax({url:e.urls.utm,cache:!1,data:{bbox:n.x+","+n.y+","+n.x+","+n.y},dataType:"jsonp",success:function(o){return t(e.parseUtm(o.features,n))}})}))),l.push(new Promise((function(t){$.ajax({url:e.urls.alti,cache:!1,data:{lat:n.y,lon:n.x},dataType:"jsonp",success:function(e){return t(null!==e.altitude?e.altitude:0)}})})));var u={lat1:n.y,lon1:n.x,startYear:a,startMonth:s,startDay:c,resultFormat:"json"};l.push(new Promise((function(t){$.ajax({url:e.urls.decli,cache:!0,data:u,success:function(n){return t(e.parseDecli(n.result[0]))},error:function(){t(void 0)}})}))),Promise.all(l).then((function(t){e.generateOutput(t,n,o,i)}))},t.prototype.generateOutput=function(t,e,n,i){var r=e.y>0?""+e.y.toFixed(6)+String.fromCharCode(176)+" N":""+-e.y.toFixed(6)+String.fromCharCode(176)+" S",a=e.x>0?""+e.x.toFixed(6)+String.fromCharCode(176)+" E":""+-e.x.toFixed(6)+String.fromCharCode(176)+" W",s=o.template.replace(/{pt.y}/,r).replace(/{pt.x}/,a).replace(/{dms.y}/,n.y).replace(/{dms.x}/,n.x).replace(/{zone}/,t[1].zone).replace(/{outPt.x}/,t[1].outPt.x).replace(/{outPt.y}/,t[1].outPt.y).replace(/{nts250}/,t[0].nts250).replace(/{nts50}/,t[0].nts50).replace(/{elevation}/,t[2]);if(t[3]){var c=o.magSection.replace(/{date}/,i).replace(/{magnetic}/,t[3].magnetic).replace(/{annChange}/,t[3].annChange).replace(/{compass}/,t[3].compass);s=s.replace(/{magSection}/,c)}else s=s.replace(/{magSection}/,"");this.panel?this.panel.close():(this.panel=this.api.panels.create("coord-info"),this.panel.element.css({bottom:"0em",width:"400px"}),this.panel.element.addClass("mobile-fullscreen"),this.panel.header.closeButton,this.panel.header.title="plugins.coordInfo.coordButtonLabel"),this.panel.body=s,this.panel.open()},t.prototype.parseNTS=function(t){return{nts250:t.length>0?t[0].properties.identifier+"-"+t[0].properties.name:"",nts50:t.length>1?t[1].properties.identifier+"-"+t[1].properties.name:""}},t.prototype.parseUtm=function(t,e){if(0===t.length)return{zone:"Error",outPt:{x:"-",y:"-"}};var n=t[0].properties.identifier;n<10&&(n="0"+n);var o=this._RV.projectGeometry(e,parseInt("326"+n));return{zone:n,outPt:{x:o.x,y:o.y}}},t.prototype.parseDecli=function(t){var e="---";if(null!==t.declination){var n=t.declination.toFixed(2);e=t.declination>0?""+n+String.fromCharCode(176)+" E":""+-n+String.fromCharCode(176)+" W"}var o="---";return null!==t.declnation_sv&&(n=t.declnation_sv.toFixed(2),o=t.declnation_sv>0?""+n+String.fromCharCode(176)+" E":""+-n+String.fromCharCode(176)+" W"),{magnetic:e,annChange:o}},t}();e.default=i,i.prototype.translations={"en-CA":{coordButtonLabel:"Coords Info",title:"Map location information",coordSection:"Geographic Coordinates",coordLat:"Latitude: ",coordLong:"Longitude: ",coordDecimal:"Degrees Decimal: ",coordDMS:"Degrees Minutes Seconds (DMS): ",utmSection:"UTM Coordinates",utmZone:"Zone: ",utmEast:"Easting: ",utmNorth:"Northing: ",ntsSection:"NTS Mapsheet",altiSection:"Elevation",magSection:"Magnetic declination",magDate:"Date: ",magDecli:"Magnetic declination (DD): ",magChange:"Annual change (minutes/year): ",magDecliOut:"-WARNING- Out of scope.",magCompassOut:"-WARNING- Compass erratic for this coordinate."},"fr-CA":{coordButtonLabel:"Info coords",title:"Information de localisation sur la carte",coordSection:"Coordonnées géographiques",coordLat:"Latitude : ",coordLong:"Longitude : ",coordDecimal:"Degrés décimaux : ",coordDMS:"Degrés minutes secondes (DMS) : ",utmSection:"Coordonnées UTM",utmZone:"Zone : ",utmEast:"Abscisse : ",utmNorth:"Ordonnée : ",ntsSection:"Carte du SNRC",altiSection:"Élévation",magSection:"Déclinaison magnétique",magDate:"Date : ",magDecli:"Déclinaison magnétique (DD) : ",magChange:"Changement annuel (minutes/année) : ",magDecliOut:"-ATTENTION- Hors de portée.",magCompassOut:"-ATTENTION- Boussole peu fiable pour cette coordonnée."}},window.coordInfo=i},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.template="<div tabindex=\"-2\"><ul class=\"rv-list\">\n    <li>\n        <strong>{{ 'plugins.coordInfo.coordSection' | translate }}</strong>\n        <div class=\"rv-subsection\">\n            <div>{{ 'plugins.coordInfo.coordDecimal' | translate }}</div>\n            <div class=\"rv-subsection\">\n            <div>{{ 'plugins.coordInfo.coordLat' | translate }}{pt.y}</div>\n            <div>{{ 'plugins.coordInfo.coordLong' | translate }}{pt.x}</div>\n            </div>\n            <div>{{ 'plugins.coordInfo.coordDMS' | translate }}</div>\n            <div class=\"rv-subsection\">\n            <div>{{ 'plugins.coordInfo.coordLat' | translate }}{dms.y}</div>\n            <div>{{ 'plugins.coordInfo.coordLong' | translate}}{dms.x}</div>\n            </div>\n        </div>\n    </li>\n    <li>\n        <strong>{{ 'plugins.coordInfo.utmSection' | translate }}</strong>\n        <div class=\"rv-subsection\">\n            <div>{{ 'plugins.coordInfo.utmZone' | translate }}{zone}</div>\n            <div>{{ 'plugins.coordInfo.utmEast' | translate }}{outPt.x}</div>\n            <div>{{ 'plugins.coordInfo.utmNorth' | translate }}{outPt.y}</div>\n        </div>\n    </li>\n    <li>\n        <strong>{{ 'plugins.coordInfo.ntsSection' | translate }}</strong>\n        <div class=\"rv-subsection\">\n            <div>{nts250}</div>\n            <div>{nts50}</div>\n        </div>\n    </li>\n    <li>\n        <strong>{{ 'plugins.coordInfo.altiSection' | translate }}</strong>\n        <div class=\"rv-subsection\">{elevation} m</div>\n    </li>\n    {magSection}\n</ul></div>",e.magSection="<li>\n<strong>{{ 'plugins.coordInfo.magSection' | translate }}</strong>\n<div class=\"rv-subsection\">\n    <div>{{ 'plugins.coordInfo.magDate' | translate }}{date}</div>\n    <div>{{ 'plugins.coordInfo.magDecli' | translate }}{magnetic}</div>\n    <div>{{ 'plugins.coordInfo.magChange' | translate }}{annChange}</div>\n</div>\n</li>"}]).default}});
//# sourceMappingURL=ramp-plugin-coordinate-info.js.map