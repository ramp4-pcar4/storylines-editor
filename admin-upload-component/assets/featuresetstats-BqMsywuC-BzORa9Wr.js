import{n as u,P as y,B as d}from"./main-rZPjAHpr.js";import{a as F,r as A}from"./unitConversion-BXECx7w3-CAb1OkqD.js";import{o as h,w as f,h as m,z as c,J as s,K as w}from"./arcade-Dg73dEoh-ByKHAcH0.js";import{D as l,i as S}from"./WhereClause-nZnXFKnG-BDHdnbAz.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-Y9GMqi1u-BngvAvK0.js";import"./TimeOnly-C3SOkmg2-B7IDOmB4.js";import"./Field-Cj6Pz3TI-CUMf7awr.js";import"./fieldType-VTpxE-EM-COKMS_29.js";import"./number-ZeBaww6r-DgJgNaaP.js";import"./featureConversionUtils-DRaHTjrY-BQSjln8f.js";import"./OptimizedFeatureSet-D6mgsKNr-CLgw-Ati.js";import"./memoryEstimations-iHVpvWPf-B7y7SIIv.js";import"./OptimizedGeometry-1qDYm3YK-DM0gr1IT.js";import"./FieldsIndex-Y7EBAYp0-C2F_HMcV.js";import"./timeZoneUtils-z3WjfjXQ-DrnDzwBK.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";async function e(a,r,n,o){if(n.length===1){if(u(n[0]))return c(a,n[0],s(n[1],-1));if(m(n[0]))return c(a,n[0].toArray(),s(n[1],-1))}else if(n.length===2){if(u(n[0]))return c(a,n[0],s(n[1],-1));if(m(n[0]))return c(a,n[0].toArray(),s(n[1],-1));if(f(n[0])){const i=await n[0].load(),t=await g(l.create(n[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),o,r);return p(r,await n[0].calculateStatistic(a,t,s(n[2],1e3),r.abortSignal))}}else if(n.length===3&&f(n[0])){const i=await n[0].load(),t=await g(l.create(n[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),o,r);return p(r,await n[0].calculateStatistic(a,t,s(n[2],1e3),r.abortSignal))}return c(a,n,-1)}function p(a,r){return r instanceof S?d.fromReaderAsTimeStampOffset(r.toStorageFormat()):r instanceof Date?d.dateJSAndZoneToArcadeDate(r,w(a)):r}async function g(a,r,n){const o=a.getVariables();if(o.length>0){const i={};for(const t of o)i[t]=r.evaluateIdentifier(n,{name:t});a.parameters=i}return a}function M(a){a.mode==="async"&&(a.functions.stdev=function(r,n){return a.standardFunctionAsync(r,n,(o,i,t)=>e("stdev",r,t,a))},a.functions.variance=function(r,n){return a.standardFunctionAsync(r,n,(o,i,t)=>e("variance",r,t,a))},a.functions.average=function(r,n){return a.standardFunctionAsync(r,n,(o,i,t)=>e("mean",r,t,a))},a.functions.mean=function(r,n){return a.standardFunctionAsync(r,n,(o,i,t)=>e("mean",r,t,a))},a.functions.sum=function(r,n){return a.standardFunctionAsync(r,n,(o,i,t)=>e("sum",r,t,a))},a.functions.min=function(r,n){return a.standardFunctionAsync(r,n,(o,i,t)=>e("min",r,t,a))},a.functions.max=function(r,n){return a.standardFunctionAsync(r,n,(o,i,t)=>e("max",r,t,a))},a.functions.count=function(r,n){return a.standardFunctionAsync(r,n,async(o,i,t)=>{if(h(t,1,1,r,n),f(t[0]))return t[0].count(o.abortSignal);if(u(t[0])||y(t[0]))return t[0].length;if(m(t[0]))return t[0].length();throw new F(r,A.InvalidParameter,n)})})}export{M as registerFunctions};
