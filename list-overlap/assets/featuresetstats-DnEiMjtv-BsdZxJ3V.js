import{i as d}from"./TimeOnly-CGkId3bj-BcrKitwG.js";import{l as y,r as F}from"./enum-g1DWyQyu-B1Xo3D9T.js";import{a as A,K as u,b as f,q as s,i as h}from"./aiServices-u5nRiq9H-DdFKuTsO.js";import{l as c}from"./arcade-BoHTeCSG-BQ5amu9g.js";import{R as l,i as v}from"./WhereClause-D4rZJkVN-v_5xxE10.js";import{i as m,j as w}from"./main-CIJCwrkk.js";import"./UnknownTimeZone-DxjyzFvs-CbzbKbHY.js";import"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import"./shared-DttuBH5Z-DBFMYgJH.js";import"./Field-BIQ-quF4-C8Z3agGn.js";import"./fieldType-PhcL4ff8-RTwMo07w.js";import"./number-mnL_JN3f-BSgc6CJd.js";import"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import"./utils-BO8hgPs3-dvWG5NOL.js";import"./featureConversionUtils-Bjjlcfdo-D-2CaS77.js";import"./OptimizedFeature-mIz_HhJg-Ds0prZCf.js";import"./memoryEstimations-DeWfxwaV-DxJrMa2A.js";import"./OptimizedGeometry-pzfNw1AT-CQEwyngO.js";import"./OptimizedFeatureSet-Dz5hF8Qm-B1brSkRC.js";import"./FieldsIndex-Bt0Y8aWr-TzHze7be.js";import"./timeZoneUtils-d5p0Jda1-DKyL38FK.js";import"./unitConversion-BxD3RA9Y-BwScVG5_.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";async function e(t,n,r,o){if(r.length===1){if(m(r[0]))return c(t,r[0],s(r[1],-1));if(f(r[0]))return c(t,r[0].toArray(),s(r[1],-1))}else if(r.length===2){if(m(r[0]))return c(t,r[0],s(r[1],-1));if(f(r[0]))return c(t,r[0].toArray(),s(r[1],-1));if(u(r[0])){const i=await r[0].load(),a=await g(l.create(r[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),o,n);return p(n,await r[0].calculateStatistic(t,a,s(r[2],1e3),n.abortSignal))}}else if(r.length===3&&u(r[0])){const i=await r[0].load(),a=await g(l.create(r[1],{fieldsIndex:i.getFieldsIndex(),timeZone:i.dateFieldsTimeZoneDefaultUTC}),o,n);return p(n,await r[0].calculateStatistic(t,a,s(r[2],1e3),n.abortSignal))}return c(t,r,-1)}function p(t,n){return n instanceof v?d.fromReaderAsTimeStampOffset(n.toStorageFormat()):n instanceof Date?d.dateJSAndZoneToArcadeDate(n,h(t)):n}async function g(t,n,r){const o=t.getVariables();if(o.length>0){const i={};for(const a of o)i[a]=n.evaluateIdentifier(r,{name:a});t.parameters=i}return t}function E(t){t.mode==="async"&&(t.functions.stdev=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("stdev",n,a,t))},t.functions.variance=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("variance",n,a,t))},t.functions.average=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("mean",n,a,t))},t.functions.mean=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("mean",n,a,t))},t.functions.sum=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("sum",n,a,t))},t.functions.min=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("min",n,a,t))},t.functions.max=function(n,r){return t.standardFunctionAsync(n,r,(o,i,a)=>e("max",n,a,t))},t.functions.count=function(n,r){return t.standardFunctionAsync(n,r,async(o,i,a)=>{if(A(a,1,1,n,r),u(a[0]))return a[0].count(o.abortSignal);if(m(a[0])||w(a[0]))return a[0].length;if(f(a[0]))return a[0].length();throw new y(n,F.InvalidParameter,r)})})}export{E as registerFunctions};
