import{y as k}from"./Field-Cj6Pz3TI-BT1_6DON.js";import{v as N,I as S,e_ as x,t as z,Y as q,z as B,d6 as J}from"./main-BrXQBr3M.js";var C;let p=C=class extends q{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new C({variableName:this.variableName,dimensionName:this.dimensionName,values:B(this.values),isSlice:this.isSlice})}};N([S({type:String,json:{write:!0}})],p.prototype,"variableName",void 0),N([S({type:String,json:{write:!0}})],p.prototype,"dimensionName",void 0),N([S({type:x.array(x.oneOf([x.native(Number),x.array(x.native(Number))])),json:{write:!0}})],p.prototype,"values",void 0),N([S({type:Boolean,json:{write:!0}})],p.prototype,"isSlice",void 0),p=C=N([z("esri.layers.support.DimensionalDefinition")],p);const A=p,Q="Raster.",g="Raster.Dim.",T=".Max",w={servicePixelValue:"Raster.ServicePixelValue",rawServicePixelValue:"Raster.ServicePixelValue.Raw",itemPixelValue:"Raster.ItemPixelValue",magnitude:"Raster.Magnitude",direction:"Raster.Direction",variable:"Raster.Variable"},Y=new Map([["quarters","Quarter"],["months","Month"],["weeks","Week of the year"],["days","Day of the year"]]);function D(e,n){return new k({name:e,alias:n,domain:null,editable:!1,length:50,type:"string"})}function M(e,n){return new k({name:e,alias:n,domain:null,editable:!1,type:"double"})}function _(e,n){return new k({name:e,alias:n,domain:null,editable:!1,type:"date"})}function ae(e){return D(w.servicePixelValue,e??"Service Pixel Value")}function re(e){return D(w.rawServicePixelValue,e??"Raw Service Pixel Value")}function se(){return D(w.itemPixelValue,"Item Pixel Value")}function le(e){return D(`${w.servicePixelValue}.${e}`,e)}function ue(e){return M(`${w.magnitude}`,"Magnitude"+(e?` (${e})`:""))}function oe(){return M(`${w.direction}`,"Direction (Â°)")}function me(e){return e.fields.filter(n=>n.type!=="oid"&&n.name.toLowerCase()!=="value").map(n=>{const i=n.clone();return i.name=`${Q}${n.name}`,i})}function ce(e){const n=new Set,i=new Set,r=new Map;return e.variables.forEach(({dimensions:a})=>{a.forEach(t=>{if(t.recurring)r.set(t.name,t.unit);else{const s=t.unit?.trim()==="ISO8601"?n:i;s.add(t.name),t.hasRanges&&s.add(`${t.name}${T}`)}})}),[D(w.variable,"Variable"),...[...n].map(a=>_(`${g}${a}`,U(a))),...[...i].map(a=>M(`${g}${a}`,U(a))),...[...r].map(([a,t])=>M(`${g}${a}`,H(a,t)))]}function H(e,n){return n=n?.toLowerCase(),n&&Y.has(n)?Y.get(n):U(e)}function U(e){const n=e.endsWith(T),i=n?e.slice(0,-4):e,r=i==="StdTime"?"Standard Time":i==="StdZ"?"Standard Z":i;return n?`${r} Max`:r}function $(e,n){return n?new Date(e):e}function fe(e,n,i){i?.length&&(n[w.variable]=i[0].variableName,i.forEach(({dimensionName:r,values:a})=>{if(r&&a?.length){const t=`${g}${r}`,s=e.find(({name:u})=>u===t);if(!s)return;const l=s.type==="date",m=a[0];if(Array.isArray(m)){if(n[`${g}${r}`]=$(m[0],l),m[1]!=null){const u=`${g}${r}${T}`;if(e.some(({name:o})=>o===u)){const o=$(m[1],l);n[u]=o}}}else n[`${g}${r}`]=$(m,l)}}))}function de(e,n){if(n.pixelType.startsWith("f")&&e.forEach(({format:i,fieldName:r})=>{i&&r&&/^raster\.(item|service)pixelvalue/i.test(r)&&(i.places=2)}),n.multidimensionalInfo){const i=n.multidimensionalInfo.variables.flatMap(({dimensions:r})=>r);e.forEach(({format:r,fieldName:a})=>{if(r&&a?.startsWith(g)){const t=a.slice(g.length),s=`${t}${T}`;i.find(({name:l})=>l===t||l===s)?.values?.every(l=>Number.isInteger(l))&&(r.places=0)}})}}function V(e,n,i){const r=n.shift();if(i.length===0){const t=[];i.push({sliceId:-1,multidimensionalDefinition:t})}const a=i.length;for(let t=0;t<a;t++){const s=i.shift().multidimensionalDefinition;r.values?.forEach(l=>{i.push({sliceId:-1,multidimensionalDefinition:[...s,{variableName:e,dimensionName:r.name,values:[l]}]})})}n.length&&V(e,n,i)}function he(e,n){const i=[];let r=0;return(n?e.variables.filter(a=>a.name.toLowerCase()===n.toLowerCase()):[...e.variables].sort((a,t)=>a.name>t.name?1:-1)).forEach(a=>{const t=[],s=[...a.dimensions].sort((l,m)=>l.name>m.name?-1:1);V(a.name,s,t),t.forEach(l=>{i.push({...l,sliceId:r++})})}),i}function ve(e,n,i){let r=e;if(n&&(n=[...n].sort((a,t)=>a.dimensionName<t.dimensionName?-1:1)).forEach(({dimensionName:a,values:t,isSlice:s})=>{t.length&&(r=r.filter(l=>{const m=l.multidimensionalDefinition.find(o=>o.dimensionName===a);if(m==null)return!1;const u=m.values[0];return typeof u=="number"?typeof t[0]=="number"?t.includes(u):t.some(o=>o[0]<=u&&o[1]>=u):typeof t[0]=="number"?t.some(o=>u[0]<=o&&u[1]>=o):s?t.some(o=>o[0]===u[0]&&o[0]===u[1]):t.some(o=>o[0]>=u[0]&&o[0]<=u[1]||o[1]>=u[0]&&o[1]<=u[1]||o[0]<u[0]&&o[1]>u[1])}))}),r.length&&i?.start!=null&&i.end!=null){const a=i.start.getTime(),t=i.end.getTime(),s=r[0].multidimensionalDefinition.findIndex(l=>l.dimensionName==="StdTime");s>-1&&(r=r.filter(l=>{const m=l.multidimensionalDefinition[s].values[0];return a<=m&&t>=m}))}return r.map(a=>a.sliceId)}function E(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function X(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function P(e){return e.length===1?[e[0],e[0]]:[e[0],e[e.length-1]]}function O(e,n,i){if(!n?.subsetDefinitions?.length)return e;let r;if(i){const{variables:s}=n;if(s.length&&!s.includes(i))return null;const l=n.subsetDefinitions.find(m=>m.dimensionName===e.name&&m.variableName===i);if(!l?.values?.length)return e;r=P(l.values)}else r=n.dimensions.find(({name:s})=>s===e.name)?.extent;const a=r;if(!a?.length)return e;const t=e.values.filter(s=>E(s,a));return{...e,extent:[...a],values:t}}function I(e,n,i){if(!n?.subsetDefinitions?.length)return!1;const{variables:r}=n;if(r.length&&e.some(({variableName:a})=>a&&!r.includes(a)))return!0;for(let a=0;a<e.length;a++){const t=e[a],s=n.subsetDefinitions.find(l=>(t.variableName===""||l.variableName===t.variableName)&&l.dimensionName===t.dimensionName);if(s?.values.length){const l=P(s.values);if(!t.isSlice&&t.values.length===2&&!Array.isArray(t.values[0])&&t.values[0]!==t.values[1]&&i){if(!X(t.values,l))return!0}else if(t.values.some(m=>!E(m,l)))return!0}}return!1}function ge(e,n){if(e==null)return{isOutside:!1};const{geometry:i,timeExtent:r,multidimensionalDefinition:a}=n;let t=null;if(r!=null&&(t=G(e,r),t==null))return{isOutside:!0};const{areaOfInterest:s}=e;if(s&&i){const l=i.type==="point"?i:i.type==="extent"?i.center:i.type==="polygon"?i.centroid:null;if(l&&!s.contains(l))return{isOutside:!0}}return a!=null&&a.length&&I(a,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:i,timeExtent:t,multidimensionalDefinition:a}}}function G(e,n){const i=e.dimensions.find(({name:s})=>s==="StdTime");if(i==null||n.start==null&&n.end==null)return n;n=n.clone();const{start:r,end:a}=n.toJSON(),t=r===a?[r]:r!=null&&a!=null?[r,a]:[r??a];return t.length===2&&i?.extent.length&&(t[0]=Math.max(t[0],i.extent[0]),t[1]=Math.min(t[1],i.extent[1]??i.extent[0]),t[1]<t[0])||I([new A({variableName:"",dimensionName:"StdTime",isSlice:t.length===1,values:t})],e,!0)?null:(n.start=new Date(t[0]),n.end=new Date(t[1]??t[0]),n)}function be(e){const{rasterInfo:n,multidimensionalSubset:i}=e,{multidimensionalInfo:r}=n;if(r==null)return null;let a=e.multidimensionalDefinition?.length?e.multidimensionalDefinition:F(n,{multidimensionalSubset:i});if(!a?.length)return null;if(a.some(s=>!s.dimensionName)){const{variableName:s}=a[0],l=F(n,{multidimensionalSubset:i,variableName:s});l?.forEach(m=>{const u=a?.find(({dimensionName:o})=>o===m.dimensionName);u?.values?.length&&(m.values=u.values,m.isSlice=u.isSlice)}),a=l}const{timeExtent:t}=e;if(a!=null&&t!=null&&(t.start!=null||t.end!=null)){a=a.map(h=>h.clone());const s=r.variables.find(({name:h})=>h===a[0].variableName)?.dimensions?.find(({name:h})=>h==="StdTime"),l=a.find(({dimensionName:h})=>h==="StdTime");if(!s||!l)return null;const{start:m,end:u}=t,o=m==null?null:m.getTime(),v=u==null?null:u.getTime(),c=o??v,d=v??o;if(s.values!=null){const h=s.values.filter(f=>{if(Array.isArray(f)){if(c===d)return f[0]<=c&&f[1]>=c;const b=f[0]<=c&&f[1]>c||f[0]<d&&f[1]>=d,y=f[0]>=c&&f[1]<=d||f[0]<c&&f[1]>d;return b||y}return c===d?f===c:f>=c&&f<=d});if(h.length){const f=h.sort((b,y)=>{const L=Array.isArray(b)?b[0]:b,j=Array.isArray(b)?b[1]:b,W=Array.isArray(y)?y[0]:y,Z=Array.isArray(y)?y[1]:y;return c===d?L-W:Math.abs(j-d)-Math.abs(Z-d)})[0];l.values=[f]}else a=null}else if(s.hasRegularIntervals&&s.extent){const[h,f]=s.extent;c>f||d<h?a=null:l.values=c===d?[c]:[Math.max(h,c),Math.min(f,d)]}}return a!=null&&I(a,i)?null:a}function K(e,n={}){const{multidimensionalInfo:i,keyProperties:r}=e;if(i==null)return null;const{variableName:a,multidimensionalSubset:t,multidimensionalDefinition:s}=n,l=s!=null?s[0]?.variableName:null,m=a||l||r?.DefaultVariable;let{variables:u}=i;return t?.variables?.length&&(u=u.filter(({name:o})=>t.variables.includes(o))),m?u.find(({name:o})=>o===m)??u[0]:u[0]}function F(e,n={}){const i=K(e,n);if(!i)return null;const r=[],{dimensions:a,name:t}=i;if(a.length===0)return[new A({variableName:t,dimensionName:"",values:[],isSlice:!0})];for(let s=0;s<a.length;s++){const l=O(a[s],n.multidimensionalSubset,t);if(!l)return null;const{values:m,extent:u}=l;let o=m?.[0]??u?.[0];l.name.toLowerCase()==="stdz"&&!l.hasRanges&&u&&Math.abs(u[1])<=Math.abs(u[0])&&(o=m?.length?m[m.length-1]:u[1]),r.push(new A({variableName:t,dimensionName:l.name,values:[o],isSlice:!n.useRangeForRangedDimensionInfo||!!l.hasRanges}))}return r}function ye(e){return!!e?.length&&e.some(n=>{if(n.values==null)return!0;const i=n.values.length;return i===0||i>1||!n.isSlice&&Array.isArray(n.values[0])})}function we(e,n){if(n==null||e==null)return null;let i=n.variables.map(r=>({...r}));return e?.variables?.length&&(i=i.filter(({name:r})=>e.variables.includes(r)),i.forEach(r=>{r.dimensions=r.dimensions.map(a=>O(a,e,r.name)).filter(J)})),i}function ee(e,n){const{values:i}=n;if(i?.length){const l=Array.isArray(i[0]),m=Array.isArray(e);return l!==m?-1:l&&m?i.findIndex(u=>u[0]===e[0]&&u[1]===e[1]):i.indexOf(e)}const{extent:r}=n;if(Array.isArray(e)||!r||e<r[0]||e>r[1])return-1;const a=n.interval||1;if(n.unit!=="ISO8601")return Math.round((e-r[0])/a);const t=r[0];let s=-1;switch(n.intervalUnit?.toLowerCase()||"days"){case"seconds":s=Math.round((e-t)/1e3/a);break;case"minutes":s=Math.round((e-t)/6e4/a);break;case"hours":s=Math.round((e-t)/36e5/a);break;case"days":s=Math.round((e-t)/864e5/a);break;case"months":{const l=new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear(),m=new Date(t).getUTCMonth(),u=new Date(e).getUTCMonth();s=l===0?u-m:u+11-m+12*(l-1)}break;case"years":s=Math.round((new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear())/a);break;case"decades":s=Math.round((new Date(e).getUTCFullYear()-new Date(t).getUTCFullYear())/10/a)}return s}function R(e){let n=e.values?.length;if(n)return n;const{extent:i,unit:r}=e,a=e.interval||1,t=i?i[1]-i[0]:0;if(r!=="ISO8601")return Math.round(t/a);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":n=Math.round(t/1e3/a);break;case"minutes":n=Math.round(t/6e4/a);break;case"hours":n=Math.round(t/36e5/a);break;case"days":n=Math.round(t/864e5/a);break;case"months":if(i){const s=new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear(),l=new Date(i[0]).getUTCMonth(),m=new Date(i[1]).getUTCMonth();n=s===0?m-l+1:m+11-l+12*(s-1)+1}else n=0;break;case"years":n=i?Math.round((new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear())/a):0;break;case"decades":n=i?Math.round((new Date(i[1]).getUTCFullYear()-new Date(i[0]).getUTCFullYear())/10/a):0;break;default:n=0}return n}function pe(e){if(e.extent?.length!==2||!e.interval)return[];const{extent:[n,i],interval:r}=e;if(e.unit==="ISO8601"){const t=e.intervalUnit?.toLowerCase()??"days";return["decades","years","months","days","hours","minutes","seconds"].includes(t)?ne(n,i,r,t):[]}const a=Math.round((i-n)/r);return Array.from({length:a},(t,s)=>s===a-1?i:n+s*r)}function ne(e,n,i,r){const a=[];let t=e;const s=new Date(e);for(;t<=n;)switch(a.push(t),r){case"decades":s.setUTCFullYear(s.getUTCFullYear()+10*i),t=s.getTime();break;case"years":s.setUTCFullYear(s.getUTCFullYear()+i),t=s.getTime();break;case"months":s.setUTCMonth(s.getUTCMonth()+i),t=s.getTime();break;case"days":t+=864e5*i;break;case"hours":t+=36e5*i;break;case"minutes":t+=6e4*i;break;case"seconds":t+=1e3*i}return a.length===1?a[1]=n:a[a.length-1]=n,a}function Ne(e,n){let i=0;const r=e[0].variableName,a=[...n.variables].sort((t,s)=>t.name>s.name?1:-1);for(let t=0;t<a.length;t++){const s=a[t],l=[...s.dimensions].sort((o,v)=>o.name>v.name?-1:1);if(s.name!==r){i+=l.map(o=>R(o)).reduce((o,v)=>o*v);continue}const m=l.map(o=>R(o)),u=l.length;for(let o=0;o<u;o++){const v=e.find(d=>d.dimensionName===l[o].name);if(v==null)return null;const c=ee(v.values[0],l[o]);if(c===-1)return null;m.shift(),i+=o===u-1?c:c*m.reduce((d,h)=>d*h)}break}return i}function xe(e){return Math.round(24*(e-25569)*3600*1e3)}export{I as $,F,ae as H,K as L,A as M,Q as V,re as X,se as _,me as a,w as b,ge as c,we as d,le as e,be as f,pe as g,ye as h,ce as i,de as l,ue as n,ve as o,Ne as p,fe as r,oe as t,he as u,g as v,xe as w};
