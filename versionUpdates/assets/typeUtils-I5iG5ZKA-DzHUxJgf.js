const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./OverrideHelper-GkMo7t6B-W3izerkZ.js","./main-BrXQBr3M.js","./main-BFPx82v4.css","./colorUtils-DxUhbS7D-1R0v1SSy.js","./vec42-D8CJyqHG-DnfLTeQH.js","./common-CYWrYyJl-E8-sukrT.js","./vec4f64-CjUMzAyX-DPYbdAom.js","./utils-BYqzY6_X-Dq82pUKM.js","./defaultCIMValues-gWpu7WSC-cjxb95kj.js","./enums-f9UUstHQ-hLTu4V1l.js","./callExpressionWithFeature-uWLbeAgq-yg0zn8jC.js","./quantizationUtils-Cndke4AR-CpcVDbiy.js"])))=>i.map(i=>d[i]);
import{z as u,cb as L,v as i,I as s,U as Y,t as D,cX as w,a1 as ne,eB as B,eC as le,bz as J,S as ae,c$ as U,Y as N,dW as K,eb as Q,d6 as ue,R as pe,bi as ye,bj as de,a8 as P,b as W,am as ce,c as he,eD as fe,_ as me,eE as ge,eF as be,e2 as ve}from"./main-BrXQBr3M.js";import{J as ee}from"./ClassBreaksRenderer-D97YzbWp-C6I_4ju-.js";import{o as Z,f as we,e as V,h as xe,T as Se,l as _e,a as je}from"./commonProperties-BLIn8DYU-BQFd4ays.js";import{i as Ie}from"./LRUCache-BLmkvs7b-Cf0KRICn.js";import{m as Ee}from"./Version-BTMwSXf1-CLS208tz.js";import{o as De}from"./FieldsIndex-Y7EBAYp0-BqfCvCRQ.js";import{q as Re,F as Me}from"./utils-BYqzY6_X-Dq82pUKM.js";import{b as Pe,y as Ve,c as Ce}from"./heatmapUtils--OU2Fakh-BWGHg30d.js";import{u as Te}from"./RendererLegendOptions-f5mIImtQ-C9HuzuEm.js";import{u as te}from"./SimpleRenderer-ADQlYl8U-DqPI9se2.js";import{_ as ie}from"./UniqueValueRenderer-BmoLL_Ee-B6g7RAOV.js";const X="esri.renderers.support.DictionaryLoader",Ne={type:"CIMSimpleLineCallout",lineSymbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",width:.5,color:[0,0,0,255]}]}};class se{constructor(t,r,o){this.config=null,this.fieldMap=null,this.url=null,this._ongoingRequests=new Map,this._symbolCache=new Ie(100),this._dictionaryVersion=null,this._fieldIndex=null,this._dictionaryPromise=null,this.url=t,this.config=r,this.fieldMap=o}getSymbolFields(){return this._symbolFields}async getSymbolAsync(t,r){let o;this._dictionaryPromise||(this._dictionaryPromise=this.fetchResources(r));try{o=await this._dictionaryPromise}catch(d){if(pe(d))return this._dictionaryPromise=null,null}const y=this._dictionaryVersion?.greaterEqual(4,0),l={};if(this.fieldMap)for(const d of this._symbolFields){const c=Re(this.fieldMap[d],this._fieldIndex);if(c){const n=t.attributes[c];l[d]=y?n:n!=null?""+t.attributes[c]:""}else l[d]=""}let a=null;try{a=o?.(l,r)}catch{return null}if(!a||typeof a!="string"||a==="invalid")return null;const g=a.split(";"),S=[],b=[];for(let d=0;d<g.length;d++){const c=g[d];if(c){if(c.includes("po:")){const n=c.slice(3).split("|");if(n.length===3){const _=n[0],j=n[1];let m=n[2];const C="countrylabel";if(_===C&&j==="TextString"){if(this.fieldMap!=null){let v=this.fieldMap[C];v==null&&(v=C,this.fieldMap[v]=v),t.attributes[v]=m}continue}if(j==="DashTemplate")m=m.split(" ").map(v=>Number(v));else if(j==="Color"){const v=new w(m).toRgba();m=[v[0],v[1],v[2],255*v[3]]}else m=Number(m);b.push({primitiveName:_,propertyName:j,value:m,defaultValue:null})}}else if(c.includes("|")){for(const n of c.split("|"))if(this._itemNames.has(n)){S.push(n);break}}else if(this._itemNames.has(c))S.push(c);else if(d===0){S.length=0;let n="Invalid_P";t.geometry!=null&&(ye(t.geometry)?n="Invalid_A":de(t.geometry)&&(n="Invalid_L")),S.push(n);break}}}const I=t.geometry==null||!t.geometry.hasZ&&t.geometry.type==="point";return this._cimPartsToCIMSymbol(t,S,b,I,r)}async fetchResources(t){if(this._dictionaryPromise)return this._dictionaryPromise;if(!this.url)return void P.getLogger(X).error("no valid URL!");const r=W(this.url+"/resources/styles/dictionary-info.json",{responseType:"json",query:{f:"json"},signal:t!=null?t.signal:null}),[{data:o}]=await Promise.all([r,ce()]);if(!o)throw this._dictionaryPromise=null,new he("esri.renderers.DictionaryRenderer","Bad dictionary data!");const{authoringInfo:y,dictionary_version:l,expression:a,itemsNames:g}=o,S=a;let b=!1;l&&(this._dictionaryVersion=Ee.parse(l),b=this._dictionaryVersion.greaterEqual(4,0)),this._refSymbolUrlTemplate=this.url+"/"+o.cimRefTemplateUrl,this._itemNames=new Set(g),this._symbolFields=y.symbol;const I={};if(this.config){const n=this.config;for(const _ in n)I[_]=n[_]}if(y.configuration)for(const n of y.configuration)I.hasOwnProperty(n.name)||(I[n.name]=n.value);const d=[];if(t?.fields&&this.fieldMap)for(const n in this.fieldMap){const _=this.fieldMap[n],j=t.fields.filter(m=>m.name.toLowerCase()===_?.toLowerCase());j.length>0&&d.push({...j[0],type:b?j[0].type:"esriFieldTypeString"})}d.length>0&&(this._fieldIndex=new De(d));const c=fe(S,t!=null?t.spatialReference:null,d,I).then(n=>{const _={scale:0};return(j,m)=>{if(n==null)return null;const C=n.repurposeFeature({geometry:null,attributes:j});return _.scale=m!=null?m.scale??void 0:void 0,n.evaluate({$feature:C,$view:_},n.services)}}).catch(n=>(P.getLogger(X).error("Creating dictionary expression failed:",n),null));return this._dictionaryPromise=c,c}async _cimPartsToCIMSymbol(t,r,o,y,l){const a=new Array(r.length);for(let b=0;b<r.length;b++)a[b]=this._getSymbolPart(r[b],l);let g=await Promise.all(a);const S=this.fieldMap;if(S&&g.length>0){const{OverrideHelper:b}=await me(()=>import("./OverrideHelper-GkMo7t6B-W3izerkZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11]),import.meta.url);g=u(g);for(const I of g)b.applyDictionaryTextOverrides(I,t,S,this._fieldIndex,Me(I))}return new ge({data:qe(g,o,y)})}async _getSymbolPart(t,r){const o=this._symbolCache.get(t);if(o)return o;if(this._ongoingRequests.has(t))return this._ongoingRequests.get(t).then(a=>a.data);const y=this._refSymbolUrlTemplate.replaceAll(/\{itemName\}/gi,t),l=W(y,{responseType:"json",query:{f:"json"},...r});this._ongoingRequests.set(t,l),l.finally(()=>this._ongoingRequests.delete(t));try{const a=await l;return this._symbolCache.put(t,a.data),a.data}catch(a){throw a}}}function qe(e,t,r){if(!e||e.length===0)return null;const o={...e[0]};if(e.length>1){o.effects=null,o.symbolLayers=[];for(const y of e){const l=y;if(l.effects!=null)for(const a of l.symbolLayers)a.effects==null?a.effects=l.effects:a.effects.unshift(...l.effects);o.symbolLayers.unshift(...l.symbolLayers)}}return r&&(o.callout=Ne),{type:"CIMSymbolReference",symbol:o,primitiveOverrides:t}}var k;let x=k=class extends Z(V){constructor(e){super(e),this.config=null,this.fieldMap=null,this.scaleExpression=null,this.scaleExpressionTitle=null,this.url=null,this.type="dictionary"}get _loader(){return new se(this.url,this.config,this.fieldMap)}writeData(e,t){e&&(t.scalingExpressionInfo={expression:e,returnType:"number"})}writeVisualVariables(e,t,r,o){o?.origin||super.writeVisualVariables(e,t,r,o)}clone(){return new k({config:u(this.config),scaleExpression:this.scaleExpression,scaleExpressionTitle:this.scaleExpressionTitle,fieldMap:u(this.fieldMap),url:u(this.url),visualVariables:u(this.visualVariables)})}async getSymbolAsync(e,t){return this._loader.getSymbolAsync(e,t)}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t),this.scaleExpression&&await L(e,t,this.scaleExpression);for(const r in this.fieldMap){const o=this.fieldMap[r];t.has(o)&&e.add(o)}}get arcadeRequired(){return!0}getSymbol(){return null}get symbols(){return[]}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return`${this.url}-${JSON.stringify(this.fieldMap)}`}getSymbolFields(){return this._loader.getSymbolFields()}};i([s({type:se})],x.prototype,"_loader",null),i([s({type:Object,json:{read:{source:"configuration"},write:{target:"configuration"}}})],x.prototype,"config",void 0),i([s({type:Object,json:{write:!0}})],x.prototype,"fieldMap",void 0),i([s({type:String,json:{read:{source:"scalingExpressionInfo.expression"},write:!0}})],x.prototype,"scaleExpression",void 0),i([Y("scaleExpression")],x.prototype,"writeData",null),i([s({type:String,json:{read:{source:"scalingExpressionInfo.title"},write:{target:"scalingExpressionInfo.title",overridePolicy(e){return{enabled:!!e&&!!this.scaleExpression}}}}})],x.prototype,"scaleExpressionTitle",void 0),i([s({type:String,json:{write:!0}})],x.prototype,"url",void 0),i([Y("visualVariables")],x.prototype,"writeVisualVariables",null),x=k=i([D("esri.renderers.DictionaryRenderer")],x);const Oe=x;var F;let E=F=class extends N{constructor(e){super(e),this.color=null,this.field=null,this.label=null,this.valueExpression=null,this.valueExpressionTitle=null}castField(e){return e==null?e:typeof e=="function"?(P.getLogger(this).error(".field: field must be a string value"),null):be(e)}getAttributeHash(){return`${this.field}-${this.valueExpression}`}clone(){return new F({color:this.color?.clone(),field:this.field,label:this.label,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};i([s({type:w,json:{type:[Number],write:!0}})],E.prototype,"color",void 0),i([s({type:String,json:{write:!0}})],E.prototype,"field",void 0),i([ne("field")],E.prototype,"castField",null),i([s({type:String,json:{write:!0}})],E.prototype,"label",void 0),i([s({type:String,json:{write:!0}})],E.prototype,"valueExpression",void 0),i([s({type:String,json:{write:!0}})],E.prototype,"valueExpressionTitle",void 0),E=F=i([D("esri.renderers.support.AttributeColorInfo")],E);const re=E;var $;let q=$=class extends N{constructor(){super(...arguments),this.unit=null}clone(){return new $({unit:this.unit})}};i([s({type:String,json:{write:!0}})],q.prototype,"unit",void 0),q=$=i([D("esri.renderers.support.DotDensityLegendOptions")],q);const Le=q;var A;let h=A=class extends Z(V){constructor(e){super(e),this.attributes=null,this.backgroundColor=new w([0,0,0,0]),this.dotBlendingEnabled=!0,this.dotShape="square",this.dotSize=1,this.legendOptions=null,this.outline=new B,this.dotValue=null,this.referenceScale=null,this.seed=1,this.type="dot-density"}calculateDotValue(e){if(this.referenceScale==null)return this.dotValue;const t=e/this.referenceScale*this.dotValue;return t<1?1:t}getSymbol(){return new le({outline:this.outline})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}getAttributeHash(){return this.attributes?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return JSON.stringify(this.outline)}clone(){return new A({attributes:u(this.attributes),backgroundColor:u(this.backgroundColor),dotBlendingEnabled:u(this.dotBlendingEnabled),dotShape:u(this.dotShape),dotSize:u(this.dotSize),dotValue:u(this.dotValue),legendOptions:u(this.legendOptions),outline:u(this.outline),referenceScale:u(this.referenceScale),seed:u(this.seed),visualVariables:u(this.visualVariables),authoringInfo:u(this.authoringInfo)})}getControllerHash(){return`${this.attributes?.map(e=>e.field||e.valueExpression||"")}-${this.outline&&JSON.stringify(this.outline.toJSON())||""}`}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes??[])r.valueExpression&&await L(e,t,r.valueExpression),r.field&&e.add(r.field)}};i([s({type:[re],json:{write:!0}})],h.prototype,"attributes",void 0),i([s({type:w,json:{write:!0}})],h.prototype,"backgroundColor",void 0),i([s({type:Boolean,json:{write:!0}})],h.prototype,"dotBlendingEnabled",void 0),i([s({type:String,json:{write:!1}})],h.prototype,"dotShape",void 0),i([s({type:Number,json:{write:!0}})],h.prototype,"dotSize",void 0),i([s({type:Le,json:{write:!0}})],h.prototype,"legendOptions",void 0),i([s({type:B,json:{default:null,write:!0}})],h.prototype,"outline",void 0),i([s({type:Number,json:{write:!0}})],h.prototype,"dotValue",void 0),i([s({type:Number,json:{write:!0}})],h.prototype,"referenceScale",void 0),i([s({type:Number,json:{write:!0}})],h.prototype,"seed",void 0),i([J({dotDensity:"dot-density"})],h.prototype,"type",void 0),h=A=i([D("esri.renderers.DotDensityRenderer")],h);const ke=h;var H;let T=H=class extends N{constructor(e){super(e),this.color=null,this.ratio=null}clone(){return new H({color:this.color&&this.color.clone(),ratio:this.ratio})}};i([s({type:w,json:{type:[ae],default:null,write:{isRequired:!0}}})],T.prototype,"color",void 0),i([s({type:Number,json:{write:{isRequired:!0}}})],T.prototype,"ratio",void 0),T=H=i([D("esri.renderers.support.HeatmapColorStop")],T);const O=T;let M=class extends U.ClonableMixin(N){constructor(){super(...arguments),this.minLabel=null,this.maxLabel=null,this.title=null}};i([s({type:String,json:{write:!0}})],M.prototype,"minLabel",void 0),i([s({type:String,json:{write:!0}})],M.prototype,"maxLabel",void 0),i([s({type:String,json:{write:!0}})],M.prototype,"title",void 0),M=i([D("esri.renderers.support.HeatmapLegendOptions")],M);var z;function G(e){if(e!=null){const{maxDensity:t,minDensity:r,radius:o}=e;if(t!=null||r!=null||o!=null){const{blurRadius:y,maxPixelIntensity:l,minPixelIntensity:a,...g}=e;return g}}return e}let p=z=class extends V{constructor(e){super(e),this.authoringInfo=null,this.colorStops=[new O({ratio:0,color:new w("rgba(255, 140, 0, 0)")}),new O({ratio:.75,color:new w("rgba(255, 140, 0, 1)")}),new O({ratio:.9,color:new w("rgba(255, 0,   0, 1)")})],this.field=null,this.legendOptions=null,this.maxDensity=.04,this.minDensity=0,this.radius=18,this.referenceScale=0,this.type="heatmap",this.valueExpression=null,this.valueExpressionTitle=null}normalizeCtorArgs(e){return G(e)}get blurRadius(){return Pe(this.radius)}set blurRadius(e){const t=this.maxPixelIntensity,r=this.minPixelIntensity;this._set("radius",Ve(e)),this._set("maxDensity",t*this._pixelIntensityToDensity),this._set("minDensity",r*this._pixelIntensityToDensity)}get maxPixelIntensity(){return this.maxDensity/this._pixelIntensityToDensity}set maxPixelIntensity(e){this._set("maxDensity",e*this._pixelIntensityToDensity)}get minPixelIntensity(){return this.minDensity/this._pixelIntensityToDensity}set minPixelIntensity(e){this._set("minDensity",e*this._pixelIntensityToDensity)}get _pixelIntensityToDensity(){return 24/(Ce**2*this.blurRadius**4)}read(e,t){e=G(e),super.read(e,t)}getSymbol(){return new Q}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol()]}async collectRequiredFields(e,t){const r=this.field,o=this.valueExpression;r&&typeof r=="string"&&ve(e,t,r),o&&typeof o=="string"&&await L(e,t,o)}getAttributeHash(){return""}getMeshHash(){return`${JSON.stringify(this.colorStops)}.${this.blurRadius}.${this.field}`}clone(){return new z({authoringInfo:this.authoringInfo&&this.authoringInfo.clone(),colorStops:u(this.colorStops),field:this.field,legendOptions:u(this.legendOptions),maxDensity:this.maxDensity,minDensity:this.minDensity,radius:this.radius,referenceScale:this.referenceScale,valueExpression:this.valueExpression,valueExpressionTitle:this.valueExpressionTitle})}};i([s({type:we,json:{write:!0,origins:{"web-scene":{write:!1,read:!1}}}})],p.prototype,"authoringInfo",void 0),i([s({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],p.prototype,"blurRadius",null),i([s({type:[O],json:{write:{isRequired:!0}}})],p.prototype,"colorStops",void 0),i([s({type:String,json:{write:!0}})],p.prototype,"field",void 0),i([s({type:M,json:{write:!0}})],p.prototype,"legendOptions",void 0),i([s({type:Number,json:{write:!0}})],p.prototype,"maxDensity",void 0),i([s({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],p.prototype,"maxPixelIntensity",null),i([s({type:Number,json:{write:!0}})],p.prototype,"minDensity",void 0),i([s({type:Number,json:{origins:{"portal-item":{write:!0},"web-map":{write:!0}}}})],p.prototype,"minPixelIntensity",null),i([s({type:Number,cast:K,json:{write:!0}})],p.prototype,"radius",void 0),i([s({type:Number,range:{min:0},json:{default:0,write:!0}})],p.prototype,"referenceScale",void 0),i([J({heatmap:"heatmap"})],p.prototype,"type",void 0),i([s({type:String,json:{write:!0,origins:{"web-document":{write:!1},"portal-item":{write:!1}}}})],p.prototype,"valueExpression",void 0),i([s({type:String})],p.prototype,"valueExpressionTitle",void 0),i([s({readOnly:!0})],p.prototype,"_pixelIntensityToDensity",null),p=z=i([D("esri.renderers.HeatmapRenderer")],p);const oe=p;let R=class extends U.ClonableMixin(N){constructor(){super(...arguments),this.color=new w([0,0,0,0]),this.label=null,this.threshold=0}};i([s({type:w,json:{write:!0}})],R.prototype,"color",void 0),i([s({type:String,json:{write:!0}})],R.prototype,"label",void 0),i([s({type:Number,range:{min:0,max:1},json:{write:!0}})],R.prototype,"threshold",void 0),R=i([D("esri.renderers.support.OthersCategory")],R);const Fe={base:Se,key:"type",typeMap:{size:_e,opacity:je}};let f=class extends Z(U.ClonableMixin(V)){constructor(e){super(e),this.attributes=null,this.backgroundFillSymbol=null,this.defaultColor=new w([0,0,0,0]),this.defaultLabel=null,this.holePercentage=0,this.othersCategory=new R,this.legendOptions=null,this.outline=null,this.size=12,this.type="pie-chart",this.visualVariables=null}getSymbol(){return new Q({size:this.size?this.size/2+(this.outline?.width||0):0})}async getSymbolAsync(){return this.getSymbol()}get symbols(){return[this.getSymbol(),this.backgroundFillSymbol].filter(ue)}getAttributeHash(){return this.visualVariables?.reduce((e,t)=>e+t.getAttributeHash(),"")??""}getMeshHash(){return this.symbols.reduce((e,t)=>e+JSON.stringify(t),"")}async collectRequiredFields(e,t){await this.collectVVRequiredFields(e,t);for(const r of this.attributes)r.valueExpression&&await L(e,t,r.valueExpression),r.field&&e.add(r.field)}};i([s({type:[re],json:{write:!0}})],f.prototype,"attributes",void 0),i([s(xe)],f.prototype,"backgroundFillSymbol",void 0),i([s({type:w,json:{write:!0}})],f.prototype,"defaultColor",void 0),i([s({type:String,json:{write:!0}})],f.prototype,"defaultLabel",void 0),i([s({type:Number,range:{min:0,max:1},json:{write:!0}})],f.prototype,"holePercentage",void 0),i([s({type:R,json:{write:!0}})],f.prototype,"othersCategory",void 0),i([s({type:Te,json:{write:!0}})],f.prototype,"legendOptions",void 0),i([s({type:B,json:{default:null,write:!0}})],f.prototype,"outline",void 0),i([s({type:Number,cast:K,json:{write:!0}})],f.prototype,"size",void 0),i([J({pieChart:"pie-chart"})],f.prototype,"type",void 0),i([s({types:[Fe]})],f.prototype,"visualVariables",void 0),f=i([D("esri.renderers.PieChartRenderer")],f);const $e=f,it={key:"type",base:V,typeMap:{heatmap:oe,simple:te,"unique-value":ie,"class-breaks":ee,"dot-density":ke,dictionary:Oe,"pie-chart":$e},errorContext:"renderer"},st={key:"type",base:V,typeMap:{simple:te,"unique-value":ie,"class-breaks":ee,heatmap:oe},errorContext:"renderer",validate:Ae};function Ae(e){switch(e.type){case"simple":return He(e);case"unique-value":return ze(e);case"class-breaks":return Be(e);case"heatmap":return e}}function He(e){if(e.symbol)return e;P.getLogger("esri.renderers.support.types").error("Removed invalid 'simple' renderer without a symbol from web scene.")}function ze(e){const t=e.uniqueValueInfos,r=t?.filter(({symbol:o,label:y},l)=>(o||P.getLogger("esri.renderers.support.types").error(`Removed invalid unique value info ([${l}] ${y}) without a symbol from web scene.`),!!o));return r?.length!==t?.length&&(e.uniqueValueInfos=r),e}function Be(e){const t=e.classBreakInfos,r=t?.filter(({symbol:o,label:y},l)=>(o||P.getLogger("esri.renderers.support.types").error(`Removed invalid class break info ([${l}] ${y}) without a symbol from web scene.`),!!o));return r?.length!==t?.length&&(e.classBreakInfos=r),e}export{st as $,it as k,O as q};
