const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./SelfSnappingEngine-cGmuW4MT-DNDLstuY.js","./main-BrXQBr3M.js","./main-BFPx82v4.css","./globalCss-CFN4F315-nvTe32za.js","./Queue-B8H6jIv7-C4vOEIQq.js","./signal-DxzURL18-BiAWl8ZV.js","./Version-BTMwSXf1-CLS208tz.js","./quantityUtils-RaoZoCNH-7yvlACmu.js","./vec2-BnynUbeJ-CKtGJQAy.js","./common-CYWrYyJl-E8-sukrT.js","./geodesicLengthMeasurementUtils-X1SKKkBz-BJVMMixh.js","./index-CVKk0WAC-D5H03Yyr.js","./draw-store-C1_quxsr-KNUUV-aj.js","./GraphicsLayer-GkJJfSu5-DuYgOfBS.js","./GraphicsCollection-rAFZo1AJ-C66GkgUC.js","./Layer-B8q-l4yV-CrUv4jz5.js","./TimeExtent-gZaEUVeW-D2eGsof2.js","./ScaleRangeLayer-DIxukUBC-C1pkfLgo.js","./layerContainerType-ChWdCT09-G5sdAsSy.js","./jsonUtils-DzmXEA9_-BnStZKpJ.js","./parser-hXQyB-Qx-Dp0xTp_H.js","./mat4f32-CiZjBg9k-CUm34GoR.js","./mat4-BFStKTjU-uiUWvEP6.js","./ElevationInfo-DkWlof50-Bezaxy73.js","./lengthUtils-wU9RRIqK-BTv_PZij.js","./intl-DLmy-Li5-DRUw9zN4.js","./jsxFactory-C5LxVioS-C8vZZ24R.js","./uuid-Dj9mdEVg-BaKSCiyT.js","./layerViewUtils-Bk5QNiAa-DVg9x4hA.js","./widget-BgluoE6k-DUnNINRe.js","./diffUtils-BSe9IE26-BhPEeZ3Z.js","./UpdatingHandles-DBzjq66S-BsyyovN3.js","./ViewingMode-CyR_b1T8-_s7_Gbsk.js","./vec2f64-CEUyUoff-BBc0aQ6D.js","./vec32-BuqRmYBM-a_dAxp7z.js","./vec42-D8CJyqHG-DnfLTeQH.js","./vec4f64-CjUMzAyX-DPYbdAom.js","./projection-m8vi7Cxv-DG9zGNlV.js","./meshVertexSpaceUtils-BwEbYR8F-B7wjvwC7.js","./MeshLocalVertexSpace-DFCiKNRA-BlhP6OPR.js","./hydratedFeatures-BDT5zTGB-DiUP0hcO.js","./projectVectorToVector-D0K_S4MR-4Lr69e04.js","./projectPointToVector-CG1hALQu-_1t8tYzF.js","./plane-B_adY3_o-k_KeEgEV.js","./mat3f64-Dh9_zhFu-BIT-k8Dm.js","./mat4f64-BaJwL7tQ-k0uMm8LY.js","./quatf64-C16JxGFv-BKWK1F8U.js","./geodesicUtils-DV-lFWtb-Cfgf3osD.js","./Scheduler-Br-2v2ys-C5OE6Pu_.js","./geometryEngineBase-DueYg7ux-CCeespPx.js","./_commonjsHelpers-BITg13Vk-KnjfkSck.js","./hydrated-Bae3cp-4-CqrNuLE6.js","./mat2d-BQA-1WB--Pnyy0dhf.js","./quat-D8L_R4I0-B2071tyE.js","./drapedUtils-7RfmdK5D-DW8HPu8_.js","./utils-C0LvbFCo-RMQaTNpt.js","./substitute-TfjvVaWd-CYbhCX1-.js","./Query-CxQYWcUQ-B-eUtOfF.js","./Field-Cj6Pz3TI-BT1_6DON.js","./fieldType-VTpxE-EM-CC-owBT-.js","./sphere-Cj20syUS-D-Z5ol5q.js","./mat3-DOnW3DjW-C3hbW9XY.js","./GridSnappingEngine-DCXaqXz2-dHI8KhnZ.js","./normalizeUtils-b-vZURob-Cu-Bjt2-.js","./utils-DuaeuwP5-t1uDCGxn.js","./utils-Jw-4AGsF-DGUB3bF1.js","./scaleUtils-DtnDbXa5-DIW3fzgY.js","./gridUtils-D2du44-d-Dq-Zb8Ky.js","./FeatureSnappingEngine-aDZtmISS-CiGhLwBA.js","./FeatureFilter-C7FajlY_-Ccw3sCjO.js","./floorFilterUtils-4r-vVdzs-C43jLoAE.js","./editingTools-KBOXuhog-DgLoMSyO.js","./SnappingVisualizer2D-DR-yrbjS-BialhzQX.js","./enums-f9UUstHQ-hLTu4V1l.js","./automaticAreaMeasurementUtils-Bz1iefP0-c1Jk-cpw.js","./PointSnappingHint-ClwQ1VNw-BUlpW57L.js","./automaticLengthMeasurementUtils-BcfJmFU0-Bdr2YwzW.js","./MeshTransform-CvTryVbE-CcTWe5ZS.js","./axisAngleDegrees-nTnQhoaG-M2xEtDgJ.js","./themeUtils-RB4IoNvm-uO-dsvgO.js","./a11yUtils-C2ydunC---DkjY4RU.js","./unitFormatUtils-zTNxheG9-BZKEJ8fP.js","./ByteSizeUnit-DL8UhsB0-B2-AmVRx.js","./spatialReferenceEllipsoidUtils-DlQOpWof-DZSRlDRY.js","./earcut-XDcq3zAf-BcwyrT7l.js","./triangle-BePBrXJ8-D-GiIJSi.js","./lineSegment-BJNfNZM5-C_IxAdr_.js","./editPlaneUtils-CYBM1uSC-DrXIsiFX.js","./boundedPlane-B6TkXVHT-DH7B9-e0.js","./cimSymbolUtils-BuFg2oLA-duvhADIj.js","./utils-BYqzY6_X-Dq82pUKM.js","./defaultCIMValues-gWpu7WSC-cjxb95kj.js","./GraphicManipulator-DXPP3gDs-C41cKRRl.js","./colorUtils-DxUhbS7D-1R0v1SSy.js","./drawUtils-BUIg7AUj-LGsIYcko.js","./editingTools-CWx0-1A2-CAVbIOPD.js","./glsl-o28TenZV-B0eZUNn3.js","./BindType-CKbZk6AG-Bqvzo9NX.js","./interfaces-D_DB_-WL-NDsk9gO8.js","./VerticalOffset.glsl-BtVaDxLq-D5ZdGnSg.js","./Indices-DkAzsiH--AFTdDkB0.js","./InterleavedLayout-DcHoXu73-C0HUpEXg.js","./BufferView-BBCzkcZS-CjZ-XaYu.js","./renderState-DlSSrLcZ-Du_EmLq6.js","./enums-DBi1-Mm2-CUS1pvQe.js","./VertexAttribute-DFC3a3eR-BhmQtMsu.js","./ShaderOutput-C_OqLoo1-jp3zUBgm.js","./requestImageUtils-rT_rMd2F-Dh2uudas.js","./TextureFormat-Cl0ugX3E-DD0Aw8RG.js","./Texture-DXSFJsEu-kk8MOEot.js","./getDataTypeBytes-HSdrWtlL-ClHsCcSN.js","./orientedBoundingBox-CTsjUkMw-C6xUHgOp.js","./computeTranslationToOriginAndRotation-DwwrTl3S-DW-aZeSo.js","./ShaderBuilder-BkQM64Qp-DIsDwu7k.js","./triangulationUtils-KRNFVU70-BLz-6NAp.js","./deduplicate-DZCyc4JG-CeHMcF3M.js","./RibbonLine.glsl-B9kKeq0l-CgqVfd8l.js","./HUDVisibility.glsl-Bl7zdrV0-CiSdbX25.js","./doublePrecisionUtils-BJbYwoii-kIP-tL_t.js","./vec3f32-BS0cezmI-B_madU1n.js","./Octree-Kk-G5P_T-R05vv0lY.js","./floatRGBA-YJlz5IlR-a5Bq-2nd.js","./HUDMaterial.glsl-DUfp5PMk-B3f3dRPx.js","./VertexArrayObject-DTkLCIKs-BW-lSVzm.js","./memoryEstimations-iHVpvWPf-Bcit1dlR.js","./HighlightDefaults-Cg50f_1y-DBQnO5UZ.js","./VertexElementDescriptor-BAy1DPb3-BOhpDZGx.js","./NestedMap-Ddo7BfvO-BpVPk8mz.js","./TextOverlayItem-pAuO460X-Bwf7xIxl.js","./glUtil-n1JOrdV3-CRAZdee5.js","./SelectedVertexTooltipInfo-C6fS9jtg-CJ62AavV.js","./TranslateTooltipInfo-BmeZ3crn-D_Ve2Bot.js","./utils-C_9ghOVk-CTZnzkQh.js","./LRUCache-BLmkvs7b-Cf0KRICn.js","./MemCache-BCippCv6-DnYe-hpD.js","./IViewEvents-BE10MM98-CvMfjolG.js","./MD5-CHHr-oed-SuyrCYQ0.js","./multiOriginJSONSupportUtils-DGETddQl-BrWaY9_8.js","./ExtentScaleTooltipInfo-DGVFaJSb-OyjqBxeE.js","./LineCallout.glsl-B1CPwb2z-YT4mRr_n.js","./heightModelInfoUtils-CI93rfC7-WEtVA2Xo.js","./HeightModelInfo-BkDck4B0-DuW1KdQ_.js","./visualVariableUtils-BO-_wo28-DfrVsYLw.js","./dehydratedFeatures-CekTKTy7-Cvrq1fCK.js","./UniqueValueRenderer-BmoLL_Ee-B6g7RAOV.js","./commonProperties-BLIn8DYU-BQFd4ays.js","./colorRamps-KMmVdCPJ-CmpjMakp.js","./ColorStop-DoHCvOqO-CN19nLxS.js","./RendererLegendOptions-f5mIImtQ-C9HuzuEm.js","./styleUtils-DxAOZq5S-C08OtaT1.js","./rendererConversion-D-HBj0jy-rZsTFyHW.js","./RealisticTree.glsl-De7nH4tm-DvbJI5-v.js","./DefaultMaterial-DGGIMylx-2HFHok1m.js","./NormalAttribute.glsl-C9zbIKka-CzfbYM8x.js","./edgeUtils-CjV7X0G9-C0rPB9rG.js","./OptimizedFeatureSet-D6mgsKNr-DozTzjts.js","./OptimizedGeometry-1qDYm3YK-NqjQEvGQ.js","./optimizedFeatureQueryEngineAdapter-Bx4OOJmK-CCXYJ5FT.js","./vec2f32-CVhmN3Me-DxoqVD7C.js","./featureConversionUtils-DRaHTjrY-fgjzbpdH.js","./webStyleAcceptedFormats-DsfCZOwz-CG7ZQ6BV.js","./PooledRBush-J5-OtqBl-BPvUcKNI.js","./quickselect-DHTstthl-Ds_Aj0x5.js","./popupUtils-sIuvqRgn-Bj4l9koJ.js","./geometryServiceUtils-7fDBrM6E-ouY-UPv7.js","./project-CdmvlsYz-D1Pfd-pG.js","./LayerView-D3XoMhlx-C8a95iA_.js","./GraphicMover-CiNX1V2i-CVpW6kxN.js","./featureUtils-CZUu1SmW-BISwh1ji.js","./utils-BG7WTOnW-ifxlWSTl.js","./timeZoneUtils-z3WjfjXQ-8JPN5aIG.js","./Box-CcaqKOvu-CYiJlMqI.js","./settings-zzKkZJrb-BdFkN7JE.js","./Reshape-BUYuf7aU-DLFuoaoa.js"])))=>i.map(i=>d[i]);
import{v as c,cE as v,f_ as ve,d6 as Cn,I as h,aa as Ee,a as zt,b9 as se,ai as _e,_ as N,H as Pt,K as Dn,eR as Nn,eb as di,eC as Hn,eB as Un,gE as Vn,gF as Fn,d1 as ui,aC as Be,aE as $n,db as Rt,aO as yi,ci as Ui,gG as jn,gg as qn,gH as J,gI as gi,a8 as Vi,c as zn,d8 as fi,dj as Zn,gh as nt,t as C,Y as Fi,cX as ot,el as Yn,fY as Bn,ac as Wn,gJ as Kn,aG as Ne,df as Xn,f$ as Jn,d9 as Qn,aj as eo,ds as vi,e1 as ke,gn as to,co as ft,ah as io,as as no,ca as oo,av as so,cM as ro,d4 as ao,gK as po}from"./main-BrXQBr3M.js";import{i as lo}from"./UpdatingHandles-DBzjq66S-BsyyovN3.js";import{O as Dt,Q as co,L as ho,k as uo,K as yo,i as go}from"./projection-m8vi7Cxv-DG9zGNlV.js";import fo from"./GraphicsLayer-GkJJfSu5-DuYgOfBS.js";import{b as vo}from"./ElevationInfo-DkWlof50-Bezaxy73.js";import{g as G,A as mi,k as mo,a as _o,W as Eo,m as bo}from"./globalCss-CFN4F315-nvTe32za.js";import{t as Ue,g as Zt}from"./quantityUtils-RaoZoCNH-7yvlACmu.js";import{i as H,y as ie,l as we,P as Me,f as wo,b as To,h as $i,M as ji,D as So,v as Oo,k as Po,A as Ro,m as qi,E as _i}from"./vec2-BnynUbeJ-CKtGJQAy.js";import{o as q,y as Go,t as Qe,l as Mo}from"./vec2f64-CEUyUoff-BBc0aQ6D.js";import{O as k,T as O,p as Nt,C as F,v as Ao,y as V,X as st,l as xo,r as vt,P as Lo,Y as ko,_ as mt,g as zi,A as ne,W as Io,V as Ht}from"./vec32-BuqRmYBM-a_dAxp7z.js";import{s as Fe,p as Zi,f as rt}from"./projectVectorToVector-D0K_S4MR-4Lr69e04.js";import{u as Ut,D as Yt,W as at,C as Bt}from"./geodesicUtils-DV-lFWtb-Cfgf3osD.js";import{O as Co}from"./TimeExtent-gZaEUVeW-D2eGsof2.js";import{b as Do}from"./Query-CxQYWcUQ-B-eUtOfF.js";import{y as No,w as Ho}from"./vec42-D8CJyqHG-DnfLTeQH.js";import{o as Uo}from"./vec4f64-CjUMzAyX-DPYbdAom.js";import{Q as z,m as Yi,O as Vo,U as Bi,P as Fo,B as _t,$ as Wi,a as Vt,E as Ki,K as $o}from"./plane-B_adY3_o-k_KeEgEV.js";import{G as jo,F as qo,B as zo,w as Zo,U as Yo}from"./sphere-Cj20syUS-D-Z5ol5q.js";import{n as Ve}from"./common-CYWrYyJl-E8-sukrT.js";function Xi(e){return e?Te:os}function Bo(e,t){return t?.mode?t.mode:Xi(e).mode}function Wo(e,t){return t??Xi(e)}function Ji(e,t){return Bo(e==null||(e.hasZ??!1),t)}function Zr(e,t){return Wo(e==null||(e.hasZ??!1),t)}function Ko(e){const t=Qi(e);return Ji(e.geometry,t)}function Xo(e){const t=Qi(e),i=Ji(e.geometry,t),n=t!=null&&i!=="on-the-ground"?ns(t):0,o=t?.featureExpressionInfo;return{mode:i,offset:n,featureExpressionInfo:o}}function Jo(e){return Et(Xo(e))}function Yr(e){return Et(e)||Qo(e)}function Qo(e){return e?.featureExpressionInfo?.expression==="0"}function Et(e){if(!e||e.mode==="on-the-ground")return!1;const t=e?.featureExpressionInfo?e.featureExpressionInfo.expression:null;return!(!t||t==="0")}function Qi(e){return e.layer&&"elevationInfo"in e.layer?e.layer.elevationInfo:null}function Wt(e,t){if(!e?.offset)return 0;const{offset:i,unit:n}=e;if(n==="decimal-degrees")return 0;const o=n!=="unknown"&&n?n:"meters",s=to(t);return s?ft(i,o,s):0}function Br(e,t,i){if(!i?.mode)return;const n=e.hasZ?e.z:0,o=Wt(i,e.spatialReference);switch(i.mode){case"absolute-height":return n-o;case"on-the-ground":return 0;case"relative-to-ground":return n-((t.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"ground")??0)+o);case"relative-to-scene":return n-((t.elevationProvider.getElevation(e.x,e.y,n,e.spatialReference,"scene")??0)+o)}}function es(e,t,i,n=null){return Kt(e,t.x,t.y,t.hasZ?t.z:0,t.spatialReference,i,n)}function en(e,t,i,n,o=null){return Kt(e,t[0],t[1],t.length>2?t[2]:0,i,n,o)}function Kt(e,t,i,n,o,s,a=null){if(s==null)return;const r=a!=null?a.mode:"absolute-height";if(r==="on-the-ground")return 0;const{absoluteZ:l}=ts(t,i,n,o,e,s);return is(l,t,i,n,o,e,a,r)}function ts(e,t,i,n,o,s){const a=Wt(s,n);switch(s.mode){case"absolute-height":return{absoluteZ:i+a,elevation:0};case"on-the-ground":{const r=o.elevationProvider.getElevation(e,t,0,n,"ground")??0;return{absoluteZ:r,elevation:r}}case"relative-to-ground":{const r=o.elevationProvider.getElevation(e,t,i,n,"ground")??0;return{absoluteZ:i+r+a,elevation:r}}case"relative-to-scene":{const r=o.elevationProvider.getElevation(e,t,i,n,"scene")??0;return{absoluteZ:i+r+a,elevation:r}}}}function is(e,t,i,n,o,s,a,r){const l=Wt(a,o);switch(r){case"absolute-height":return e-l;case"relative-to-ground":return e-((s.elevationProvider.getElevation(t,i,n,o,"ground")??0)+l);case"relative-to-scene":return e-((s.elevationProvider.getElevation(t,i,n,o,"scene")??0)+l)}}function Wr(e,t){if(t==null)return!1;const{mode:i}=t;return i!=null&&(e==="scene"&&i==="relative-to-scene"||e==="ground"&&i!=="absolute-height")}function Kr(e,t,i){return i&&i.mode!==t?`${e} only support ${t} elevation mode`:null}function Xr(e,t,i){return i?.mode===t?`${e} do not support ${t} elevation mode`:null}function Jr(e,t){return t?.featureExpressionInfo!=null&&t.featureExpressionInfo.expression!=="0"?`${e} do not support featureExpressionInfo`:null}function Qr(e,t){t&&e.warn(".elevationInfo=",t)}function ns(e){return(e?.offset??0)*vo(e?.unit)}const Te={mode:"absolute-height",offset:0},os={mode:"on-the-ground",offset:null};function Gt(e,t){return e[0]*t[1]-e[1]*t[0]}function ss(e,t,i){const n=Me(i,t)/we(i);return Oo(e,i,n)}function ea(e,t,i,n,o=i){return H(be,n,i),H(pt,t,o),ss(Re,pt,be),To(e,o,Re)}function ta(e,t,i,n){H(be,t,i);const o=n/$i(be);return ie(e,i,be,o)}function ia(e,t){const i=e.start,n=e.end,o=t.start,s=t.end,a=H(be,n,i),r=H(tn,s,o),l=Gt(a,r);if(Math.abs(l)<=as)return[];const p=H(pt,i,o),d=Gt(r,p)/l,u=Gt(a,p)/l;if(d>=0){if(u>=0||t.type===P.LINE)return[ie(Re,i,a,d)]}else if(e.type===P.LINE&&(u>=0||t.type===P.LINE))return[ie(Re,i,a,d)];return[]}function rs(e,t,i){const n=[],o=H(be,e.end,e.start),s=H(tn,e.start,t),a=we(o),r=2*Me(o,s),l=r*r-4*a*(we(s)-i*i);if(l===0){const p=-r/(2*a);(e.type===P.LINE||p>=0)&&n.push(ie(Re,e.start,o,p))}else if(l>0){const p=Math.sqrt(l),d=(-r+p)/(2*a);(e.type===P.LINE||d>=0)&&n.push(ie(Re,e.start,o,d));const u=(-r-p)/(2*a);(e.type===P.LINE||u>=0)&&n.push(ie(pt,e.start,o,u))}return n}var P;(function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"})(P||(P={}));const as=1e-6,be=q(),tn=q(),pt=q(),Re=q();function ps(e,t,i,n,o=v()){const s=mt(ls,e);return s[2]=en(n,s,t,i)||0,n.renderCoordsHelper.toRenderCoords(s,t,o),o}const ls=v(),nn="z",on="r",R={redo:on,undo:nn,center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},Ei={toggle:"Control"},na={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},oa={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:mo,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},editSourcePoints:{key:"Alt",continuePropagation:!0},undo:nn,redo:on};let sa=class{constructor(){this._bindings=new Map}add(e,t){return this.addToggle(e,i=>{i.type==="key-down"&&t(i)})}addToggle(e,t){const i=cs.fromDefinition(e,t),n=io(this._bindings,i.key,()=>[]);return n.push(i),no(()=>oo(n,i))}register(e,t=G.WIDGET){return so([e.on("key-down",i=>this.dispatch(e.inputManager,i),t),e.on("key-up",i=>this.dispatch(e.inputManager,i),t)])}dispatch(e,t){const i=t.key,n=this._bindings.get(i);if(n)for(const o of n)o.process(e,t)}},cs=class Ft{constructor(t,i,n,o,s){this.key=t,this.modifiers=i,this.repeats=n,this.continuePropagation=o,this.callback=s}process(t,i){if(!(i.key!==this.key||"repeat"in i&&i.repeat&&!this.repeats)){for(const n of this.modifiers)if(!t.isModifierKeyDown(n))return;this.continuePropagation||i.stopPropagation(),this.callback(i)}}static fromDefinition(t,i){if(typeof t=="string")return new Ft(t,[],!1,!1,i);const{key:n,modifier:o,repeats:s,continuePropagation:a}=t;return new Ft(n,o?Array.isArray(o)?o:[o]:[],!!s,!!a,i)}};var Se;function sn(e,t,i){return j(e,t,i)}function j(e=0,t=0,i=0){return nt(e,t,i)}function ra(e){return e}function aa(e){return e}function me(e,t,i){return nt(e,t,i)}function Ge(e){const[t,i,n]=e;return e.length>3?[t,i,n,e[3]]:[t,i,n]}function Mt(e){return e[3]=((e.length>3?e[3]:void 0)??Se.NONE)|Se.TARGET,e}function pa(e){return!!(((e.length>3?e[3]:void 0)??Se.NONE)&Se.TARGET)}function bi(e,t,{coordinateHelper:i,elevationInfo:n},o){return e?De(i.vectorToDehydratedPoint(e,hs),t,n,o):null}function De(e,t,i,n=j()){return n[0]=e.x,n[1]=e.y,n[2]=e.z??0,t==null||(t.type==="2d"?n[2]=0:n[2]=es(t,e,i,Te)??0),n}function la(e,t,i){return i?(Zi(i,e[0],e[1],e[2],t),i):Fe(e[0],e[1],e[2],t)}function wi(e,t,{z:i,m:n},o,s){const{spatialReference:a,elevationInfo:r}=o;let l;i==null&&n==null?l=void 0:t==null||t.type==="2d"?l=i??void 0:l=en(t,e,a,Te,r)??0;const[p,d]=e;return s?Zi(s,p,d,l,a):s=Fe(p,d,l,a),n!=null&&(s.m=n,s.hasM=!0),s}function ca(e,t,i,n,o=j()){const[s,a]=e;return o[0]=s,o[1]=a,e.length>3&&(o[3]=e[3]??Se.NONE),i?.type!=="3d"?(o[2]=t.value,o):(o[2]=Kt(i,s,a,t.value,n,t.elevationInfo,Te)??0,o)}(function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"})(Se||(Se={}));const hs=Fe(0,0,0,null);let K=class extends Fi{constructor(){super(...arguments),this.enabled=!0}};c([h({type:Boolean})],K.prototype,"enabled",void 0),K=c([C("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],K);let S=class extends Fi{constructor(e){super(e),this.lineSnapper=new K,this.parallelLineSnapper=new K,this.rightAngleSnapper=new K,this.rightAngleTriangleSnapper=new K,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new ot([255,127,0]),this.orangeTransparent=new ot([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};c([h({type:K,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"lineSnapper",void 0),c([h({type:K,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"parallelLineSnapper",void 0),c([h({type:K,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleSnapper",void 0),c([h({type:K,constructOnly:!0,nonNullable:!0,json:{write:!0}})],S.prototype,"rightAngleTriangleSnapper",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"shortLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],S.prototype,"distance",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"intersectionParallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"parallelLineThreshold",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"verticalLineThresholdMeters",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"touchSensitivityMultiplier",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],S.prototype,"pointOnLineThreshold",void 0),c([h({type:ot,nonNullable:!0})],S.prototype,"orange",void 0),c([h({type:ot,nonNullable:!0})],S.prototype,"orangeTransparent",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthReference",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"lineHintWidthTarget",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],S.prototype,"lineHintFadedExtensions",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],S.prototype,"parallelLineHintWidth",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],S.prototype,"parallelLineHintLength",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"parallelLineHintOffset",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],S.prototype,"rightAngleHintSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],S.prototype,"rightAngleHintOutlineSize",void 0),c([h({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],S.prototype,"satisfiesConstraintScreenThreshold",void 0),S=c([C("esri.views.interactive.snapping.Settings.Defaults")],S);const lt=new S;var I;(function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"})(I||(I={}));let bt=class{constructor(e,t){this.isDraped=e,this.domain=t}},ds=class rn extends bt{constructor(t,i,n=I.ALL){super(i,n),this.intersectionPoint=t}equals(t){return t instanceof rn&&O(this.intersectionPoint,t.intersectionPoint)}},oe=class an extends bt{constructor(t,i,n,o,s=I.ALL,a=!0,r=!0){super(o,s),this.type=t,this.lineStart=i,this.lineEnd=n,this.fadeLeft=a,this.fadeRight=r}equals(t){return t instanceof an&&this.type===t.type&&O(this.lineStart,t.lineStart)&&O(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return zi(this.lineStart,this.lineEnd)}},us=class pn extends bt{constructor(t,i,n,o=I.ALL){super(n,o),this.lineStart=t,this.lineEnd=i}equals(t){return t instanceof pn&&O(this.lineStart,t.lineStart)&&O(this.lineEnd,t.lineEnd)}},ln=class cn extends bt{constructor(t,i,n,o,s=I.ALL){super(o,s),this.previousVertex=t,this.centerVertex=i,this.nextVertex=n}equals(t){return t instanceof cn&&O(this.previousVertex,t.previousVertex)&&O(this.centerVertex,t.centerVertex)&&O(this.nextVertex,t.nextVertex)}};function Xt({start:e,end:t,type:i},n,o){const s=[],a=H($e,t,e),r=H(wt,e,n),l=we(a),p=2*Me(a,r),d=p*p-4*l*(we(r)-o*o);if(d===0){const u=-p/(2*l);(i===$.PLANE||u>=0)&&s.push(ie(q(),e,a,u))}else if(d>0){const u=Math.sqrt(d),f=(-p+u)/(2*l);(i===$.PLANE||f>=0)&&s.push(ie(q(),e,a,f));const y=(-p-u)/(2*l);(i===$.PLANE||y>=0)&&s.push(ie(q(),e,a,y))}return s}function hn(e,t){const i=e.start,n=e.end,o=H($e,n,i),s=ne(St,-o[1],o[0],0),a=t.start,r=t.end,l=F(Qt,r,a),p=V(l,s),d=ne(_n,i[0],i[1],0),u=F(En,d,a),f=V(u,s),y=Ve();if(Math.abs(p)<y)return[];const g=k(bn,a,l,f/p);if(t.type===P.RAY){const _=F($t,g,a);if(V(_,l)<-y)return[]}if(e.type===$.HALF_PLANE){const _=Po(wt,g,i);if(Me(_,o)<-y)return[]}return[ve(g)]}function ys(e,t){return fs(ct(ei,t[2],e),t)}function dn(e,t){return vn(ct(ei,0,e),ct(Es,0,t)).map(([i,n])=>Qe(i,n))}function un(e,t,i){return gn(e,ct(ei,e[2],t),i)}function yn(e,t,i,n=v()){const o=H($e,e,t),s=$i(o);return ie(n,t,o,s===0?1:i/s),n[2]=e[2],n}function gn(e,{start:t,end:i,type:n},o=v()){const s=F(Tt,e,t),a=F(St,i,t),r=V(s,a)/V(a,a);return k(o,t,a,n===P.RAY?Math.max(r,0):r)}const gs=(()=>{const e=v(),t=v(),i=v();return({start:n,end:o},{center:s,radius:a,normal:r,slicePlane:l})=>{const p=_t(s,r,_s);if(w(Vt(p,n),0)&&w(Vt(p,o),0)){Wi(r,e,t);const u=(g,_)=>(vt(i,_,s),qi(g,V(i,e),V(i,t)),g),f=rs({start:u($e,n),end:u(wt,o),type:P.LINE},Mo,a),y=[];for(const[g,_]of f){const T=mt(v(),s);k(T,T,e,g),k(T,T,t,_),l&&!fe(l,T)||y.push(T)}return y}const d=v();return Yi(p,n,o,d)?!w(zi(d,s),a)||l&&!fe(l,d)?[]:[d]:[]}})();function fn({start:e,end:t,type:i},n,o){const s=[],a=vt(Tt,t,e),r=H(wt,e,n),l=we(a),p=2*Me(a,r),d=p*p-4*l*(we(r)-o*o);if(d===0){const u=-p/(2*l);(i===P.LINE||u>=0)&&s.push(k(v(),e,a,u))}else if(d>0){const u=Math.sqrt(d),f=(-p+u)/(2*l);(i===P.LINE||f>=0)&&s.push(k(v(),e,a,f));const y=(-p-u)/(2*l);(i===P.LINE||y>=0)&&s.push(k(v(),e,a,y))}return s}function vn(e,t){const i=e.start,n=e.end,o=t.start,s=t.end,a=F(Tt,n,i),r=F(St,s,o),l=F(Qt,o,i),p=st(_n,a,r);if(!w(V(l,p),0))return[];const d=Ht(p);if(w(d,0))return[];const u=st(En,l,r),f=V(u,p)/d,y=k(bn,i,a,f);if(e.type===P.RAY){const g=F($t,y,i);if(V(a,g)<-Ve())return[]}if(t.type===P.RAY){const g=F($t,y,o);if(V(r,g)<-Ve())return[]}return[ve(y)]}function fs({start:e,end:t,type:i},n){const o=F(Tt,n,e),s=F(St,t,e),a=st(Qt,s,o),r=Ht(a)/Ht(s),l=Ve();if(r<l)switch(i){case P.LINE:return[ve(n)];case P.RAY:return V(s,o)<-l?[]:[ve(n)]}return[]}function Jt(e,t,i,n){const[o,s]=e,[a,r]=i,l=a-o,p=r-s,d=l*l+p*p,u=Math.sqrt(d);if(u>t+n)return[];if(u<Math.abs(t-n))return[];if(w(u,0)&&w(t,n))return[];const f=(t*t-n*n+d)/(2*u),y=Math.sqrt(t*t-f*f),g=y*p/u,_=y*l/u,[T,E]=Ro($e,e,i,f/u);return w(g,_)?[Qe(T,E)]:[Qe(T+g,E-_),Qe(T-g,E+_)]}function ct(e,t,{start:i,end:n,type:o}){return ne(e.start,i[0],i[1],t),ne(e.end,n[0],n[1],t),e.type=ms[o],e}function mn(e,t){return w(e[2],t[2])}function w(e,t){return Yn(Math.abs(e-t),0,Ve())}function vs(e,t){return t.filter(i=>fe(e,i))}function fe(e,t){return Fo(e,t)}var $;(function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"})($||($={}));const ms={[$.PLANE]:P.LINE,[$.HALF_PLANE]:P.RAY},$e=q(),wt=q(),Tt=v(),St=v(),Qt=v(),_n=v(),En=v(),bn=v(),$t=v(),_s=z(),ei={start:v(),end:v(),type:P.LINE},Es={start:v(),end:v(),type:P.LINE};class Y{intersect(t){return re(this,t)}closestPoints(t){return[this.closestTo(t)]}}class Ae extends Y{constructor(t){super(),this.point=t}equals(t){return this===t||B(t)&&O(this.point,t.point)}closestTo(){return Ge(this.point)}}class ti extends Y{constructor(t,i,n){super(),this.start=t,this.end=i,this.lineLike={start:t,end:i,type:n}}equals(t){return this===t||Q(t)&&this.lineLike.type===t.lineLike.type&&O(this.start,t.start)&&O(this.end,t.end)}closestTo(t){const i=j();return gn(t,this.lineLike,i),i}}class ii extends ti{constructor(t,i){super(t,i,P.LINE)}}class bs extends ti{constructor(t,i){super(t,i,P.RAY)}}class wn extends Y{constructor(t){super(),this.constraints=t}equals(t){return this===t||jt(t)&&Bn(this.constraints,t.constraints,(i,n)=>i.equals(n))}closestTo(t){let i,n=1/0;for(const o of this.constraints){const s=o.closestTo(t),a=Nt(t,s);a<n&&(n=a,i=s)}return Ge(i??t)}closestPoints(t){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(t))}}class Tn extends Y{constructor(t,i){super(),this.center=t,this.radius=i}equals(t){return this===t||te(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const i=j();return yn(t,this.center,this.radius,i),i}}class ni extends Y{constructor(t,i){super(),this.center=t,this.radius=i}equals(t){return this===t||pe(t)&&O(this.center,t.center)&&this.radius===t.radius}closestTo(t){const i=j();return yn(t,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new oi(Ge(this.center),this.radius,me(0,0,1))}}class oi extends Y{constructor(t,i,n,o=void 0){super(),this.center=t,this.radius=i,this.normal=n,this.slicePlane=o}equals(t){return this===t||ue(t)&&O(this.center,t.center)&&O(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:i,radius:n}=this;Bi(this.getPlane(ws),t,At);const o=F(At,At,i),s=Ao(o);if(w(s,0))return Ge(t);const a=n/Math.sqrt(s),r=j();k(r,i,o,a);const{slicePlane:l}=this;return l&&!fe(l,r)?ri(l,this)?.closestTo(t)??Ge(t):r}getPlane(t=z()){return _t(this.center,this.normal,t)}}const At=v(),ws=z();class Ts extends Y{constructor(t){super(),this.z=t}equals(t){return this===t||ae(t)&&this.z===t.z}closestTo(t){return me(t[0],t[1],this.z)}getPlane(t=z()){return ne(Ti,0,0,this.z),_t(Ti,po,t)}}const Ti=v();class si extends Y{constructor(t,i,n){super(),this.start=t,this.end=i,this.planeLike={start:t,end:i,type:n}}equals(t){return this===t||ee(t)&&this.planeLike.type===t.planeLike.type&&O(this.start,t.start)&&O(this.end,t.end)}closestTo(t){const i=j();return un(t,this.planeLike,i),i}closestEndTo(t){const{start:i,end:n}=this.planeLike;return Math.sign(Me(H(Ss,n,i),H(Os,t,i)))>0?this.end:this.start}getPlane(t=z()){const i=mt(Si,this.end);return i[2]+=1,$o(this.start,this.end,i,t)}getSlicePlane(t=z()){const{start:i,end:n,type:o}=this.planeLike;if(o===$.PLANE)return;const s=ne(Si,i[0],i[1],0),a=ne(Oi,n[0],n[1],0),r=vt(Oi,a,s);return _t(s,r,t),t}}const Ss=q(),Os=q(),Si=v(),Oi=v();class ha extends si{constructor(t,i){super(t,i,$.HALF_PLANE)}}class Sn extends si{constructor(t,i){super(t,i,$.PLANE)}}class Ps extends Y{constructor(t,i){super(),this.sphere=qo(t,i)}equals(t){return this===t||le(t)&&zo(this.sphere,t.sphere)}closestTo(t){const i=j();return Zo(this.sphere,t,i),i}get center(){return Yo(this.sphere)}get radius(){return this.sphere[3]}}class On extends Y{constructor(t,i,n){super(),this.start=t,this.end=i,this.getZ=n,this.planeLike={start:t,end:i,type:$.PLANE}}equals(t){return this===t||ht(t)&&O(this.start,t.start)&&O(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return Ls(this,t)}addIfOnTheGround(t,i){for(const n of i){const o=this.getZ(n[0],n[1])??0;w(n[2],o)&&(n[2]=o,t.push(n))}}}class Rs extends Y{constructor(t,i,n){super(),this._x=t,this._y=i,this._z=n}equals(t){return this===t||Bs(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,i,n]){return sn(this._x??t,this._y??i,this._z??n)}}class Gs extends Y{constructor(t,i,n,o,s){super(),this._origin=t,this._spatialReference=i,this._distanceMeters=n,this._z=o,this._directionDegrees=s}equals(t){return this===t||Ys(t)&&_i(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,i,n]){return qi(Ie,t,i),_i(Ie,this._origin)||this._applyDirectionAndDistance(Ie),sn(Ie[0],Ie[1],this._z??n)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)at(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)As(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=Yt(Ms,this._origin,t,this._spatialReference);at(t,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const Ie=[0,0],Ms=new Bt;function As(e,t,i,n,o){let{azimuth:s,distance:a}=Yt(xs,t,n,o);s??=0;let r=a*Math.cos((s-i)*go);r=Math.max(0,r),at(e,t,i,r,o)}const xs=new Bt;function Ls(e,t){const i=j();return un(t,e.planeLike,i),i[2]=e.getZ(i[0],i[1])??Rn,i}function re(e,t){if(jt(e)){const i=[];for(const n of e.constraints){const o=n.intersect(t);o&&i.push(o)}return ai(i)}if(jt(t))return re(t,e);if(ht(e))return Pi(e,t);if(ht(t))return Pi(t,e);if(B(e)){const{point:i}=e;if(B(t))return O(i,t.point)?e:void 0;const n=t.closestTo(i);return Io(n,i)?e:void 0}if(Q(e)){if(B(t))return re(t,e);if(Q(t))return X(vn(e.lineLike,t.lineLike));if(ae(t))return ks(e,t);if(ee(t))return X(hn(t.planeLike,e.lineLike));if(te(t))return X(fn(e.lineLike,t.center,t.radius));if(ue(t))return X(gs(e.lineLike,t));if(pe(t))return Is(e,t);if(le(t))return Cs(e,t)}else if(ae(e)){if(B(t)||Q(t))return re(t,e);if(ae(t))return Ds(e,t);if(ee(t))return Ns(e,t);if(te(t))return Hs(e,t);if(ue(t))return Vs(e,t);if(pe(t))return Us(e,t);if(le(t))return Fs(e,t)}else if(ee(e)){if(B(t)||Q(t)||ae(t))return re(t,e);if(ee(t))return xt(dn(e.planeLike,t.planeLike));if(te(t))return xt(Xt(e.planeLike,t.center,t.radius));if(ue(t))return js(e,t);if(pe(t))return $s(e,t);if(le(t))return qs(e,t)}else if(te(e)){if(B(t)||Q(t)||ae(t)||ee(t))return re(t,e);if(te(t))return xt(Jt(e.center,e.radius,t.center,t.radius));if(ue(t))return;if(pe(t))return zs(e,t);if(le(t))return}else if(ue(e)){if(B(t)||Q(t)||ae(t)||ee(t)||te(t))return re(t,e);if(ue(t))return;if(pe(t))return t.asCircle(),void 0;if(le(t))return}else if(pe(e)){if(B(t)||Q(t)||ae(t)||ee(t)||te(t)||ue(t))return re(t,e);if(pe(t))return Zs(t,e);if(le(t))return}else if(le(e)){if(B(t)||Q(t)||ae(t)||ee(t)||te(t)||pe(t))return re(t,e);if(le(t))return}}const ks=(()=>{const e=z();return(t,i)=>{const{start:n,end:o}=t;if(mn(n,o)&&w(n[2],i.z))return t;const s=j();return Yi(i.getPlane(e),n,o,s)?new Ae(s):void 0}})();function Is({lineLike:e},{center:t,radius:i}){const n=t[2];return X(fn(e,t,i).filter(o=>w(o[2],n)))}function Cs({lineLike:e},{sphere:t}){return X(jo(t,e.start,e.end))}const ri=(()=>{const e=Uo(),t=v(),i=v();return(n,o,s)=>{const{normal:a,center:r,radius:l}=o;Wi(a,t,i);const p=Ki(n),d=l*V(p,t),u=l*V(p,i);No(e,r[0],r[1],r[2],1);const f=Ho(n,e),y=Math.hypot(d,u),g=w(y,0);if(w(Vt(n,r),0)){if(g)return o;if(w(l,0))return!s||fe(s,r)?new Ae(Ge(r)):void 0;st(t,p,a),xo(t,t);const Ot=new Array,Ze=ve(r);k(Ze,Ze,t,l),s&&!fe(s,Ze)||Ot.push(Ze);const Ye=ve(r);return k(Ye,Ye,t,-l),s&&!fe(s,Ye)||Ot.push(Ye),X(Ot)}if(g)return;const _=-f/y;if(Math.abs(_)>1||w(_,1))return;const T=Math.atan(d/u),E=ro(_)-T,Le=Math.PI-E,je=new Array,qe=v();k(qe,r,t,l*Math.cos(E)),k(qe,qe,i,l*Math.sin(E)),je.push(qe);const ze=v();return k(ze,r,t,l*Math.cos(Le)),k(ze,ze,i,l*Math.sin(Le)),je.push(ze),X(s?vs(s,je):je)}})();function Ds(e,t){return w(e.z,t.z)?e:void 0}function Ns({z:e},{planeLike:t}){const[i,n]=t.start,[o,s]=t.end,a=me(i,n,e),r=me(o,s,e);return t.type===$.PLANE?new ii(a,r):new bs(a,r)}function Hs(e,t){const[i,n]=t.center;return new ni(me(i,n,e.z),t.radius)}function Us(e,t){return w(t.center[2],e.z)?t:void 0}const Vs=(()=>{const e=z();return(t,i)=>ri(t.getPlane(e),i,i.slicePlane)})();function Fs(e,{center:t,radius:i}){const n=Math.abs(t[2]-e.z);if(n>i&&!w(n,i))return;const o=me(t[0],t[1],e.z),s=Math.sqrt(i**2-n**2);return w(s,0)?void 0:new ni(o,s)}const $s=(()=>{const e=z();return(t,{center:i,radius:n})=>{const o=Xt(t.planeLike,i,n),s=i[2];t.getSlicePlane(e);const a=new Array;for(const[r,l]of o){const p=[r,l,s];fe(e,p)&&a.push(p)}return X(a)}})(),js=(()=>{const e=z(),t=z();return(i,n)=>ri(i.getPlane(e),n,i.getSlicePlane(t))})(),qs=(()=>{const e=z();return(t,{center:i,radius:n})=>{const o=t.getPlane(e),s=Vo(o,i),a=Math.abs(s);if(a>n&&!w(a,n))return;const r=Math.sqrt(n**2-s**2);if(w(r,0)){const d=j();return Bi(o,i,d),new Ae(d)}const l=j(),p=ve(Ki(o));return k(l,i,p,s),new oi(l,r,p,t.getSlicePlane())}})();function zs(e,t){const i=ji(e.center,t.center);return w(i,0)&&w(e.radius,t.radius)?t:Pn(Jt(e.center,e.radius,t.center,t.radius),t.center[2])}function Zs(e,t){if(!mn(e.center,t.center))return;const i=ji(e.center,t.center);return w(i,0)&&w(e.radius,t.radius)?e:Pn(Jt(e.center,e.radius,t.center,t.radius),e.center[2])}function Pi(e,t){const{planeLike:i,getZ:n}=e,o=new Array;if(B(t))e.addIfOnTheGround(o,ys(i,t.point));else if(Q(t))e.addIfOnTheGround(o,hn(i,t.lineLike));else if(te(t))for(const[s,a]of Xt(i,t.center,t.radius)){const r=n(s,a);r!=null&&o.push(nt(s,a,r))}else if(ee(t)||ht(t))for(const[s,a]of dn(i,t.planeLike)){const r=n(s,a)??Rn;o.push(nt(s,a,r))}return X(o)}function xt(e){return ai(e.map(([t,i])=>{const n=me(t,i,0),o=me(t,i,1);return new ii(n,o)}))}function X(e){return ai(e.map(t=>t?new Ae(t):void 0))}function Pn(e,t){return X(e.map(([i,n])=>[i,n,t]))}function ai(e){if(e.length!==0)return e.length===1?e[0]??void 0:new wn(e.filter(Cn))}function jt(e){return e instanceof wn}function B(e){return e instanceof Ae}function Q(e){return e instanceof ti}function ae(e){return e instanceof Ts}function ee(e){return e instanceof si}function te(e){return e instanceof Tn}function pe(e){return e instanceof ni}function ue(e){return e instanceof oi}function le(e){return e instanceof Ps}function ht(e){return e instanceof On}function Ys(e){return e instanceof Gs}function Bs(e){return e instanceof Rs}const Rn=0;var U;function Ws(e,t){if(e==null||t==null)return;const i=qt(e,t);return i!=null?Ue(i,"radians","geographic"):void 0}(function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"})(U||(U={}));const qt=(()=>{const e=v(),t=v();return(i,n)=>(ne(e,i.x,i.y,i.z??0),ne(t,n.x,n.y,n.z??0),Ks(e,t,i.spatialReference,n.spatialReference))})(),Ks=(()=>{const e=q(),t=v(),i=v();return(n,o,s,a)=>{if(O(n,o))return;const r=Ut(s),l=Ut(a);if(r&&l&&Ui(r,l)&&rt(n,s,t,r)&&rt(o,a,i,l)){const{azimuth:d}=Yt(Js,t,i,r);return d!=null?ft(d,"degrees","radians"):void 0}e[0]=o[0]-n[0],e[1]=o[1]-n[1];let p=So(Go,e);return e[0]<0&&(p=Qs-p),p}})();function da(e,t,i,n=U.Absolute){if(t&&i)switch(n){case U.Absolute:return Ws(t,i);case U.Relative:return Gi(Ri(e,t,i),U.Relative);case U.RelativeBilateral:return Gi(Ri(e,t,i),U.RelativeBilateral)}}function Ri(e,t,i){if(!e||!t||!i)return;const n=qt(e,t),o=qt(t,i);return n!=null&&o!=null?Ue(o-n,"radians","geographic"):void 0}function Gi(e,t){if(e!=null)switch(t){case U.Absolute:return Xs(e);case U.Relative:{const i=dt(e);let n=Mi.normalize(i,0,!0);return n===-180&&(n=180),Ue(n,"degrees","geographic")}case U.RelativeBilateral:{const i=dt(e),n=Math.abs(Mi.normalize(i,0,!0));return Ue(n,"degrees","geographic")}}}function Xs(e){const t=dt(e),i=er.normalize(t,0,!0);return Ue(i,"degrees","geographic")}const ua=(()=>{const e=v();return(t,i,n,o,s,a="geodesic")=>{mt(e,i);const r=dt(s);if(a==="geodesic"){const y=Ut(n);if(y&&rt(e,n,e,y))return at(t,e,r,o,y),t[2]=i[2],!!rt(t,y,t,n)}const l=Zt(r,"geographic","arithmetic"),p=ft(l,"degrees","radians"),d=i[0]+o*Math.cos(p),u=i[1]+o*Math.sin(p),f=i[2];return ne(t,d,u,f),!0}})();function dt(e){if(e!=null)return Zt(Gn(e),e.rotationType,"geographic")}function ya(e){if(e!=null)return Zt(Gn(e),e.rotationType,"arithmetic")}function Gn(e){return ft(e.value,e.unit,"degrees")}const Js=new Bt,Qs=2*Math.PI,er=Eo,Mi=new bo(-180,180);let et=class extends se{constructor(e){super(e),this.enabled=!1}};c([h({type:Boolean,nonNullable:!0})],et.prototype,"enabled",void 0),et=c([C("esri.views.interactive.sketch.SketchLabelOptions")],et);const pi=et,ga=Symbol("grid-placement-graphic");function Mn(e,t){const i=e.x-t.x,n=e.y-t.y;return i*i+n*n}function fa(e,t){return Math.sqrt(Mn(e,t))}function tr(e,t){t.sort((i,n)=>Nt(i.targetPoint,e)-Nt(n.targetPoint,e))}var Z;function va({point:e,distance:t,returnEdge:i,vertexMode:n,coordinateHelper:{spatialReference:o},filter:s},a,r){return r=r!=null?r.clone():new Do({where:"1=1"}),s&&(r.geometry=s.geometry,r.distance=s.distance,r.spatialRelationship=s.spatialRelationship,r.where=Wn(r.where,s.where),r.timeExtent=Co(r.timeExtent,s.timeExtent),r.objectIds=ir(r.objectIds,s.objectIds)),{point:Fe(e[0],e[1],e[2],o.toJSON()),mode:a,distance:t,returnEdge:i,vertexMode:n,query:r.toJSON()}}function ir(e,t){return e||t?t?e?Array.from(Kn(new Set(e),new Set(t))):t:e:null}function ma(e,t,i){return{left:bi(e.leftVertex.pos,t,i),right:bi(e.rightVertex.pos,t,i)}}(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(Z||(Z={}));const Ai=Symbol("snapping-toggle");function nr(e,t=()=>{}){const i=_e(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:n,snappingOptions:o})=>{if(e.removeHandles(Ai),!n||!o)return;const s=G.TOOL,a=[n.on("key-down",r=>{r.key!==Ei.toggle||r.repeat||(o.enabledToggled=!0,t())},s),n.on("key-up",r=>{r.key===Ei.toggle&&(o.enabledToggled=!1,t())},s),n.on("pointer-move",r=>{const l=r.native.ctrlKey;o.enabledToggled!==l&&(o.enabledToggled=l,t())},s)];e.addHandles(a,Ai)},Ne);e.addHandles(i)}function _a(e){return _o(e)&&"utilityNetworks"in e&&!!e.utilityNetworks?.length}let He=class extends se{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};c([h({type:String,nonNullable:!0})],He.prototype,"mode",void 0),He=c([C("esri.views.interactive.sketch.SketchTooltipElevationOptions")],He);let L=class extends se{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};c([h({type:Boolean,nonNullable:!0})],L.prototype,"area",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"coordinates",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"direction",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"distance",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"elevation",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"header",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"helpMessage",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"orientation",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"radius",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"rotation",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"scale",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"size",void 0),c([h({type:Boolean,nonNullable:!0})],L.prototype,"totalLength",void 0),L=c([C("esri.views.interactive.sketch.SketchTooltipVisibleElements")],L);const An=L;let D=class extends se{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new He,this.placement="auto",this.offset=null,this.visibleElements=new An,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};c([h({type:Boolean,nonNullable:!0})],D.prototype,"enabled",void 0),c([h()],D.prototype,"forceEnabled",void 0),c([h()],D.prototype,"effectiveEnabled",null),c([h()],D.prototype,"helpMessage",void 0),c([h()],D.prototype,"helpMessageIcon",void 0),c([h({type:Boolean,nonNullable:!0})],D.prototype,"inputEnabled",void 0),c([h({type:He,nonNullable:!0})],D.prototype,"elevation",void 0),c([h()],D.prototype,"placement",void 0),c([h()],D.prototype,"offset",void 0),c([h({type:An,nonNullable:!0})],D.prototype,"visibleElements",void 0),c([h()],D.prototype,"visualVariables",void 0),c([h()],D.prototype,"xyMode",void 0),D=c([C("esri.views.interactive.sketch.SketchTooltipOptions")],D);const li=D;let Oe=class extends se{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};c([h()],Oe.prototype,"length",void 0),c([h()],Oe.prototype,"verticalLength",void 0),c([h()],Oe.prototype,"area",void 0),Oe=c([C("esri.views.interactive.sketch.Units")],Oe);const ut=Oe;let ye=class extends se{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?U.RelativeBilateral:U.Relative;case"absolute":return U.Absolute}}get displayUnits(){return this._get("displayUnits")??new ut}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new ut}set inputUnits(e){this._set("inputUnits",e)}};c([h({type:String,nonNullable:!0})],ye.prototype,"directionMode",void 0),c([h({type:Boolean,nonNullable:!0})],ye.prototype,"relativeDirectionIsBilateral",void 0),c([h()],ye.prototype,"effectiveDirectionMode",null),c([h({type:ut,nonNullable:!0})],ye.prototype,"displayUnits",null),c([h({type:ut,nonNullable:!0})],ye.prototype,"inputUnits",null),ye=c([C("esri.views.interactive.sketch.SketchValueOptions")],ye);const ci=ye;let ge=class extends se{constructor(e){super(e),this.layer=null,this.enabled=!0,this.updating=!1,this.availability=1,this.sublayerSources=new Ee}};c([h({constructOnly:!0})],ge.prototype,"layer",void 0),c([h()],ge.prototype,"enabled",void 0),c([h()],ge.prototype,"updating",void 0),c([h()],ge.prototype,"availability",void 0),c([h()],ge.prototype,"sublayerSources",void 0),ge=c([C("esri.views.interactive.snapping.FeatureSnappingLayerSource")],ge);const xn=ge;let A=class extends se{constructor(e){super(e),this.enabled=!1,this.enabledToggled=!1,this.forceDisabled=!1,this.selfEnabled=!0,this.featureEnabled=!0,this.gridEnabled=!1,this.attributeRulesEnabled=!1,this.featureSources=new Ee,this.distance=lt.distance,this.touchSensitivityMultiplier=lt.touchSensitivityMultiplier}get effectiveEnabled(){return!this.forceDisabled&&(this.enabledToggled?!this.enabled:this.enabled)}get effectiveGridEnabled(){return this.effectiveEnabled&&this.gridEnabled}get effectiveSelfEnabled(){return this.effectiveEnabled&&this.selfEnabled}get effectiveFeatureEnabled(){return this.effectiveEnabled&&this.featureEnabled}get _effectiveFeatureSources(){const e=this.featureSources;e.some(xi)&&Vi.getLogger(this).warnOnce("Do not configure SubtypeGroupLayer sources in SnappingOptions.featureSources directly. Create a FeatureSnappingLayerSource for each SubtypeSublayer.");const t=e.filter(sr),i=this._get("_effectiveFeatureSources")?.filter(xi)??new Ee;for(const r of t){const l=i.find(p=>p.layer===r.layer.parent);if(l)l.sublayerSources.includes(r)||l.sublayerSources.add(r);else if(r.layer.parent){const p=new xn({layer:r.layer.parent});p.sublayerSources.add(r),i.add(p)}}for(const r of i){const l=r.sublayerSources.filter(p=>!t.includes(p));r.sublayerSources.removeMany(l)}i.removeMany(i.filter(r=>r.sublayerSources.length===0));const n=e.filter(or),o=this._get("_effectiveFeatureSources")??new Ee,{added:s,removed:a}=ao(o.toArray(),[...n,...i]);return o.removeMany(a),o.addMany(s),o}};c([h()],A.prototype,"enabled",void 0),c([h()],A.prototype,"enabledToggled",void 0),c([h()],A.prototype,"forceDisabled",void 0),c([h()],A.prototype,"selfEnabled",void 0),c([h()],A.prototype,"featureEnabled",void 0),c([h()],A.prototype,"gridEnabled",void 0),c([h()],A.prototype,"attributeRulesEnabled",void 0),c([h({type:Ee.ofType(xn)})],A.prototype,"featureSources",void 0),c([h()],A.prototype,"distance",void 0),c([h()],A.prototype,"touchSensitivityMultiplier",void 0),c([h({readOnly:!0})],A.prototype,"effectiveEnabled",null),c([h({readOnly:!0})],A.prototype,"effectiveGridEnabled",null),c([h({readOnly:!0})],A.prototype,"effectiveSelfEnabled",null),c([h({readOnly:!0})],A.prototype,"effectiveFeatureEnabled",null),c([h({readOnly:!0})],A.prototype,"_effectiveFeatureSources",null),A=c([C("esri.views.interactive.snapping.SnappingOptions")],A);const hi=A;function xi(e){return e.layer.type==="subtype-group"}function or(e){return e.layer.type!=="subtype-group"}function sr(e){return e.layer.type==="subtype-sublayer"}function rr(e){return e?.type==="graphic"}function ar(e){return e.find(rr)??null}class xe{constructor(t,i,n,o){this.targetPoint=t,this.constraint=i,this.isDraped=n,this.domain=o}}let Ln=class extends xe{constructor({targetPoint:e,objectId:t,constraint:i,isDraped:n}){super(e,i,n,I.FEATURE),this.objectId=t}},pr=class extends Ln{constructor(e){super({...e,isDraped:!0,constraint:new On(e.edgeStart,e.edgeEnd,e.getGroundElevation)})}get hints(){return[new oe(Z.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},lr=class extends Ln{constructor(e){super({...e,constraint:new ii(e.edgeStart,e.edgeEnd)})}get hints(){return[new oe(Z.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}},tt=class extends xe{constructor(e,t,i,n){super(e,new Ae(e),n,I.ALL),this.first=t,this.second=i}get hints(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[...this.first.hints,...this.second.hints,new ds(this.targetPoint,this.isDraped,this.domain)]}},cr=class extends xe{constructor({lineStart:e,lineEnd:t,targetPoint:i,isDraped:n}){super(i,new Sn(e,t),n,I.SELF),this._referenceLineHint=new oe(Z.REFERENCE_EXTENSION,e,t,n,this.domain)}get hints(){return[this._referenceLineHint,new oe(Z.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}_lineEndClosestToTarget(){return this.constraint.closestEndTo(this.targetPoint)}},hr=class extends xe{constructor({referenceLine:e,lineStart:t,targetPoint:i,isDraped:n}){const o=ve(t),{left:s,right:a}=e;vt(o,Lo(o,o,a),s),super(i,new Sn(t,o),n,I.SELF),this._referenceLines=[{edge:e,fadeLeft:!0,fadeRight:!0}]}get hints(){return[new oe(Z.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new us(this.constraint.start,this.targetPoint,this.isDraped,this.domain),...this._referenceLines.map(e=>new oe(Z.REFERENCE,e.edge.left,e.edge.right,this.isDraped,this.domain,e.fadeLeft,e.fadeRight))]}addReferenceLine(e){const t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach(i=>{O(e.right,i.edge.left)&&(i.fadeLeft=!1,t.fadeRight=!1),O(e.right,i.edge.right)&&(i.fadeRight=!1,t.fadeRight=!1),O(e.left,i.edge.right)&&(i.fadeRight=!1,t.fadeLeft=!1),O(e.left,i.edge.left)&&(i.fadeLeft=!1,t.fadeLeft=!1)}),this._referenceLines.push(t)}},dr=class extends xe{constructor({targetPoint:e,constraint:t,previousVertex:i,otherVertex:n,otherVertexType:o,isDraped:s,selfSnappingType:a,objectId:r,domain:l}){super(e,t,s,l??I.SELF),this.previousVertex=i,this.otherVertex=n,this.otherVertexType=o,this.selfSnappingType=a??gt.None,this.objectId=r??null}get hints(){const e=this.previousVertex,t=this.otherVertexType===yt.CENTER?this.otherVertex:this.targetPoint,i=this.otherVertexType===yt.CENTER?this.targetPoint:this.otherVertex;return[new oe(Z.TARGET,t,i,this.isDraped,this.domain),new oe(Z.REFERENCE,e,t,this.isDraped,this.domain),new ln(this.previousVertex,t,i,this.isDraped,this.domain)]}};var yt,gt;(function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"})(yt||(yt={})),function(e){e[e.None=0]="None",e[e.LastVertex=1]="LastVertex",e[e.FirstVertex=2]="FirstVertex",e[e.ExistingEdge=3]="ExistingEdge"}(gt||(gt={}));class ur extends xe{constructor({targetPoint:t,point1:i,point2:n,isDraped:o}){super(t,new Tn(ko(v(),i,n,.5),.5*wo(i,n)),o,I.SELF),this._p1=i,this._p2=n}get hints(){return[new oe(Z.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new oe(Z.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new ln(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}function yr(e,t,i,n){return n.type==="2d"?(We.x=e[0],We.y=e[1],We.spatialReference=t,n.toScreen(We)):(ps(e,t,i,n,Li),n.state.camera.projectToScreen(Li,Lt),Xn(Lt[0],Lt[1]))}const We=Fe(0,0,0,null),Li=v(),Lt=Jn();let W=class extends zt.EventedMixin(se){constructor(e){super(e),this.options=new hi,this._engineCache=new Map,this._loadTask=null,this._engines=[],this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ce.MAIN}initialize(){this.addHandles([_e(()=>{const{distance:e,touchSensitivityMultiplier:t,effectiveSelfEnabled:i,effectiveFeatureEnabled:n,effectiveGridEnabled:o}=this.options;return{selfEnabled:i,featureEnabled:n,gridEnabled:this.view.type==="2d"&&o,viewReady:this.view.ready,viewSpatialReference:this.view.spatialReference,distance:e,touchSensitivityMultiplier:t}},(e,t)=>{t&&(this.doneSnapping(),this.emit("changed")),this._loadTask?.abort(),this._loadTask=Qn(i=>this._updateEngines(e,t,i))},Ne),_e(()=>this.options,e=>{for(const t of this._engines)t.options=e},eo)])}destroy(){this._loadTask?.abort(),this._destroyEngines()}get updating(){return this._engines.some(e=>e.updating)||!this._loadTask?.finished}_destroyEngines(){this._engineCache.forEach(e=>e.destroy()),this._engineCache.clear(),this._engines=[]}async _updateEngines(e,t,i){if(!e.viewReady)return void this._destroyEngines();t?.viewSpatialReference!==e.viewSpatialReference&&this._destroyEngines();const n=this._engineCache,o=await Promise.allSettled([e.featureEnabled&&!n.has("feature")?this._createFeatureSnappingEngine(i):void 0,e.selfEnabled&&!n.has("self")?this._createSelfSnappingEngine(i):void 0,e.gridEnabled&&!n.has("grid")?this._createGridSnappingEngine(i):void 0]);if(i.aborted)for(const s of o)s.status==="fulfilled"&&s.value?.engine.destroy();else{for(const s of o)s.status==="fulfilled"&&s.value&&n.set(s.value.type,s.value.engine);this._engines=Array.from(n.values())}}async _createSelfSnappingEngine(e){const{SelfSnappingEngine:t}=await N(()=>import("./SelfSnappingEngine-cGmuW4MT-DNDLstuY.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61]),import.meta.url);return Pt(e),{type:"self",engine:new t({view:this.view,options:this.options})}}async _createGridSnappingEngine(e){const{view:t}=this;if(t.type!=="2d")return;const{GridSnappingEngine:i}=await N(()=>import("./GridSnappingEngine-DCXaqXz2-dHI8KhnZ.js"),__vite__mapDeps([62,1,2,34,9,37,63,64,65,66,67,47,31,13,14,15,16,17,18,19,20,21,22,23,24,3,4,5,6,7,8,33,41,42,57,58,59,35,36,43,44,45,46,60,61]),import.meta.url);return Pt(e),{type:"grid",engine:new i({view:t,options:this.options})}}async _createFeatureSnappingEngine(e){const{FeatureSnappingEngine:t}=await N(()=>import("./FeatureSnappingEngine-aDZtmISS-CiGhLwBA.js"),__vite__mapDeps([68,1,2,8,9,34,31,69,57,58,59,16,70,28,37,13,14,15,17,18,19,20,21,22,23,24,3,4,5,6,7,33,41,42,47,35,36,43,44,45,46,60,61]),import.meta.url);Pt(e);const{view:i,options:n}=this,{spatialReference:o}=i;return{type:"feature",engine:new t({view:i,options:n,spatialReference:o})}}get _squaredMouseProximityThreshold(){return this.options.distance*this.options.distance}get _squaredTouchProximityThreshold(){const{distance:e,touchSensitivityMultiplier:t}=this.options,i=e*t;return i*i}snap(e){return vr(e)?this._snapMultiPoint(e):this._snapSinglePoint(e)}update(e){const{point:t,context:i}=e;this._removeVisualization();const n=this._currentMainCandidate;if(n==null)return t;const o=this._selectUpdateInput(e);if(o==null)return t;const{spatialReference:s}=i,a=Dt(o,s);if(a==null)return t;const{view:r}=this,{elevationInfo:l,visualizer:p}=i,d=[],u=De(a,r,l),f=n.constraint.closestTo(u);if(!this._arePointsWithinScreenThreshold(u,f,i)||!It(n,i.drawConstraints))return this._resetSnappingState(),t;n.targetPoint=Mt(f),d.push(...n.hints);for(const y of this._currentOtherActiveCandidates)It(y,i.drawConstraints)&&(y.targetPoint=Mt(f),d.push(...y.hints));return p!=null&&this.addHandles(p.draw(d,{spatialReference:s,elevationInfo:mr(i),view:r,selfSnappingZ:i.selfSnappingZ}),kt),wi(f,r,t,i)}doneSnapping(){this._removeVisualization(),this._resetSnappingState()}_selectUpdateInput({point:e,scenePoint:t}){switch(this._currentSnappedType){case ce.MAIN:return e;case ce.SCENE:return t}}_resetSnappingState(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=ce.MAIN}_removeVisualization(){this.removeHandles(kt)}async _snapSinglePoint({point:e,context:t,signal:i}){const{view:n}=this,{elevationInfo:o}=t,s=De(e,n,o),a=await this._fetchCandidates(s,I.ALL,t,i);return this._createSnapResult(s,ce.MAIN,a,n,e,t,i)}async _snapMultiPoint({point:e,scenePoint:t,context:i,signal:n}){const{view:o}=this,{coordinateHelper:s,elevationInfo:a,spatialReference:r}=i;await co(t.spatialReference,r);const l=Dt(t,r),p=De(l,o,a),d=await this._fetchCandidates(p,I.FEATURE,i,n);if(d.length>0){const y=await this._fetchCandidates(p,I.SELF,i,n);return this._createSnapResult(p,ce.SCENE,[...d,...y],o,l,i,n)}const u=De(e,o,a),f=await this._fetchCandidates(u,I.SELF,i,n);return this._createSnapResult(u,ce.MAIN,f,o,{z:s.hasZ()&&e.hasZ?e.z??0:void 0,m:s.hasM()&&e.hasM?e.m??0:void 0},i,n)}async _fetchCandidates(e,t,i,n){return(await Promise.all(this._engines.map(o=>o.fetchCandidates(e,t,i,n)))).flat()}_createSnapResult(e,t,i,n,o,s,a){return{get valid(){return!Dn(a)},apply:()=>{const{spatialReference:r}=s,{snappedPoint:l,hints:p}=this._processCandidates(e,t,i,s);return this._removeVisualization(),s.visualizer!=null&&this.addHandles(s.visualizer.draw(p,{spatialReference:r,elevationInfo:Te,view:n,selfSnappingZ:s.selfSnappingZ}),kt),wi(l,n,o,s)}}}_processCandidates(e,t,i,n){if(i.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),tr(e,i);const o=this._currentMainCandidate;if(o!=null){const s=fr(o,i);if(s>=0){if(!(i[s]instanceof tt))return this._intersectWithOtherCandidates(s,i,e,t,n);if(this._arePointsWithinScreenThreshold(e,o.targetPoint,n))return this._updateSnappingCandidate(o,t,i,n)}}return this._intersectWithOtherCandidates(0,i,e,t,n)}_intersectWithOtherCandidates(e,t,i,n,o){const{coordinateHelper:s}=o,a=t[e],r=[];for(let l=0;l<t.length;++l){if(l===e)continue;const p=t[l],d=a.constraint.intersect(p.constraint);if(d)for(const u of d.closestPoints(a.targetPoint))r.push([new tt(Mt(u),a,p,p.isDraped),this._squaredScreenDistance(i,u,s)])}return r.length>0&&(r.sort((l,p)=>l[1]-p[1]),r[0][1]<this._squaredPointProximityThreshold(o.pointer))?this._updateSnappingCandidate(r[0][0],n,t,o):It(a,o.drawConstraints)?this._updateSnappingCandidate(a,n,t,o):{snappedPoint:i,hints:[]}}_updateSnappingCandidate(e,t,i,n){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;const o=this._currentMainCandidate.targetPoint,s=[];s.push(...e.hints);for(const a of i){if(e instanceof tt){if(a.constraint.equals(e.first.constraint)||a.constraint.equals(e.second.constraint))continue}else if(a.constraint.equals(e.constraint))continue;const r=a.constraint.closestTo(o);this._squaredScreenDistance(r,o,n.coordinateHelper)<gr()&&(a.targetPoint=o,this._currentOtherActiveCandidates.push(a),s.push(...a.hints))}return{snappedPoint:o,hints:s}}_squaredPointProximityThreshold(e){return e==="touch"?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}_arePointsWithinScreenThreshold(e,t,i){return this._squaredScreenDistance(e,t,i.coordinateHelper)<this._squaredPointProximityThreshold(i.pointer)}_squaredScreenDistance(e,t,i){return Mn(this._toScreen(e,i),this._toScreen(t,i))}_toScreen(e,t){return yr(e,t.spatialReference,Te,this.view)}get test(){}};var ce;c([h({constructOnly:!0})],W.prototype,"view",void 0),c([h()],W.prototype,"options",void 0),c([h({readOnly:!0})],W.prototype,"updating",null),c([h()],W.prototype,"_loadTask",void 0),c([h()],W.prototype,"_engines",void 0),c([h()],W.prototype,"_squaredMouseProximityThreshold",null),c([h()],W.prototype,"_squaredTouchProximityThreshold",null),W=c([C("esri.views.interactive.snapping.SnappingManager")],W),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(ce||(ce={}));const kt="visualization-handle";function gr(){return lt.satisfiesConstraintScreenThreshold*lt.satisfiesConstraintScreenThreshold}function It(e,t){return!t||t.direction==null&&t.distance==null||!(e instanceof pr||e instanceof lr||e instanceof cr||e instanceof hr||e instanceof ur)&&(!(e instanceof dr)||t.direction==null&&e.selfSnappingType===gt.LastVertex)}function fr(e,t){return e instanceof tt?Ct(t,e.first)>=0&&Ct(t,e.second)>=0?0:-1:Ct(t,e)}function Ct(e,t){let i=-1;for(let n=0;n<e.length;++n)if(t.constraint.equals(e[n].constraint)){i=n;break}return i}function vr(e){return e.scenePoint!=null}function mr({coordinateHelper:e,elevationInfo:t}){return e.hasZ()?Te:t}let Pe=class extends se{constructor(e){super(e),this.labels=new pi,this.tooltips=new li,this.values=new ci}};c([h({nonNullable:!0,type:pi})],Pe.prototype,"labels",void 0),c([h({nonNullable:!0,type:li})],Pe.prototype,"tooltips",void 0),c([h({nonNullable:!0,type:ci})],Pe.prototype,"values",void 0),Pe=c([C("esri.views.interactive.sketch.SketchOptions")],Pe);const kn=Pe;function ki(e,t,i){if(!t||!e?.map)return;const{map:n}=e,o=n.layers.find(s=>s===t);o||n.add(t,i),o&&i!=null&&n.layers.reorder(o,i)}function Ea(e,t){const i=t?.type==="subtype-sublayer"?t.parent:t;return e.allLayerViews.find(n=>{const o=n.layer;return o===i||"sublayers"in o&&o.sublayers!=null&&o.sublayers.includes(i)})}function _r(e,t){return t==="freehandPolygon"||t==="freehandPolyline"?"freehand":e??(t==="rectangle"||t==="circle"?"hybrid":"click")}function Er(e){switch(e){case"freehandPolygon":return"polygon";case"freehandPolyline":return"polyline";default:return e}}var Ii;(function(e){e[e.ForceCollapse=-1]="ForceCollapse",e[e.Low=0]="Low",e[e.Medium=10]="Medium",e[e.High=100]="High",e[e.Max=1e3]="Max"})(Ii||(Ii={}));function Ci(e){switch(e){case b.SUPPORTED:break;case b.GRAPHICS_LAYER_MISSING:return"not owned by a graphics layer";case b.GEOMETRY_MISSING:return"no geometry";case b.GEOMETRY_TYPE_UNSUPPORTED:return"the geometry type is not supported";case b.ELEVATION_MODE_UNSUPPORTED:return"the elevation mode is not supported";case b.SYMBOL_TYPE_UNSUPPORTED:return"the symbol type is not supported"}return""}var b;(function(e){e[e.SUPPORTED=0]="SUPPORTED",e[e.GRAPHICS_LAYER_MISSING=1]="GRAPHICS_LAYER_MISSING",e[e.GEOMETRY_MISSING=2]="GEOMETRY_MISSING",e[e.GEOMETRY_TYPE_UNSUPPORTED=3]="GEOMETRY_TYPE_UNSUPPORTED",e[e.ELEVATION_MODE_UNSUPPORTED=4]="ELEVATION_MODE_UNSUPPORTED",e[e.SYMBOL_TYPE_UNSUPPORTED=5]="SYMBOL_TYPE_UNSUPPORTED"})(b||(b={}));function br(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;const t=e.operations?.data.type;if(!t)return b.GEOMETRY_TYPE_UNSUPPORTED;switch(t){case"polygon":case"point":case"polyline":case"mesh":break;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const i=e.elevationInfo;return Et(i)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}function wr(e){return Tr(e).result}function Tr(e){if(e.graphic&&e.graphic.layer?.type!=="graphics")return{result:b.GRAPHICS_LAYER_MISSING};if(!e.operations)return{result:b.GEOMETRY_MISSING};if(Et(e.elevationInfo))return{result:b.ELEVATION_MODE_UNSUPPORTED};const t=e.operations.data.type,i=e.operations.data.geometry;return t==="point"||t==="mesh"||t==="polyline"||t==="polygon"?{result:b.SUPPORTED,geometry:i}:{result:b.GEOMETRY_TYPE_UNSUPPORTED}}function Sr(e){if(e.layer?.type!=="graphics")return b.GRAPHICS_LAYER_MISSING;if(e.geometry==null)return b.GEOMETRY_MISSING;switch(e.geometry.type){case"point":break;case"polygon":case"polyline":case"multipoint":case"extent":case"mesh":return b.SUPPORTED;default:return b.GEOMETRY_TYPE_UNSUPPORTED}const t=e.symbol!=null&&e.symbol.type==="point-3d"&&e.symbol.symbolLayers;return!t||!t.some(i=>i.type==="object")?b.SYMBOL_TYPE_UNSUPPORTED:Ko(e)!=="on-the-ground"&&Jo(e)?b.ELEVATION_MODE_UNSUPPORTED:b.SUPPORTED}let x=class extends zt.EventedAccessor{constructor(e){super(e),this.cancelled=!1,this.history={undo:[],redo:[]},this.type=null}get tool(){if(!this.activeComponent)return null;switch(this.activeComponent.type){case"graphic-mover":case"move-3d":return"move";case"box":case"transform-3d":return"transform";case"reshape":case"reshape-3d":return"reshape";case"draw-2d":case"draw-3d":return this.activeComponent.geometryType;default:Nn(this.activeComponent)}return null}addToHistory(e){this.history.redo=[],this.history.undo.push(e)}resetHistory(){this.history.redo=[],this.history.undo=[]}canUndo(){return this.history.undo.length>0}canRedo(){return this.history.redo.length>0}complete(){this._reset(),this.onEnd(),this.emit("complete")}cancel(){this.cancelled=!0,this.complete()}_reset(){this.activeComponent?.reset()}refreshComponent(){const e=this.activeComponent;e&&(e.type!=="box"&&e.type!=="reshape"&&e.type!=="graphic-mover"||e.refresh())}set undo(e){this._set("undo",()=>{this.canUndo()&&e()})}set redo(e){this._set("redo",()=>{this.canRedo()&&e()})}};c([h()],x.prototype,"activeComponent",void 0),c([h()],x.prototype,"cancelled",void 0),c([h()],x.prototype,"history",void 0),c([h()],x.prototype,"tool",null),c([h()],x.prototype,"type",void 0),c([h()],x.prototype,"canUndo",null),c([h()],x.prototype,"canRedo",null),c([h()],x.prototype,"onEnd",void 0),c([h()],x.prototype,"undo",null),c([h()],x.prototype,"redo",null),c([h()],x.prototype,"toggleTool",void 0),c([h()],x.prototype,"addToSelection",void 0),c([h()],x.prototype,"removeFromSelection",void 0),x=c([C("esri.widgets.Sketch.support.OperationHandle")],x);let it=class extends x{};c([h()],it.prototype,"activeComponent",void 0),it=c([C("esri.widgets.Sketch.support.OperationHandle.CreateOperationHandle")],it);let he=class extends x{};c([h()],he.prototype,"activeComponent",void 0),he=c([C("esri.widgets.Sketch.support.OperationHandle.UpdateOperationHandle")],he);const Di={defaultZ:0},Ce={reshapeOptions:{edgeOperation:"split",shapeOperation:"move",vertexOperation:"move"},enableMoveAllGraphics:!0,enableRotation:!0,enableScaling:!0,multipleSelectionEnabled:!0,preserveAspectRatio:!1,toggleToolOnClick:!0,enableZ:!0,highlightOptions:{enabled:!0},tool:"transform"};let m=class extends zt.EventedAccessor{constructor(e){super(e),this._defaultSnappingManager=null,this._updatingHandles=new lo,this._internalGraphicsLayer=new fo({listMode:"hide",internal:!0,title:"SVM Internal"}),this._operationHandle=null,this._viewHandlesKey="viewHandles",this.activeFillSymbol=null,this.activeLineSymbol=null,this.activeVertexSymbol=null,this.allowDeleteKey=!0,this.layer=null,this.pointSymbol=new di({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.polygonSymbol=new Hn({color:[150,150,150,.2],outline:{color:[50,50,50],width:2}}),this.polylineSymbol=new Un({color:[130,130,130,1],width:2}),this.meshSymbol=new Vn({symbolLayers:new Ee([new Fn])}),this.updateGraphics=new Ee,this.updateOnGraphicClick=!0,this.creationMode="single",this.vertexSymbol=new di({style:"circle",size:6,color:[255,255,255],outline:{color:[50,50,50],width:1}}),this.sketchOptions=new kn,this._moduleLoaderAbortController=null,this._viewReadyAbortController=null,this._sketchContinuationFlag=!1,this._originalPopupEnabled=null,this.defaultCreateOptions=Di,this.defaultUpdateOptions=Ce,this.snappingOptions=e?.snappingManager?.options??e?.snappingOptions??new hi}initialize(){this.addHandles([ui(()=>this.view?.map?.layers,"change",e=>{e.removed.includes(this.layer)&&this.cancel()}),ui(()=>this.layer?.graphics,"change",e=>{if(this._operationHandle!=null)for(const t of e.removed)this.updateGraphics.includes(t)&&(this.updateGraphics.length>1?this._operationHandle.removeFromSelection(t):this._operationHandle.cancel())}),_e(()=>this.layer?.elevationInfo??null,e=>{e!==this._internalGraphicsLayer.elevationInfo&&(this.cancel(),this._internalGraphicsLayer.elevationInfo=e)},Ne),_e(()=>this.view,e=>{this._defaultSnappingManager=Be(this._defaultSnappingManager),e&&(this.snappingManager||(this._defaultSnappingManager=new W({view:e,options:this.snappingOptions})),e.type==="2d"?N(()=>import("./editingTools-KBOXuhog-DgLoMSyO.js"),__vite__mapDeps([71,1,2,72,8,9,33,73,74,75,34,7,76,25,77,22,45,53,44,46,35,78,38,39,79,26,27,80,11,12,13,14,15,16,17,18,19,20,21,23,24,3,4,5,6,28,29,30,31,32,36,37,40,41,42,43,47,48,49,50,51,52,54,55,56,57,58,59,60,61,81,82,83,10,84,85,86,87,88,89,90,91,92,93,94]),import.meta.url):e.type==="3d"&&(N(()=>import("./editingTools-CWx0-1A2-CAVbIOPD.js"),__vite__mapDeps([95,8,9,33,96,97,1,2,98,36,37,99,45,34,100,101,102,35,85,60,22,61,44,43,46,86,103,104,105,106,24,88,32,107,108,109,5,110,111,53,83,112,113,114,84,115,116,117,118,119,38,39,41,42,40,120,23,121,122,123,124,78,125,126,127,48,93,25,76,7,77,79,26,27,80,11,12,13,14,15,16,17,18,19,20,21,3,4,6,28,29,30,31,47,49,50,51,52,54,55,56,57,58,59,81,82,10,128,129,74,75,87,130,131,132,89,90,91,73,133,134,135,136,137,138,92]),import.meta.url).then(t=>t.e),N(()=>import("./LineCallout.glsl-B1CPwb2z-YT4mRr_n.js"),__vite__mapDeps([139,1,2,140,141,42,37,41,116,34,9,36,111,61,44,45,53,46,35,83,112,22,43,33,32,99,100,101,102,8,85,60,86,103,104,105,106,97,96,24,88,107,108,109,5,110,117,118,119,38,39,40,120,23,121,113,30,31,15,16,142,57,58,59,134,143,124,48,144,145,146,147,148,149,150,21,25,151,152,153,154,155,156,157,158,159,160,161,162,163,3,4,6,28,164,165,64,65,166,125,13,14,17,18,19,20,7,47]),import.meta.url).then(t=>t.G)))},Ne),_e(()=>this.view?.spatialReference,(e,t)=>{e&&t&&!e.equals(t)&&this.cancel()})]),nr(this)}destroy(){this.cancel(),this._removeDefaultLayer(),this._defaultSnappingManager=Be(this._defaultSnappingManager),this._set("snappingManager",null),this._set("view",null),this._updatingHandles.destroy(),this.emit("destroy")}get updating(){return this._updatingHandles.updating||this.snappingManager!=null&&this.snappingManager.updating}get activeTool(){return this._operationHandle?.tool??null}get activeCreateToolDrawMode(){return this._operationHandle?.type==="create"&&this._operationHandle.activeComponent&&"mode"in this._operationHandle.activeComponent?this._operationHandle.activeComponent.mode:null}get activeTooltip(){const{activeComponent:e,destroyed:t}=this,i=!t&&e&&"tooltip"in e?e.tooltip:null;return i?.visible?i:null}get activeComponent(){return this._operationHandle?.activeComponent??null}get createGraphic(){return this.activeComponent==null||this.activeComponent.type!=="draw-3d"&&this.activeComponent.type!=="draw-2d"?this._get("createGraphic"):this.activeComponent.graphic}get defaultCreateOptions(){return this._get("defaultCreateOptions")}set defaultCreateOptions(e){this._set("defaultCreateOptions",{...Di,...e})}get defaultUpdateOptions(){return this._get("defaultUpdateOptions")}set defaultUpdateOptions(e){this._set("defaultUpdateOptions",{...Ce,...e,reshapeOptions:{...Ce.reshapeOptions,...e?.reshapeOptions},highlightOptions:{...Ce.highlightOptions,...e?.highlightOptions}})}get labelOptions(){return this.sketchOptions.labels}set labelOptions(e){this.sketchOptions.labels=e}get snappingOptions(){return this.snappingManager?.options??this._get("snappingOptions")}set snappingOptions(e){this._defaultSnappingManager!=null&&(this._defaultSnappingManager.options=e),this._set("snappingOptions",e)}get snappingManager(){return this._isOverridden("snappingManager")&&this._get("snappingManager"),this._defaultSnappingManager}set snappingManager(e){if(e)this._isOverridden("snappingManager")||(this._defaultSnappingManager=Be(this._defaultSnappingManager)),this._override("snappingManager",e);else{const{view:t}=this;!this._defaultSnappingManager&&t&&(this._defaultSnappingManager=new W({options:this.snappingOptions,view:t})),this._clearOverride("snappingManager")}}get state(){const e=!(!this.view?.ready||!this.layer),t=this._operationHandle;return e&&t?"active":e?"ready":"disabled"}get tooltipOptions(){return this.sketchOptions.tooltips}set tooltipOptions(e){this.sketchOptions.tooltips=e}get valueOptions(){return this.sketchOptions.values}set valueOptions(e){this.sketchOptions.values=e}get view(){return this._get("view")}set view(e){const t=this._get("view");if(t){const{container:n,map:o}=t;n&&(t.cursor=null),o?.remove(this._internalGraphicsLayer),this.removeHandles(this._viewHandlesKey),this.cancel()}const i="view-ready";this.removeHandles(i),e&&this.addHandles($n(()=>e.ready,n=>{this.removeHandles(this._viewHandlesKey),n&&this.addHandles(this._generateViewHandles(e),this._viewHandlesKey)},Ne),i),this._set("view",e)}cancel(){this._moduleLoaderAbortController=Rt(this._moduleLoaderAbortController),this._viewReadyAbortController=Rt(this._viewReadyAbortController),this._sketchContinuationFlag=!0,this._operationHandle&&this._operationHandle.cancel()}complete(){this._operationHandle&&this._operationHandle.complete()}delete(){const{state:e,updateGraphics:t}=this;if(e==="active"&&t.length){const{activeTool:i,layer:n}=this,o=t.toArray();n.removeMany(o),this.cancel(),this._emitDeleteEvent({graphics:o,tool:i})}}duplicate(){if(this.state==="active"&&this.updateGraphics.length){const e=this.updateGraphics.map(t=>t.clone()).toArray();return this.layer.addMany(e),this.emit("duplicate",{graphics:e,type:"duplicate"}),e}return[]}async create(e,t){this.cancel(),await this._waitViewReady();const{view:i,layer:n}=this;if(!i||this.state==="disabled")throw n||this._logMissingLayer(),yi();if(i.activeTool!=null&&(i.activeTool=null),!e)return void this._logError("sketch:missing-parameter","Missing parameter 'tool'.");ki(i,this._internalGraphicsLayer);const o=await this._updatingHandles.addPromise(this._setupCreateOperation(e,t));if(o==null||this.destroyed)return void i.map.remove(this._internalGraphicsLayer);const s=()=>{if(o===this._operationHandle){const a=this.createGraphic,r=this._operationHandle.cancelled;if(this._operationHandle.destroy(),this._operationHandle=null,this._set("createGraphic",null),this.view?.map&&this.view.map.remove(this._internalGraphicsLayer),o.cancelled||a==null||n.add(a),this._sketchContinuationFlag=!1,this.emit("create",{graphic:a,state:r?"cancel":"complete",tool:e,toolEventInfo:null,type:"create"}),r||this._sketchContinuationFlag)return;const{creationMode:l}=this;if(l==="continuous"){if(t?.geometryToPlace)return;this._updatingHandles.addPromise(vi(this.create(e,t)))}else l==="update"&&a&&this._updatingHandles.addPromise(vi(this.update([a])))}};o.on("complete",s),this._operationHandle=o,i.ready&&i.focus()}async place(e,t){return this.create("mesh",{mode:"click",hasZ:e.hasZ,geometryToPlace:e,...t})}async update(e,t){this.cancel(),await this._waitViewReady();const{layer:i,view:n,state:o}=this;if(!n||o==="disabled")throw i||this._logMissingLayer(),yi();n.activeTool!=null&&(n.activeTool=null);const s=Array.isArray(e)?e:[e];if(e==null||!s?.length)return void this._logError("sketch:missing-parameter","Missing parameter 'graphics'.");if(s.some(r=>r.layer!==i?(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics missing from the supplied GraphicsLayer."),!0):r.geometry==null&&(this._logError("sketch:invalid-parameter","Parameter 'graphics' contains one or more graphics with an unsupported geometry."),!0)))return;const a=await this._updatingHandles.addPromise(this._setupUpdateOperation(s,t));this.destroyed||a==null||M(a)||(ki(n,this._internalGraphicsLayer),this._setUpdateOperationHandle(a,t),this.emit("update",{graphics:s,state:"start",aborted:!1,tool:a.tool,toolEventInfo:null,type:"update"}))}async _updateSpatialReference(e){const t=this.view;if(t){e=Array.isArray(e)?e:[e];for(const i of e)i.geometry==null||i.geometry.type==="mesh"||Ui(i.geometry.spatialReference,t.spatialReference)||(ho(i.geometry.spatialReference,t.spatialReference)||uo()||await yo(),i.geometry=Dt(i.geometry,t.spatialReference))}else this._logMissingView()}undo(){this.canUndo()&&this._operationHandle?.undo()}redo(){this.canRedo()&&this._operationHandle?.redo()}canUndo(){return!!this._operationHandle?.canUndo()}canRedo(){return!!this._operationHandle?.canRedo()}toggleUpdateTool(){this._operationHandle?.toggleTool()}async _getFirstHit(e){const t=this.view;if(!t)return this._logMissingView(),null;if(t.type==="2d"){const o=[];t.map.allLayers.forEach(a=>{a.type!=="vector-tile"&&a.type!=="imagery"||o.push(a)});const s=await t.hitTest(e,{exclude:o});return ar(s.results)}const i=[t.map.ground];t.map.allLayers.forEach(o=>{jn(o.type)&&i.push(o)});const n=await t.hitTest(e,{exclude:i});if(n.results.length>0){const o=n.results[0];if(o!=null&&o.type==="graphic"&&o.graphic&&(!n.ground.mapPoint||t.map.ground.opacity<1||n.ground.distance-(o.distance??0)>-Math.min(3*n.ground.distance,t.viewingMode==="global"?qn(t.renderCoordsHelper.spatialReference).radius/t.renderCoordsHelper.unitInMeters:Number.POSITIVE_INFINITY)))return o}return null}_generateViewHandles(e){return[e.on("immediate-click",async t=>{const i=this.state==="active"&&this._operationHandle?.type==="create";this.state!=="disabled"&&!i&&this.updateOnGraphicClick&&await this._updatingHandles.addPromise(this._handleImmediateClick(t))},G.WIDGET)]}async _handleImmediateClick(e){const t=await e.async(()=>this._getFirstHit(mi(e)));let i=null;if(t!=null){const n=t.graphic;this.updateGraphics.includes(n)||n.layer===this.layer?(e.stopPropagation(),i=n):this.view?.type!=="2d"||this._isComponentGraphic(n)||this.state!=="active"||this.cancel()}else this.state==="active"&&this.cancel();i==null||this.updateGraphics.includes(i)||await this.update([i],{...this.defaultUpdateOptions,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions}})}async _setupCreateOperation(e,t){const i=this.view;if(!i)return this._logMissingView(),null;const n={hasZ:i.type==="3d",...this.defaultCreateOptions,...t},o=await this._setupDrawGraphicTool(e,i,n);return o==null?null:(i.tools.add(o),i.activeTool=o,this._setupCreateOperationHandle(o))}async _setupDrawGraphicTool(e,t,i){if(e==="multipoint"&&t.type==="3d")return this._logError("sketch:create","Multipoint geometries are not supported in SceneView."),null;if(!t)return this._logMissingView(),null;const{cursor:n,defaultZ:o,hasZ:s,geometryToPlace:a,graphicProperties:r,mode:l,preserveAspectRatio:p}=i,d=_r(l,e),u=Er(e),f=i?.optionsPerTool?.has(e)?i.optionsPerTool.get(e):{},y=f?.preserveAspectRatio??p??e!=="rectangle",g={centered:e!=="rectangle"&&!(e==="circle"&&!y),cursor:n,defaultZ:o,forceUniformSize:y,graphicProperties:{...r,attributes:{...r?.attributes}},geometryToPlace:a,geometryType:u,mode:d,graphicSymbol:this._getGraphicSymbolFromTool(e),hasZ:s,snappingManager:this.snappingManager,snapToScene:!1,view:t,...f};return t.type==="2d"?this._makeDrawGraphicTool2D(g):this._makeDrawGraphicTool3D(g)}async _makeDrawGraphicTool2D(e){const t=await this._requireModule(N(()=>import("./editingTools-KBOXuhog-DgLoMSyO.js"),__vite__mapDeps([71,1,2,72,8,9,33,73,74,75,34,7,76,25,77,22,45,53,44,46,35,78,38,39,79,26,27,80,11,12,13,14,15,16,17,18,19,20,21,23,24,3,4,5,6,28,29,30,31,32,36,37,40,41,42,43,47,48,49,50,51,52,54,55,56,57,58,59,60,61,81,82,83,10,84,85,86,87,88,89,90,91,92,93,94]),import.meta.url));return M(t)||this.destroyed?null:new t.module.DrawGraphicTool2D({...e,activeVertexSymbol:this.activeVertexSymbol,regularVerticesSymbol:this.vertexSymbol,activeLineSymbol:this.activeLineSymbol,activeFillSymbol:Pr(e.geometryType)?this.activeFillSymbol:null,sketchOptions:this.sketchOptions})}async _makeDrawGraphicTool3D(e){const t=await this._requireModule(N(()=>import("./editingTools-CWx0-1A2-CAVbIOPD.js"),__vite__mapDeps([95,8,9,33,96,97,1,2,98,36,37,99,45,34,100,101,102,35,85,60,22,61,44,43,46,86,103,104,105,106,24,88,32,107,108,109,5,110,111,53,83,112,113,114,84,115,116,117,118,119,38,39,41,42,40,120,23,121,122,123,124,78,125,126,127,48,93,25,76,7,77,79,26,27,80,11,12,13,14,15,16,17,18,19,20,21,3,4,6,28,29,30,31,47,49,50,51,52,54,55,56,57,58,59,81,82,10,128,129,74,75,87,130,131,132,89,90,91,73,133,134,135,136,137,138,92]),import.meta.url).then(n=>n.e));if(M(t)||this.destroyed)return null;const{elevationInfo:i}=this.layer;return new t.module.DrawGraphicTool3D({...e,elevationInfo:i,snapToScene:!0,sketchOptions:this.sketchOptions})}_setupCreateOperationHandle(e){const t=this.view;if(!t)return this._logMissingView(),null;let i=null;const n=e.forceUniformSize,o=e.centered,s=[t.on("key-down",r=>{if(r.key===R.pan)r.stopPropagation(),r.repeat||(e.enabled=!1);else if(r.key===R.complete)r.stopPropagation(),e.completeCreateOperation();else if(r.key!==R.vertexAdd||r.repeat)r.key===R.undo?(r.stopPropagation(),a.undo()):r.key===R.redo?(r.stopPropagation(),a.redo()):r.key!==R.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"||r.repeat?r.key===R.center&&(r.repeat||(e.centered=!o,r.stopPropagation())):(e.forceUniformSize=!n,r.stopPropagation());else{const l=e.drawOperation.geometryType;l!=="polyline"&&l!=="polygon"&&l!=="multipoint"||(r.stopPropagation(),e.drawOperation.commitStagedVertex())}},G.WIDGET),t.on("key-up",r=>{r.key===R.pan?e.enabled=!0:r.key!==R.constraint||e.geometryType!=="rectangle"&&e.geometryType!=="circle"?r.key===R.center&&(e.centered=o,r.stopPropagation()):(e.forceUniformSize=n,r.stopPropagation())},G.WIDGET),e.on("vertex-add",r=>{switch(i=i==null?"start":"active",r.operation){case"apply":this.emit("create",{graphic:e.graphic,state:i,tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("cursor-update",r=>{e.drawOperation.numCommittedVertices>0&&this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:{coordinates:r.vertices[0].coordinates,type:"cursor-update"},type:"create"})}),e.on("vertex-remove",r=>{switch(r.operation){case"apply":this.emit("create",{graphic:e.graphic,state:"active",tool:this.activeTool,toolEventInfo:r,type:"create"});break;case"undo":this._emitUndoEvent({graphics:[e.graphic],tool:e.geometryType});break;case"redo":this._emitRedoEvent({graphics:[e.graphic],tool:e.geometryType})}}),e.on("complete",r=>{this._set("createGraphic",r.graphic),i="complete",r.aborted?a&&a.cancel():a&&a.complete()}),_e(()=>this._getGraphicSymbolFromTool(e.geometryType),r=>{e.graphicSymbol=r})],a=new it({activeComponent:e,tool:e.geometryType,type:"create",onEnd:()=>{J(s),t.tools?.remove(e)},undo:()=>{e.canUndo&&e.undo()},redo:()=>{e.canRedo&&e.redo()},canUndo:()=>e.canUndo,canRedo:()=>e.canRedo});return a}_getGraphicSymbolFromTool(e){switch(e){case"point":case"multipoint":return this.pointSymbol;case"polyline":case"freehandPolyline":return this.polylineSymbol;case"circle":case"rectangle":case"polygon":case"freehandPolygon":return this.polygonSymbol;case"mesh":return this.meshSymbol}}async _setupUpdateOperation(e,t){const{layer:i,view:n}=this;if(!n)return this._logMissingView(),null;const o={...this.defaultUpdateOptions,...t,reshapeOptions:{...this.defaultUpdateOptions.reshapeOptions,...t?.reshapeOptions},highlightOptions:{...this.defaultUpdateOptions.highlightOptions,...t?.highlightOptions}};let s=o.tool??Ce.tool;for(const a of e)i.remove(a),i.add(a);if(n.type==="3d"){if(e.length===0)return null;switch(s){case"move":return this._setupMove3DOperation(e,o,n,s);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupReshape3DOperation(e[0],o,n);case"transform":return this._setupGraphicTransform3DOperation(e,o,n)}}switch(s){case"move":return this._setupMove2DOperation(e,o,n);case"reshape":return e.length>1?(this._logError("sketch:reshape-multiple","Reshape operation does not support multiple graphics."),null):this._setupTransformOrReshape2DOperation(e,s,o,n);case"transform":if(e.length===1){const a=e[0].geometry?.type;a!=="point"&&a!=="multipoint"||(s="reshape")}return this._setupTransformOrReshape2DOperation(e,s,o,n)}}async _setupMove3DOperation(e,t,i,n,o=!1){const s=await this._requireModule(N(()=>import("./editingTools-CWx0-1A2-CAVbIOPD.js"),__vite__mapDeps([95,8,9,33,96,97,1,2,98,36,37,99,45,34,100,101,102,35,85,60,22,61,44,43,46,86,103,104,105,106,24,88,32,107,108,109,5,110,111,53,83,112,113,114,84,115,116,117,118,119,38,39,41,42,40,120,23,121,122,123,124,78,125,126,127,48,93,25,76,7,77,79,26,27,80,11,12,13,14,15,16,17,18,19,20,21,3,4,6,28,29,30,31,47,49,50,51,52,54,55,56,57,58,59,81,82,10,128,129,74,75,87,130,131,132,89,90,91,73,133,134,135,136,137,138,92]),import.meta.url).then(y=>y.e));if(M(s))return s;const{ManipulatedObject3DGraphic:a,MoveTool3D:r}=s.module,l=new Map,p=()=>{l.forEach(y=>y.destroy()),l.clear()};for(const y of e){const g=new a({view:i,graphic:y}),_=br(g);if(_!==b.SUPPORTED)return p(),this._logError("sketch:move",`Move operation not supported for provided graphic(s) (${Ci(_)}).`),null;l.set(y,g)}const d=new r({view:i,enableZ:t.enableZ,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(d),d.objects.addMany(Array.from(l.values())),o||this.updateGraphics.addMany(e);const u=[],f=new he({activeComponent:d,tool:n,type:"update",onEnd:()=>{J(u),Je(i,d),p()},undo:()=>{Hi(this.view,d),Ke(f,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{Xe(f,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:y=>{this.updateGraphics.push(y);const g=new a({view:i,graphic:y});l.set(y,g),d.objects.push(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[y],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:y=>{const g=this.updateGraphics.indexOf(y);if(f.history.undo.forEach(T=>T.updates.splice(g,1)),f.history.redo.forEach(T=>T.updates.splice(g,1)),this.updateGraphics.remove(y),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[y],type:"selection-change"},type:"update"}),this.updateGraphics.length===0)return void f.complete();const _=l.get(y);_&&(d.objects.remove(_),_.destroy(),l.delete(y))},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1||n!=="transform")return;const y=this.updateGraphics.at(0),g=await this._setupReshape3DOperation(y,t,i,!0);g&&!M(g)&&(f.onEnd(),f.destroy(),this._setUpdateOperationHandle(g,t))}});return u.push(...this._getHandlesForComponent(f,t),i.on("immediate-click",y=>this._getCommonUpdateOperationClickHandlers(f,y,t),G.WIDGET),i.on("key-down",y=>{this._getCommonUpdateOperationKeyDownHandlers(f,y)},G.WIDGET)),f}_setupGraphicTransform3DOperation(e,t,i,n=!1){if(e.length===1&&Sr(e[0])===b.SUPPORTED){const o=e[0],s=o.geometry;if(s!=null&&(s.type==="point"||s.type==="mesh"))return this._setupPointTransform3DOperation(o,t,i);if(s!=null&&(s.type==="polygon"||s.type==="polyline"))return this._setupPolyTransform3DOperation(o,t,i,n)}return this._setupMove3DOperation(e,t,i,"transform",n)}async _setupPointTransform3DOperation(e,t,i){const n="transform",{enableRotation:o,enableScaling:s,enableZ:a}=t,r=await this._requireModule(N(()=>import("./editingTools-CWx0-1A2-CAVbIOPD.js"),__vite__mapDeps([95,8,9,33,96,97,1,2,98,36,37,99,45,34,100,101,102,35,85,60,22,61,44,43,46,86,103,104,105,106,24,88,32,107,108,109,5,110,111,53,83,112,113,114,84,115,116,117,118,119,38,39,41,42,40,120,23,121,122,123,124,78,125,126,127,48,93,25,76,7,77,79,26,27,80,11,12,13,14,15,16,17,18,19,20,21,3,4,6,28,29,30,31,47,49,50,51,52,54,55,56,57,58,59,81,82,10,128,129,74,75,87,130,131,132,89,90,91,73,133,134,135,136,137,138,92]),import.meta.url).then(g=>g.e));if(M(r))return r;const{TransformTool3D:l,ManipulatedObject3DGraphic:p}=r.module,d=new p({graphic:e,view:i}),u=new l({object:d,view:i,enableRotation:o,enableScaling:s,enableZ:a,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(u),this.updateGraphics.add(e);const f=[],y=new he({activeComponent:u,tool:n,type:"update",onEnd:()=>{J(f),Je(i,u),d.destroy()},undo:()=>{Hi(this.view,u),Ke(y,this.updateGraphics.toArray()),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:n})},redo:()=>{Xe(y,this.updateGraphics.toArray()),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:n})},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const _=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);M(_)||this._setUpdateOperationHandle(_,t)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),y.complete()},toggleTool:()=>{}});return f.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,t),G.WIDGET),i.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},G.WIDGET)),y}async _setupPolyTransform3DOperation(e,t,i,n=!1){const o="transform",{enableRotation:s,enableScaling:a,enableZ:r,preserveAspectRatio:l}=t,p=await this._requireModule(N(()=>import("./editingTools-CWx0-1A2-CAVbIOPD.js"),__vite__mapDeps([95,8,9,33,96,97,1,2,98,36,37,99,45,34,100,101,102,35,85,60,22,61,44,43,46,86,103,104,105,106,24,88,32,107,108,109,5,110,111,53,83,112,113,114,84,115,116,117,118,119,38,39,41,42,40,120,23,121,122,123,124,78,125,126,127,48,93,25,76,7,77,79,26,27,80,11,12,13,14,15,16,17,18,19,20,21,3,4,6,28,29,30,31,47,49,50,51,52,54,55,56,57,58,59,81,82,10,128,129,74,75,87,130,131,132,89,90,91,73,133,134,135,136,137,138,92]),import.meta.url).then(E=>E.e));if(M(p))return p;const{ManipulatedObject3DGraphic:d,ExtentTransformTool:u}=p.module,f=this.view?.inputManager?.isModifierKeyDown(R.constraint),y=new d({view:i,graphic:e}),g=new u({object:y,view:i,enableRotation:s,enableScaling:a,enableZ:r,preserveAspectRatio:!!l!=!!f,sketchOptions:this.sketchOptions});i.tools.add(g),n||this.updateGraphics.add(e);const _=[],T=new he({activeComponent:g,tool:o,type:"update",onEnd:()=>{J(_),Je(i,g),y.destroy()},canUndo:()=>!g.destroyed&&g.canUndo,undo:()=>{g.destroyed||(g.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!g.destroyed&&g.canRedo,redo:()=>{g.destroyed||(g.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async E=>{this.updateGraphics.add(E),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[E],removed:[],type:"selection-change"},type:"update"}),T.onEnd(),T.destroy();const Le=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);M(Le)||this._setUpdateOperationHandle(Le,t)},removeFromSelection:E=>{this.updateGraphics.remove(E),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[E],type:"selection-change"},type:"update"}),T.complete()},toggleTool:async()=>{if(this.updateGraphics.length!==1||t.toggleToolOnClick===!1)return;const E=await this._setupReshape3DOperation(e,t,i,!0);E&&!M(E)&&(T.onEnd(),T.destroy(),this._setUpdateOperationHandle(E,t))}});return _.push(...this._getHandlesForComponent(T,t),i.on("immediate-click",E=>this._getCommonUpdateOperationClickHandlers(T,E,t),G.WIDGET),i.on("key-down",E=>this._getCommonUpdateOperationKeyDownHandlers(T,E),G.WIDGET),i.on("key-down",E=>{E.key!==R.constraint||E.repeat||(g.preserveAspectRatio=!g.preserveAspectRatio,E.stopPropagation())},G.WIDGET),i.on("key-up",E=>{E.key===R.constraint&&(g.preserveAspectRatio=!g.preserveAspectRatio,E.stopPropagation())},G.WIDGET)),T}async _setupMove2DOperation(e,t,i){const n="move";this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=await this._getGraphicMover(e,t,i);if(M(o))return o;const s=new he({activeComponent:o,tool:n,type:"update",onEnd:()=>{this._displayDefaultCursor(),J(l),J(r),o.destroy(),this._internalGraphicsLayer?.removeMany([...this.updateGraphics.toArray()])},undo:()=>{const p=this.updateGraphics.toArray();Ke(s,p),s.refreshComponent(),this._emitUndoEvent({graphics:p,tool:n})},redo:()=>{const p=this.updateGraphics.toArray();Xe(s,p),s.refreshComponent(),this._emitRedoEvent({graphics:p,tool:n})},addToSelection:async p=>{await this._updatingHandles.addPromise(this._updateSpatialReference(p)),this.updateGraphics.push(p),o.graphics=this.updateGraphics.toArray(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[p],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:p=>{const d=this.updateGraphics.indexOf(p);s.history.undo.forEach(f=>f.updates.splice(d,1)),s.history.redo.forEach(f=>f.updates.splice(d,1)),this.updateGraphics.remove(p);const u=this.updateGraphics.toArray();this.emit("update",{graphics:u,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[p],type:"selection-change"},type:"update"}),this.updateGraphics.length!==0?o.graphics=u:s.complete()}});let a=!1;const r=[i.on("immediate-click",p=>this._getCommonUpdateOperationClickHandlers(s,p,t),G.WIDGET),i.on("key-down",p=>{this._getCommonUpdateOperationKeyDownHandlers(s,p),p.key!==R.constraint||p.repeat||(a=!0,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},G.WIDGET),i.on("key-up",p=>{p.key===R.constraint&&a&&(a=!1,o.enableMoveAllGraphics=!o.enableMoveAllGraphics)},G.WIDGET)],l=this._getHandlesForComponent(s,t);return s}async _setupReshape3DOperation(e,t,i,n=!1){const o="reshape",s=await this._requireModule(N(()=>import("./editingTools-CWx0-1A2-CAVbIOPD.js"),__vite__mapDeps([95,8,9,33,96,97,1,2,98,36,37,99,45,34,100,101,102,35,85,60,22,61,44,43,46,86,103,104,105,106,24,88,32,107,108,109,5,110,111,53,83,112,113,114,84,115,116,117,118,119,38,39,41,42,40,120,23,121,122,123,124,78,125,126,127,48,93,25,76,7,77,79,26,27,80,11,12,13,14,15,16,17,18,19,20,21,3,4,6,28,29,30,31,47,49,50,51,52,54,55,56,57,58,59,81,82,10,128,129,74,75,87,130,131,132,89,90,91,73,133,134,135,136,137,138,92]),import.meta.url).then(g=>g.e));if(M(s))return s;const{ManipulatedObject3DGraphic:a,ReshapeTool3D:r}=s.module,l=new a({view:i,graphic:e}),p=wr(l);if(p!==b.SUPPORTED)return l.destroy(),this._logError("sketch:reshape",`Reshape operation not supported for provided graphic(s) (${Ci(p)}).`),null;const d=t.reshapeOptions,u=new r({view:i,object:l,enableZVertex:t.enableZ&&d?.vertexOperation==="move",enableZShape:t.enableZ&&d?.shapeOperation==="move",enableMoveObject:d?.shapeOperation==="move"||d?.shapeOperation==="move-xy",enableMidpoints:d?.edgeOperation==="split",enableEdgeOffset:d?.edgeOperation==="offset",snappingManager:this.snappingManager,sketchOptions:this.sketchOptions});i.tools.add(u),n||this.updateGraphics.add(l.graphic);const f=[],y=new he({activeComponent:u,tool:o,type:"update",onEnd:()=>{J(f),Je(i,u),l.destroy()},canUndo:()=>!u.destroyed&&u.canUndo,undo:()=>{u.destroyed||(u.undo(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},canRedo:()=>!u.destroyed&&u.canRedo,redo:()=>{u.destroyed||(u.redo(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:o}))},addToSelection:async g=>{this.updateGraphics.add(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[g],removed:[],type:"selection-change"},type:"update"}),y.onEnd(),y.destroy();const _=await this._setupMove3DOperation(this.updateGraphics.toArray(),t,i,"transform",!0);M(_)||this._setUpdateOperationHandle(_,t)},removeFromSelection:g=>{this.updateGraphics.remove(g),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[g],type:"selection-change"},type:"update"}),y.complete()},toggleTool:async()=>{if(t.toggleToolOnClick===!1)return;y.onEnd(),y.destroy();const g=await this._setupGraphicTransform3DOperation(this.updateGraphics.toArray(),t,i,!0);M(g)||this._setUpdateOperationHandle(g,t)}});return f.push(...this._getHandlesForComponent(y,t),i.on("immediate-click",g=>this._getCommonUpdateOperationClickHandlers(y,g,t),G.WIDGET),i.on("key-down",g=>{this._getCommonUpdateOperationKeyDownHandlers(y,g)},G.WIDGET)),y}async _setupTransformOrReshape2DOperation(e,t,i,n){this.updateGraphics.addMany(e),await this._updatingHandles.addPromise(this._updateSpatialReference(e));const o=t==="transform"?await this._getBox(e,i,n):await this._getReshape(e,i,n);if(M(o))return o;const s=new he({activeComponent:o,type:"update",onEnd:()=>{J(r),J(a),s.activeComponent&&!s.activeComponent.destroyed&&s.activeComponent.destroy(),this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray())},undo:()=>{Ke(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitUndoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},redo:()=>{Xe(s,this.updateGraphics.toArray()),s.refreshComponent(),this._emitRedoEvent({graphics:this.updateGraphics.toArray(),tool:s.tool})},addToSelection:async l=>{let p=s.activeComponent;if(p?.type==="reshape"){const d=[...this.updateGraphics,l];this.updateGraphics.removeAll(),s.onEnd(),s.destroy();const u=await this._setupTransformOrReshape2DOperation(d,"transform",i,n);if(M(u))return;this._setUpdateOperationHandle(u,i)}else this.updateGraphics.add(l),p.graphics=this.updateGraphics.toArray(),p.refresh(),s.resetHistory();this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[l],removed:[],type:"selection-change"},type:"update"})},removeFromSelection:async l=>{const p=this.updateGraphics.indexOf(l);s.history.undo.forEach(u=>u.updates.splice(p,1)),s.history.redo.forEach(u=>u.updates.splice(p,1)),this.updateGraphics.remove(l);const d=this.updateGraphics.toArray();if(d.length===0)s.complete();else{const u=d[0].geometry;d.length!==1||u==null||u.type!=="point"&&u.type!=="multipoint"?s.activeComponent.graphics=d:s.toggleTool()}this.emit("update",{graphics:d,state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:[],removed:[l],type:"selection-change"},type:"update"})},toggleTool:async()=>{if(this.updateGraphics.length>1)return;const l=this.updateGraphics.at(0),p=l.geometry;if(p!=null&&(s.tool==="reshape"&&(p.type==="point"||p.type==="multipoint")||s.tool==="transform"&&p.type==="extent"))return;let d=null;s.tool==="transform"?d=await this._getReshape([l],i,n):s.tool==="reshape"&&(d=await this._getBox([l],i,n)),M(d)||(s.activeComponent?.destroy(),s.activeComponent=d,s.activeComponent&&(J(r),r=this._getHandlesForComponent(s,i)))}}),a=[n.on("immediate-click",l=>this._getCommonUpdateOperationClickHandlers(s,l,i),G.WIDGET),n.on("key-down",l=>{if(this._getCommonUpdateOperationKeyDownHandlers(s,l),l.key===R.constraint&&!l.repeat&&s){const p=s.activeComponent;p&&p.type==="box"&&(p.preserveAspectRatio=!p.preserveAspectRatio)}},G.WIDGET),n.on("key-up",l=>{if(l.key===R.constraint&&s){const p=s.activeComponent;p&&p.type==="box"&&(p.preserveAspectRatio=!p.preserveAspectRatio)}},G.WIDGET)];let r=this._getHandlesForComponent(s,i);return s}async _getGraphicMover(e,t,i){const{enableMoveAllGraphics:n,highlightOptions:o}=t,s=await this._requireModule(N(()=>import("./GraphicMover-CiNX1V2i-CVpW6kxN.js"),__vite__mapDeps([167,1,2,13,14,15,16,17,18,19,20,21,22,9,23,24,94,125,28,168,25,169,170,3,4,5,6,92,8,34,37,42,54,31,7,33,41,47,57,58,59,35,36,43,44,45,46,60,61]),import.meta.url).then(a=>a.G));return M(s)?s:new s.module.default({enableMoveAllGraphics:n,highlightsEnabled:!!o?.enabled,indicatorsEnabled:!1,graphics:e,view:i,callbacks:{onGraphicMoveStart:({dx:a,dy:r,graphic:l})=>{this._displayGrabbingCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:r,mover:l,type:"move-start"},type:"update"})},onGraphicMove:({dx:a,dy:r,graphic:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:r,mover:l,type:"move"},type:"update"}),onGraphicMoveStop:({dx:a,dy:r,graphic:l})=>{this._displayPointerCursor(),this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:a,dy:r,mover:l,type:"move-stop"},type:"update"})},onGraphicPointerOver:()=>this._displayPointerCursor(),onGraphicPointerOut:()=>this._displayDefaultCursor()}})}async _getBox(e,t,i){const{enableRotation:n,enableScaling:o,highlightOptions:s,preserveAspectRatio:a}=t,r=await this._requireModule(N(()=>import("./Box-CcaqKOvu-CYiJlMqI.js"),__vite__mapDeps([171,1,2,7,94,167,13,14,15,16,17,18,19,20,21,22,9,23,24,125,28,168,25,169,170,3,4,5,6,92,8,34,37,42,54,31,33,41,47,57,58,59,35,36,43,44,45,46,60,61,172,76,77,53,78,38,39,79,26,27,80,11,12,29,30,32,40,48,49,50,51,52,55,56,81,82,83,10,138,131]),import.meta.url));if(M(r))return r;const l=this.view?.inputManager?.isModifierKeyDown(R.constraint);return new r.module.default({graphics:e,enableRotation:n,enableScaling:o,highlightsEnabled:!!s?.enabled,preserveAspectRatio:!!a!=!!l,layer:this._internalGraphicsLayer,view:i,sketchOptions:this.sketchOptions,callbacks:{onMoveStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onMove:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onMoveStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScaleStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScale:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onScaleStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotateStart:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotate:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"}),onRotateStop:p=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...p},type:"update"})}})}async _getReshape(e,t,i){const n=t.reshapeOptions?.edgeOperation==="split",o=t.reshapeOptions?.shapeOperation==="move",s=!!t.highlightOptions?.enabled,a=await this._requireModule(N(()=>import("./Reshape-BUYuf7aU-DLFuoaoa.js"),__vite__mapDeps([173,1,2,13,14,15,16,17,18,19,20,21,22,9,23,24,32,72,8,33,73,74,75,34,7,76,25,77,45,53,44,46,35,78,38,39,79,26,27,80,11,12,3,4,5,6,28,29,30,31,36,37,40,41,42,43,47,48,49,50,51,52,54,55,56,57,58,59,60,61,81,82,83,10,84,85,86,94,167,125,168,169,170,92,130,131,172]),import.meta.url));return M(a)?a:new a.module.default({enableMidpoints:n,enableMovement:o,graphic:e[0],highlightsEnabled:s,layer:this._internalGraphicsLayer,snappingManager:this.snappingManager,sketchOptions:this.sketchOptions,view:i,callbacks:{onReshapeStart:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onReshape:r=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...r},type:"update"}),onReshapeStop:({mover:r,type:l})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:r,type:l},type:"update"}),onMoveStart:({dx:r,dy:l,mover:p,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:l,mover:p,type:d},type:"update"}),onMove:({dx:r,dy:l,mover:p,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:l,mover:p,type:d},type:"update"}),onMoveStop:({dx:r,dy:l,mover:p,type:d})=>this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:r,dy:l,mover:p,type:d},type:"update"}),onVertexAdd:({added:r,type:l,vertices:p})=>{const d=r.map(u=>gi(u.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{added:d,vertices:p,type:l},type:"update"})},onVertexRemove:({removed:r,type:l,vertices:p})=>{const d=r.map(u=>gi(u.geometry));this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{removed:d,vertices:p,type:l},type:"update"})}}})}_getHandlesForComponent(e,t){const i=e.activeComponent;if(!i)return[];switch(i.type){case"graphic-mover":return[i.on("graphic-click",({graphic:n,viewEvent:o})=>{o.native?.shiftKey&&(o.stopPropagation(),e.removeFromSelection(n))}),i.on("graphic-move-start",n=>e.addToHistory(de(n.allGraphics)))];case"box":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),i.on("move-start",n=>e.addToHistory(de(n.graphics))),i.on("rotate-start",n=>e.addToHistory(de(n.graphics))),i.on("scale-start",n=>e.addToHistory(de(n.graphics)))];case"reshape":return[i.on("graphic-click",n=>this._onTransformOrReshape2DGraphicClick(e,t,n)),i.on("move-start",n=>e.addToHistory(de([n.mover]))),i.on("reshape-start",n=>e.addToHistory(de([n.graphic]))),i.on("vertex-add",n=>e.addToHistory(de([n.oldGraphic]))),i.on("vertex-remove",n=>e.addToHistory(de([n.oldGraphic])))];case"move-3d":return[i.events.on("record-undo",({updates:n})=>{e.addToHistory({updates:n})}),i.events.on("move-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-start"},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:n.dx,dy:n.dy,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move"},type:"update"})}),i.events.on("move-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{dx:0,dy:0,mover:n.objects.length>0?n.objects[0].graphic:null,type:"move-stop"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case"transform-3d":return[i.events.on("record-undo",({updates:n})=>{e.addToHistory({updates:n})}),i.events.on("translate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-start"},type:"update"})}),i.events.on("translate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move-stop"},type:"update"})}),i.events.on("rotate-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-start"},type:"update"})}),i.events.on("rotate-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate-stop"},type:"update"})}),i.events.on("scale-start",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-start"},type:"update"})}),i.events.on("scale-stop",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale-stop"},type:"update"})}),i.events.on("translate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,dx:n.dxScreen,dy:n.dyScreen,type:"move"},type:"update"})}),i.events.on("rotate",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,angle:n.angle,type:"rotate"},type:"update"})}),i.events.on("scale",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{mover:n.object.graphic,xScale:n.xScale,yScale:n.yScale,type:"scale"},type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})];case"reshape-3d":return[i.events.on("reshape",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("move",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:{...n,mover:n.object.graphic},type:"update"})}),i.events.on("vertex-add",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("vertex-remove",n=>{this.emit("update",{graphics:this.updateGraphics.toArray(),state:"active",aborted:!1,tool:this.activeTool,toolEventInfo:n,type:"update"})}),i.events.on("immediate-click",n=>{n.shiftKey?this._toggleSelection([n.object.graphic],e,t):e.toggleTool()})]}}_onTransformOrReshape2DGraphicClick(e,t,i){const{graphic:n,viewEvent:o}=i;return o.native?.shiftKey&&n.layer===this.layer?(o.stopPropagation(),e.removeFromSelection(n)):t.toggleToolOnClick?(o.stopPropagation(),e.toggleTool()):void 0}_setUpdateOperationHandle(e,t){this._operationHandle=e;const i=this.view?.map;this._disablePopup(t);const n=()=>{if(e===this._operationHandle){const o=this.updateGraphics.toArray(),s=this._operationHandle.tool;this._operationHandle.destroy(),this._operationHandle=null,this._internalGraphicsLayer.removeMany(this.updateGraphics.toArray()),this.updateGraphics.removeAll(),i&&i.remove(this._internalGraphicsLayer),this._restorePopup(t),this.emit("update",{graphics:o,state:"complete",aborted:e.cancelled,tool:s,toolEventInfo:null,type:"update"})}};e.on("complete",n)}async _getCommonUpdateOperationClickHandlers(e,t,i){const n=mi(t),o=await t.async(()=>this._getFirstHit(n));if(o==null)return void e.complete();if(t.native.shiftKey&&this._toggleSelection([o.graphic],e,i))return void t.stopPropagation();this.updateGraphics.includes(o.graphic)?t.stopPropagation():e.complete()}_toggleSelection(e,t,i){const n=!!i.multipleSelectionEnabled;return e.some(o=>o!=null&&!(!n||o.layer!==this.layer)&&(this.updateGraphics.includes(o)?t.removeFromSelection(o):t.addToSelection(o),!0))}_getCommonUpdateOperationKeyDownHandlers(e,t){if(!e)return;const i=t.key;i===R.undo&&e.canUndo()?(t.stopPropagation(),e.undo()):i===R.redo&&e.canRedo()?(t.stopPropagation(),e.redo()):i===R.cancel?(t.stopPropagation(),e.cancel()):this.allowDeleteKey&&R.delete.includes(i)&&this._onDeleteKey(t)}_onDeleteKey(e){if(!this._operationHandle||this._operationHandle.type!=="update")return;const t=this.activeComponent,i=this.updateGraphics.toArray();t!=null&&(t.type!=="reshape"||i.length===1&&i[0].geometry?.type==="point")&&(e.stopPropagation(),this.delete())}_removeDefaultLayer(){this._internalGraphicsLayer&&(this.view?.map?.remove(this._internalGraphicsLayer),this._internalGraphicsLayer=Be(this._internalGraphicsLayer))}_isComponentGraphic(e){const{activeComponent:t}=this;return!(!e||t==null)&&(e.attributes?.esriSketchTool||t.type==="draw-2d"&&t.graphic===e||(t.type==="box"||t.type==="reshape")&&t.isUIGraphic(e))}_displayPointerCursor(){this.view?.container&&this.view.cursor!=="pointer"&&(this.view.cursor="pointer")}_displayGrabbingCursor(){this.view?.container&&this.view.cursor!=="grabbing"&&(this.view.cursor="grabbing")}_displayDefaultCursor(){this.view?.container&&this.view.cursor!==null&&(this.view.cursor=null)}_logError(e,t,i){Vi.getLogger(this).error(new zn(e,t,i))}async _requireModule(e){const t=new AbortController;this._moduleLoaderAbortController=t;const i=await e;return this._moduleLoaderAbortController!==t||t.signal.aborted?{requireError:"aborted"}:{module:i}}_emitUndoEvent(e){this.emit("undo",{...e,type:"undo"})}_emitRedoEvent(e){this.emit("redo",{...e,type:"redo"})}_emitDeleteEvent(e){this.emit("delete",{...e,type:"delete"})}get test(){}wait(){return fi(()=>!this.updating)}_disablePopupEnabled(e){return this.view?.type!=="3d"||this.updateOnGraphicClick||(e?.toggleToolOnClick??!1)}_disablePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled==null&&(this._originalPopupEnabled=this.view.popupEnabled,this.view.popupEnabled=!1)}_restorePopup(e){this._disablePopupEnabled(e)&&this.view&&this._originalPopupEnabled!=null&&(this.view.popupEnabled=this._originalPopupEnabled,this._originalPopupEnabled=null)}async _waitViewReady(){const e=this.view;e?(Rt(this._viewReadyAbortController),this._viewReadyAbortController=new AbortController,await Zn(fi(()=>e?.ready),this._viewReadyAbortController.signal)):this._logMissingView()}_logMissingView(){this._logError("sketch:missing-property",Ni("view"))}_logMissingLayer(){this._logError(Or,Ni("layer"))}};c([h()],m.prototype,"_defaultSnappingManager",void 0),c([h()],m.prototype,"updating",null),c([h({readOnly:!0})],m.prototype,"_updatingHandles",void 0),c([h()],m.prototype,"_operationHandle",void 0),c([h({readOnly:!0})],m.prototype,"activeTool",null),c([h({readOnly:!0})],m.prototype,"activeCreateToolDrawMode",null),c([h()],m.prototype,"activeTooltip",null),c([h({types:ke})],m.prototype,"activeFillSymbol",void 0),c([h()],m.prototype,"activeLineSymbol",void 0),c([h()],m.prototype,"activeVertexSymbol",void 0),c([h()],m.prototype,"allowDeleteKey",void 0),c([h({readOnly:!0})],m.prototype,"createGraphic",null),c([h()],m.prototype,"defaultCreateOptions",null),c([h()],m.prototype,"defaultUpdateOptions",null),c([h({type:pi,nonNullable:!0})],m.prototype,"labelOptions",null),c([h()],m.prototype,"layer",void 0),c([h({types:ke})],m.prototype,"pointSymbol",void 0),c([h({types:ke})],m.prototype,"polygonSymbol",void 0),c([h({types:ke})],m.prototype,"polylineSymbol",void 0),c([h()],m.prototype,"meshSymbol",void 0),c([h({type:hi,nonNullable:!0})],m.prototype,"snappingOptions",null),c([h()],m.prototype,"snappingManager",null),c([h({readOnly:!0})],m.prototype,"state",null),c([h({type:li,nonNullable:!0})],m.prototype,"tooltipOptions",null),c([h({readOnly:!0})],m.prototype,"updateGraphics",void 0),c([h()],m.prototype,"updateOnGraphicClick",void 0),c([h()],m.prototype,"creationMode",void 0),c([h({type:ci,nonNullable:!0})],m.prototype,"valueOptions",null),c([h({types:ke})],m.prototype,"vertexSymbol",void 0),c([h({value:null})],m.prototype,"view",null),c([h({constructOnly:!0,type:kn})],m.prototype,"sketchOptions",void 0),m=c([C("esri.widgets.Sketch.SketchViewModel")],m);const Or="sketch:missing-property",Ni=e=>`Property '${e}' is missing on SketchViewModel.`;function Pr(e){return e==="polygon"||e==="rectangle"||e==="circle"}function Ke(e,t){In("undo",e.history.undo,e.history.redo,t)}function Xe(e,t){In("redo",e.history.redo,e.history.undo,t)}function In(e,t,i,n){const o=t.pop();if(!o)return;const s=o.updates,a=[];n.forEach((r,l)=>{const p=s[l];p!=null&&("geometry"in p&&p.geometry!=null&&(a.push({geometry:r.geometry}),r.geometry=p.geometry),"symbol"in p&&p.symbol!=null&&(a.push({symbol:r.symbol}),r.symbol=p.symbol),"undo"in p&&(a.push(p),p[e](r)))}),i.push({updates:a})}function Hi(e,t){e!=null&&t.hasGrabbedManipulators&&(e.activeTool=null)}function de(e){return{updates:e.map(({geometry:t})=>t?.type==="mesh"?{geometry:t.cloneShallow()}:{geometry:t})}}function Je(e,t){e.tools?.remove(t),t.destroyed||t.destroy()}function M(e){return"requireError"in e&&e.requireError==="aborted"}const ba=m;export{Ko as $,ya as A,Ea as B,oe as C,U as D,us as E,nr as F,ln as G,lt as H,ia as I,Xs as J,Wo as K,ga as L,R as M,bt as N,P as O,De as P,I as Q,ua as R,Br as S,kn as T,na as U,sa as V,wi as W,Xo as X,tr as Y,yr as Z,ai as _,j as a,ma as a0,bi as a1,Mt as a2,ra as a3,Mn as a4,cr as a5,Ks as a6,gn as a7,ea as a8,me as a9,Qo as aA,Zr as aB,ki as aC,Qr as aD,Kr as aE,Jr as aF,Xr as aG,Wr as aH,va as aI,hr as aa,gt as ab,dr as ac,yt as ad,ta as ae,ur as af,sn as ag,tt as ah,Ln as ai,lr as aj,pr as ak,fa as al,_a as am,Bo as an,br as ao,b as ap,Wt as aq,Yr as ar,la as as,os as at,pa as au,ca as av,Z as aw,ps as ax,Ji as ay,en as az,B as b,hi as c,ci as d,es as e,Rs as f,Kt as g,Ii as h,Ts as i,dt as j,Ws as k,Gs as l,Ae as m,oa as n,da as o,ts as p,ar as q,ha as r,Tn as s,ba as t,Te as u,xn as v,pi as w,ds as x,Gi as y,aa as z};
