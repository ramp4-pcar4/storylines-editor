import{eQ as x,c as N,cX as P,jp as $}from"./main-BrXQBr3M.js";import{R as j}from"./colorUtils-DxUhbS7D-1R0v1SSy.js";import{y as V}from"./fontUtils-Ce-zEYaT-5mQ8Jon9.js";import{O as I,Q}from"./quantizationUtils-Cndke4AR-CpcVDbiy.js";import{F as Z,b as E,j as W,G as X}from"./utils-C_9ghOVk-CTZnzkQh.js";import{g as C,p as G,r as F,D as H}from"./utils-C1HQJ6Ct-DfyqQ0D3.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./vec4f64-CjUMzAyX-DPYbdAom.js";import"./jsonUtils-DzmXEA9_-BnStZKpJ.js";import"./parser-hXQyB-Qx-Dp0xTp_H.js";import"./mat4f32-CiZjBg9k-CUm34GoR.js";import"./mat4-BFStKTjU-uiUWvEP6.js";import"./cimSymbolUtils-BuFg2oLA-duvhADIj.js";import"./utils-BYqzY6_X-Dq82pUKM.js";import"./defaultCIMValues-gWpu7WSC-cjxb95kj.js";import"./enums-f9UUstHQ-hLTu4V1l.js";import"./LRUCache-BLmkvs7b-Cf0KRICn.js";import"./MemCache-BCippCv6-DnYe-hpD.js";import"./globalCss-CFN4F315-nvTe32za.js";import"./Queue-B8H6jIv7-C4vOEIQq.js";import"./signal-DxzURL18-BiAWl8ZV.js";import"./Version-BTMwSXf1-CLS208tz.js";import"./jsxFactory-C5LxVioS-C8vZZ24R.js";import"./intl-DLmy-Li5-DRUw9zN4.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./mat2df32-BCnkwMW8-BLRY8i4P.js";import"./mat2d-BQA-1WB--Pnyy0dhf.js";import"./webStyleSymbolUtils-BLJ6xjmu-BPMSqghD.js";import"./devEnvironmentUtils-CxrVv3RG-CX5aoxVE.js";import"./styleUtils-DxAOZq5S-C08OtaT1.js";import"./webStyleAcceptedFormats-DsfCZOwz-CG7ZQ6BV.js";import"./ColorStop-DoHCvOqO-CN19nLxS.js";import"./TimeExtent-gZaEUVeW-D2eGsof2.js";import"./utils-BG7WTOnW-ifxlWSTl.js";import"./timeZoneUtils-z3WjfjXQ-8JPN5aIG.js";import"./typeUtils-I5iG5ZKA-DzHUxJgf.js";import"./ClassBreaksRenderer-D97YzbWp-C6I_4ju-.js";import"./commonProperties-BLIn8DYU-BQFd4ays.js";import"./colorRamps-KMmVdCPJ-CmpjMakp.js";import"./visualVariableUtils-BO-_wo28-DfrVsYLw.js";import"./lengthUtils-wU9RRIqK-BTv_PZij.js";import"./RendererLegendOptions-f5mIImtQ-C9HuzuEm.js";import"./FieldsIndex-Y7EBAYp0-BqfCvCRQ.js";import"./heatmapUtils--OU2Fakh-BWGHg30d.js";import"./SimpleRenderer-ADQlYl8U-DqPI9se2.js";import"./UniqueValueRenderer-BmoLL_Ee-B6g7RAOV.js";import"./diffUtils-BSe9IE26-BhPEeZ3Z.js";const T="picture-fill",K="picture-marker",Y="simple-fill",_="simple-line",J="simple-marker",U="text",tt="Aa",et=C.size,z=C.maxSize,it=C.maxOutlineSize,O=C.lineWidth,R=225,ot=document.createElement("canvas");function A(e,t,r){if(e.type==="polygon"){const o=e.extent,c=o.width===0?1:o.width,s=o.height===0?1:o.height;e=I({originPosition:"upperLeft",scale:[c/t,s/r],translate:[o.xmin,o.ymax]},{},e);let m="";for(let l=0;l<e.rings.length;l++){const a=e.rings[l];for(let h=0;h<a.length;h++){const u=a[h][0],d=a[h][1];let i="";h===0?(i=`M${u.toString()} ${d.toString()}`,m!==""&&(i=` ${i}`),m+=i):h===a.length-1?(i=`l${u.toString()} ${d.toString()} Z`,m!==""&&(i=` ${i}`),m+=i):(i=`l${u.toString()} ${d.toString()}`,m!==""&&(i=` ${i}`),m+=i)}}return m}if(e.type==="polyline"){const o=e.extent,c=o.width===0?1:o.width,s=o.height===0?1:o.height;e=Q({originPosition:"upperLeft",scale:[c/t,s/r],translate:[o.xmin,o.ymax]},{},e);let m="";for(let l=0;l<e.paths.length;l++){const a=e.paths[l];for(let h=0;h<a.length;h++){const u=a[h][0],d=a[h][1];let i="";h===0?(i=`M${u.toString()} ${d.toString()}`,m!==""&&(i=` ${i}`),m+=i):(i=`l${u.toString()} ${d.toString()}`,m!==""&&(i=` ${i}`),m+=i)}}return m}return""}function q(e,t){const r=ot.getContext("2d"),o=[];t&&(t.weight&&o.push(t.weight),t.size&&o.push(t.size+"px"),t.family&&o.push(t.family)),r.font=o.join(" ");const{width:c,actualBoundingBoxLeft:s,actualBoundingBoxRight:m,actualBoundingBoxAscent:l,actualBoundingBoxDescent:a}=r.measureText(e);return{width:Math.ceil(Math.max(c,s+m)),height:Math.ceil(l+a),x:Math.floor(s),y:Math.floor((l-a)/2)}}function k(e){const t=e?.size;return{width:t!=null&&typeof t=="object"&&"width"in t?x(t.width):null,height:t!=null&&typeof t=="object"&&"height"in t?x(t.height):null}}async function at(e,t){const r=t.fill,o=e.color;if(r?.type==="pattern"&&o&&e.type!==T){const c=await X(r.src,o.toCss(!0));r.src=c,t.fill=r}}async function nt(e,t,r,o){if(!("font"in e)||!e.font||t.shape.type!=="text")return;try{await V(e.font)}catch{}const{width:c,height:s}=k(o);if(!/[\uE600-\uE6FF]/.test(t.shape.text)){const{width:m,height:l,x:a,y:h}=q(t.shape.text,{weight:t.font?.weight,size:t.font?.size,family:t.font?.family});r[0]=c??m,r[1]=s??l,t.shape.x=a,t.shape.y=h;let u="angle"in e?e.angle:null;if(o?.rotation!=null&&(u=(u??0)+o.rotation),u){const d=u*(Math.PI/180),i=Math.abs(Math.sin(d)),n=Math.abs(Math.cos(d));r[1]=r[0]*i+r[1]*n}}}function lt(e,t,r,o,c){if(e.haloColor!=null&&e.haloSize!=null){c.masking??=r.map(()=>[]);const s=x(e.haloSize);o[0]+=s,o[1]+=s,r.unshift([{...t,fill:null,stroke:{color:e.haloColor,width:2*s,join:"round",cap:"round"}}]),c.masking.unshift([{shape:{type:"rect",x:0,y:0,width:o[0]+2*$,height:o[1]+2*$},fill:[255,255,255],stroke:null},{...t,fill:[0,0,0,0],stroke:null}])}e.backgroundColor==null&&e.borderLineColor==null||(o[0]+=2*$,o[1]+=2*$,r.unshift([{shape:{type:"rect",x:0,y:0,width:o[0],height:o[1]},fill:e.backgroundColor,stroke:{color:e.borderLineColor,width:x(e.borderLineSize)}}]),c.masking?.unshift([]))}function D(e,t){return e>t?"dark":"light"}function rt(e,t){const r=typeof t?.size=="number"?t?.size:null,o=r!=null?x(r):null,c=t?.maxSize!=null?x(t.maxSize):null;let s="angle"in e?e.angle:null;t?.rotation!=null&&(s=(s??0)+t.rotation);const m=Z(e);let l=E(e);st(e,245)!=="dark"||t?.ignoreWhiteSymbols||(l={width:.75,...l,color:"#bdc3c7"});let a=null;const h={shape:null,fill:m,stroke:l,offset:[0,0]};l?.width&&(l.width=Math.min(l.width,it));const u=l?.width||0;let d=t?.size!=null&&(t?.scale==null||t?.scale),i=0,n=0,S=!1;switch(e.type){case J:{const f=e.style,{width:g,height:p}=k(t);let b=g===p&&g!=null?g:o??Math.min(x(e.size),c||z);if(t?.useMarkerSymbolSize===!0&&g!==null&&p!==null){const y=Math.min(x(e.size),c||z);b=y>g&&y>p?Math.min(g,p):y}switch(i=b,n=b,f){case"circle":h.shape={type:"circle",cx:0,cy:0,r:.5*b},d||(i+=u,n+=u);break;case"cross":h.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[i,.5*n]},{command:"M",values:[.5*i,0]},{command:"L",values:[.5*i,n]}]};break;case"diamond":h.shape={type:"path",path:[{command:"M",values:[0,.5*n]},{command:"L",values:[.5*i,0]},{command:"L",values:[i,.5*n]},{command:"L",values:[.5*i,n]},{command:"Z",values:[]}]},d||(i+=u,n+=u);break;case"square":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,0]},{command:"L",values:[i,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},d||(i+=u,n+=u),s&&(S=!0);break;case"triangle":h.shape={type:"path",path:[{command:"M",values:[.5*i,0]},{command:"L",values:[i,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]},d||(i+=u,n+=u),s&&(S=!0);break;case"x":h.shape={type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,n]},{command:"M",values:[i,0]},{command:"L",values:[0,n]}]},s&&(S=!0);break;case"path":h.shape={type:"path",path:e.path||""},d||(i+=u,n+=u),s&&(S=!0),d=!0}break}case _:{const{width:f,height:g}=k(t),p=W(l).reduce((v,M)=>v+M,0),b=p&&Math.ceil(O/p),y=g??o??u,w=f??(p*b||O);if(d=!0,t?.geometry?.type==="polyline"&&t?.geometry?.extent){i=w,n=g??i;const v=1e3,M=.15*v;a=[i,n],n=a[0]>a[1]?v*a[1]/a[0]:v,i=a[0]>a[1]?v:v*a[0]/a[1],l?.width&&(l.width=l.width*v/(a[1]>a[0]?a[1]:a[0]),l.width>M&&(l.width=M)),h.shape={type:"path",path:A(t.geometry,i,n)}}else i=t?.maxSize!=null?Math.min(w,t.maxSize):w,n=y,l&&(l.width=y),h.shape={type:"path",path:[{command:"M",values:[y/2,n/2]},{command:"L",values:[i-y/2,n/2]}]};break}case T:case Y:{const f=typeof t?.symbolConfig=="object"&&!!t?.symbolConfig?.isSquareFill,{width:g,height:p}=k(t);i=!f&&g!==p||g==null?o??et:g,n=!f&&g!==p||p==null?i:p,d||(i+=u,n+=u),d=!0,t?.geometry?.extent&&t?.geometry?.type==="polygon"?(a=[i,n],n=a[0]>a[1]?1e3*a[1]/a[0]:1e3,i=a[0]>a[1]?1e3:1e3*a[0]/a[1],h.shape={type:"path",path:A(t.geometry,i,n)}):h.shape=f?{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[i,0]},{command:"L",values:[i,n]},{command:"L",values:[0,n]},{command:"L",values:[0,0]},{command:"Z",values:[]}]}:G.fill[0];break}case K:{const f=Math.min(x(e.width),c||z),g=Math.min(x(e.height),c||z),{width:p,height:b}=k(t),y=p===b&&p!=null?p:o??Math.max(f,g),w=e.width/e.height;i=w<=1?Math.ceil(y*w):y,n=w<=1?y:Math.ceil(y/w),h.shape={type:"image",x:-Math.round(i/2),y:-Math.round(n/2),width:i,height:n,src:e.url||""},s&&(S=!0);break}case U:{const f=e,g=t?.overrideText||f.text||tt,p=f.font,{width:b,height:y}=k(t),w=y??o??Math.min(x(p.size),c||z),{width:v,height:M}=q(g,{weight:p.weight,size:w,family:p.family}),L=/[\uE600-\uE6FF]/.test(g);i=b??(L?w:v),n=L?w:M;let B=.5*(L?w:M);L&&(B+=5),h.shape={type:"text",text:g,x:f.xoffset||0,y:f.yoffset||B,align:"middle",alignBaseline:f.verticalAlignment,decoration:p&&p.decoration,rotated:f.rotated,kerning:f.kerning},h.font=p&&{size:w,style:p.style,decoration:p.decoration,weight:p.weight,family:p.family};break}}return{shapeDescriptor:h,size:[i,n],outputSize:a,renderOptions:{node:t?.node,scale:d,opacity:t?.opacity,rotations:[s],useRotationSize:S,effectView:t?.effectView,ariaLabel:t?.ariaLabel}}}async function oe(e,t){const{shapeDescriptor:r,size:o,renderOptions:c,outputSize:s}=rt(e,t);if(!r.shape)throw new N("symbolPreview: renderPreviewHTML2D","symbol not supported.");await at(e,r),await nt(e,r,o,t);const m=[[r]];if(typeof t?.symbolConfig=="object"&&t?.symbolConfig?.applyColorModulation){const a=.6*o[0];m.unshift([{...r,offset:[-a,0],fill:F(r.fill,-.3)}]),m.push([{...r,offset:[a,0],fill:F(r.fill,.3)}]),o[0]+=2*a,c.scale=!1}e.type==="text"&&lt(e,r,m,o,c);const l=H(m,o,c);if(s&&l){const a=l.nodeName.toLowerCase()==="img"?l:l.firstChild;a.nodeName.toLowerCase()==="svg"&&a.setAttribute("viewBox",`0 0 ${o[0].toString()} ${o[1].toString()}`),a.setAttribute("width",s[0].toString()),a.setAttribute("height",s[1].toString()),s.length>2&&(a.style.setProperty("padding-left",s[2]?.toString()+"px"),a.style.setProperty("padding-right",s[2]?.toString()+"px"),a.style.setProperty("padding-top",s[3]?.toString()+"px"),a.style.setProperty("padding-bottom",s[3]?.toString()+"px"),a.style.setProperty("box-sizing","border-box"))}return l}function st(e,t=R){const r=Z(e),o=E(e),c=!r||"type"in r?null:new P(r),s=o?.color?new P(o?.color):null,m=c?D(j(c),t):null,l=s?D(j(s),t):null;return l?m?m===l?m:t>=R?"light":"dark":l:m}export{st as getContrastingBackgroundTheme,rt as getRenderSymbolParameters,oe as previewSymbol2D};
