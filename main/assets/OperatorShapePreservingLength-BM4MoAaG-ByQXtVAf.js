import{w as Y,x as I,n as $,y as k,g as O,A as Q,L as W,P as Z,D as J,a as K,d as R,f as ee,c as te,E as se,b as S,F as C,G as ne,H as oe}from"./ProjectionTransformation-BocI5WO--BZseuXwW.js";function j(){return{m_pGcs:new S,m_xyz:new C,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:ae,setLength:re,assign:ie}}function ae(i,e,t,n){this.m_factor=i,this.m_pGcs.assign(e),this.m_xyz.assign(n),this.m_geoLength=t}function re(i){this.m_geoLength=i}function ie(i){this.m_pGcs.assign(i.m_pGcs),this.m_xyz.assign(i.m_xyz),this.m_factor=i.m_factor,this.m_geoLength=i.m_geoLength}class ce{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,n){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,n,u,s){if(e.hasNonLinearSegments()&&(e=new Y().execute(e,0,t.getTolerance(0),0,s)),t.isPannable()){let m=90,a=-90;if(n.getUnit().getUnitToBaseFactor()===1&&(m*=Math.PI/180,a*=Math.PI/180),t.getCoordinateSystemType()===2){let _=null;const o=[0,0,0,0];_=t.getPECoordSys(),o[0]=0,o[1]=m,o[2]=0,o[3]=a,I.geogToProj(_,2,o),m=o[1],a=o[3]}const c=new $;e.queryEnvelope(c),c.ymin=a,c.ymax=m,e=new k().execute(e,c,t,s)}else{const m=t.getPCSHorizon();(e=new O().execute(e,m,t,s))===m&&(e=e.clone())}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,n,u,1,s)}_ExecuteIterativeApproach(e,t,n,u,s,m){const a=ne();n.querySpheroidData(a);const c=a.majorSemiAxis,_=a.e2,o=n.getUnit().getUnitToBaseFactor(),b=40,N=Q(j,b),w=W(b,Number.NaN),f=j(),g=j();let y;const r=[0,0,0,0],U=t.getPECoordSys(),E=new S,L=new S,p=new S,x=new S,d=new S;let V=0;const v=e.querySegmentIterator();for(;v.nextPath();)for(;v.hasNextSegment();){const D=v.nextSegment();E.assign(D.getStartXY()),L.assign(D.getEndXY()),t.getCoordinateSystemType()===2?(r[0]=E.x,r[1]=E.y,r[2]=L.x,r[3]=L.y,I.projToGeog(U,2,r),p.x=r[0]*o,p.y=r[1]*o,x.x=r[2]*o,x.y=r[3]*o):(p.setCoordsPoint2D(E),x.setCoordsPoint2D(L),p.scale(o),x.scale(o));const z=new C,A=new C;M(c,_,p,z),M(c,_,x,A);let l=T(c,z,A);f.setValues(0,p,Number.NaN,z),g.setValues(1,x,l,A),y=s,N[0].assign(g),w[0]=s;let h=0;for(;;){h>128&&oe("iterations exceeded");const q=.5*(f.m_factor+g.m_factor),F=D.getCoord2D(q);t.getCoordinateSystemType()===2?(r[0]=F.x,r[1]=F.y,I.projToGeog(U,1,r),d.x=r[0]*o,d.y=r[1]*o):(d.setCoordsPoint2D(F),d.scale(o)),p.setCoordsPoint2D(f.m_pGcs),x.setCoordsPoint2D(g.m_pGcs);const G=new C;M(c,_,d,G);const B=T(c,f.m_xyz,G),X=T(c,g.m_xyz,G);l=g.m_geoLength,Number.isNaN(l)&&(l=T(c,f.m_xyz,g.m_xyz));const P=B+X,H=y===s&&P>=20&&Math.abs(P-l)>1e-8*(l+P);if(h+2<b&&(H||Math.abs(P-l)>0&&y>0))g.setLength(X),N[h].assign(g),g.setValues(q,d,B,G),N[++h].assign(g),H?(y=s,w[h]=s):(y--,w[h-1]=y,w[h]=y);else{if(V+=P,h===0)break;f.assign(g),g.assign(N[--h]),y=w[h]}}}return V}execute(e,t,n){if(t&&t.getCoordinateSystemType()!==0||Z(""),e.isEmpty()||e.getDimension()<1)return 0;let u=null;const s=t.getGCS();s!==t&&(u=J(t,s,null));const m=e.getGeometryType();if(m===K.enumEnvelope){const a=new R;return a.addEnvelope(e,!1),this._ExecuteShapePreservingLength(a,t,s,u,n)}if(ee(m)){const a=new te;return a.addSegment(e,!0),this._ExecuteShapePreservingLength(a,t,s,u,n)}return this._ExecuteShapePreservingLength(e,t,s,u,n)}}function M(i,e,t,n){n.assign(se(i,e,t))}function T(i,e,t){const n=i,u=new C;u.setSub(e,t);const s=u.length();return 2*n*Math.asin(s/(2*n))}export{ce as g};
