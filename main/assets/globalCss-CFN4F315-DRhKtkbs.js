import{a5 as S,v as l,I as d,t as k,df as g,ct as H,b9 as A,a8 as D,dA as x,dB as R,dC as y}from"./main-D7vwjMDX.js";import{r as P}from"./Queue-B8H6jIv7-oUuyYSR9.js";import{o as N}from"./signal-DxzURL18-CpTU2B0U.js";import{m as O}from"./Version-BTMwSXf1-pRbtbwqb.js";let f=class{constructor(t,e){this.min=t,this.max=e,this.range=e-t}normalize(t,e=0,i=!1){return E(this.range,this.min,this.max,t,e,i)}clamp(t,e=0){return H(t-e,this.min,this.max)+e}monotonic(t,e,i){return t<e?e:e+v(this.range,t-e,i)}minimalMonotonic(t,e,i){return E(this.range,t,t+this.range,e,i)}center(t,e,i){return e=this.monotonic(t,e,i),this.normalize((t+e)/2,i)}diff(t,e,i){return this.monotonic(t,e,i)-t}shortestSignedDiff(t,e){t=this.normalize(t);const i=(e=this.normalize(e))-t,n=e<t?this.minimalMonotonic(t,e)-t:e-this.minimalMonotonic(e,t);return Math.abs(i)<Math.abs(n)?i:n}contains(t,e,i){return e=this.minimalMonotonic(t,e),(i=this.minimalMonotonic(t,i))>t&&i<e}};function E(t,e,i,n,s=0,r=!1){return(n-=s)<e?n+=v(t,e-n):n>i&&(n-=v(t,n-i)),r&&n===i&&(n=e),n+s}function v(t,e,i=0){return Math.ceil((e-i)/t)*t+i}const ot=new f(0,2*Math.PI),at=new f(-Math.PI,Math.PI),ht=new f(0,360);function I(){return[1,0,0,1,0,0]}function K(t){return[t[0],t[1],t[2],t[3],t[4],t[5]]}function L(t,e,i,n,s,r){return[t,e,i,n,s,r]}function U(t,e){return new Float64Array(t,e,6)}const z=I();Object.freeze(Object.defineProperty({__proto__:null,IDENTITY:z,clone:K,create:I,createView:U,fromValues:L},Symbol.toStringTag,{value:"Module"}));var T,b,C;(function(t){t[t.USER=0]="USER",t[t.MANAGER=1]="MANAGER"})(T||(T={})),function(t){t[t.None=0]="None",t[t.Unfocused=1]="Unfocused",t[t.Focused=2]="Focused",t[t.Unselected=4]="Unselected",t[t.Selected=8]="Selected",t[t.All=15]="All"}(b||(b={})),function(t){t[t.None=0]="None",t[t.Custom1=16]="Custom1",t[t.Custom2=32]="Custom2",t[t.Custom3=64]="Custom3",t[t.Custom4=128]="Custom4",t[t.Custom5=256]="Custom5",t[t.Custom6=512]="Custom6",t[t.Custom7=1024]="Custom7",t[t.Custom8=2048]="Custom8",t[t.Custom9=4096]="Custom9",t[t.Custom10=8192]="Custom10",t[t.Custom11=16384]="Custom11",t[t.Custom12=32768]="Custom12",t[t.All=65520]="All"}(C||(C={}));let G=class{constructor(t,e=[]){this.eventType=t,this.keyModifiers=e}matches(t){if(t.type!==this.eventType)return!1;if(this.keyModifiers.length===0)return!0;const e=t.modifiers;for(const i of this.keyModifiers)if(!e.has(i))return!1;return!0}},w=class{constructor(t){this._manager=null,this._incoming={},this._outgoing={},this._incomingEventMatches=null,this._incomingEventTypes=null,this._outgoingEventTypes=null,this._hasSideEffects=t}get incomingEventMatches(){if(!this._incomingEventMatches){this._incomingEventMatches=[];for(const t in this._incoming){const e=this._incoming[t];for(const i of e)this._incomingEventMatches.push(i.match)}}return this._incomingEventMatches}get incomingEventTypes(){return this._incomingEventTypes||(this._incomingEventTypes=this.incomingEventMatches.map(t=>t.eventType)),this._incomingEventTypes}get outgoingEventTypes(){return this._outgoingEventTypes||(this._outgoingEventTypes=Object.keys(this._outgoing)),this._outgoingEventTypes}get hasSideEffects(){return this._hasSideEffects}get hasPendingInputs(){return!1}onInstall(t){this._manager||(t.setEventCallback(e=>this._handleEvent(e)),t.setUninstallCallback(()=>this._onUninstall()),this._manager=t)}onUninstall(){}registerIncoming(t,e,i){let n;typeof e=="function"?(i=e,n=[]):n=e||[];const s=typeof t=="string"?new G(t,n):t,r=()=>{this._incomingEventTypes=null,this._incomingEventMatches=null},o=p=>{const u=this._incoming[p.match.eventType];if(u){const M=u.indexOf(p);u.splice(M,1),r(),this._manager&&this._manager.updateDependencies()}},a=new q(s,i,{onPause:o,onRemove:o,onResume:p=>{const u=this._incoming[p.match.eventType];u&&!u.includes(p)&&(u.push(p),r(),this._manager&&this._manager.updateDependencies())}});let c=this._incoming[s.eventType];return c||(c=[],this._incoming[s.eventType]=c),c.push(a),r(),this._manager&&this._manager.updateDependencies(),a}registerOutgoing(t){if(this._outgoing[t])throw new Error("There is already a callback registered for this outgoing InputEvent: "+t);const e=new F(t,{onEmit:(i,n,s,r)=>{this._manager?.emit(i.eventType,n,s,r)},onRemove:i=>{delete this._outgoing[i.eventType],this._manager?.updateDependencies()}});return this._outgoing[t]=e,this._outgoingEventTypes=null,this._manager&&this._manager.updateDependencies(),e}startCapturingPointer(t){this._manager?.setPointerCapture(t,!0)}stopCapturingPointer(t){this._manager?.setPointerCapture(t,!1)}refreshHasPendingInputs(){this._manager?.refreshHasPendingInputs()}_onUninstall(){this._manager&&(this.onUninstall(),this._manager=null)}_handleEvent(t){const e=this._incoming[t.type];if(e){for(const i of e)if(i.match.matches(t)&&(i.callback?.(t),t.shouldStopPropagation()))break}}},q=class{constructor(t,e,i){this.match=t,this._callback=e,this._handler=i}pause(){this._handler.onPause(this)}resume(){this._handler.onResume(this)}remove(){this._handler.onRemove(this)}get callback(){return this._callback}},F=class{constructor(t,e){this.eventType=t,this._removed=!1,this._handler=e}emit(t,e,i){this._removed||this._handler.onEmit(this,t,e,i)}remove(){this._removed=!0,this._handler.onRemove(this)}};const j=S("mac")?"Meta":"Control",W=new Set(["Alt","Control","Meta","Shift","Ctrl","Primary"]),B=t=>W.has(t);let Y=class extends w{constructor(t){super(!0),this._onChange=t,this._value="mouse",this._x=null,this._y=null,this.registerIncoming("pointer-move",e=>this._update(e.data))}_update(t){const e=t.native.pointerType==="touch"?"touch":"mouse",{x:i,y:n}=t;e===this._value&&this._x===i&&this._y===n||(this._value=e,this._x=i,this._y=n,this._onChange(e,i,n))}},$=class extends w{get multiTouchActive(){return this._multiTouchActive.value}constructor(){super(!0),this._activeTouchPointerIds=new Set,this._multiTouchActive=N(!1),this._onPointerAdd=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.add(t.native.pointerId),this._update())},this._onPointerRemove=({data:t})=>{t.pointerType==="touch"&&(this._activeTouchPointerIds.delete(t.native.pointerId),this._update())},this.registerIncoming("pointer-down",this._onPointerAdd),this.registerIncoming("pointer-up",this._onPointerRemove),this.registerIncoming("pointer-capture-lost",this._onPointerRemove),this.registerIncoming("pointer-cancel",this._onPointerRemove)}_update(){this._multiTouchActive.value=this._activeTouchPointerIds.size>1}},V=class{constructor(t,e){this._owner=e,this._properties={},this._afterDispatchHandle=null;for(const i in t){const n=t[i],s=new x(n,void 0,void 0,2,2);this._properties[i]={pool:s,acquired:[]}}this._afterDispatchHandle=R(()=>this._release())}destroy(){this._afterDispatchHandle&&(this._afterDispatchHandle.remove(),this._afterDispatchHandle=null);for(const t in this._properties){const e=this._properties[t];for(const i of e.acquired)y(i)||e.pool.release(i);e.pool.destroy(),e.pool=null,e.acquired=null}this._properties=null,this._owner=null}get(t){const e=this._owner._get(t),i=this._properties[t];let n=i.pool.acquire();for(i.acquired.push(n);n===e;)i.acquired.push(n),n=i.pool.acquire();return n}_release(){for(const t in this._properties){const e=this._properties[t];let i=0;for(const n of e.acquired)y(n)?e.acquired[i++]=n:e.pool.release(n);e.acquired.length=i}}},h=class extends A{constructor(t){super(t),this._pointerCaptures=new Map,this._nameToGroup={},this._handlers=[],this._handlersPriority=[],this._currentPropagation=null,this._updateDependenciesAfterPropagation=!1,this._sourceEvents=new Set,this._keyModifiers=new Set,this._activeKeyModifiers=new Set,this._stoppedPropagationEventIds=new Set,this.primaryKey=j,this._latestPointerType="mouse",this._propertiesPool=new V({latestPointerLocation:Q},this),this.latestPointerLocation=null,this._paused=!1,this.test={timestamp:void 0,hasCurrentPropagation:()=>!!this._currentPropagation}}initialize(){this.eventSource.onEventReceived=this._onEventReceived.bind(this),this._installRecognizers()}destroy(){const t=Object.keys(this._nameToGroup);for(const e of t)this.uninstallHandlers(e);this.eventSource.destroy(),this._currentPropagation=null,this._propertiesPool.destroy()}get hasPendingInputs(){return this._handlers.some(t=>t.handler.hasPendingInputs)}get latestPointerType(){return this._latestPointerType}get multiTouchActive(){return this._multiTouchHandler.multiTouchActive}get updating(){return this.hasPendingInputs||this._paused}installHandlers(t,e,i=m.INTERNAL){if(this._nameToGroup[t]||e.length===0)return;const n={name:t,handlers:e.map(s=>({handler:s,active:!0,removed:!1,priorityIndex:0,groupPriority:i,eventCallback:null,uninstallCallback:null}))};this._nameToGroup[t]=n;for(let s=n.handlers.length-1;s>=0;s--){const r=n.handlers[s];this._handlers.push(r),r.handler.onInstall({updateDependencies:()=>{this.updateDependencies()},emit:(o,a,c,p,u)=>{this._emitInputEvent(r.priorityIndex+1,o,a,c,u,p)},setPointerCapture:(o,a)=>{this._setPointerCapture(n,r,o,a)},setEventCallback:o=>{r.eventCallback=o},setUninstallCallback:o=>{r.uninstallCallback=o},refreshHasPendingInputs:()=>{this.notifyChange("hasPendingInputs")}})}this.updateDependencies()}uninstallHandlers(t){const e=this._nameToGroup[t];e?(e.handlers.forEach(i=>{i.removed=!0,i.uninstallCallback?.()}),delete this._nameToGroup[t],this._currentPropagation?this._currentPropagation.needsHandlerGarbageCollect=!0:this._garbageCollectRemovedHandlers()):D.getLogger(this).error("There is no InputHandler group registered under the name `"+t+"`")}hasHandlers(t){return this._nameToGroup[t]!==void 0}isModifierKeyDown(t){return this._activeKeyModifiers.has(t)}updateDependencies(){if(this._currentPropagation)return void(this._updateDependenciesAfterPropagation=!0);this._updateDependenciesAfterPropagation=!1;const t=new Set,e=new Set;this._handlersPriority=[];for(let i=this._handlers.length-1;i>=0;i--){const n=this._handlers[i];n.priorityIndex=i,this._handlersPriority.push(n)}this._handlersPriority=this._sortHandlersPriority(this._handlersPriority);for(let i=this._handlersPriority.length-1;i>=0;i--){const n=this._handlersPriority[i];n.priorityIndex=i;let s=n.handler.hasSideEffects;if(!s){for(const r of n.handler.outgoingEventTypes)if(t.has(r)){s=!0;break}}if(s)for(const r of n.handler.incomingEventMatches){t.add(r.eventType);for(const o of r.keyModifiers)B(o)||e.add(o)}n.active=s}this._sourceEvents=t,this._keyModifiers=e,this._pointerCaptures.size>0&&this._sourceEvents.add("pointer-capture-lost"),this._keyModifiers.size>0&&(this._sourceEvents.add("key-down"),this._sourceEvents.add("key-up")),this.eventSource&&(this.eventSource.activeEvents=this._sourceEvents)}_setLatestPointer(t,e,i){this._latestPointerType=t;const n=this._get("latestPointerLocation");if(n==null||n.x!==e||n.y!==i){const s=this._propertiesPool.get("latestPointerLocation");s.x=e,s.y=i,this._set("latestPointerLocation",s)}}_onEventReceived(t,e){if(t==="pointer-capture-lost"){const s=e;this._pointerCaptures.delete(s.native.pointerId)}this._updateKeyModifiers(t,e);const i=this.test.timestamp!=null?this.test.timestamp:e.native?e.native.timestamp:void 0,n=e.native?e.native.cancelable:void 0;this._emitInputEventFromSource(t,e,i,n)}_updateKeyModifiers(t,e){if(!e)return;let i=!1;const n=()=>{i||(this._activeKeyModifiers=new Set(this._activeKeyModifiers),i=!0)},s=(o,a)=>{a&&!this._activeKeyModifiers.has(o)?(n(),this._activeKeyModifiers.add(o)):!a&&this._activeKeyModifiers.has(o)&&(n(),this._activeKeyModifiers.delete(o))};if(t==="key-down"||t==="key-up"){const o=e.key;this._keyModifiers.has(o)&&s(o,t==="key-down")}const r=e.native;s("Alt",!!r?.altKey),s("Control",!!r?.ctrlKey),s("Ctrl",!!r?.ctrlKey),s("Shift",!!r?.shiftKey),s("Meta",!!r?.metaKey),s("Primary",this._activeKeyModifiers.has(this.primaryKey))}_installRecognizers(){this._latestPointerHandler=new Y((t,e,i)=>this._setLatestPointer(t,e,i)),this._multiTouchHandler=new $,this.installHandlers("input-manager-logic",[this._latestPointerHandler,this._multiTouchHandler],m.ALWAYS),this.recognizers.length>0&&this.installHandlers("default",this.recognizers,m.INTERNAL)}_setPointerCapture(t,e,i,n){const s=t.name+"-"+e.priorityIndex,r=this._pointerCaptures.get(i.pointerId)||new Set;this._pointerCaptures.set(i.pointerId,r),n?(r.add(s),r.size===1&&this.eventSource&&this.eventSource.setPointerCapture(i,!0)):r.has(s)&&(r.delete(s),r.size===0&&(this._pointerCaptures.delete(i.pointerId),this.eventSource&&this.eventSource.setPointerCapture(i,!1)))}_garbageCollectRemovedHandlers(){this._handlers=this._handlers.filter(t=>!t.removed),this.updateDependencies()}_emitInputEventFromSource(t,e,i,n){this._emitInputEvent(0,t,e,i,n)}_emitInputEvent(t,e,i,n,s,r){const o=n!==void 0?n:this._currentPropagation?this._currentPropagation.timestamp:performance.now(),a=s!==void 0&&s,c={event:new X(e,i,o,r||this._activeKeyModifiers,a),priorityIndex:t};this._currentPropagation?this._currentPropagation.events.push(c):this._doNewPropagation(c)}_doNewPropagation(t){this._currentPropagation={events:new P,currentHandler:null,needsHandlerGarbageCollect:!1,timestamp:t.event.timestamp},this._currentPropagation.events.push(t),this._continuePropagation()}_continuePropagation(){this._paused=!1;const t=this._currentPropagation;if(t){for(;t.events.length>0;){const{event:e,priorityIndex:i}=t.events.pop(),n=e.data?.eventId;if(!(n!=null&&this._stoppedPropagationEventIds.has(n)))for(t.currentHandler=this._handlersPriority[i];t.currentHandler;){if(t.currentHandler.removed)t.needsHandlerGarbageCollect=!0;else{if(t.currentHandler.active&&!e.shouldStopPropagation()&&t.currentHandler.eventCallback?.(e),e.shouldStopPropagation()){n!=null&&this._stoppedPropagationEventIds.add(n);break}if(e.shouldPausePropagation(()=>this._continuePropagation()))return void this._pausePropagation({event:e,priorityIndex:t.currentHandler.priorityIndex+1})}t.currentHandler=this._handlersPriority[t.currentHandler.priorityIndex+1]}}t.needsHandlerGarbageCollect&&this._garbageCollectRemovedHandlers(),this.hasPendingInputs||this._stoppedPropagationEventIds.clear(),this._currentPropagation=null,this._updateDependenciesAfterPropagation&&this.updateDependencies()}}_pausePropagation(t){const e=new P;e.push(t);const i=this._currentPropagation;if(i){for(;i.events.length;)e.push(i.events.pop());i.events=e,i.currentHandler=null,this._paused=!0}}_compareHandlerPriority(t,e){if(t.handler.hasSideEffects!==e.handler.hasSideEffects)return t.handler.hasSideEffects?1:-1;if(t.groupPriority!==e.groupPriority)return t.groupPriority>e.groupPriority?-1:1;for(const i of t.handler.incomingEventMatches)for(const n of e.handler.incomingEventMatches){if(i.eventType!==n.eventType)continue;const s=i.keyModifiers.filter(r=>n.keyModifiers.includes(r));if(s.length===i.keyModifiers.length!=(s.length===n.keyModifiers.length))return i.keyModifiers.length>n.keyModifiers.length?-1:1}return t.priorityIndex>e.priorityIndex?-1:1}_sortHandlersPriority(t){const e=[];for(const i of t){let n=0;for(;n<e.length&&this._compareHandlerPriority(i,e[n])>=0;)n++;e.splice(n,0,i)}return e}get debug(){const t=e=>{const i=this._setPointerCapture;this._setPointerCapture=()=>{},e(),this._setPointerCapture=i};return{injectEvent:(e,i)=>{t(()=>this._onEventReceived(e,i))},disablePointerCapture:t}}};l([d({readOnly:!0})],h.prototype,"hasPendingInputs",null),l([d({constructOnly:!0})],h.prototype,"eventSource",void 0),l([d({constructOnly:!0})],h.prototype,"recognizers",void 0),l([d()],h.prototype,"_latestPointerType",void 0),l([d()],h.prototype,"latestPointerType",null),l([d()],h.prototype,"multiTouchActive",null),l([d({readOnly:!0})],h.prototype,"latestPointerLocation",void 0),l([d()],h.prototype,"_paused",void 0),l([d({readOnly:!0})],h.prototype,"updating",null),h=l([k("esri.views.input.InputManager")],h);class X{constructor(e,i,n,s,r){this.type=e,this.data=i,this.timestamp=n,this.modifiers=s,this.cancelable=r,this._propagationState=_.NONE,this._resumeCallback=null}stopPropagation(){this._propagationState|=_.STOPPED}shouldStopPropagation(){return!!(this._propagationState&_.STOPPED)}async(e){this._propagationState|=_.PAUSED;const i=(n,s)=>{this._propagationState&=~_.PAUSED;const r=this._resumeCallback;if(this._resumeCallback=null,r&&r(),s)throw n;return n};return(typeof e=="function"?e():e).then(n=>i(n,!1),n=>i(n,!0))}shouldPausePropagation(e){return!!(this._propagationState&_.PAUSED)&&(this._resumeCallback=e,!0)}preventDefault(){this.data.native.preventDefault()}}var _;(function(t){t[t.NONE=0]="NONE",t[t.STOPPED=1]="STOPPED",t[t.PAUSED=2]="PAUSED"})(_||(_={}));const m={ALWAYS:1,DEFAULT:0,TOOL:-1,WIDGET:-2,INTERNAL:-3};class J{}const Q=J;function Z(t){return g(t.x,t.y)}function tt(t,e){const i=(t instanceof HTMLElement?t:t.surface)?.getBoundingClientRect();return i?g(e.clientX-i.left,e.clientY-i.top):g(0,0)}function lt(t,e){return e instanceof Event?tt(t,e):Z(e)}function ct(t){if(t instanceof Event)return!0;if(typeof t=="object"&&"type"in t)switch(t.type){case"click":case"double-click":case"pointer-down":case"pointer-drag":case"pointer-enter":case"pointer-leave":case"pointer-up":case"pointer-move":case"immediate-click":case"immediate-double-click":case"hold":case"drag":case"mouse-wheel":return!0;default:return!1}return!1}class et extends O{constructor(e,i){super(e,i,"webmap")}}function ut(t){return t!=null&&typeof t=="object"&&"declaredClass"in t&&t.declaredClass==="esri.WebMap"}new et(2,33);const dt={anchor:"esri-widget__anchor",anchorDisabled:"esri-widget__anchor--disabled",button:"esri-button",buttonDisabled:"esri-button--disabled",buttonHalf:"esri-button--half",buttonSecondary:"esri-button--secondary",buttonSmall:"esri-button--small",buttonTertiary:"esri-button--tertiary",buttonThird:"esri-button--third",disabled:"esri-disabled",empty:"esri-widget__content--empty",emptyIllustration:"esri-widget__content-illustration--empty",heading:"esri-widget__heading",hidden:"esri-hidden",input:"esri-input",interactive:"esri-interactive",loader:"esri-widget__loader",loaderAnimation:"esri-widget__loader-animation",loaderText:"esri-widget__loader-text",menu:"esri-menu",menuHeader:"esri-menu__header",menuItem:"esri-menu__list-item",menuItemActive:"esri-menu__list-item--active",menuItemFocus:"esri-menu__list-item--focus",menuList:"esri-menu__list",panel:"esri-widget--panel",panelHeightOnly:"esri-widget--panel-height-only",primaryTick:"primary-tick",primaryTickAmPm:"primary-tick__ampm",primaryTickLabel:"primary-tick__label",rotating:"esri-rotating",secondaryTick:"secondary-tick",select:"esri-select",table:"esri-widget__table",widget:"esri-widget",widgetButton:"esri-widget--button",widgetButtonActive:"esri-widget--button-active",widgetDisabled:"esri-widget--disabled"};export{Z as A,tt as D,b as E,at as F,V as H,z as M,T as P,K as S,C as T,ht as W,ut as a,w as b,h as c,m as g,dt as h,j as k,f as m,ot as q,ct as r,lt as s,I as y};
