const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./ElevationQuery-DuUlMAmS-D4SqcfY_.js","./main-D7vwjMDX.js","./main-CUxMDcRh.css","./projection-m8vi7Cxv-CyI2jDkU.js","./TileKey-B_6qmYK--BtZdR-Xy.js","./layersCreator-Vp21VWYz-DI_-yG5T.js","./loadUtils-qPQbuxA4-CNm-ZkM5.js","./fetchService-Bp_4TwIU-Lh3ZeIyd.js","./associatedFeatureServiceUtils-DCapzd9d-BGJe-Txx.js","./PortalItem-CJetnHeq-o-aav5WN.js","./lazyLayerLoader-CEoVkyTx-D9tXPviG.js","./portalLayers-DhiK9wgY-D7hfq5H8.js","./portalItemUtils-DsrxEt4W-CwmflhO-.js","./styleUtils-DbPBpaXg-sXJw7KaF.js"])))=>i.map(i=>d[i]);
import{v as i,bz as D,I as l,t as c,Y as j,a3 as G,aa as E,R as H,a8 as p,aC as g,bH as $,cV as q,c as z,_ as w,H as L,z as x,U as V,S as O,bN as J,cW as Q,cX as W,a as Y,b9 as k,a1 as R,aQ as Z,cY as K,cZ as X,A as ee,a9 as B,ai as te,aG as re,as as se}from"./main-D7vwjMDX.js";import{F as f,a as M}from"./Basemap-DxWxjcEH-CddtD3Sh.js";import{y as ae}from"./loadAll-BIhJ1RSe-CGx7RnSl.js";import{f as I}from"./CollectionFlattener-9hYRBLDX-H-sAZSUK.js";import"./mat4f32-CiZjBg9k-CUm34GoR.js";import"./mat4-BFStKTjU-WrlKAspo.js";import{U as oe}from"./Layer-B8q-l4yV-BexM1eQl.js";import"./PortalItem-CJetnHeq-o-aav5WN.js";import"./intl-DLmy-Li5-l7mSy0H0.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./TimeExtent-gZaEUVeW-B8lK7hOc.js";var T;let m=T=class extends j{constructor(e){super(e),this.type="none"}clone(){return new T({type:this.type})}};i([D({none:"none",stayAbove:"stay-above"}),l({json:{write:{isRequired:!0}}})],m.prototype,"type",void 0),m=T=i([c("esri.ground.NavigationConstraint")],m);const ne=Symbol("GroundInstance");var F,C;let y=C=class extends j.JSONSupportMixin(G){constructor(e){super(e),this[F]=!0,this.opacity=1,this.surfaceColor=null,this.navigationConstraint=null,this.layers=new E;const t=s=>{s.parent&&s.parent!==this&&"remove"in s.parent&&s.parent.remove(s),s.parent=this,s.type!=="elevation"&&s.type!=="base-elevation"&&p.getLogger(this).error(`Layer '${s.title}, id:${s.id}' of type '${s.type}' is not supported as a ground layer and will therefore be ignored. Only layers of type 'elevation' are supported.`)},r=s=>{s.parent=null};this.addHandles([this.layers.on("after-add",s=>t(s.item)),this.layers.on("after-remove",s=>r(s.item))])}initialize(){this.when().catch(e=>{H(e)||p.getLogger(this).error("#load()","Failed to load ground",e)}),this.resourceInfo&&this.read(this.resourceInfo.data,this.resourceInfo.context)}destroy(){const e=this.layers.removeAll();for(const t of e)g(t);this.layers.destroy()}normalizeCtorArgs(e){return e&&"resourceInfo"in e&&(this._set("resourceInfo",e.resourceInfo),delete(e={...e}).resourceInfo),e}get layers(){return this._get("layers")}set layers(e){this._set("layers",$(e,this._get("layers")))}writeLayers(e,t,r,s){const o=[];e&&(s={...s,layerContainerType:"ground"},e.forEach(n=>{if("write"in n){const a={};q(n)().write(a,s)&&o.push(a)}else s?.messages&&s.messages.push(new z("layer:unsupported",`Layers (${n.title}, ${n.id}) of type '${n.declaredClass}' cannot be persisted in the ground`,{layer:n}))})),t.layers=o}load(e){return this.addResolvingPromise(this._loadFromSource(e)),Promise.resolve(this)}loadAll(){return ae(this,e=>{e(this.layers)})}async queryElevation(e,t){await this.load({signal:t?.signal});const{ElevationQuery:r}=await w(()=>import("./ElevationQuery-DuUlMAmS-D4SqcfY_.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url);L(t);const s=new r,o=this.layers.filter(N).toArray();return s.queryAll(o,e,t)}async createElevationSampler(e,t){await this.load({signal:t?.signal});const{ElevationQuery:r}=await w(()=>import("./ElevationQuery-DuUlMAmS-D4SqcfY_.js"),__vite__mapDeps([0,1,2,3,4]),import.meta.url);L(t);const s=new r,o=this.layers.filter(N).toArray();return s.createSamplerAll(o,e,t)}clone(){const e={opacity:this.opacity,surfaceColor:x(this.surfaceColor),navigationConstraint:x(this.navigationConstraint),layers:this.layers.slice()};return this.loaded&&(e.loadStatus="loaded"),new C({resourceInfo:this.resourceInfo}).set(e)}read(e,t){this.resourceInfo||this._set("resourceInfo",{data:e,context:t}),super.read(e,t)}_loadFromSource(e){const t=this.resourceInfo;return t?this._loadLayersFromJSON(t.data,t.context,e):Promise.resolve()}async _loadLayersFromJSON(e,t,r){const s=t?.origin||"web-scene",o=t?.portal||null,n=t?.url||null,{populateOperationalLayers:a}=await w(async()=>{const{populateOperationalLayers:v}=await import("./layersCreator-Vp21VWYz-DI_-yG5T.js");return{populateOperationalLayers:v}},__vite__mapDeps([5,1,2,6,7,8,9,10,11,12,3,13]),import.meta.url);L(r);const u=[];if(e.layers&&Array.isArray(e.layers)){const v={context:{origin:s,url:n,portal:o,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"};u.push(a(this.layers,e.layers,v))}await Promise.allSettled(u)}};function ie(e){return e&&"createElevationSampler"in e}function N(e){return e.type==="elevation"||ie(e)}F=ne,i([l({json:{read:!1,write:{isRequired:!0}}})],y.prototype,"layers",null),i([V("layers")],y.prototype,"writeLayers",null),i([l({readOnly:!0})],y.prototype,"resourceInfo",void 0),i([l({type:Number,nonNullable:!0,range:{min:0,max:1},json:{type:O,read:{reader:J,source:"transparency"},write:{writer:(e,t)=>{t.transparency=Q(e)},target:"transparency"}}})],y.prototype,"opacity",void 0),i([l({type:W,json:{type:[O],write:(e,t)=>{t.surfaceColor=e.toJSON().slice(0,3)}}})],y.prototype,"surfaceColor",void 0),i([l({type:m,json:{write:!0}})],y.prototype,"navigationConstraint",void 0),y=C=i([c("esri.Ground")],y);const b=y;function le(e){return new I({getCollections:()=>[e.tables,e.layers],getChildrenFunction:t=>{const r=[];return"tables"in t&&r.push(t.tables),"layers"in t&&r.push(t.layers),r},itemFilterFunction:t=>{const r=t.parent;return!!r&&"tables"in r&&r.tables.includes(t)}})}function xe(e){for(const t of e.values())t?.destroy();e.clear()}function S(e,t,r){let s,o;if(e)for(let n=0,a=e.length;n<a;n++){if(s=e.at(n),s?.[t]===r)return s;if(s?.type==="group"&&(o=S(s.layers,t,r),o))return o}}const de=e=>{let t=class extends e{constructor(...r){super(...r),this.layers=new E;const s=a=>{a.parent&&"remove"in a.parent&&a.parent.remove(a)},o=a=>{a.parent=this,this.layerAdded(a),a.type!=="elevation"&&a.type!=="base-elevation"||p.getLogger(this).error(`Layer 'title:${a.title}, id:${a.id}' of type '${a.type}' is not supported as an operational layer and will therefore be ignored.`)},n=a=>{a.parent=null,this.layerRemoved(a)};this.addHandles([this.layers.on("before-add",a=>{if(a.item===this)return a.preventDefault(),void p.getLogger(this).error("#add()","Cannot add layer to itself.");s(a.item)}),this.layers.on("after-add",a=>o(a.item)),this.layers.on("after-remove",a=>n(a.item))])}destroy(){const r=this.layers.toArray();for(const s of r)s.destroy();this.layers.destroy()}set layers(r){this._set("layers",$(r,this._get("layers")))}add(r,s){const o=this.layers;if(s=o.getNextIndex(s),r instanceof oe){const n=r;n.parent===this?this.reorder(n,s):o.add(n,s)}else Z(r)?r.then(n=>{this.destroyed||this.add(n,s)}):p.getLogger(this).error("#add()","The item being added is not a Layer or a Promise that resolves to a Layer.")}addMany(r,s){const o=this.layers;let n=o.getNextIndex(s);r.slice().forEach(a=>{a.parent!==this?(o.add(a,n),n+=1):this.reorder(a,n)})}findLayerById(r){return S(this.layers,"id",r)}findLayerByUid(r){return S(this.layers,"uid",r)}remove(r){return this.layers.remove(r)}removeMany(r){return this.layers.removeMany(r)}removeAll(){return this.layers.removeAll()}reorder(r,s){return this.layers.reorder(r,s)}layerAdded(r){}layerRemoved(r){}};return i([l()],t.prototype,"layers",null),t=i([c("esri.support.LayersMixin")],t),t},ye=new Set(["feature","subtype-group"]);function A(e,t,r){if(e)for(let s=0,o=e.length;s<o;s++){const n=e.at(s);if(n[t]===r)return n;if(n?.type==="group"){const a=A(n.tables,t,r);if(a)return a}}}const pe=e=>{let t=class extends e{constructor(...r){super(...r),this.tables=new E,this.addHandles([this.tables.on("after-add",s=>{const o=s.item;o.parent&&o.parent!==this&&"tables"in o.parent&&o.parent.tables.remove(o),o.parent=this,ye.has(o.type)||p.getLogger(this).error(`Layer 'title:${o.title}, id:${o.id}' of type '${o.type}' is not supported as a table and will therefore be ignored.`)}),this.tables.on("after-remove",s=>{s.item.parent=null})])}destroy(){const r=this.tables.toArray();for(const s of r)s.destroy();this.tables.destroy()}set tables(r){this._set("tables",$(r,this._get("tables")))}findTableById(r){return A(this.tables,"id",r)}findTableByUid(r){return A(this.tables,"uid",r)}};return i([l()],t.prototype,"tables",null),t=i([c("esri.support.TablesMixin")],t),t},h=new WeakMap;function P(e){return!e.destroyed&&(h.has(e)||e.addHandles([te(()=>{const t=e.parent;return!(!t||!("type"in t))&&(t.type==="catalog-dynamic-group"||P(t))},t=>h.set(e,t),re),se(()=>h.delete(e))]),h.get(e))}function ue(e){return typeof e=="object"&&e!=null&&"loaded"in e&&e.loaded===!0&&"type"in e}function ce(e){return!(!ue(e)||!K(e)?.operations?.supportsEditing||"editingEnabled"in e&&!X(e)||P(e))}const _=()=>p.getLogger("esri.support.basemapUtils");function he(){return{}}function fe(e){for(const t in e){const r=e[t];g(r),delete e[t]}}function me(e,t){let r;if(typeof e=="string"){const s=e in M,o=!s&&e.includes("/");if(!s&&!o){if(ee.apiKey)_().warn(`Unable to find basemap definition for: ${e}. See available styles at https://developers.arcgis.com/rest/basemap-styles/`);else{const n=Object.entries(M).filter(([a,u])=>u.classic||u.is3d).map(([a])=>`"${a}"`).sort().join(", ");_().warn(`Unable to find basemap definition for: ${e}. Try one of these: ${n}`)}return null}t&&(r=t[e]),r||(r=s?f.fromId(e):new f({style:{id:e}}),t&&(t[e]=r))}else r=B(f,e);return r?.destroyed&&(_().warn("The provided basemap is already destroyed",{basemap:r}),r=null),r}const U={"world-elevation":{id:"worldElevation",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"},"world-topobathymetry":{id:"worldTopoBathymetry",url:"//elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/TopoBathy3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}};function ge(e){let t=null;if(typeof e=="string")if(e in U){const r=U[e];t=new b({resourceInfo:{data:{layers:[r]}}})}else p.getLogger("esri.support.groundUtils").warn(`Unable to find ground definition for: ${e}. Try "world-elevation"`);else t=B(b,e);return t}let d=class extends pe(de(Y.EventedMixin(k))){constructor(e){super(e),this.allLayers=new I({getCollections:()=>[this.basemap?.baseLayers,this.ground?.layers,this.layers,this.basemap?.referenceLayers],getChildrenFunction:t=>"layers"in t?t.layers:null}),this.allTables=le(this),this.basemap=null,this.editableLayers=new I({getCollections:()=>[this.allLayers],itemFilterFunction:ce}),this.ground=new b,this._basemapCache=he()}destroy(){fe(this._basemapCache),this._basemapCache=null,this.allLayers.destroy(),this.allTables.destroy(),this.editableLayers.destroy(),this.basemap=g(this.basemap),g(this.ground),this._set("ground",null)}castBasemap(e){return me(e,this._basemapCache)}castGround(e){return ge(e)??this._get("ground")}findLayerById(e){return this.allLayers.find(t=>t.id===e)}findTableById(e){return this.allTables.find(t=>t.id===e)}};i([l({readOnly:!0,dependsOn:[]})],d.prototype,"allLayers",void 0),i([l({readOnly:!0})],d.prototype,"allTables",void 0),i([l({type:f,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],d.prototype,"basemap",void 0),i([R("basemap")],d.prototype,"castBasemap",null),i([l({readOnly:!0})],d.prototype,"editableLayers",void 0),i([l({type:b,nonNullable:!0})],d.prototype,"ground",void 0),i([R("ground")],d.prototype,"castGround",null),i([l()],d.prototype,"undoRedo",void 0),d=i([c("esri.Map")],d);const be=d,Oe=Object.freeze(Object.defineProperty({__proto__:null,default:be},Symbol.toStringTag,{value:"Module"}));export{be as L,Oe as M,de as a,pe as l,xe as n,le as t};
