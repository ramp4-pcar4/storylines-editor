import{v as l,I as h,t as d,b9 as m,a5 as T,a8 as v,z as _}from"./main-DK5A1thH.js";import{c as O,C as w,O as E}from"./parser-hXQyB-Qx-BrGynOq8.js";const u=-1;let f=class extends m{constructor(t){super(t),this._from=null,this._to=null,this._final=null,this._current=[],this._time=0,this.duration=T("mapview-transitions-duration"),this.effects=[]}set effect(t){if(this._get("effect")!==(t=t||"")){this._set("effect",t);try{this._transitionTo(p(t))}catch(e){this._transitionTo([]),v.getLogger(this).warn("Invalid Effect",{effect:t,error:e})}}}get final(){return this._final}get hasEffects(){return this.transitioning||!!this.effects.length}set scale(t){this._updateForScale(t)}get transitioning(){return this._to!==null}canTransitionTo(t){try{return this.scale>0&&g(this._current,p(t),this.scale)}catch{return!1}}transitionStep(t,e){this._applyTimeTransition(t),this._updateForScale(e)}endTransition(){this._applyTimeTransition(this.duration)}_transitionTo(t){this.scale>0&&g(this._current,t,this.scale)?(this._final=t,this._to=_(t),F(this._current,this._to,this.scale),this._from=_(this._current),this._time=0):(this._from=this._to=this._final=null,this._current=t),this._set("effects",this._current[0]?_(this._current[0].effects):[])}_applyTimeTransition(t){if(!(this._to&&this._from&&this._current&&this._final))return;this._time+=t;const e=Math.min(1,this._time/this.duration);for(let n=0;n<this._current.length;n++){const c=this._current[n],r=this._from[n],a=this._to[n];c.scale=S(r.scale,a.scale,e);for(let i=0;i<c.effects.length;i++){const o=c.effects[i],s=r.effects[i],y=a.effects[i];o.interpolate(s,y,e)}}e===1&&(this._current=this._final,this._set("effects",this._current[0]?_(this._current[0].effects):[]),this._from=this._to=this._final=null)}_updateForScale(t){if(this._set("scale",t),this._current.length===0)return;const e=this._current,n=this._current.length-1;let c,r,a=1;if(e.length===1||t>=e[0].scale)r=c=e[0].effects;else if(t<=e[n].scale)r=c=e[n].effects;else for(let i=0;i<n;i++){const o=e[i],s=e[i+1];if(o.scale>=t&&s.scale<=t){a=(t-o.scale)/(s.scale-o.scale),c=o.effects,r=s.effects;break}}for(let i=0;i<this.effects.length;i++)this.effects[i].interpolate(c[i],r[i],a)}};function p(t){const e=O(t)||[];return x(e)?[{scale:u,effects:e}]:e}function g(t,e,n){return!t[0]?.effects||!e[0]?.effects?!0:!((t[0]?.scale===u||e[0]?.scale===u)&&(t.length>1||e.length>1)&&n<=0)&&w(t[0].effects,e[0].effects)}function F(t,e,n){const c=t.length>e.length?t:e,r=t.length>e.length?e:t,a=r[r.length-1],i=a?.scale??n,o=a?.effects??[];for(let s=r.length;s<c.length;s++)r.push({scale:i,effects:[...o]});for(let s=0;s<c.length;s++)r[s].scale=r[s].scale===u?n:r[s].scale,c[s].scale=c[s].scale===u?n:c[s].scale,E(r[s].effects,c[s].effects)}function S(t,e,n){return t+(e-t)*n}function x(t){const e=t[0];return!!e&&"type"in e}l([h()],f.prototype,"_to",void 0),l([h()],f.prototype,"duration",void 0),l([h({value:""})],f.prototype,"effect",null),l([h({readOnly:!0})],f.prototype,"effects",void 0),l([h({readOnly:!0})],f.prototype,"final",null),l([h({readOnly:!0})],f.prototype,"hasEffects",null),l([h({value:0})],f.prototype,"scale",null),l([h({readOnly:!0})],f.prototype,"transitioning",null),f=l([d("esri.layers.effects.EffectView")],f);export{f};
