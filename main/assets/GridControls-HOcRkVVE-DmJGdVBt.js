const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./index-CXn0Qeo5-KNnoJ3TR.js","./index-D0o7KJz6-D7Mu5XBh.js","./jsxFactory-Cua8zWVZ-Bm1Ev3dC.js","./main-DCA-OWQn.js","./main-D4BKErAX.css","./intl-BAA1onnp-DS6qbKRl.js","./uuid-Dj9mdEVg-BaKSCiyT.js","./sanitizerUtils-B1yRmbO2-B7KG_jBT.js","./guid-Dls486Er-CBh637k4.js","./useT9n-Cp7CFBMO-2Bs3Lbew.js","./index-DV38aJMs-Cr0HwlBq.js","./dom-PjyVZjPa-gk-HfDuw.js","./observers-CJ7vGAr1-DcxN4unf.js","./keyed-B9HAtbdo-jRzbKGPY.js","./ref-XMc4F1eh-wCTkBa1W.js","./interactive-EVx-Nhoa-D7MsQbtV.js","./component-DGkKmsFn-BLxaTxSY.js","./index-B4aE1io5-D-orcoay.js","./index-Btp8sfgk-C29yYrYo.js","./floating-ui-C_auppeo-BZMJaqYU.js","./debounce-B9WUP9Xk-BvexrlwN.js","./openCloseComponent-CAhwMrL1-Cgv5I_nr.js","./static-Dm6M7dSg-CbVkMOZy.js","./FloatingArrow-BFsffpOS-CrVxyinX.js","./key-CZySMiwx-kmS7VeUz.js","./index-BCOMKfi--e1tX5t5I.js","./array-C6Ny8gbM-C9M-r-JU.js","./index-DO-jU4VZ-BBmjxJ2U.js","./index-CjNVVdGY-CxL3aLd4.js","./label-DeyAgFGa-ISgIDhzT.js","./index-CsuaBzKX-ekjpAr7g.js","./index-CNL4JQYq-DEGPcBiy.js","./global-BCP_CA6c-DEpeqMUQ.js","./index-SxXZaKTz-BWVA_4bo.js","./customElement-DL8inR2X-B8rOLiAw.js","./input-BpGQpkEK-uFT9Dobd.js","./form-D_5VLLzu-Br-3bF0p.js","./Validation-DwCZur7y-B_UAUVUF.js","./index-DEuHuu_F-BxA4sv81.js","./index-CK6nlFfs-Be4yC8ld.js"])))=>i.map(i=>d[i]);
import{v as n,S as o,bf as lt,n as M,ar as E,K as ct,ai as pt,a1 as R,ak as $,df as j,l as L,a6 as Y,ad as v,eJ as J,eu as dt,X as ht,ac as Z,h as G,ap as mt,a$ as ut,ll as Q,b2 as gt,a2 as vt,_ as S,aJ as _t}from"./main-DCA-OWQn.js";import"./intl-BAA1onnp-DS6qbKRl.js";import{e as yt}from"./unitFormatUtils-FAypDaT5-BFUaj0yv.js";import{V as U,K as a,W as ft,P as bt,_ as wt}from"./jsxFactory-Cua8zWVZ-Bm1Ev3dC.js";import{V as W,g as St,n as Ct,f as B}from"./utils-Dd8gTonD-Dg7nIlJR.js";import{r as tt,n as Mt,c as I}from"./index-kib5quT9-5gGoOVox.js";import{U as xt,O as et,k as Pt}from"./projectionUtils-B-CplN3q-BNkDhpWU.js";import{f as It}from"./scaleUtils-Br-smv3A-CXPwkKeY.js";import{s as N}from"./projectVectorToVector-DcyiGOWJ-Cml5tzYZ.js";import{i as Tt,a as Rt,l as Et,r as Lt,I as Ot,p as kt,d as $t,u as Gt,c as At}from"./SketchTooltipInfo-CkyYTifq-BvG3AW9Y.js";import{j as Dt,L as Vt,x as jt,U as Ut}from"./gridUtils-ZkKc2j-y-3egt0oKX.js";import{DrawGraphicTool2D as Wt}from"./editingTools-7dqMzBcg-KedjIaz_.js";import{d as q,i as Bt,O as Nt,P as qt}from"./SketchViewModel-B0qFHK0t-DQ0MbNLB.js";import{n as Ft}from"./TextOverlayItem-BwTcOTWP-Cm2-hA7o.js";import{x as zt}from"./number-mnL_JN3f-DNGzeF7U.js";import{b as Ht}from"./substitute-B3zxyWVi-ChmjZmFM.js";import"./ByteSizeUnit-DL8UhsB0-B2-AmVRx.js";import"./Cyclical-DgD7_U1C-pgwwDWfS.js";import"./quantityUtils-B1Ov7DZK-Uh9Fu0hY.js";import"./uuid-Dj9mdEVg-BaKSCiyT.js";import"./sanitizerUtils-B1yRmbO2-B7KG_jBT.js";import"./Queue-DV3gpSdl-BtNURUqz.js";import"./Version-CnwD6MZa-DSxTmAWA.js";import"./draw-store-DnCf4IRI-DvvQNsGO.js";import"./GraphicsLayer-BiEC2-gS-BILNnr7q.js";import"./GraphicsCollection-uWAVmks7-D0F1sgr_.js";import"./Layer-DvVVmz9x-BsZCwYCX.js";import"./TimeExtent-Cf2Pienb-D5UQq94-.js";import"./BlendLayer-DjW_5k0v-CHSf0emy.js";import"./layerContainerType-ChWdCT09-G5sdAsSy.js";import"./jsonUtils-BwLwuQj7-CvwJgom9.js";import"./parser-CWccHtwJ-C1GfdNx6.js";import"./mat4f32-BdRMyjXW-CWt6U0BP.js";import"./mat4-OOmHNWi7-BCiI9ZK-.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./ScaleRangeLayer-x42fwED3-pp-wSF1_.js";import"./ElevationInfo-DE5to86a-CoD3DKWI.js";import"./lengthUtils-C61nRlXw-X8iT8Y4e.js";import"./layerViewUtils-DLIaYA64-CkLxPK2q.js";import"./asyncUtils-BPUlNCrX-Dqd0v9w6.js";import"./drapedUtils-DARF9dbf-ClKDW1d3.js";import"./utils-C0LvbFCo-RMQaTNpt.js";import"./widget-p2YDjs4S-CWURnSYr.js";import"./UpdatingHandles-Bd2FQ26N-1NU4dKIw.js";import"./elevationInfoUtils-Ccn2Wfoe-Bsa7gXqf.js";import"./editableLayers-DFUBlMJy-BXxUGDXg.js";import"./vec2-BnynUbeJ-CKtGJQAy.js";import"./vec2f64-CkowXrDb-3zFQ3LNH.js";import"./vec32-Cj8pVsU0-DaGl27gM.js";import"./projectPointToVector-BZJhoF_5-Bt3jRF2Z.js";import"./geodesicUtils-DKS2UG72-CjUXrVJZ.js";import"./Query-n1aoaaFC-BGXwG0qF.js";import"./Field-BIQ-quF4-B6ITjmRe.js";import"./fieldType-PhcL4ff8-tM8Bc75H.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./vec4f64-DD-nkcCV-CSNWKRqG.js";import"./plane-Cf3Koz3c-SNOH5rGa.js";import"./vectorStacks-5ZZtmT9E-Nl97JGvf.js";import"./mat3f64-BnNZDR5l-Bz3OL2oI.js";import"./mat4f64-xsZDPPj0-Dq35B4BL.js";import"./quatf64-C16JxGFv-BKWK1F8U.js";import"./sphere-zPMQWhGG-DU3axfvl.js";import"./mat3-DOnW3DjW-C3hbW9XY.js";import"./geodeticLengthOperator-DHGBHzf3-2kq4uenF.js";import"./geodeticCurveType-D_etKnbP-CirnHLSB.js";import"./earcut-C6NeZYSh-Da0ULCQ5.js";import"./triangle-BM89wdHY-D7AKVZLe.js";import"./lineSegment-BAWQVP9P-ZoqMJ2LU.js";import"./spatialReferenceEllipsoidUtils-BK0OQJn2-BMvZwtta.js";import"./MeshTransform-ByFk-Izc-DpqA4ZGx.js";import"./quat-DQgq9Ar5-B1hw5GYS.js";import"./axisAngleDegrees-BTSCyz4U-CkPVtLd8.js";import"./meshVertexSpaceUtils-CCr86FVF-CzdTtdGZ.js";import"./MeshLocalVertexSpace-Cfxtmv6L-tz589ztz.js";import"./modeUtils-deizL-Tg-C4WiXKJs.js";import"./a11yUtils-CoCwThtH-oq-8JchR.js";import"./memoize-DvEt8OkT-Cy_RrfpZ.js";import"./normalizeUtils-u00NGW3M-DurLb7Fw.js";import"./normalizeUtilsCommon-ClagynAA-DdX9PUCg.js";import"./utils-BO8hgPs3-CZYmQGRe.js";import"./utils-DpLVEUvg-j58TjKSA.js";import"./SnappingVisualizer2D-Di4uotAR-DosOFB4V.js";import"./enums-a_LDTPYU-CBIcy3mM.js";import"./TooltipInfoWithCoordinates-Xxefy9Or-CFiehqV4.js";import"./PointSnappingHint-OKXicQ1z-DmwmLUIO.js";import"./editPlaneUtils-DmK-4boe-Bd7dbd7b.js";import"./drawSurfaces-DQUGW1oK-4eY5-lmX.js";import"./distanceOperator-CZDvZf3O-CPjvjrgM.js";import"./Point2D-CaHJVGk1-JqvJXjLr.js";import"./ProjectionTransformation-DQ4GElxa-DOYKU9uW.js";import"./Envelope2D-DlBzXkgv-eKRxGysX.js";import"./Transformation2D-CXWnDKXs-CjsleQQw.js";import"./SimpleGeometryCursor-DSF_YyIm-TAMgMsbK.js";import"./OperatorDefinitions-DJdq_wrt-DP7_WWTp.js";import"./apiConverter-CSuukuP9-CTiunFlU.js";import"./jsonConverter-tsQ40CV0-D2823Y1V.js";import"./simplifyOperator-BW9Vrh-l-B6Z88mci.js";import"./operatorSimplify-CjcRb60U-BvJKwPTJ.js";import"./mat2d-BQA-1WB--Pnyy0dhf.js";import"./mat2df64-DDXwUeaJ-Tu7q-7Mk.js";import"./ReactiveSet-CRNikQMW-BAfA5sJq.js";import"./diffUtils-BxG8DCnW-WOrUtE1J.js";import"./ViewingMode-CdRKcXnc-Dab70bGf.js";import"./SnappingContext-OY7xJ98b-BL_wHvCy.js";import"./hydratedFeatures-oobA80ei-Dctfm-gs.js";import"./Scheduler-BV4C4cVP-BiFv41YX.js";import"./debugFlags-8tOwPnHK-D4dMeP86.js";import"./boundedPlane-QDtjx5eO-CJi7aO0N.js";import"./cimSymbolUtils-DCedSSCN-BW_YybsO.js";import"./utils-BfXZnjCE-CFbU0njg.js";import"./defaultCIMValues-BcSaJjm--58G-soMN.js";import"./GraphicManipulator-D_ewLKOT-Bf06Swa_.js";import"./colorUtils-Eg6lOlXm-Qm-bOk1A.js";import"./drawUtils-pJlGx3nm-CdgH_wvu.js";let g=class extends ht{constructor(t){super(t),this.center=new L,this.dynamicScaling=!0,this.majorLineColor=v.fromArray([115,115,115,1]),this.majorLineInterval=10,this.minorLineColor=v.fromArray([165,165,165,1]),this.rotateWithMap=!1,this.rotation=0,this.spacing=1,this.type="measured",this.units="miles"}};n([o()],g.prototype,"center",void 0),n([o()],g.prototype,"dynamicScaling",void 0),n([o()],g.prototype,"majorLineColor",void 0),n([o()],g.prototype,"majorLineInterval",void 0),n([o()],g.prototype,"minorLineColor",void 0),n([o()],g.prototype,"rotateWithMap",void 0),n([o()],g.prototype,"rotation",void 0),n([o()],g.prototype,"spacing",void 0),n([lt({measured:"measured"})],g.prototype,"type",void 0),n([o()],g.prototype,"units",void 0),g=n([M("esri.grids.MeasuredGrid")],g);const Kt={readOnly:!0,get(){return Tt(this.view)}};let _=class extends Z{constructor(t){super(t),this.color=new v([255,127,0,1]),this.isDecoration=!0,this.length=34,this.rotation=0,this.thickness=2,this.visible=!0}get _strokeStyle(){return this.color.toCss(!0)}render(){const{x:t,y:e,length:i,thickness:r,rotation:s}=this,c=i/2,p=`0 0 ${i} ${i}`,d=`M${c} 0 V${i} M0 ${c} H${i}`;return a("div",{classes:{"esri-box-overlay-item":!0},dir:"ltr",styles:{left:`${(t??0)-c}px`,top:`${(e??0)-c}px`,width:`${i}px`,height:`${i}px`,transform:`rotate(${s}deg)`,visibility:this.visible?"visible":"hidden"}},a("svg",{styles:{overflow:"visible"},viewbox:p},a("path",{d,stroke:this._strokeStyle,"stroke-width":r})))}renderCanvas(){}};n([o()],_.prototype,"color",void 0),n([o()],_.prototype,"isDecoration",void 0),n([o()],_.prototype,"length",void 0),n([o()],_.prototype,"rotation",void 0),n([o()],_.prototype,"thickness",void 0),n([o()],_.prototype,"visible",void 0),n([o()],_.prototype,"x",void 0),n([o()],_.prototype,"y",void 0),n([o({readOnly:!0})],_.prototype,"_strokeStyle",null),_=n([M("esri.views.overlay.CrosshairOverlayItem")],_);function Xt(t,e){const i=it(e);return[t[0].toFixed(i),t[1].toFixed(i)]}function it(t){return t>=500?6:t<500&&t>=50?7:t<50&&t>=5?8:9}function Yt(t,e){const i=t.includes(",")?",":" ",[r,s,c]=t.split(i).map(d=>{const h=d.trim();return h?Number(h):null});if(!O(r)||!O(s))return null;const p=new L({x:r,y:s,spatialReference:e||E.WGS84});return c&&(p.z=c,p.hasZ=!0),p}function O(t){return typeof t=="number"&&isFinite(t)}function F(t){return!!t&&O(t.x)&&O(t.y)}function z(t,e){if(t.spatialReference.isGeographic&&e){const[i,r]=Xt([t.x,t.y],e);return`${i}, ${r}`}return`${t.x.toFixed(3)}, ${t.y.toFixed(3)}`}let m=class extends Z{constructor(t){super(t),this.conversionInfo=null,this.coordinateSegments=null,this._currentPattern=void 0,this.defaultPattern=null,this.name=null,this.viewModel=null}get currentPattern(){return(this._currentPattern||this.defaultPattern)??""}set currentPattern(t){this._currentPattern=t}get label(){return this.name??""}set label(t){this._overrideIfSome("label",t)}get hasDisplayProperties(){return!(!this.defaultPattern||!this.coordinateSegments)}get spatialReference(){return this.name==="basemap"?this._viewSpatialReference:this.conversionInfo?.spatialReference??E.WGS84}set spatialReference(t){this._overrideIfSome("spatialReference",t)}get _viewSpatialReference(){return this.viewModel?.view?.spatialReference??E.WGS84}get _additionalCharactersPattern(){const t=this.coordinateSegments;if(!t)return null;const e=t.map(r=>r.alias),i=this.currentPattern.replaceAll(new RegExp(`["nsew${e.join()}]`,"gi"),"").replaceAll(" ","");return new RegExp(`[${i}]`,"g")}get test(){}async convert(t){if(!F(t))throw new G("format:invalid-point","Could not convert invalid point.",{point:t});const e=this.conversionInfo?.convert;if(e)return Promise.resolve().then(()=>e(t));const i=await this._project(t,this.spatialReference);return{location:i,coordinate:await this._getCoordinate(i)}}getConversionStrategy(){const t=this._viewSpatialReference;return this.conversionInfo?.convert||this.viewModel?.formatterAvailable||this.name==="xy"&&(t.isWebMercator||t.isWGS84)||this.name==="basemap"?"client":"server"}getDisplayCoordinate(t){if(!t)return null;if(!this.coordinateSegments||!this.currentPattern)return t;let e=this.currentPattern;const i=this._getSegmentMatches(t,!1);for(let r=this.coordinateSegments.length-1;r>=0;r--){const s=this.coordinateSegments[r];e=e.replace(s.alias,i[r])}return e}_parseUserInput(t){const{defaultPattern:e,_additionalCharactersPattern:i,coordinateSegments:r}=this;if(!e||!i)return"";let s=e.replace(i,"");t=t.replace(i,"");const c=this._getSegmentMatches(t,!0);if(r)for(let p=r.length-1;p>=0;p--){const d=r[p];s=s.replace(d.alias,c[p])}return s}_getSegmentMatches(t,e){const i=new Array,{coordinateSegments:r}=this;if(!r)return i;for(let s=0;s<r.length;s++){const c=r[s],p=t.match(c.searchPattern);if(!p){i.push("");continue}let d=p[0];if(t=t.replace(d,"").trim(),c.substitution){const h=e?c.substitution.input(d):c.substitution.output(d);h&&(d=`${h}`)}i.push(d)}return i}async reverseConvert(t){const e=this._parseUserInput(t),i=this.conversionInfo?.reverseConvert;let r;if(i)r=i(e);else if(this.name==="xy"||this.name==="basemap")r=Yt(e,this.spatialReference);else if(this.viewModel?.formatterAvailable)switch(this.name){case"dd":case"ddm":case"dms":r=Ot(e,this.spatialReference);break;case"mgrs":{r=Lt(e,this.spatialReference,"automatic");break}case"utm":{r=Et(e,this.spatialReference,"latitude-band-indicators");break}case"usng":r=Rt(e,this.spatialReference);break;default:r=null}if(!r)throw new G("format:invalid-input","Could not parse input into point.",{userInput:t});return this._project(r,this._viewSpatialReference)}async _getCoordinate(t){const e=this.viewModel?.view?.scale??0;if(!F(t))throw new G("format:invalid-point","Could not transform invalid point into coordinate.",{point:t});if(this.viewModel?.formatterAvailable||this.name==="basemap"||this.name==="xy")switch(this.name){case"dd":case"ddm":case"dms":{const i=it(e);return At(t,this.name,i)}case"mgrs":return Gt(t,"automatic",5,!1);case"usng":return $t(t,5,!1);case"utm":return kt(t,"latitude-band-indicators",!0);default:return z(t,e)}return z(t,e)}async _project(t,e){if(mt(t.spatialReference,e)||!e)return t;if(this.viewModel?.formatterAvailable&&Pt())return et(t,e);if(!this.viewModel?.formatterAvailable){const i=ut(t,e);if(i!=null)return i}return null}};n([o()],m.prototype,"conversionInfo",void 0),n([o()],m.prototype,"coordinateSegments",void 0),n([o()],m.prototype,"currentPattern",null),n([o()],m.prototype,"_currentPattern",void 0),n([o()],m.prototype,"label",null),n([o()],m.prototype,"defaultPattern",void 0),n([o({readOnly:!0})],m.prototype,"hasDisplayProperties",null),n([o()],m.prototype,"name",void 0),n([o({type:E})],m.prototype,"spatialReference",null),n([o()],m.prototype,"viewModel",void 0),n([o({readOnly:!0})],m.prototype,"_viewSpatialReference",null),n([o({readOnly:!0})],m.prototype,"_additionalCharactersPattern",null),m=n([M("esri.widgets.CoordinateConversion.support.Format")],m),zt().decimal;const Jt="°‎",rt=t=>{if(t==null||isNaN(t))return 0;const e=t+180;return Math.trunc(Q(e,360))},Zt=t=>{let e=t;return e==null?0:(typeof e=="string"&&(e=parseInt(e,10)),isNaN(e)?0:Q(Math.trunc(e),360)-180)},H=(t,e)=>{if(!t||e.length<3)return;const[i,r,s,c]=e,[p,d]=c===void 0?[1,.25]:[c,.25*c];t.majorLineColor=v.fromArray([i,r,s,p]),t.minorLineColor=v.fromArray([i,r,s,d])},K=Symbol("grid-interactivity");let l=class extends ct.EventedAccessor{constructor(t){super(t),this._drawGraphicTool=null,this._keybindings=null,this._crosshairLabel=null,this._crosshairItem=null,this.snappingManager=null,this.snappingOptions=null,this.view=null,this.placementDisabled=!1,this._mostRecentlyShownGrid=null,this._sketchedVertexCount=0}initialize(){this.addHandles([pt(()=>!this.displayEnabled,()=>{this.interactivePlacementState=null}),R(()=>this.view?.viewpoint,()=>{this._renderOverlays()}),R(()=>this.snappingOptions?.gridEnabled,t=>{t!=null&&this.trySetDisplayEnabled(t)}),R(()=>this.view?.grid,(t,e)=>{this._mostRecentlyShownGrid=!t&&e?e:null})])}destroy(){this._resetGridPlacementState(),this._crosshairItem&&(this.view?.overlay?.removeItem(this._crosshairItem),this._crosshairItem=$(this._crosshairItem)),this._crosshairLabel&&(this.view?.overlay?.removeItem(this._crosshairLabel),this._crosshairLabel=$(this._crosshairLabel))}get displayEnabled(){return!!this.view?.grid}get dynamicScaling(){return this.grid?.dynamicScaling??!1}set dynamicScaling(t){this.grid&&(this.grid.dynamicScaling=t)}get grid(){return this.view?.grid??this._mostRecentlyShownGrid}set gridColor(t){if(t?.equals(this.grid?.majorLineColor)||!t)return;const[e,i,r,s]=t.toArray();H(this.grid,[e,i,r,s/255])}get gridColor(){return this.grid?.majorLineColor}get gridControlsEnabled(){return this.displayEnabled&&!this.interactivePlacementState}set interactivePlacementState(t){this._set("interactivePlacementState",t),this._resetGridPlacementState(),t&&this._startGridManipulation(t)}get majorLineInterval(){return this.grid?.majorLineInterval??10}set majorLineInterval(t){this.grid&&(this.grid.majorLineInterval=t<1?1:t>15?15:t)}get rotateWithMap(){return this.grid?.rotateWithMap??!1}set rotateWithMap(t){this.grid&&(this.grid.rotateWithMap=t)}get rotation(){return this.grid?.rotation??-180}set rotation(t){this.grid&&(this.grid.rotation=t)}get snappingEnabled(){return(this.grid&&this.snappingOptions?.gridEnabled)??!1}set snappingEnabled(t){const{snappingOptions:e}=this;e&&(e.gridEnabled=t)}get spacing(){return this.grid?.spacing??1}set spacing(t){this.grid&&t>0&&(this.grid.spacing=t)}get unit(){return this.grid?.units}set unit(t){this.grid&&(this.grid.units=t)}get gridOutOfScale(){return!this.dynamicScaling&&this._pixelsPerStride!=null&&this._pixelsPerStride<Dt}get effectiveSpacingAfterDynamicScaling(){return this.majorLineInterval<1||!this.dynamicScaling||!this.view||this._pixelsPerStride==null||!this.grid?.spacing?null:this.grid.spacing*Vt(this.majorLineInterval,this._pixelsPerStride,this.dynamicScaling)}get numericSpacingInputShouldBeVisible(){return!!this.view?.spatialReference&&jt(this.view.spatialReference)}get _metersPerSRUnit(){if(!(this.view&&this.displayEnabled&&this.grid&&xt(this.grid.center.spatialReference,this.view.spatialReference)))return null;const t=et(this.grid.center,this.view.spatialReference);return Ut(t)}get _pixelsPerStride(){if(!this.view?.scale||!this.displayEnabled||!this.grid||this._metersPerSRUnit==null)return null;const t=this.grid,{scale:e,spatialReference:i}=this.view;return j(t.spacing,t.units,"meters")/(this._metersPerSRUnit*It(e,i))}get _isPlacing(){if(!this._drawGraphicTool)return!1;const t=this.interactivePlacementState;return t==="place"||t==="interactive"&&this._sketchedVertexCount===0}get _isRotating(){if(!this._drawGraphicTool)return!1;const t=this.interactivePlacementState;return t==="rotate"||t==="interactive"&&this._sketchedVertexCount===1}get _isScaling(){return this._drawGraphicTool?this.interactivePlacementState==="interactive"&&this._sketchedVertexCount===1:!1}togglePlacementState(t){this.interactivePlacementState=this.interactivePlacementState===t?null:t}trySetDisplayEnabled(t){const{view:e}=this;if(e?.ready)if(!e.grid&&t)if(this._mostRecentlyShownGrid)e.grid=this._mostRecentlyShownGrid;else{const i=this.defaultUnit==="imperial"?"feet":"meters";e.grid=new g({units:i,center:e.center??new L,rotateWithMap:!0}),H(this.grid,[115,115,115])}else t||(e.grid=null);else Y.getLogger(this).warn("Attempting to enable grid display while view is not ready")}async startPlacement(t){const{view:e,snappingManager:i}=this;if(!e)return;this._set("interactivePlacementState",t),this._sketchedVertexCount=0;const r=new Wt({view:e,graphicProperties:{attributes:{[q]:q}},sketchOptions:{tooltips:{enabled:!0,visibleElements:{direction:!1,rotation:!1,totalLength:!1,elevation:!1,distance:!1,area:!1}}},geometryType:"polyline",mode:"click",snapToScene:!1,snappingManager:i,forceUniformSize:!0,centered:!1,cursor:this.interactivePlacementState==="interactive"||this.interactivePlacementState==="place"?"none":null,regularVerticesSymbol:void 0,activeVertexSymbol:Qt,activeLineSymbol:X,graphicSymbol:X,automaticAreaMeasurementUtils:await Bt(),automaticLengthMeasurementUtils:await Nt()});if(this._drawGraphicTool=r,e.addAndActivateTool(r),this._renderOverlays(),!this._keybindings){const s=new Ct;s.add(W.complete,()=>this._onDrawComplete()),s.add(W.vertexAdd,()=>this._drawGraphicTool?.drawOperation.commitStagedVertex()),this._keybindings=s}this.addHandles([r.on("cursor-update",s=>this._onCursorUpdate(s)),r.on("complete",()=>this._onDrawComplete()),r.on("vertex-add",s=>this._onVertexAdd(s,t)),this._keybindings.register(e,St.WIDGET)],K)}async _startGridManipulation(t){const{view:e}=this;if(!e)return void(this.interactivePlacementState=null);const i=new CustomEvent("before-placement",{cancelable:!0});this.emit("before-placement",i),i.defaultPrevented||await this.startPlacement(t)}_onCursorUpdate(t){try{if(this._isPlacing){const e=t.vertices[0].coordinates;return void this._handlePlace(e)}if(this._drawGraphicTool.cursor=null,this._isRotating&&this._handleRotate(t.vertices[0].coordinates),this._isScaling){const e=this._drawGraphicTool?.drawOperation.cursorVertex;this._handleScale(e)}}finally{this._renderOverlays()}}_onDrawComplete(){this._drawGraphicTool.cursor=null,this.interactivePlacementState=null}_onVertexAdd(t,e){const i=t.vertices[0].coordinates;this._isPlacing&&this._handlePlace(i),this._isRotating&&this._sketchedVertexCount>0&&this._handleRotate(i),this._isScaling&&this._sketchedVertexCount>0&&this._handleScale(N(i[0],i[1],void 0,this.view.spatialReference)),this._sketchedVertexCount++,this._drawGraphicTool.cursor=null,this._sketchedVertexCount!==2&&e==="interactive"||(this.interactivePlacementState=null),this._renderOverlays()}_handlePlace(t){const{grid:e,view:i}=this;e&&i&&(e.center=new L({x:t[0],y:t[1],spatialReference:i.spatialReference}))}_handleRotate(t){const{grid:e,view:i}=this;if(!e||!i)return;this._drawGraphicTool?.sketchOptions.tooltips.set("enabled",!1);const{x:r,y:s}=e.center,[c,p]=t,d=i.toScreen(e.center,{pickClosestTarget:!0}),h=d&&i.toMap(d),f=i.toScreen(N(c,p,void 0,i.spatialReference),{pickClosestTarget:!0}),b=f&&i.toMap(f),x=h?h.x:r,k=h?h.y:s,P=x-(b?b.x:c),D=k-(b?b.y:p);if(P===0&&D===0)return;const nt=Math.atan2(D,P),V=_t(nt),ot=e.rotateWithMap,st=i.viewpoint.rotation??0,at=ot?V:V-st;e.rotation=Math.fround(at)%360}_handleScale(t){const{view:e,grid:i,_drawGraphicTool:r,interactivePlacementState:s,_metersPerSRUnit:c}=this;if(!(t&&e&&i&&r&&c))return;r.sketchOptions.tooltips.enabled=!1;const p=s==="interactive"?i.center:r.drawOperation.firstVertex;if(!p||!t)return;const d=e?.toScreen(p),h=d&&e.toMap(d),f=e?.toScreen(t),b=h??p,x=(f&&e.toMap(f))??t,k=Math.sqrt((b.x-x.x)**2+(b.y-x.y)**2),P=j(k*c,"meters",i.units);this.spacing=P}_renderOverlays(){this._renderCrosshairOverlay(),this._renderTextOverlay()}_renderTextOverlay(){const{grid:t,view:e,_drawGraphicTool:i}=this,r=this._getCrosshairLabel();if(!(t&&e?.overlay&&i&&r))return;const s=e.toScreen(t.center,{pickClosestTarget:!0});s&&(r.position=[s.x+12,s.y+12]),this._isRotating?(r.text=`${rt(t.rotation)}${Jt}`,r.visible=!0):r.visible=!1}_renderCrosshairOverlay(){const{grid:t,view:e,_drawGraphicTool:i}=this;if(!t||!e?.overlay||!i)return;const r=this._getCrosshair();if(!r)return;const s=e.toScreen(t.center);s&&(r.x=s.x,r.y=s.y,r.rotation=t.rotateWithMap?e.viewpoint.rotation-t.rotation:-t.rotation,r.visible=!!i)}_getCrosshairLabel(){if(this._crosshairLabel)return this._crosshairLabel;const{grid:t,view:e,_drawGraphicTool:i}=this;if(!t||!e?.overlay||!i)return null;const r=new Ft({anchor:"top-left",fontSize:10,textColor:new v([21,21,21]),backgroundColor:new v([248,248,248]),padding:8,borderRadius:20});return e.overlay.addItem(r),this._crosshairLabel=r,r}_getCrosshair(){const{_crosshairItem:t,view:e}=this;return e?.overlay?t&&e.overlay.items.includes(t)?t:(this._crosshairItem=new _({color:e.effectiveTheme.accentColor,thickness:4,length:36,visible:!0}),e.overlay?.addItem(this._crosshairItem),this._crosshairItem):null}_resetGridPlacementState(){this.removeHandles(K),this._crosshairItem&&(this._crosshairItem.visible=!1),this._crosshairLabel&&(this._crosshairLabel.visible=!1),this._drawGraphicTool&&(this.view?.activeTool===this._drawGraphicTool&&(this.view.activeTool=null),this.view?.tools.remove(this._drawGraphicTool)),this._drawGraphicTool=$(this._drawGraphicTool)}};n([o(Kt)],l.prototype,"defaultUnit",void 0),n([o({readOnly:!0})],l.prototype,"displayEnabled",null),n([o()],l.prototype,"dynamicScaling",null),n([o()],l.prototype,"grid",null),n([o()],l.prototype,"gridColor",null),n([o({readOnly:!0})],l.prototype,"gridControlsEnabled",null),n([o()],l.prototype,"interactivePlacementState",null),n([o()],l.prototype,"majorLineInterval",null),n([o()],l.prototype,"rotateWithMap",null),n([o()],l.prototype,"rotation",null),n([o()],l.prototype,"snappingEnabled",null),n([o()],l.prototype,"snappingManager",void 0),n([o({type:qt})],l.prototype,"snappingOptions",void 0),n([o()],l.prototype,"spacing",null),n([o()],l.prototype,"unit",null),n([o()],l.prototype,"view",void 0),n([o({readOnly:!0})],l.prototype,"gridOutOfScale",null),n([o({readOnly:!0})],l.prototype,"effectiveSpacingAfterDynamicScaling",null),n([o({readOnly:!0})],l.prototype,"numericSpacingInputShouldBeVisible",null),n([o()],l.prototype,"placementDisabled",void 0),n([o()],l.prototype,"_metersPerSRUnit",null),n([o()],l.prototype,"_pixelsPerStride",null),n([o()],l.prototype,"_isPlacing",null),n([o()],l.prototype,"_isRotating",null),n([o()],l.prototype,"_isScaling",null),n([o()],l.prototype,"_mostRecentlyShownGrid",void 0),n([o()],l.prototype,"_sketchedVertexCount",void 0),l=n([M("esri.widgets.support.GridControls.GridControlsViewModel")],l);const X=new J({width:0}),Qt=new dt({color:v.fromArray([0,0,0,0]),outline:new J({color:v.fromArray([0,0,0,0])})}),w="esri-grid-controls",y={base:w,borderedSwitch:`${w}__switch--bordered`,container:`${w}__container`,numericInputsContainer:`${w}__numeric-inputs__container`,tilegroup:`${w}__tilegroup`,tile:`${w}__tile`,tileDisabled:`${w}__tile--disabled`,tileContent:`${w}__tile__content`,suffixedInputContainer:`${w}__input-with-suffix__container`,inlineIcon:`${w}__inline-icon`},C={widgetIcon:"grid-unit",gridTheme:{light:"circle",dark:"circle-area",custom:"palette"},placementState:{interactive:"maximum-territory-distance",place:"move",rotate:"rotate"},warning:"exclamation-mark-triangle"},T=v.fromArray([115,115,115]),A=v.fromArray([200,200,200]),te=["interactive","place","rotate"];let u=class extends ft{constructor(t,e){super(t,e),this.customColor=null,this.messages=null,this.messagesUnits=null,this.viewModel=new l,this.visibleElements=new tt,gt(Y.getLogger(this),"Grid Controls","arcgis-grid-controls",{version:"4.33"})}initialize(){this.addHandles([R(()=>this.viewModel.gridColor,t=>{!t||T.equals(t)||A.equals(t)||(this.customColor=t)},vt)])}loadDependencies(){return Promise.all([bt({action:()=>S(()=>import("./index-CXn0Qeo5-KNnoJ3TR.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]),import.meta.url),"action-bar":()=>S(()=>import("./index-B4aE1io5-D-orcoay.js"),__vite__mapDeps([17,1,2,3,4,5,6,7,8,9,10,11,12,0,13,14,15,16,18,19,20,21,22,23,24,25,26,27]),import.meta.url),label:()=>S(()=>import("./index-CjNVVdGY-CxL3aLd4.js"),__vite__mapDeps([28,2,3,4,5,6,7,29,11]),import.meta.url),icon:()=>S(()=>import("./index-DV38aJMs-Cr0HwlBq.js"),__vite__mapDeps([10,2,3,4,5,6,7,11,12]),import.meta.url).then(t=>t.i),popover:()=>S(()=>import("./index-Btp8sfgk-C29yYrYo.js"),__vite__mapDeps([18,1,2,3,4,5,6,7,8,9,10,11,12,0,13,14,15,16,19,20,21,22,23,24]),import.meta.url).then(t=>t.i),tooltip:()=>S(()=>import("./index-CsuaBzKX-ekjpAr7g.js"),__vite__mapDeps([30,2,3,4,5,6,7,14,19,11,20,8,21,23,13]),import.meta.url),"color-picker":()=>S(()=>import("./index-CNL4JQYq-DEGPcBiy.js"),__vite__mapDeps([31,2,3,4,5,6,7,13,14,11,32,10,12,33,34,35,24,36,15,29,16,37,9,38,1,8,39,22,20]),import.meta.url),"input-number":()=>S(()=>import("./index-DEuHuu_F-BxA4sv81.js"),__vite__mapDeps([38,10,2,3,4,5,6,7,11,12,33,34,35,14,24,13,36,15,29,16,37,9]),import.meta.url)}),Mt()])}get icon(){return C.widgetIcon}set icon(t){this._overrideIfSome("icon",t)}get label(){return this.messages.widgetLabel}set label(t){this._overrideIfSome("label",t)}get snappingManager(){return this.viewModel.snappingManager}set snappingManager(t){this.viewModel.snappingManager=t}get snappingOptions(){return this.viewModel.snappingOptions}set snappingOptions(t){this.viewModel.snappingOptions=t}get theme(){const t=this.viewModel.gridColor;return t?T.equals(t)?"dark":A.equals(t)?"light":"custom":null}set theme(t){const{viewModel:e,customColor:i,view:r}=this;switch(t){case"light":e.gridColor=A;break;case"dark":e.gridColor=T;break;case"custom":e.gridColor=i??r?.effectiveTheme.accentColor??T}}get view(){return this.viewModel.view}set view(t){this.viewModel.view=t}render(){return a("div",{"aria-label":this.label,class:this.classes(y.base,B.widget,B.panel)},a("div",{class:y.container},this._renderContent()))}_renderContent(){const{visibleElements:t}=this;return[t.gridEnabledToggle?this._renderEnabledToggle():null,t.placementButtons?this._renderGridPlacementButtons():null,t.numericInputs?this._renderNumericInputs():null,t.lineIntervalInput?this._renderIntervalInput():null,t.gridSnapEnabledToggle&&this.viewModel.snappingOptions?this._renderSnappingToggle():null,t.dynamicScaleToggle?this._renderDynamicScaleToggle():null,t.rotateWithMapToggle?this._renderRotateToggle():null,t.colorSelection?this._renderColorSelection():null]}_renderGridPlacementButtons(){const{interactivePlacementState:t,placementDisabled:e,gridControlsEnabled:i}=this.viewModel,r=e||!i;return a("calcite-label",{key:"grid-placement-buttons",scale:"s"},this.messages.placementOptions,a("calcite-action-bar",{expandDisabled:!0,layout:"horizontal"},te.map(s=>this._renderPlacementModeButton(s,r,t))))}_renderPlacementModeButton(t,e,i){const r=this.messages.placementState[t],s=`__placement-action-${t}`;return a("div",null,a("calcite-action",{active:i===t,alignment:"center",disabled:e,icon:C.placementState[t],id:s,onclick:()=>this.viewModel.togglePlacementState(t),text:r}),a("calcite-tooltip",{overlayPositioning:"fixed",placement:"top",referenceElement:s},r))}_renderNumericInputs(){const{rotation:t,spacing:e,effectiveSpacingAfterDynamicScaling:i,numericSpacingInputShouldBeVisible:r,unit:s="meters"}=this.viewModel,c=this.messagesUnits.units[s].abbr,p=this.viewModel.gridControlsEnabled,d=i!=null&&i!==this.viewModel.spacing,h=`__spacing_input_scaled-${this.id}`;return a("div",{class:this.classes(y.numericInputsContainer)},[r?a("calcite-label",{key:"spacing-label",scale:"s"},a("span",null,this.messages.inputLabel.spacing,d?a("calcite-icon",{class:this.classes(y.inlineIcon),icon:C.warning,id:h,scale:"s",tabIndex:0}):void 0),a("div",{class:y.suffixedInputContainer},a("calcite-input-number",{disabled:!p,numberButtonType:"none",suffixText:c,value:`${e?.toFixed(2)}`,onCalciteInputNumberChange:({currentTarget:f})=>{const b=parseFloat(f.value);this.viewModel.spacing=b,b!==this.viewModel.spacing&&(f.value=`${this.viewModel.spacing}`)}}),d?a("calcite-tooltip",{overlayPositioning:"fixed",placement:"leading",referenceElement:h},Ht(this.messages.warnings.dynamicSpacing,{actualSpacingIncludingUnit:yt(this.messagesUnits,i,s,2,"plural")})):void 0)):void 0,a("calcite-label",{key:"angle-label",scale:"s"},this.messages.inputLabel.angle,a("calcite-input-number",{disabled:!p,integer:!0,numberButtonType:"none",suffixText:this.messagesUnits.units.degrees.abbr,value:`${rt(t)}`,onCalciteInputNumberChange:({currentTarget:f})=>this.viewModel.rotation=Zt(f.value)}))])}_renderIntervalInput(){const{majorLineInterval:t,gridControlsEnabled:e}=this.viewModel;return a("div",{class:this.classes(y.numericInputsContainer)},a("calcite-label",{scale:"s"},this.messages.inputLabel.interval,a("calcite-input-number",{disabled:!e,integer:!0,max:15,min:1,numberButtonType:"vertical",value:`${t}`,onCalciteInputNumberChange:({currentTarget:i})=>{const r=Number.parseInt(i.value,10);this.viewModel.majorLineInterval=r,r!==this.viewModel.majorLineInterval&&(i.value=`${this.viewModel.majorLineInterval}`)}})))}_renderSnappingToggle(){const{snappingOptions:t,gridControlsEnabled:e}=this.viewModel;return a(I,{checked:!!(t?.gridEnabled??!1),disabled:!(e&&t),key:"grid-snap-enabled-toggle",label:this.messages.switchLabel.snap,onChange:i=>this.viewModel.snappingOptions?.set("gridEnabled",i)})}_renderDynamicScaleToggle(){const{viewModel:t,messages:e}=this,i=this.visibleElements.outOfScaleWarning&&t.gridOutOfScale;return a(I,{checked:t.dynamicScaling,disabled:!t.gridControlsEnabled,hint:i?e.warnings.outOfScale:void 0,hintIcon:C.warning,hintKind:"warning",key:`grid-dynamic-scale-toggle-${this.id}`,label:e.switchLabel.scaling,onChange:r=>t.dynamicScaling=r})}_renderRotateToggle(){const{gridControlsEnabled:t,rotateWithMap:e}=this.viewModel;return a(I,{checked:e,disabled:!t,key:"grid-rotate-map-toggle",label:this.messages.switchLabel.rotateWithMap,onChange:i=>this.viewModel.rotateWithMap=i})}_renderEnabledToggle(){return a("div",{class:y.borderedSwitch},a(I,{checked:this.viewModel.displayEnabled,disabled:!!this.viewModel.interactivePlacementState,key:"grid-enabled-toggle",label:this.messages.switchLabel.display,onChange:t=>this.viewModel.trySetDisplayEnabled(t)}))}_renderColorSelection(){const{customColor:t}=this,e=`${this.id}--custom-grid-color-button`;return a("calcite-label",{scale:"s"},this.messages.inputLabel.theme,a("div",{class:y.tilegroup},[this._renderThemeTile({value:"dark"}),this._renderThemeTile({value:"light"}),this._renderThemeTile({value:"custom",id:e}),a("calcite-popover",{autoClose:!0,label:this.messages.gridLineColorPopoverLabel,overlayPositioning:"fixed",referenceElement:e},a("calcite-color-picker",{alphaChannel:!0,savedDisabled:!0,value:t?.toHex({digits:8})??"#000000ff",onCalciteColorPickerChange:i=>{const r=v.fromHex(i.currentTarget.value);r&&(this.customColor=r,this.theme="custom")}}))]))}_renderThemeTile(t){const{theme:e}=this,{value:i}=t,r=this.messages.gridTheme[i],s=`${this.id}--theme_tile_${i}`,c=`${s}__label`,p=C.gridTheme[i],d=this.viewModel.gridControlsEnabled;return a("div",{class:wt({[y.tile]:!0,[y.tileDisabled]:!d}),id:t.id,role:"button"},a("input",{"aria-labelledby":c,checked:e===i,disabled:!d,id:s,name:`${this.id}--theme`,onchange:h=>{this.theme=i,h.target?.focus()},tabIndex:0,type:"radio"}),a("div",{class:y.tileContent},a("calcite-icon",{icon:p,scale:"l"}),a("calcite-label",{for:s,id:c},r)))}};n([o({type:v})],u.prototype,"customColor",void 0),n([o()],u.prototype,"icon",null),n([o()],u.prototype,"label",null),n([o(),U("esri/widgets/support/GridControls/t9n/GridControls")],u.prototype,"messages",void 0),n([o(),U("esri/core/t9n/Units")],u.prototype,"messagesUnits",void 0),n([o()],u.prototype,"snappingManager",null),n([o()],u.prototype,"snappingOptions",null),n([o()],u.prototype,"theme",null),n([o()],u.prototype,"view",null),n([o({type:l})],u.prototype,"viewModel",void 0),n([o({type:tt,nonNullable:!0})],u.prototype,"visibleElements",void 0),u=n([M("esri.widgets.support.GridControls")],u);const ar=u;export{ar as default};
