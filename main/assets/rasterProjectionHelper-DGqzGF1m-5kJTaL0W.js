const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./projectOperator-BEghhU44-CGPUeu4e.js","./main-DXQSfJ4c.js","./main-CUHYO_F4.css","./SimpleGeometryCursor-DSF_YyIm-TAMgMsbK.js","./geographicTransformationUtils-BzAGUyRl-ChEXZcji.js","./GeographicTransformation-Ccb709r9-BDL62del.js"])))=>i.map(i=>d[i]);
import{H as Nt,_ as ct,o as B,az as z,a8 as _t,Z as it,l as _,at as kt,h as yt,jO as v,jP as T,jQ as ft,jR as Tt,jS as vt,ar as dt}from"./main-DXQSfJ4c.js";import{$ as Ct}from"./projectionUtils-B-CplN3q-R11C1T8y.js";var U;function j(){if(!ot)throw new yt("rasterprojectionhelper-project","projection operator is not loaded")}(function(t){t[t.None=0]="None",t[t.North=1]="North",t[t.South=2]="South",t[t.Both=3]="Both"})(U||(U={}));const ut=(t,e,i,o=0)=>{if(i[0]===1)return[0,0];let r=1,n=-1,s=1,c=-1;for(let f=0;f<t.length;f+=2)isNaN(t[f])||(r=r>t[f]?t[f]:r,n=n>t[f]?n:t[f],s=s>t[f+1]?t[f+1]:s,c=c>t[f+1]?c:t[f+1]);const{cols:l,rows:a}=e,u=(n-r)/l/i[0],d=(c-s)/a/i[1],h=2*o;let m=0,x=!1,p=[0,0];for(let f=0;f<l-3;f++){for(let M=0;M<a-3;M++){const g=f*a*2+2*M,y=(t[g]+t[g+4]+t[g+4*a]+t[g+4*a+4])/4,w=(t[g+1]+t[g+5]+t[g+4*a+1]+t[g+4*a+5])/4,R=Math.abs((y-t[g+2*a+2])/u),S=Math.abs((w-t[g+2*a+3])/d);if(R+S>m&&(m=R+S,p=[R,S]),h&&m>h){x=!0;break}}if(x)break}return p},zt={3395:20037508342789244e-9,3410:17334193943686873e-9,3857:20037508342788905e-9,3975:17367530445161372e-9,4087:20037508342789244e-9,4088:20015108787169147e-9,6933:17367530445161372e-9,32662:20037508342789244e-9,53001:2001508679602057e-8,53002:1000754339801029e-8,53003:2001508679602057e-8,53004:2001508679602057e-8,53016:14152803599503474e-9,53017:17333573624304302e-9,53034:2001508679602057e-8,53079:20015114352186374e-9,53080:20015114352186374e-9,54001:20037508342789244e-9,54002:10018754171394624e-9,54003:20037508342789244e-9,54004:20037508342789244e-9,54016:14168658027268292e-9,54017:1736753044516137e-8,54034:20037508342789244e-9,54079:20037508342789244e-9,54080:20037508342789244e-9,54100:20037508342789244e-9,54101:20037508342789244e-9},Y=32,D=4,V=D,Z=new Map,K=new Map,$=500,Lt=39.37,jt=96;let F,N,A,ot=!1;async function Ht(){return F||(F=Nt(),N=await ct(()=>import("./projectOperator-BEghhU44-CGPUeu4e.js"),__vite__mapDeps([0,1,2,3]),import.meta.url),A=await ct(()=>import("./geographicTransformationUtils-BzAGUyRl-ChEXZcji.js"),__vite__mapDeps([4,1,2,5]),import.meta.url),N.isLoaded()||await N.load(),A.isLoaded()||await A.load(),ot=!0,F.resolve()),F.promise}function Ot(t,e,i){if(j(),i){const o=N.execute(t,e);return A.getTransformation(e,t.spatialReference,o)}return A.getTransformation(t.spatialReference,e,t)}function Vt(t,e,i,o){const r=t.spatialReference;if(!r||!e||r.equals(e))return t;j();const n=i.center,s=new B({xmin:n.x-t.x/2,xmax:n.x+t.x/2,ymin:n.y-t.y/2,ymax:n.y+t.y/2,spatialReference:r}),c=N.execute(s,e,{geographicTransformation:o}),l=k(e);return c==null||l!=null&&c.width>=l?q(t,r,e):{x:c.width,y:c.height}}function q(t,e,i){const o=z(e)/z(i);return{x:t.x*o,y:t.y*o}}function tt(t,e,i){const{spatialReference:o}=i;if(!o||!e||o.equals(e))return t;if(o.isGeographic&&e.isGeographic)return q(t,o,e);if(j(),!ot)throw new yt("raster-projection-helper:project-dataset-resolution","geometry engine is not loaded");let{x:r,y:n}=t;const s=(r+n)/2*z(o);let c=1;s>30&&(c=30/s,r*=c,n*=c);const l=256,a=r*l/2,u=n*l/2,{x:d,y:h}=i.center,m=[];for(let P=0;P<=l;P++)m.push([d-a,h-u+P*n]);for(let P=1;P<=l;P++)m.push([d-a+P*r,h+u]);for(let P=1;P<=l;P++)m.push([d+a,h+u-P*n]);for(let P=1;P<l;P++)m.push([d+a-P*r,h-u]);m.push(m[0]);const x=new it({rings:[m],spatialReference:o}),p=N.execute(x,e);if(!p)return q(t,o,e);const f=p.extent,M=k(e);if(f==null||M!=null&&f.width>=M)return q(t,o,e);const g=$t(p.rings),y=r*n*l*l,w=Math.sqrt(g/y)/c,R={x:f.width/c/l,y:f.height/c/l},S={x:r*w,y:n*w},b=R.x*R.y;return Math.abs(b-S.x*S.y)/b<.1?R:S}function et(t,e){return(typeof t=="number"?t:(t.x+t.y)/2)*z(e)*jt*Lt}function Zt(t,e){const{pixelSize:i,extent:o}=t;return et(tt(i,e,o),e)}function E(t,e=.01){return z(t)?e/z(t):0}function xt(t,e,i,o=!0){const r=t.spatialReference;if(r.equals(e))return t;j();const n=N.execute(t,e,{geographicTransformation:i});return o&&n&&wt([t],[n],r,e),n}function wt(t,e,i,o){const r=J(i,!0),n=J(o,!0),s=E(i,$),c=E(o,$);if(s&&r!=null&&n!=null)for(let l=0;l<t.length;l++){const a=e[l];if(!a)continue;const{x:u}=t[l],{x:d}=a;d>=n[1]-c&&Math.abs(u-r[0])<s?a.x-=n[1]-n[0]:d<=n[0]+c&&Math.abs(u-r[1])<s&&(a.x+=n[1]-n[0])}}function Wt(t){const{inSR:e,outSR:i,preferPE:o}=t;if(e.equals(i)){const{points:r}=st(t,null);return r}return e.isWebMercator&&i.isWGS84||e.isWGS84&&i.isWebMercator?Bt(t):o&&(e.isGeographic||L(e)!=null)?At(t):It(t)}function It(t){const{points:e}=st(t,null),{inSR:i,outSR:o,datumTransformation:r}=t,n=e.map(c=>new _(c[0],c[1],i)),s=N.executeMany(n,o,{geographicTransformation:r});return r&&wt(n,s,i,o),s.map(c=>c?[c.x,c.y]:[NaN,NaN])}function At(t){const{inSR:e,outSR:i,datumTransformation:o}=t,r=L(e),{points:n,mask:s}=st(t,r);if(!e.isGeographic){const l=e.wkid?v.coordsys(e.wkid):v.fromString(e.isGeographic?T.PE_TYPE_GEOGCS:T.PE_TYPE_PROJCS,e.wkt2||e.wkt);ft.projToGeog(l,n.length,n)}if(o!=null&&o.steps.length){let l;if(i.isGeographic&&(l=n.map(([a])=>a>179.9955?1:a<-179.9955?-1:0)),o.steps.forEach(a=>{const u=a.wkid?v.geogtran(a.wkid):v.fromString(T.PE_TYPE_GEOGTRAN,a.wkt);Tt.geogToGeog(u,n.length,n,null,a.isInverse?T.PE_TRANSFORM_2_TO_1:T.PE_TRANSFORM_1_TO_2)}),l)for(let a=0;a<n.length;a++){const u=l[a],d=n[a][0],h=d>179.9955?1:d<-179.9955?-1:0;u&&h&&u!==h&&(n[a][0]=u>0?d+360:d-360)}}if(!i.isGeographic){const l=L(i,!0),a=l!=null&&l.isEnvelope?[l.bbox[1],l.bbox[3]]:[-90,90];Ft(n,a);const u=i.wkid?v.coordsys(i.wkid):v.fromString(i.isGeographic?T.PE_TYPE_GEOGCS:T.PE_TYPE_PROJCS,i.wkt2||i.wkt);ft.geogToProj(u,n.length,n)}let c=n;if(s&&n.length!==s.length){c=[];for(let l=0,a=0;l<s.length;l++)s[l]?c.push(n[a++]):c.push([NaN,NaN])}return c}function Bt(t){const{cols:e,rows:i,xres:o,yres:r,usePixelCenter:n,inSR:s,outSR:c}=t;let{xmin:l,ymax:a}=t;n&&(l+=o/2,a-=r/2);const u=[],d=[],h=Math.max(e,i);for(let x=0;x<h;x++){const p=l+o*Math.min(e,x),f=a-r*Math.min(i,x),M=Ct(new _({x:p,y:f,spatialReference:s}),s,c);x<=e&&u.push(M.x),x<=i&&d.push(M.y)}const m=[];for(let x=0;x<e;x++)for(let p=0;p<i;p++)m.push([u[x],d[p]]);return m}function L(t,e=!1){let i=t.wkid||t.wkt2||t.wkt;if(!i||t.isGeographic)return null;if(i=String(i),Z.has(i)){const s=Z.get(i);return e?s?.gcs:s?.pcs}const o=t.wkid?v.coordsys(t.wkid):v.fromString(t.isGeographic?T.PE_TYPE_GEOGCS:T.PE_TYPE_PROJCS,t.wkt2||t.wkt),r=ht(o,E(t,1e-4)),n=ht(o,0,!0);return Z.set(i,{pcs:r,gcs:n}),e?n:r}function ht(t,e=0,i=!1){const o=vt.generate(t),r=i?t.horizonGcsGenerate():t.horizonPcsGenerate();if(!o||!r?.length)return null;let n=!1,s=r.find(f=>f.getInclusive()===1&&f.getKind()===1);if(!s){if(s=r.find(f=>f.getInclusive()===1&&f.getKind()===0),!s)return null;n=!0}const c=i?0:(o.getNorthPoleLocation()===2?1:0)|(o.getSouthPoleLocation()===2?2:0),l=o.isPannableRectangle(),a=s.getCoord();if(n)return{isEnvelope:n,isPannable:l,vertices:a,coef:null,bbox:[a[0][0]-e,a[0][1]-e,a[1][0]+e,a[1][1]+e],poleLocation:c};let u=0;const d=[];let[h,m]=a[0],[x,p]=a[0];for(let f=0,M=a.length;f<M;f++){u++,u===M&&(u=0);const[g,y]=a[f],[w,R]=a[u];if(R===y)d.push([g,w,y,R,2]);else{const S=(w-g)/(R-y||1e-4),b=g-S*y;y<R?d.push([S,b,y,R,0]):d.push([S,b,R,y,1])}h=h<g?h:g,m=m<y?m:y,x=x>g?x:g,p=p>y?p:y}return{isEnvelope:!1,isPannable:l,vertices:a,coef:d,bbox:[h,m,x,p],poleLocation:c}}function st(t,e){const i=[],{cols:o,rows:r,xres:n,yres:s,usePixelCenter:c}=t;let{xmin:l,ymax:a}=t;if(c&&(l+=n/2,a-=s/2),e==null){for(let m=0;m<o;m++)for(let x=0;x<r;x++)i.push([l+n*m,a-s*x]);return{points:i}}const u=new Uint8Array(o*r);if(e.isEnvelope){const{bbox:[m,x,p,f]}=e;for(let M=0,g=0;M<o;M++){const y=l+n*M,w=e.isPannable||y>=m&&y<=p;for(let R=0;R<r;R++,g++){const S=a-s*R;w&&S>=x&&S<=f&&(i.push([y,S]),u[g]=1)}}return{points:i,mask:u}}const d=e.coef,h=[];for(let m=0;m<r;m++){const x=a-s*m,p=[],f=[];for(let g=0;g<d.length;g++){const[y,w,R,S,b]=d[g];if(x===R&&R===S)p.push(y),p.push(w),f.push(2),f.push(2);else if(x>=R&&x<=S){const P=y*x+w;p.push(P),f.push(b)}}let M=p;if(p.length>2){let g=f[0]===2?0:f[0],y=p[0];M=[];for(let w=1;w<f.length;w++)f[w]===2&&w!==f.length-1||(f[w]!==g&&(M.push(g===0?Math.min(y,p[w-1]):Math.max(y,p[w-1])),g=f[w],y=p[w]),w===f.length-1&&M.push(f[w]===0?Math.min(y,p[w]):Math.max(y,p[w])));M.sort((w,R)=>w-R)}else p[0]>p[1]&&(M=[p[1],p[0]]);h.push(M)}for(let m=0,x=0;m<o;m++){const p=l+n*m;for(let f=0;f<r;f++,x++){const M=a-s*f,g=h[f];if(g.length===2)p>=g[0]&&p<=g[1]&&(i.push([p,M]),u[x]=1);else if(g.length>2){let y=!1;for(let w=0;w<g.length;w+=2)if(p>=g[w]&&p<=g[w+1]){y=!0;break}y&&(i.push([p,M]),u[x]=1)}}}return{points:i,mask:u}}function Ft(t,e){const[i,o]=e;for(let r=0;r<t.length;r++){const n=t[r][1];(n<i||n>o)&&(t[r]=[NaN,NaN])}}function Mt(t,e){const i=k(t[0].spatialReference);if(t.length<2||i==null||(e=e??E(t[0].spatialReference),(t=t.filter(c=>c.width>e)).length===1))return t[0];let{xmin:o,xmax:r,ymin:n,ymax:s}=t[0];for(let c=1;c<t.length;c++){const l=t[c];r=l.xmax+i*c,n=Math.min(n,l.ymin),s=Math.max(s,l.ymax)}return new B({xmin:o,xmax:r,ymin:n,ymax:s,spatialReference:t[0].spatialReference})}function Rt(t,e,i=null,o=!0){const r=t.spatialReference;if(r.equals(e)||!e)return t;const n=rt(t),s=k(r,!0),c=k(e);if(n===0||s==null||c==null){const u=nt(t,e,i,o);if(u&&s==null&&c!=null&&Math.abs(u.width-c)<E(e)&&N.isLoaded()){const d=L(r);if(d!=null&&d.poleLocation===U.None&&t.width<(d.bbox[2]-d.bbox[0])/2)return qt(t,e)||u}return u}const l=t.clone().normalize();if(l.length===1&&t.xmax<s&&t.xmax-s/2>E(r)){const{xmin:u,xmax:d}=t;for(let h=0;h<=n;h++){const m=h===0?u:-s/2,x=h===n?d-s*h:s/2;l[h]=new B({xmin:m,xmax:x,ymin:t.ymin,ymax:t.ymax,spatialReference:r})}}const a=l.map(u=>nt(u,e,i,o)).filter(_t);return a.length===0?null:Mt(a)}function Kt(t,e,i){if(t.type==="extent"){const{xmin:o,ymin:r,xmax:n,ymax:s,spatialReference:c}=t;t=new it({rings:[[[o,s],[n,s],[n,r],[o,r],[o,s]]],spatialReference:c})}return t.spatialReference.equals(e)?t:(j(),N.execute(t,e,{geographicTransformation:i}))}function qt(t,e){const i=k(e);if(i==null)return null;let{xmin:o,ymin:r,xmax:n,ymax:s}=t;const c=t.spatialReference,l=new it({spatialReference:c,rings:[[[o,r],[n,r],[n,s],[o,s],[o,r]]]}),a=N.execute(l,e);if(a.rings.length!==2||!a.rings[0].length||!a.rings[1].length)return null;const{rings:u}=a,d=E(c),h=new B({spatialReference:e});for(let m=0;m<2;m++){o=n=u[m][0][0],r=s=u[m][0][1];for(let x=0;x<u[m].length;x++)o=o>u[m][x][0]?u[m][x][0]:o,n=n<u[m][x][0]?u[m][x][0]:n,r=r>u[m][x][1]?u[m][x][1]:r,s=s<u[m][x][1]?u[m][x][1]:s;if(m===0)h.ymin=r,h.ymax=s,h.xmin=o,h.xmax=n;else if(h.ymin=Math.min(h.ymin,r),h.ymax=Math.max(h.ymax,s),Math.abs(n-i/2)<d)h.xmin=o,h.xmax=h.xmax+i;else{if(!(Math.abs(o+i/2)<d))return null;h.xmax=n+i}}return h}function nt(t,e,i,o=!0,r=!0){const n=t.spatialReference;if(n.equals(e)||!e)return t;j();const s=N.execute(t,e,{geographicTransformation:i});if(r&&e.isWebMercator&&s&&(s.ymax=Math.min(20037508342787e-6,s.ymax),s.ymin=Math.max(-20037508342787e-6,s.ymin),s.ymin>=s.ymax))return null;if(!o||!s)return s;const c=J(n,!0),l=J(e,!0);if(c==null||l==null)return s;const a=E(n,.001),u=E(n,$),d=E(e,.001);if(Math.abs(s.xmin-l[0])<d&&Math.abs(s.xmax-l[1])<d){const h=Math.abs(t.xmin-c[0]),m=Math.abs(c[1]-t.xmax);if(h<a&&m>u){s.xmin=l[0];const x=[];x.push(new _(t.xmax,t.ymin,n)),x.push(new _(t.xmax,(t.ymin+t.ymax)/2,n)),x.push(new _(t.xmax,t.ymax,n));const p=x.map(f=>xt(f,e,i)).filter(f=>!isNaN(f?.x)).map(f=>f.x);s.xmax=Math.max.apply(null,p)}if(m<a&&h>u){s.xmax=l[1];const x=[];x.push(new _(t.xmin,t.ymin,n)),x.push(new _(t.xmin,(t.ymin+t.ymax)/2,n)),x.push(new _(t.xmin,t.ymax,n));const p=x.map(f=>xt(f,e,i)).filter(f=>!isNaN(f?.x)).map(f=>f.x);s.xmin=Math.min.apply(null,p)}}else{const h=E(e,.001);Math.abs(s.xmin-l[0])<h&&(s.xmin=l[0]),Math.abs(s.xmax-l[1])<h&&(s.xmax=l[1])}return s}function k(t,e=!1){if(!t)return null;const i=e?20037508342787e-6:20037508342788905e-9;return t.isWebMercator?2*i:t.wkid&&t.isGeographic?360:2*zt[t.wkid]||null}function J(t,e=!1){if(t.isGeographic)return[-180,180];const i=k(t,e);return i!=null?[-i/2,i/2]:null}function mt(t,e,i,o){let r=(t-e)/i;return r-Math.floor(r)!==0?r=Math.floor(r):o&&(r-=1),r}function rt(t,e=!1){const i=k(t.spatialReference);if(i==null)return 0;const o=e?0:-(i/2),r=E(t.spatialReference),n=!e&&Math.abs(t.xmax-i/2)<r?i/2:t.xmax,s=!e&&Math.abs(t.xmin+i/2)<r?-i/2:t.xmin;return mt(n,o,i,!0)-mt(s,o,i,!1)}function Qt(t){const e=t.storageInfo.origin.x,i=k(t.spatialReference,!0);if(i==null)return{originX:e,halfWorldWidth:null,pyramidsInfo:null};const o=i/2,{nativePixelSize:r,storageInfo:n,extent:s}=t,{maximumPyramidLevel:c,blockWidth:l,pyramidScalingFactor:a}=n;let u=r.x;const d=[],h=t.transform!=null&&t.transform.type==="gcs-shift",m=e+(h?0:o),x=h?i-e:o-e;for(let p=0;p<=c;p++){const f=(s.xmax-e)/u/l,M=f-Math.floor(f)===0?f:Math.ceil(f),g=x/u/l,y=g-Math.floor(g)===0?g:Math.ceil(g),w=Math.floor(m/u/l),R=Math.round(m/u)%l,S=(l-Math.round(x/u)%l)%l;d.push({resolutionX:u,blockWidth:l,datasetColumnCount:M,worldColumnCountFromOrigin:y,leftMargin:R,rightPadding:S,originColumnOffset:w}),u*=a}return{originX:e,halfWorldWidth:o,pyramidsInfo:d,hasGCSSShiftTransform:h}}function Yt(t){if(!t||t.isGeographic)return t;const e=String(t.wkid||t.wkt2||t.wkt);let i;return K.has(e)?i=K.get(e):(i=(t.wkid?v.coordsys(t.wkid):v.fromString(T.PE_TYPE_PROJCS,t.wkt2||t.wkt)).getGeogcs().getCode(),K.set(e,i)),new dt({wkid:i})}function Ut(t){const e=t.isAdaptive&&t.spacing==null;let i=t.spacing||[Y,Y],o=Q(t),r={cols:o.size[0]+1,rows:o.size[1]+1};const n=o.outofBoundPointCount>0&&o.outofBoundPointCount<o.offsets.length/2;let s=o.outofBoundPointCount===o.offsets.length/2||e&&n?[0,0]:ut(o.offsets,r,i,V);const c=(s[0]+s[1])/2,l=t.projectedExtent.spatialReference,a=t.srcBufferExtent.spatialReference;if(e&&(n||c>V)&&(l.isGeographic||L(l),i=[D,D],o=Q({...t,spacing:i}),r={cols:o.size[0]+1,rows:o.size[1]+1},s=ut(o.offsets,r,i,V)),o.error=s,i[0]>1&&(o.coefficients=pt(o.offsets,r,n)),t.includeGCSGrid&&!l.isGeographic&&!l.isWebMercator)if(a.isGeographic)o.gcsGrid={offsets:o.offsets,coefficients:o.coefficients,spacing:i};else{const u=L(l);if(u!=null&&!u.isEnvelope){const d=Yt(l),h=Rt(t.projectedExtent,d),{offsets:m}=Q({...t,srcBufferExtent:h,spacing:i}),x=pt(m,r,n);o.gcsGrid={offsets:m,coefficients:x,spacing:i}}}return o}function Q(t){const{projectedExtent:e,srcBufferExtent:i,pixelSize:o,datumTransformation:r,rasterTransform:n}=t,s=e.spatialReference,c=i.spatialReference;j();const{xmin:l,ymin:a,xmax:u,ymax:d}=e,h=k(c),m=h!=null&&(t.hasWrapAround||n?.type==="gcs-shift"),x=t.spacing||[Y,Y],p=x[0]*o.x,f=x[1]*o.y,M=x[0]===1,g=Math.ceil((u-l)/p-.1/x[0])+(M?0:1),y=Math.ceil((d-a)/f-.1/x[1])+(M?0:1),w=Wt({cols:g,rows:y,xmin:l,ymax:d,xres:p,yres:f,inSR:s,outSR:c,datumTransformation:r,preferPE:x[0]<=D,usePixelCenter:M}),R=[];let S,b=0;const P=M?-1:NaN,{xmin:C,xmax:O,ymax:X,width:Pt,height:St}=i,bt=E(c,$),Gt=h!=null&&C>0&&O>h/2,at=L(s),Et=at!=null&&at.poleLocation>0;for(let W=0;W<g;W++){const H=[];for(let I=0;I<y;I++){let G=w[W*y+I];if(m&&G[0]>O&&G[0]>h/2-bt?G[0]-=h:m&&W===0&&G[0]<0&&Gt&&!n&&(G[0]+=h),!G||isNaN(G[0])||isNaN(G[1]))R.push(P),R.push(P),H.push(null),b++;else{if(n){const lt=n.inverseTransform(new _({x:G[0],y:G[1],spatialReference:c}));G=[lt.x,lt.y]}H.push(G),W>0&&m&&S[I]&&G[0]<S[I][0]&&(G[0]+=h,Et&&G[0]>O&&G[0]>h&&(G[0]-=h)),R.push((G[0]-C)/Pt),R.push((X-G[1])/St)}}S=H}return{offsets:R,error:null,coefficients:null,outofBoundPointCount:b,spacing:x,size:M?[g,y]:[g-1,y-1]}}function pt(t,e,i){const{cols:o,rows:r}=e,n=new Float32Array((o-1)*(r-1)*2*6),s=new Float32Array([-0,-1,1,-1,1,-0,1,-0,-0]),c=new Float32Array([-1,1,0,0,-1,1,1,0,0]);for(let l=0;l<o-1;l++){for(let a=0;a<r-1;a++){let u=l*r*2+2*a;const d=t[u],h=t[u+1],m=t[u+2],x=t[u+3];u+=2*r;const p=t[u],f=t[u+1],M=t[u+2],g=t[u+3];let y=0,w=12*(a*(o-1)+l);for(let R=0;R<3;R++)n[w++]=s[y++]*d+s[y++]*m+s[y++]*M;y=0;for(let R=0;R<3;R++)n[w++]=s[y++]*h+s[y++]*x+s[y++]*g;y=0;for(let R=0;R<3;R++)n[w++]=c[y++]*d+c[y++]*p+c[y++]*M;y=0;for(let R=0;R<3;R++)n[w++]=c[y++]*h+c[y++]*f+c[y++]*g}if(i)for(let a=0;a<n.length;a++)isNaN(n[a])&&(n[a]=-1)}return n}function Dt(t,e){const i=t.clone().normalize();return i.length===1?i[0]:Mt(i,e)}function te(t){const{spatialReference:e}=t,i=kt(e);if(!i)return t;const[o,r]=i.valid,n=r-o;let s=0;if(t.xmin<o){const c=o-t.xmin;s=Math.ceil(c/n)}else if(t.xmin>r){const c=t.xmin-r;s=-Math.ceil(c/n)}return new B({spatialReference:t.spatialReference,xmin:t.xmin+s*n,ymin:t.ymin,xmax:t.xmax+s*n,ymax:t.ymax})}function ee(t,e,i){const{storageInfo:o,pixelSize:r}=e;let n=0,s=!1;const{pyramidResolutions:c}=o,l=o.tileInfo.format?.toLowerCase()==="mixed"?Math.max(1,Math.min(3,o.tileInfo.dpi/96)):1,a=(t.x+t.y)/2/l;if(c!=null&&c.length){const x=c[c.length-1],p=(x.x+x.y)/2,f=(r.x+r.y)/2;if(a<=f)n=0;else if(a>=p)n=c.length,s=a/p>8;else{let g,y=f;for(let w=1;w<=c.length;w++){if(g=(c[w-1].x+c[w-1].y)/2,a<=g){a===g?n=w:i==="down"?(n=w-1,s=a/y>8):n=i==="up"||a-y>g-a||a/y>2?w:w-1;break}y=g}}const M=n===0?r:c[n-1];return s&&Math.min(M.x,M.y)*z(e.spatialReference)>19567&&(s=!1),{pyramidLevel:n,pyramidResolution:new _({x:M.x,y:M.y,spatialReference:e.spatialReference}),excessiveReading:s}}const u=Math.log(t.x/r.x)/Math.LN2,d=Math.log(t.y/r.y)/Math.LN2,h=e.storageInfo.maximumPyramidLevel||0;n=i==="down"?Math.floor(Math.min(u,d)):i==="up"?Math.ceil(Math.max(u,d)):Math.round((u+d)/2),n<0?n=0:n>h&&(s=n>h+3,n=h);const m=2**n;return{pyramidLevel:n,pyramidResolution:new _({x:m*e.nativePixelSize.x,y:m*e.nativePixelSize.y,spatialReference:e.spatialReference}),excessiveReading:s}}function gt(t,e,i=!1){const{pixelSize:o,extent:r}=t,n=Ot(r,e,!1),s=Rt(Dt(r,(o.x+o.y)/16),e,n);return!s||i||rt(s)===0?s:nt(r,e,n)}function ne(t,e,i){const o=i?.tileSize,r=i?.alignGlobalDatasetWithAGOL,{extent:n,spatialReference:s,pixelSize:c}=t,l=tt(c,e,n);if(l==null)return{projectedPixelSize:null,scales:null,srcResolutions:null,isCustomTilingScheme:!1};const a=(l.x+l.y)/2,u=et(a,e),d=e.isGeographic?256/o*2958287637958547e-7:256/o*591657527591555e-6;let h=t.dataType==="vector-magdir"||t.dataType==="vector-uv";const m=gt(t,e,!0),x=Math.min(Math.ceil(Math.log(Math.min(t.width,t.height)/32)/Math.LN2),Math.ceil(Math.log(d/2/u)/Math.LN2));if(!h&&m&&r&&(e.isGeographic||e.isWebMercator)){const b=k(e);if(h=rt(m)>0||b!=null&&m.width>b/4,!h&&b!=null){let P=-1;if(x<3)P=2**x*a*o;else if(t.storageInfo){const{maximumPyramidLevel:O=0,pyramidScalingFactor:X=2}=t.storageInfo;P=X**O*a*o}const C=Math.ceil(b/P);h=C===1||C===2&&b/2-m.xmax<P}}let p,f=u;const M=1.001,g=Math.min(2,Math.max(1.414,t.storageInfo?.pyramidScalingFactor||2));if(h){f=d;const b=e.isGeographic?1341104507446289e-21:.29858214164761665,P=et(b,e),C=e.isGeographic?4326:3857;p=tt({x:b,y:b},s,gt(t,new dt({wkid:C}),!0)),p.x*=f/P,p.y*=f/P}else{p={x:c.x,y:c.y};let b=0;for(;f<d*(M/2)&&b<x;)b++,f*=g,p.x*=g,p.y*=g;Math.max(f,d)/Math.min(f,d)<=M&&(f=d)}const y=[f],w=[{x:p.x,y:p.y}],R=70.5310735,S=Math.min(R,u)/M;for(;f>=S;)f/=g,p.x/=g,p.y/=g,y.push(f),w.push({x:p.x,y:p.y});return{projectedPixelSize:l,scales:y,srcResolutions:w,isCustomTilingScheme:!h}}function $t(t){let e=0;for(const i of t){const o=i.length;let r=i[0][0]*(i[1][1]-i[o-2][1]);for(let n=1;n<o-1;n++)r+=i[n][0]*(i[n+1][1]-i[n-1][1]);e+=r/2}return Math.abs(e)}export{Qt as $,Ut as D,k as E,ne as H,Vt as I,Kt as J,te as U,ee as V,Ht as W,rt as X,gt as c,Ot as g,xt as i,Zt as j,Rt as r};
