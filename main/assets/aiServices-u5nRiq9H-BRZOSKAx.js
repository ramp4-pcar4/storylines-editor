import{l as N,r as T}from"./enum-g1DWyQyu-DKb6jS1y.js";import{i as z,I as Ht,u as Kt,m as Xt}from"./TimeOnly-CGkId3bj-CKWqr-6N.js";import{aT as Qt,l as q,j as d,k as b,G as S,i as v,Z as ft,B as ht,m as dt,o as mt,b8 as I,bP as At,ce as Wt,z as W,cj as $t,ar as te,f as ee,aB as Mt,ch as ne,cd as re,v as w,S as C,n as pt,$ as se,X as yt,h as ae,a6 as ie,bq as oe,N as le,D as ue}from"./main-CKPAMuMz.js";import{n as M}from"./ImmutableArray-CiJxhY8_-Kqx7aWRu.js";import{v as ce,h as Ot}from"./shared-DttuBH5Z-DCbw84Bb.js";import{M as fe,z as he}from"./number-mnL_JN3f-_-JYORno.js";import{t as de}from"./commonProperties-D1Pjvz5u-DHiB1uzW.js";import{J as me,m as pe,d as ye}from"./utils-BO8hgPs3-DlaAfBsx.js";import"./UnknownTimeZone-DxjyzFvs-CR_Jjq_7.js";import"./Field-BIQ-quF4-9XHTYQ2U.js";import"./fieldType-PhcL4ff8-DWQ9tbHz.js";function ge(t){if(typeof t=="string")return t.toLowerCase();if("name"in t)return t.name.toLowerCase();if(typeof t.value!="string")throw new N(null,T.InvalidIdentifier,null);return t.value.toLowerCase()}const cn=Object.freeze({aborted:!1});let gt=class{};class B{constructor(){}}function Dt(t,e,n){if(t instanceof B&&!(t instanceof it)){const r=new it;return r.fn=t,r.parameterEvaluator=n,r.context=e,r}return t}let fn=class extends B{constructor(t){super(),this.fn=t}createFunction(t){return(...e)=>this.fn(t,{preparsed:!0,arguments:e})}call(t,e){return this.fn(t,e)}marshalledCall(t,e,n,r){return r(t,e,(s,a,i)=>{i=i.map(u=>u instanceof B&&!(u instanceof it)?Dt(u,t,r):u);const o=this.call(n,{args:i});return Qt(o)?o.then(u=>Dt(u,n,r)):o})}},it=class extends B{constructor(){super(...arguments),this.fn=null,this.context=null}createFunction(t){return this.fn.createFunction(this.context)}call(t,e){return this.fn.marshalledCall(t,e,this.context,this.parameterEvaluator)}marshalledCall(t,e,n){return this.fn.marshalledCall(t,e,this.context,this.parameterEvaluator)}},K=class Jt extends M{constructor(e,n,r,s,a,i){super(e),this._lazyPt=[],this._hasZ=!1,this._hasM=!1,this._spRef=n,this._hasZ=r,this._hasM=s,this._cacheId=a,this._partId=i}get(e){if(this._lazyPt[e]===void 0){const n=this._elements[e];if(n===void 0)return;const r=new q(n[0],n[1],this._spRef);this._hasZ&&(r.z=n[2]),this._hasM&&(r.m=this._hasZ?n[3]:n[2]),r.cache._arcadeCacheId=this._cacheId.toString()+"-"+this._partId.toString()+"-"+e.toString(),this._lazyPt[e]=r}return this._lazyPt[e]}equalityTest(e){return e===this||e!==null&&e instanceof Jt&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()+"-"+this._partId.toString()}};class bt extends M{constructor(e,n,r,s,a){super(e),this._lazyPath=[],this._hasZ=!1,this._hasM=!1,this._hasZ=r,this._hasM=s,this._spRef=n,this._cacheId=a}get(e){if(this._lazyPath[e]===void 0){const n=this._elements[e];if(n===void 0)return;this._lazyPath[e]=new K(n,this._spRef,this._hasZ,this._hasM,this._cacheId,e)}return this._lazyPath[e]}equalityTest(e){return e===this||e!==null&&e instanceof bt&&e.getUniqueHash()===this.getUniqueHash()}getUniqueHash(){return this._cacheId.toString()}}let be=class{constructor(t){this.value=t}};class Se{constructor(e){this.value=e}}const _={type:"VOID"},_e=Symbol("BREAK"),we=Symbol("CONTINUE");function E(t,e,n){return e===""||e==null||e===n||e===n?t:t=t.split(e).join(n)}function V(t){return t instanceof B}function St(t){return t instanceof gt}function G(t){return!!d(t)||!!b(t)||!!f(t)||!!p(t)||!!y(t)||!!S(t)||t===null||t===_||typeof t=="number"}function Ne(t,e){return t===void 0?e:t}function Te(t){return t==null?"":v(t)||k(t)?"Array":f(t)?"Date":y(t)?"Time":p(t)?"DateOnly":d(t)?"String":S(t)?"Boolean":b(t)?"Number":t?.declaredClass==="esri.arcade.Attachment"?"Attachment":t?.declaredClass==="esri.arcade.Portal"?"Portal":t?.declaredClass==="esri.arcade.Dictionary"?"Dictionary":vt(t)?"KnowledgeGraph":t instanceof gt?"Module":X(t)?"Feature":t instanceof q?"Point":t instanceof ft?"Polygon":t instanceof ht?"Polyline":t instanceof dt?"Multipoint":t instanceof mt?"Extent":V(t)?"Function":wt(t)?"FeatureSet":Tt(t)?"FeatureSetCollection":_t(t)?"Voxel":t===_?"":typeof t=="number"&&isNaN(t)?"Number":"Unrecognized Type"}function ve(t){return t===_}function nt(t){return t instanceof I}function X(t){return t?.arcadeDeclaredClass==="esri.arcade.Feature"}function _t(t){return t?.arcadeDeclaredClass==="esri.arcade.Voxel"}function wt(t){return t?.declaredRootClass==="esri.arcade.featureset.support.FeatureSet"}function Nt(t){return t?.declaredClass==="esri.arcade.Dictionary"}function xe(t){return Nt(t)||X(t)||_t(t)}function Tt(t){return t?.declaredRootClass==="esri.arcade.featureSetCollection"}function vt(t){return t?.declaredClass==="esri.rest.knowledgeGraph.KnowledgeGraph"}function k(t){return t instanceof M}function f(t){return t instanceof z}function p(t){return t instanceof Ht}function y(t){return t instanceof Kt}function ot(t){return t!=null&&typeof t=="object"}function Lt(t,e,n,r,s){if(t.length<e||t.length>n)throw new N(r,T.WrongNumberOfParameters,s)}function Ce(t){return t<0?-Math.round(-t):Math.round(t)}function xt(t,e){return isNaN(t)||e==null||e===""?t.toString():(e=E(e,"‰",""),e=E(e,"¤",""),he(t,{pattern:e}))}function rt(t,e){return e==null||e===""?t.toISOString(!0):t.toFormat(It(e),{locale:Mt(),numberingSystem:"latn"})}function It(t,e=!1){t=t.replaceAll(/LTS|LT|L{1,4}|l{1,4}/g,"[$&]");let n="";const r=/(\[[^[]*\])|(\\)?([Hh]mm(ss)?|Mo|M{1,4}|Do|DDDo|D{1,4}|d{2,4}|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|Z{1,5}|.)/g;for(const s of t.match(r)||[])switch(s){case"D":n+="d";break;case"DD":n+="dd";break;case"DDD":n+="o";break;case"d":n+="c";break;case"ddd":n+="ccc";break;case"dddd":n+="cccc";break;case"M":n+="L";break;case"MM":n+="LL";break;case"MMM":n+="LLL";break;case"MMMM":n+="LLLL";break;case"YY":n+="yy";break;case"Y":case"YYYY":n+="yyyy";break;case"Q":n+="q";break;case"Z":n+="Z";break;case"ZZ":n+="ZZ";break;case"ZZZ":n+="ZZZ";break;case"ZZZZ":n+=e?"[ZZZZ]":"ZZZZ";break;case"ZZZZZ":n+=e?"[ZZZZZ]":"ZZZZZ";break;case"S":n+="'S'";break;case"SS":n+="'SS'";break;case"SSS":n+="u";break;case"A":case"a":n+="a";break;case"m":case"mm":case"h":case"hh":case"H":case"HH":case"s":case"ss":case"X":case"x":n+=s;break;default:s.length>=2&&s.slice(0,1)==="["&&s.slice(-1)==="]"?n+=`'${s.slice(1,-1)}'`:n+=`'${s}'`}return n}function l(t,e,n){switch(n){case">":return t>e;case"<":return t<e;case">=":return t>=e;case"<=":return t<=e}return!1}function Ze(t,e,n){if(t===null){if(e===null||e===_)return l(null,null,n);if(b(e))return l(0,e,n);if(d(e)||S(e))return l(0,m(e),n);if(f(e))return l(0,e.toNumber(),n);if(y(e)||p(e))return l(t,e.toNumber(),n)}if(t===_){if(e===null||e===_)return l(null,null,n);if(b(e))return l(0,e,n);if(d(e)||S(e))return l(0,m(e),n);if(f(e))return l(0,e.toNumber(),n);if(y(e)||p(e))return l(t,e.toNumber(),n)}else if(b(t)){if(b(e))return l(t,e,n);if(S(e))return l(t,m(e),n);if(e===null||e===_)return l(t,0,n);if(d(e))return l(t,m(e),n);if(f(e)||y(e)||p(e))return l(t,e.toNumber(),n)}else if(d(t)){if(d(e))return l(j(t),j(e),n);if(f(e)||y(e)||p(e))return l(m(t),e.toNumber(),n);if(b(e))return l(m(t),e,n);if(e===null||e===_)return l(m(t),0,n);if(S(e))return l(m(t),m(e),n)}else if(f(t)){if(f(e))return t.timeZone!==e.timeZone&&(t.isUnknownTimeZone?t=z.arcadeDateAndZoneToArcadeDate(t,e.timeZone):e.isUnknownTimeZone&&(e=z.arcadeDateAndZoneToArcadeDate(e,t.timeZone))),l(t.toNumber(),e.toNumber(),n);if(e===null||e===_)return l(t.toNumber(),0,n);if(b(e))return l(t.toNumber(),e,n);if(S(e)||d(e))return l(t.toNumber(),m(e),n);if(y(e))throw new N(null,T.CannotCompareDateAndTime,null);if(p(e))return l(t.toNumber(),e.toNumber(),n)}else if(S(t)){if(S(e))return l(t,e,n);if(b(e))return l(m(t),m(e),n);if(f(e)||y(e)||p(e))return l(m(t),e.toNumber(),n);if(e===null||e===_)return l(m(t),0,n);if(d(e))return l(m(t),m(e),n)}else if(p(t)){if(f(e))return l(t.toNumber(),e.toNumber(),n);if(e===null||e===_)return l(t.toNumber(),0,n);if(b(e))return l(t.toNumber(),e,n);if(S(e)||d(e))return l(t.toNumber(),m(e),n);if(y(e))throw new N(null,T.CannotCompareDateAndTime,null);if(p(e))return l(t.toNumber(),e.toNumber(),n)}else if(y(t)){if(f(e))throw new N(null,T.CannotCompareDateAndTime,null);if(e===null||e===_)return l(t.toNumber(),0,n);if(b(e))return l(t.toNumber(),e,n);if(S(e)||d(e))return l(t.toNumber(),m(e),n);if(y(e))return l(t.toNumber(),e.toNumber(),n);if(p(e))throw new N(null,T.CannotCompareDateAndTime,null)}return!!Pt(t,e)&&(n==="<="||n===">=")}function Pt(t,e){if(t===e||t===null&&e===_||e===null&&t===_)return!0;if(f(t)&&f(e)||y(t)&&y(e)||p(t)&&p(e))return t.equals(e);if(t instanceof bt||t instanceof K)return t.equalityTest(e);if(t instanceof q&&e instanceof q){const n=t.cache._arcadeCacheId,r=e.cache._arcadeCacheId;if(n!=null)return n===r}return!!(ot(t)&&ot(e)&&(t._arcadeCacheId===e._arcadeCacheId&&t._arcadeCacheId!==void 0&&t._arcadeCacheId!==null||t._underlyingGraphic===e._underlyingGraphic&&t._underlyingGraphic!==void 0&&t._underlyingGraphic!==null))}function Rt(t,{useNumbersForDates:e}){let n="";for(const r in t){n!==""&&(n+=",");const s=t[r];s==null?n+=JSON.stringify(r)+":null":S(s)||b(s)||d(s)?n+=JSON.stringify(r)+":"+JSON.stringify(s):nt(s)?n+=JSON.stringify(r)+":"+$(s):y(s)||p(s)?n+=`${JSON.stringify(r)}:${JSON.stringify(s.toString())}`:k(s)||Array.isArray(s)?n+=JSON.stringify(r)+":"+$(s,null,e):f(s)?n+=e?JSON.stringify(r)+":"+JSON.stringify(s.getTime()):JSON.stringify(r)+":"+s.stringify():s!==null&&typeof s=="object"&&"castToText"in s&&(n+=JSON.stringify(r)+":"+s.castToText(e))}return"{"+n+"}"}function j(t,e){if(d(t))return t;if(t===null)return"";if(b(t))return xt(t,e);if(S(t))return t.toString();if(f(t))return rt(t,e);if(y(t)||p(t))return t.toFormat(e);if(t instanceof I)return JSON.stringify(t.toJSON());if(v(t)){const n=[];for(let r=0;r<t.length;r++)n[r]=tt(t[r]);return"["+n.join(",")+"]"}if(t instanceof M){const n=[];for(let r=0;r<t.length();r++)n[r]=tt(t.get(r));return"["+n.join(",")+"]"}return t!==null&&typeof t=="object"&&"castToText"in t?t.castToText():V(t)?"object, Function":t===_?"":St(t)?"object, Module":""}function ke(t){const e=[];if(t instanceof M){for(let n=0;n<t.length();n++)e[n]=m(t.get(n));return e}if(!v(t))return null;for(let n=0;n<t.length;n++)e[n]=m(t[n]);return e}function $(t,e,n=!1){if(d(t))return t;if(t===null)return"";if(b(t))return xt(t,e);if(S(t))return t.toString();if(f(t))return rt(t,e);if(y(t)||p(t))return t.toFormat(e);if(t instanceof I)return t instanceof mt?'{"xmin":'+t.xmin.toString()+',"ymin":'+t.ymin.toString()+","+(t.hasZ?'"zmin":'+t.zmin.toString()+",":"")+(t.hasM?'"mmin":'+t.mmin.toString()+",":"")+'"xmax":'+t.xmax.toString()+',"ymax":'+t.ymax.toString()+","+(t.hasZ?'"zmax":'+t.zmax.toString()+",":"")+(t.hasM?'"mmax":'+t.mmax.toString()+",":"")+'"spatialReference":'+lt(t.spatialReference)+"}":lt(t.toJSON(),(r,s)=>r.key===s.key?0:r.key==="spatialReference"?1:s.key==="spatialReference"||r.key<s.key?-1:r.key>s.key?1:0);if(v(t)){const r=[];for(let s=0;s<t.length;s++)r[s]=tt(t[s],n);return"["+r.join(",")+"]"}if(t instanceof M){const r=[];for(let s=0;s<t.length();s++)r[s]=tt(t.get(s),n);return"["+r.join(",")+"]"}return t!==null&&typeof t=="object"&&"castToText"in t?t.castToText(n):V(t)?"object, Function":t===_?"":St(t)?"object, Module":""}function tt(t,e=!1){if(t===null)return"null";if(S(t)||b(t)||d(t))return JSON.stringify(t);if(t instanceof I||t instanceof M||Array.isArray(t))return $(t,null,e);if(f(t))return JSON.stringify(e?t.getTime():rt(t,""));if(y(t)||p(t))return JSON.stringify(t.toString());if(t!==null&&typeof t=="object"){if("castToText"in t)return t.castToText(e)}else if(t===_)return"null";return"null"}function m(t,e){return b(t)?t:t===null||t===""?0:f(t)||p(t)||y(t)?NaN:S(t)?t?1:0:v(t)||t===""||t===void 0?NaN:e!==void 0&&d(t)?(e=E(e,"‰",""),e=E(e,"¤",""),fe(t,{pattern:e})):t===_?0:Number(t)}function Ae(t,e){if(f(t))return t;if(d(t)){const n=Oe(t,e);if(n)return z.dateTimeToArcadeDate(n)}return null}function Oe(t,e){const n=/ (\d\d)/,r=Xt(e);let s=At.fromISO(t,{zone:r});return s.isValid||n.test(t)&&(t=t.replace(n,"T$1"),s=At.fromISO(t,{zone:e}),s.isValid)?s:null}function De(t){return S(t)?t:d(t)?(t=t.toLowerCase())==="true":!!b(t)&&t!==0&&!isNaN(t)}function Fe(t,e){const n=JSON.parse(t);return n&&!n.spatialReference&&(n.spatialReference=e),se(n)}function je(t,e){return t==null?null:(t.spatialReference!==null&&t.spatialReference!==void 0||(t.spatialReference=e),t)}function Me(t){if(t===null)return null;if(t instanceof q)return t.x==="NaN"||t.x===null||isNaN(t.x)?null:t;if(t instanceof ft){if((t.curveRings??t.rings).length===0)return null;for(const e of t.curveRings??t.rings)if(e.length>0)return t;return null}if(t instanceof ht){if((t.curvePaths??t.paths).length===0)return null;for(const e of t.curvePaths??t.paths)if(e.length>0)return t;return null}return t instanceof dt?t.points.length===0?null:t:t instanceof mt?t.xmin==="NaN"||t.xmin===null||isNaN(t.xmin)?null:t:null}function zt(t,e){if(!t||!t.domain)return e;let n=null,r=null;if(f(e))n=e.toNumber();else if(p(e))n=e.toString();else if(y(e))n=e.toStorageString();else if(t.field.type==="string"||t.field.type==="esriFieldTypeString")n=j(e);else{if(e==null)return null;if(e==="")return e;n=m(e)}for(let s=0;s<t.domain.codedValues.length;s++){const a=t.domain.codedValues[s];a.code===n&&(r=a)}return r===null?j(e):r.name}function Yt(t,e){if(!t||!t.domain)return e;let n=null;const r=j(e);for(let s=0;s<t.domain.codedValues.length;s++){const a=t.domain.codedValues[s];a.name===r&&(n=a)}return n===null?e:n.code}function st(t,e,n=null,r=null){if(!e||!e.fields)return null;let s,a,i=null;for(let c=0;c<e.fields.length;c++){const g=e.fields[c];g.name.toLowerCase()===t.toString().toLowerCase()&&(i=g)}if(i===null)throw new N(null,T.FieldNotFound,null,{key:t});let o=e.typeIdField,u="id",h=e.types;if(e.subtypeField&&(o=e.subtypeField,u="code",h=e.subtypes??[]),r===null&&n&&o)r=n.hasField(o)?n.field(o):null;else if(o&&r!==null){let c=!1;for(const g of h||[])if(r===g[u]){c=!0;break}if(!c){for(const g of h||[])if(r===g.name){r=g[u],c=!0;break}}c||(r=null,n&&o&&(r=n.hasField(o)?n.field(o):null))}return r!=null&&h.some(c=>c[u]===r&&(s=c.domains?.[i.name],s&&s.type==="inherited"&&(s=Ft(i.name,e),a=!0),!0)),a||s||(s=Ft(t,e)),{field:i,domain:s}}function Ft(t,e){let n;return e.fields.some(r=>(r.name.toLowerCase()===t.toLowerCase()&&(n=r.domain),!!n)),n}function lt(t,e){e||(e={}),typeof e=="function"&&(e={cmp:e});const n=typeof e.cycles=="boolean"&&e.cycles,r=e.cmp&&(s=e.cmp,function(i){return function(o,u){const h={key:o,value:i[o]},c={key:u,value:i[u]};return s(h,c)}});var s;const a=[];return function i(o){if(o?.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o===void 0)return;if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);let u,h;if(Array.isArray(o)){for(h="[",u=0;u<o.length;u++)u&&(h+=","),h+=i(o[u])||"null";return h+"]"}if(o===null)return"null";if(a.includes(o)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}const c=a.push(o)-1,g=Object.keys(o).sort(r?.(o));for(h="",u=0;u<g.length;u++){const D=g[u],x=i(o[D]);x&&(h&&(h+=","),h+=JSON.stringify(D)+":"+x)}return a.splice(c,1),"{"+h+"}"}(t)}function Je(t){if(t===null)return null;const e=[];for(const n of t)X(n)?e.push(n.geometry()):e.push(n);return e}function U(t,e){if(!(e instanceof q))throw new N(null,T.InvalidParameter,null);t.push(e.hasZ?e.hasM?[e.x,e.y,e.z,e.m]:[e.x,e.y,e.z]:[e.x,e.y])}function Le(t,e){if(v(t)||k(t)){let n=!1,r=!1,s=[],a=e;if(v(t)){for(const i of t)U(s,i);s.length>0&&(a=t[0].spatialReference,n=t[0].hasZ,r=t[0].hasM)}else if(t instanceof K)s=t._elements,s.length>0&&(n=t._hasZ,r=t._hasM,a=t.get(0).spatialReference);else{if(!k(t))throw new N(null,T.InvalidParameter,null);for(const i of t.toArray())U(s,i);s.length>0&&(a=t.get(0).spatialReference,n=t.get(0).hasZ===!0,r=t.get(0).hasM===!0)}return s.length===0?null:(Wt(s)||(s=s.slice().reverse()),new ft({rings:[s],spatialReference:a,hasZ:n,hasM:r}))}return t}function Ie(t,e){if(v(t)||k(t)){let n=!1,r=!1,s=[],a=e;if(v(t)){for(const i of t)U(s,i);s.length>0&&(a=t[0].spatialReference,n=t[0].hasZ===!0,r=t[0].hasM===!0)}else if(t instanceof K)s=t._elements,s.length>0&&(n=t._hasZ,r=t._hasM,a=t.get(0).spatialReference);else if(k(t)){for(const i of t.toArray())U(s,i);s.length>0&&(a=t.get(0).spatialReference,n=t.get(0).hasZ===!0,r=t.get(0).hasM===!0)}return s.length===0?null:new ht({paths:[s],spatialReference:a,hasZ:n,hasM:r})}return t}function Pe(t,e){if(v(t)||k(t)){let n=!1,r=!1,s=[],a=e;if(v(t)){for(const i of t)U(s,i);s.length>0&&(a=t[0].spatialReference,n=t[0].hasZ===!0,r=t[0].hasM===!0)}else if(t instanceof K)s=t._elements,s.length>0&&(n=t._hasZ,r=t._hasM,a=t.get(0).spatialReference);else if(k(t)){for(const i of t.toArray())U(s,i);s.length>0&&(a=t.get(0).spatialReference,n=t.get(0).hasZ===!0,r=t.get(0).hasM===!0)}return s.length===0?null:new dt({points:s,spatialReference:a,hasZ:n,hasM:r})}return t}function ut(t,e=!0){if(t==null)return[];if(v(t)){const n=[];for(const r of t){const s=j(r);(e||s!=="")&&n.push(s)}return n}if(k(t)){const n=[];for(let r=0;r<t.length();r++){const s=j(t.get(r));(e||s!=="")&&n.push(s)}return n}if(G(t)){const n=j(t);if(e||n!=="")return[n]}return[]}let at=0;function Re(t){return at++,at%100==0?(at=0,new Promise(e=>{setTimeout(()=>{e(t)},0)})):t}function ze(t,e,n){switch(n){case"&":return t&e;case"|":return t|e;case"^":return t^e;case"<<":return t<<e;case">>":return t>>e;case">>>":return t>>>e}}function Y(t,e=null){return t==null?null:S(t)||b(t)||d(t)?t:t instanceof I?e?.keepGeometryType===!0?t:t.toJSON():t instanceof M?t.toArray().map(n=>Y(n,e)):Array.isArray(t)?t.map(n=>Y(n,e)):W(t)?t:f(t)?t.toJSDate():y(t)?t.toString():p(t)?t.toJSDate():t!==null&&typeof t=="object"&&t.castAsJson!==void 0?t.castAsJson(e):null}async function Ye(t,e,n,r,s){const a=await Ct(t,e,n);s[r]=a}async function Ct(t,e=null,n=null){if(t instanceof M&&(t=t.toArray()),t==null)return null;if(G(t)||t instanceof I||W(t)||f(t))return Y(t,n);if(Array.isArray(t)){const r=[],s=[];for(const a of t)a===null||G(a)||a instanceof I||W(a)||f(a)?s.push(Y(a,n)):(s.push(null),r.push(Ye(a,e,n,s.length-1,s)));return r.length>0&&await Promise.all(r),s}return t!==null&&typeof t=="object"&&t.castAsJsonAsync!==void 0?t.castAsJsonAsync(e,n):null}function Q(t){return qt(t)?t.parent:t}function qt(t){return t&&"declaredClass"in t&&t.declaredClass==="esri.layers.support.SubtypeSublayer"}function qe(t){return t&&"declaredClass"in t&&t.declaredClass==="esri.layers.SubtypeGroupLayer"}function Ge(t,e,n){const r=Q(t.fullSchema());return r===null||!r.fields?null:st(e,r,t,n)}function Ue(t){const e=Q(t.fullSchema());return e===null?null:e.fields?e.subtypeField?{subtypeField:e.subtypeField,subtypes:e.subtypes?e.subtypes.map(n=>({name:n.name,code:n.code})):[]}:e.typeIdField?{subtypeField:e.typeIdField,subtypes:e.types?e.types.map(n=>({name:n.name,code:n.id})):[]}:null:null}function Ve(t,e,n,r){const s=Q(t.fullSchema());if(s===null||!s.fields)return null;const a=st(e,s,t,r);if(n===void 0)try{n=t.field(e)}catch{return null}return zt(a,n)}function Be(t,e,n,r){const s=Q(t.fullSchema());if(s===null||!s.fields)return null;if(n===void 0){try{n=t.field(e)}catch{return null}return n}return Yt(st(e,s,t,r),n)}function Ee(t){return t?.timeZone??"system"}function He(t){const e=Q(t.fullSchema());if(e===null||!e.fields)return null;const n=[];for(const r of e.fields)n.push(ce(r));return{objectIdField:e.objectIdField,globalIdField:e.globalIdField??"",geometryType:Ot[e.geometryType]===void 0?"":Ot[e.geometryType],fields:n}}function Ke(t,e){const n=z.systemTimeZoneCanonicalName;return t==="system"&&(t=n),{version:Gt,engineVersion:$t,timeZone:t,userTimeZone:n,spatialReference:e instanceof te?e.toJSON():e,application:ee.applicationName??"",engine:"web",locale:Mt()}}const Gt="1.32",hn=Object.freeze(Object.defineProperty({__proto__:null,ImplicitResult:Se,ReturnResult:be,absRound:Ce,arcadeVersion:Gt,autoCastArrayOfPointsToMultiPoint:Pe,autoCastArrayOfPointsToPolygon:Le,autoCastArrayOfPointsToPolyline:Ie,autoCastFeatureToGeometry:Je,binaryOperator:ze,breakResult:_e,castAsJson:Y,castAsJsonAsync:Ct,castRecordToText:Rt,continueResult:we,defaultExecutingContext:Ke,defaultTimeZone:Ee,defaultUndefined:Ne,equalityTest:Pt,featureDomainCodeLookup:Be,featureDomainValueLookup:Ve,featureFullDomain:Ge,featureSchema:He,featureSubtypes:Ue,fixNullGeometry:Me,fixSpatialReference:je,formatDate:rt,formatNumber:xt,getDomain:st,getDomainCode:Yt,getDomainValue:zt,getType:Te,greaterThanLessThan:Ze,isArray:v,isBoolean:S,isDate:f,isDateOnly:p,isDictionary:Nt,isDictionaryLike:xe,isFeature:X,isFeatureSet:wt,isFeatureSetCollection:Tt,isFunctionParameter:V,isGeometry:nt,isGraphic:ne,isImmutableArray:k,isInteger:re,isJsDate:W,isKnowledgeGraph:vt,isModule:St,isNumber:b,isObject:ot,isSimpleType:G,isString:d,isSubtypeGrouplayer:qe,isSubtypeSublayer:qt,isTime:y,isVoid:ve,isVoxel:_t,multiReplace:E,parseGeometryFromJson:Fe,pcCheck:Lt,stableStringify:lt,standardiseDateFormat:It,tick:Re,toBoolean:De,toDate:Ae,toNumber:m,toNumberArray:ke,toString:j,toStringArray:ut,toStringExplicit:$,voidOperation:_},Symbol.toStringTag,{value:"Module"}));function dn(t){Ut=t}let Ut;function ct(t){return t===null?null:f(t)?t.clone():G(t)?t:nt(t)?t.clone():k(t)?t.toArray().map(e=>ct(e)):v(t)?t.map(e=>ct(e)):X(t)?Ut.createFromArcadeFeature(t):Tt(t)||wt(t)?t:Nt(t)||t?.declaredClass==="esri.arcade.Attachment"?t.deepClone():(t?.declaredClass==="esri.arcade.Portal"||vt(t)||t instanceof gt||V(t),t)}function et(t,e,n=!1,r=!1){if(t==null)return null;if(b(t)||S(t)||d(t)||f(t)||p(t)||y(t))return t;if(v(t)){const a=[];for(const i of t)a.push(et(i,e,n,r));return a}if(r&&nt(t))return t;const s=new O;s.immutable=!1;for(const[a,i]of Object.entries(t))i!==void 0&&s.setField(a,et(i,e,n,r));return s.immutable=n,s}class O{constructor(e){this.declaredClass="esri.arcade.Dictionary",this.plain=!1,this.immutable=!0,e instanceof O?this.attributes=e.attributes:e==null?this.attributes=Object.create(null):Object.getPrototypeOf(e)!=null?this.attributes={__proto__:null,...e}:this.attributes=e}static containerEntry(e,n){return new O({__proto__:null,key:e,value:n})}static textFormatting(){const e=new O({__proto__:null,newline:`
`,tab:"	",singlequote:"'",doublequote:'"',forwardslash:"/",backwardslash:"\\"});return e.immutable=!1,e}field(e){const n=e.toLowerCase(),r=this.attributes[e];if(r!==void 0)return r;for(const s in this.attributes)if(s.toLowerCase()===n)return this.attributes[s];throw new N(null,T.FieldNotFound,null,{key:e})}setField(e,n){if(this.immutable)throw new N(null,T.Immutable,null);if(V(n))throw new N(null,T.NoFunctionInDictionary,null);const r=e.toLowerCase();if(n instanceof Date&&(n=z.dateJSToArcadeDate(n)),this.attributes[e]===void 0){for(const s in this.attributes)if(s.toLowerCase()===r)return void(this.attributes[s]=n);this.attributes[e]=n}else this.attributes[e]=n}hasField(e){const n=e.toLowerCase();if(this.attributes[e]!==void 0)return!0;for(const r in this.attributes)if(r.toLowerCase()===n)return!0;return!1}keys(){let e=[];for(const n in this.attributes)e.push(n);return e=e.sort(),e}castToText(e=!1){return Rt(this.attributes,{useNumbersForDates:e})}static convertObjectToArcadeDictionary(e,n,r=!0,s=!1){const a=new O;a.immutable=!1;for(const i in e){const o=e[i];o!==void 0&&a.setField(i.toString(),et(o,n,r,s))}return a.immutable=r,a}static convertJsonToArcade(e,n,r=!1,s=!1){return et(e,n,r,s)}castAsJson(e=null){const n=Object.create(null);for(let r in this.attributes){const s=this.attributes[r];s!==void 0&&(e?.keyTranslate&&(r=e.keyTranslate(r)),n[r]=Y(s,e))}return n}async castDictionaryValueAsJsonAsync(e,n,r,s=null,a){const i=await Ct(r,s,a);return e[n]=i,i}async castAsJsonAsync(e=null,n=null){const r=Object.create(null),s=[];for(let a in this.attributes){const i=this.attributes[a];n?.keyTranslate&&(a=n.keyTranslate(a)),i!==void 0&&(G(i)||i instanceof I||i instanceof z?r[a]=Y(i,n):s.push(this.castDictionaryValueAsJsonAsync(r,a,i,e,n)))}return s.length>0&&await Promise.all(s),r}deepClone(){const e=new O;e.immutable=!1;for(const n of this.keys())e.setField(n,ct(this.field(n)));return e}}let F=class extends yt{constructor(t){super(t),this.text=null,this.detectedLanguage="en",this.detectedLanguageScore=-1}};w([C({type:String,json:{write:!0}})],F.prototype,"key",void 0),w([C({type:String,json:{write:!0}})],F.prototype,"text",void 0),w([C({type:String,json:{read:{source:"detectedLanguage.language"},write:{target:"detectedLanguage.language"}}})],F.prototype,"detectedLanguage",void 0),w([C({type:Number,json:{read:{source:"detectedLanguage.score"},write:{target:"detectedLanguage.score"}}})],F.prototype,"detectedLanguageScore",void 0),w([C({type:Object,json:{write:!0}})],F.prototype,"translation",void 0),F=w([pt("esri.rest.support.TranslateResult")],F);async function Xe(t,e,n){const r=e.toJSON();r.contents=JSON.stringify(r.contents),r.token=await me(e.portalUrl,e.apiKey,{signal:n?.signal,prompt:n?.authMode!=="no-prompt"});const s=pe(t),a=ye(s.query,{...n,query:r,method:"post",authMode:"anonymous"});return(await le(s.path,a)).data.results.map(i=>F.fromJSON(i))}let R=class extends yt{constructor(t){super(t)}};w([C({type:String,json:{write:!0}})],R.prototype,"key",void 0),w([C({type:String,json:{write:!0}})],R.prototype,"text",void 0),R=w([pt("esri.rest.support.TranslateContent")],R);let A=class extends yt{constructor(t){super(t),this.to=null,this.contents=null,this.portalUrl="https://www.arcgis.com",this.translator="esri",this.from=null,this.apiKey=null,this.requestSource=null}};w([C({type:[String],json:{write:!0}})],A.prototype,"to",void 0),w([C({type:[R],json:{write:!0}})],A.prototype,"contents",void 0),w([C({type:String,json:{write:!0}})],A.prototype,"portalUrl",void 0),w([C({type:String,json:{write:!0,default:"esri"}})],A.prototype,"translator",void 0),w([C({type:String,json:{write:!0}})],A.prototype,"from",void 0),w([C(de)],A.prototype,"apiKey",void 0),w([C({type:String,json:{name:"x-esri-request-source"}})],A.prototype,"requestSource",void 0),A=w([pt("esri.rest.support.TranslateParameters")],A);class Zt{constructor(e,n){this.portal=e,this._debugLog=n}async translate(e){this.portal.loaded||await this.portal.load();const n=this.portal.helperServices?.aiUtilityServices;if(n==null)return{success:!1};const r=n.url+n.translateUtility;try{return e.requestSource??="arcade",{success:!0,results:(await Xe(r,e,{authMode:"no-prompt"})).map(s=>s.toJSON())}}catch(s){return this._debugLog!=null&&(s instanceof Error||s instanceof ae)&&this._debugLog(`TranslateText error: ${s.message}`),ie.getLogger("esri.arcade.functions.aiServices").error(s),{success:!1}}}}class Qe{constructor(e,n,r){this._parameters=e,this._maxTotalContentSize=n,this._maxContentsLength=r,this._requests=[],this._normalizedContents=new Map,this._contentsTotalSize=0}tryAdd(e){const n=new Set(e.filter(a=>!this._normalizedContents.has(a.text)).map(a=>a.text));if(this._requests.length+n.size>this._maxContentsLength)return null;let r=0;for(const a of n)r+=a.length;if((r+this._contentsTotalSize)*(this._parameters.to.length??1)>this._maxTotalContentSize)return null;const s=this._requests.length;for(const{key:a,text:i}of e)ue(this._normalizedContents,i,()=>[]).push({batchIdx:s,key:a});return this._requests.push(e),this._contentsTotalSize+=r,s}async send(e){const n=[],r=[];let s=0;for(const[u,h]of this._normalizedContents)n.push(new R({key:String(s++),text:u})),r.push(h);const a=new A(this._parameters);a.contents=n;const i=await e.translate(a);if(!i.success)return Array.from(this._requests,()=>i);const o=Array.from(this._requests,()=>({success:!0,results:[]}));for(const u of i.results){const h=Number(u.key);for(const c of r[h])o[c.batchIdx].results.push({...u,key:c.key})}return o}}function H(t){const e=[...new Set(t.to)].sort(),n=t.from??null,r=t.portalUrl,s=t.translator,a=t.apiKey??null;return JSON.stringify([e,n,r,s,a])}async function jt(t,e,n){try{return(await t.yieldFor(n))[e]}catch{return{success:!1}}}class Vt{constructor(e,n,{maxTotalContentSize:r=5e4,maxContentsLength:s=1e3}={}){this._executor=e,this._service=n,this._openBatches=new Map,this._maxTotalContentSize=r,this._maxContentsLength=s}create(e){return{translate:async n=>{const r=H(n),{contents:s,to:a,from:i,translator:o,portalUrl:u,apiKey:h}=n;if(a==null)return{success:!1};if(s==null||s.every(x=>x.text.length===0))return{success:!1};const c=this._openBatches.get(r);if(c!=null){const x=c.data.tryAdd(s);if(x!=null)return await jt(e,x,c);c.send()}const g=new Qe({to:a,from:i,translator:o,portalUrl:u,apiKey:h},this._maxTotalContentSize,this._maxContentsLength),D=g.tryAdd(s);if(D!=null){const x=this._executor.openBatch(g,{open:P=>{this._openBatches.set(r,P)},execute:P=>P.send(this._service),close:P=>{this._openBatches.get(r)===P&&this._openBatches.delete(r)}});return await jt(e,D,x)}return await this._service.translate(n)}}}}function Bt(t){t.mode==="async"&&(t.functions[ge("TranslateText")]=function(e,n){return t.standardFunctionAsync(e,n,async(r,s,a)=>{if(Lt(a,2,3,r,s),!d(a[0])&&!v(a[0])&&!k(a[0]))throw new N(r,T.InvalidParameter,s);const i=ut(a[0]);if(!d(a[1])&&!v(a[1])&&!k(a[1]))throw new N(r,T.InvalidParameter,s);const o=ut(a[1]);let u=null;if(a.length>=3){if(!d(a[2]))throw new N(r,T.InvalidParameter,s);u=a[2]}const h=i.map((J,Z)=>new R({key:String(Z),text:J})),c=r.services?.portal??oe.getDefault(),g=new A({to:o,contents:h,from:u,portalUrl:c.restUrl.replace(/\/sharing\/rest$/,"")}),D=new Map;let x=null;if(r.lrucache!=null){const J=r.lrucache;x??=H(g),g.contents=g.contents?.filter(Z=>{const L=J.getCachedTranslation(x,Z.text);return L==null||(D.set(Z.key,{...L,key:Z.key,text:Z.text}),!1)})}if(g.contents?.length){const J=r.services?.translation??new Zt(c,r.console),Z=await J.translate(g);if(!Z.success)return new O({__proto__:null,success:!1});for(const L of Z.results){const kt=g.contents?.find(Et=>Et.key===L.key)?.text;if(kt==null)throw new N(null,T.NeverReach,null);D.set(L.key,L),r.lrucache!=null&&(x??=H(g),r.lrucache.setCachedTranslation(x,kt,{detectedLanguage:L.detectedLanguage,translation:L.translation}))}}const P=Array.from(h,J=>{const Z=F.fromJSON(D.get(J.key));if(Z==null)throw new N(null,T.NeverReach,null);return Z.text=J.text,O.convertJsonToArcade(Z.toJSON(),r.timeZone??"system",!0)});return new O({__proto__:null,success:!0,results:P})})})}const mn=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:Vt,PortalTranslationService:Zt,getTranslateParametersKey:H,registerFunctions:Bt},Symbol.toStringTag,{value:"Module"})),pn=Object.freeze(Object.defineProperty({__proto__:null,BatchTranslationServiceFactory:Vt,PortalTranslationService:Zt,getTranslateParametersKey:H,registerFunctions:Bt},Symbol.toStringTag,{value:"Module"}));export{X as $,y as A,Be as B,st as C,zt as D,Nt as E,Rt as F,V as G,nt as H,_ as I,je as J,wt as K,Pe as L,Le as M,m as N,Yt as O,_e as P,xe as Q,Ie as R,Ae as S,De as T,ve as U,ut as V,He as W,Tt as X,we as Y,E as Z,Se as _,Lt as a,Re as a0,qt as a1,K as a2,bt as a3,G as a4,Y as a5,dn as a6,ct as a7,Te as a8,It as a9,Ce as aa,Me as ab,_t as ac,ke as ad,Ke as ae,hn as af,pn as ag,k as b,ze as c,Pt as d,fn as e,Dt as f,gt as g,mn as h,Ee as i,O as j,Ge as k,Ue as l,Ze as m,cn as n,Ve as o,j as p,Ne as q,B as r,it as s,ge as t,$ as u,be as v,Je as w,vt as x,f as y,p as z};
