const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./loader-hV6Mz7xG-DQHONgeH.js","./main-DK5A1thH.js","./main-BRDqyNC1.css","./mat4f64-BaJwL7tQ-k0uMm8LY.js","./enums-DBi1-Mm2-CUS1pvQe.js","./Version-BTMwSXf1-W7KhXniF.js","./mat4-BFStKTjU-BMLpTkEG.js","./common-CYWrYyJl-E8-sukrT.js","./quat-D8L_R4I0-CsHvsQG-.js","./mat3f64-Dh9_zhFu-BIT-k8Dm.js","./quatf64-C16JxGFv-BKWK1F8U.js","./vec32-BuqRmYBM-Docn8r6P.js","./vec42-D8CJyqHG-DnfLTeQH.js","./BufferView-BBCzkcZS-BKSq5J5y.js","./vec2-BnynUbeJ-CKtGJQAy.js","./devEnvironmentUtils-CxrVv3RG-CX5aoxVE.js","./mat3-DOnW3DjW-C3hbW9XY.js","./vec2f64-CEUyUoff-BBc0aQ6D.js","./VerticalOffset.glsl-BtVaDxLq-Bbkz3TDV.js","./Indices-DkAzsiH--DFsJBoBx.js","./InterleavedLayout-DcHoXu73-35D6EIGL.js","./vec4f64-CjUMzAyX-DPYbdAom.js","./triangle-BePBrXJ8-BGvt3tv3.js","./sphere-Cj20syUS-P9gsXSIi.js","./plane-B_adY3_o-Ns1JnzfT.js","./lineSegment-BJNfNZM5-RDIZE__8.js","./renderState-DlSSrLcZ-Du_EmLq6.js","./VertexAttribute-DFC3a3eR-BhmQtMsu.js","./ShaderOutput-C_OqLoo1-jp3zUBgm.js","./BindType-CKbZk6AG-Bqvzo9NX.js","./glsl-o28TenZV-B0eZUNn3.js","./lengthUtils-wU9RRIqK-CcSgrDlT.js","./boundedPlane-B6TkXVHT-y-1QO8ec.js","./ViewingMode-CyR_b1T8-_s7_Gbsk.js","./requestImageUtils-rT_rMd2F-Cv4KeeHw.js","./TextureFormat-Cl0ugX3E-DD0Aw8RG.js","./Texture-DXSFJsEu-0d91IJKM.js","./signal-DxzURL18-BUWbVrim.js","./getDataTypeBytes-HSdrWtlL-ClHsCcSN.js","./orientedBoundingBox-CTsjUkMw-DzdH9G5q.js","./spatialReferenceEllipsoidUtils-DlQOpWof-8b-0SJHm.js","./computeTranslationToOriginAndRotation-DwwrTl3S-JrOuDVP0.js","./projection-m8vi7Cxv-ByA_2Rez.js","./vec3-CRJiMrND-_4JodicD.js","./vec4-DcTMp5mq-dtE5kkDn.js","./vec2f32-CVhmN3Me-DxoqVD7C.js","./memoryEstimations-iHVpvWPf-CMfAjuGi.js","./NestedMap-Ddo7BfvO-BpVPk8mz.js","./DefaultMaterial-DGGIMylx-Co3fv8Ux.js","./NormalAttribute.glsl-C9zbIKka-BQ-gxZja.js","./doublePrecisionUtils-BJbYwoii-kIP-tL_t.js","./ShaderBuilder-BkQM64Qp-Ckh4B6kE.js"])))=>i.map(i=>d[i]);
import{bB as ve,mf as Re,mg as Ae,mh as Me,_ as Be,j7 as ie,jQ as F,iR as W,bD as Se,H as Ie,me as Ee,b as le,bM as K,G as H,c as ue,gi as Y,jV as Oe,iX as ce,cE as D,a8 as _e,a5 as $e}from"./main-DK5A1thH.js";import{m as Pe}from"./devEnvironmentUtils-CxrVv3RG-CX5aoxVE.js";import{X as Le,P as Ue,E as Z}from"./mat3-DOnW3DjW-C3hbW9XY.js";import{n as me,o as G}from"./mat3f64-Dh9_zhFu-BIT-k8Dm.js";import{z as je}from"./mat4-BFStKTjU-BMLpTkEG.js";import{n as Ce}from"./mat4f64-BaJwL7tQ-k0uMm8LY.js";import{_ as Ne}from"./vec2f64-CEUyUoff-BBc0aQ6D.js";import{Z as ee,r as ke,x as te,b as Fe,l as qe,Y as De}from"./vec32-BuqRmYBM-Docn8r6P.js";import{aR as k,aQ as fe,q as de}from"./VerticalOffset.glsl-BtVaDxLq-Bbkz3TDV.js";import{X as pe,L as Ge,C as Ve,l as he,g as ze,M as Xe}from"./BufferView-BBCzkcZS-BKSq5J5y.js";import{_ as Ke,z as He,T as re,R as ne}from"./vec3-CRJiMrND-_4JodicD.js";import{R as Qe,q as oe}from"./vec4-DcTMp5mq-dtE5kkDn.js";import{A as ye,c as Je}from"./Indices-DkAzsiH--DFsJBoBx.js";import{G as se,T as V}from"./enums-DBi1-Mm2-CUS1pvQe.js";import{I as A,c as We,a as X,v as ge}from"./renderState-DlSSrLcZ-Du_EmLq6.js";import{f as Ye,l as Ze}from"./vec2f32-CVhmN3Me-DxoqVD7C.js";import{f as et}from"./memoryEstimations-iHVpvWPf-CMfAjuGi.js";import{s as tt}from"./NestedMap-Ddo7BfvO-BpVPk8mz.js";import{m as xe}from"./Version-BTMwSXf1-W7KhXniF.js";import{r as rt}from"./requestImageUtils-rT_rMd2F-Cv4KeeHw.js";import{M as P}from"./orientedBoundingBox-CTsjUkMw-DzdH9G5q.js";import{T as _}from"./VertexAttribute-DFC3a3eR-BhmQtMsu.js";import{e as nt,p as ot,E as q,K as st,Q as at}from"./DefaultMaterial-DGGIMylx-Co3fv8Ux.js";import{a as ae}from"./NormalAttribute.glsl-C9zbIKka-BQ-gxZja.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./InterleavedLayout-DcHoXu73-35D6EIGL.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./vec4f64-CjUMzAyX-DPYbdAom.js";import"./triangle-BePBrXJ8-BGvt3tv3.js";import"./sphere-Cj20syUS-P9gsXSIi.js";import"./plane-B_adY3_o-Ns1JnzfT.js";import"./quatf64-C16JxGFv-BKWK1F8U.js";import"./lineSegment-BJNfNZM5-RDIZE__8.js";import"./ShaderOutput-C_OqLoo1-jp3zUBgm.js";import"./BindType-CKbZk6AG-Bqvzo9NX.js";import"./glsl-o28TenZV-B0eZUNn3.js";import"./lengthUtils-wU9RRIqK-CcSgrDlT.js";import"./boundedPlane-B6TkXVHT-y-1QO8ec.js";import"./ViewingMode-CyR_b1T8-_s7_Gbsk.js";import"./TextureFormat-Cl0ugX3E-DD0Aw8RG.js";import"./Texture-DXSFJsEu-0d91IJKM.js";import"./signal-DxzURL18-BUWbVrim.js";import"./getDataTypeBytes-HSdrWtlL-ClHsCcSN.js";import"./vec2-BnynUbeJ-CKtGJQAy.js";import"./projection-m8vi7Cxv-ByA_2Rez.js";import"./quat-D8L_R4I0-CsHvsQG-.js";import"./spatialReferenceEllipsoidUtils-DlQOpWof-8b-0SJHm.js";import"./computeTranslationToOriginAndRotation-DwwrTl3S-JrOuDVP0.js";import"./doublePrecisionUtils-BJbYwoii-kIP-tL_t.js";import"./ShaderBuilder-BkQM64Qp-Ckh4B6kE.js";let it=class{constructor(e){this._streamDataRequester=e}async loadJSON(e,t){return this._load("json",e,t)}async loadBinary(e,t){return Se(e)?(Ie(t),Ee(e)):this._load("binary",e,t)}async loadImage(e,t){return this._load("image",e,t)}async _load(e,t,o){if(this._streamDataRequester==null)return(await le(t,{responseType:lt[e]})).data;const r=await K(this._streamDataRequester.request(t,e,o));if(r.ok===!0)return r.value;throw H(r.error),new ue("glt-loader-request-error",`Request for resource failed: ${r.error}`)}};const lt={image:"image",binary:"array-buffer",json:"json","image+type":void 0},B=()=>_e.getLogger("esri.views.3d.layers.graphics.objectResourceUtils");class ut{constructor(t,o,r){this.resource=t,this.textures=o,this.cachedMemory=r}}async function ct(e,t){const o=await mt(e,t),r=await yt(o.textureDefinitions??{},t);let a=0;for(const s in r)if(r.hasOwnProperty(s)){const i=r[s];a+=i?.image?i.image.width*i.image.height*4:0}return new ut(o,r,a+et(o))}async function mt(e,t){const o=t?.streamDataRequester;if(o)return ft(e,o,t);const r=await K(le(e,t));if(r.ok===!0)return r.value.data;H(r.error),Te(r.error)}async function ft(e,t,o){const r=await K(t.request(e,"json",o));if(r.ok===!0)return r.value;H(r.error),Te(r.error.details.url)}function Te(e){throw new ue("",`Request for object resource failed: ${e}`)}function dt(e){const t=e.params,o=t.topology;let r=!0;switch(t.vertexAttributes||(B().warn("Geometry must specify vertex attributes"),r=!1),t.topology){case"PerAttributeArray":break;case"Indexed":case null:case void 0:{const s=t.faces;if(s){if(t.vertexAttributes)for(const i in t.vertexAttributes){const l=s[i];l?.values?(l.valueType!=null&&l.valueType!=="UInt32"&&(B().warn(`Unsupported indexed geometry indices type '${l.valueType}', only UInt32 is currently supported`),r=!1),l.valuesPerElement!=null&&l.valuesPerElement!==1&&(B().warn(`Unsupported indexed geometry values per element '${l.valuesPerElement}', only 1 is currently supported`),r=!1)):(B().warn(`Indexed geometry does not specify face indices for '${i}' attribute`),r=!1)}}else B().warn("Indexed geometries must specify faces"),r=!1;break}default:B().warn(`Unsupported topology '${o}'`),r=!1}e.params.material||(B().warn("Geometry requires material"),r=!1);const a=e.params.vertexAttributes;for(const s in a)a[s].values||(B().warn("Geometries with externally defined attributes are not yet supported"),r=!1);return r}function pt(e,t){const o=new Array,r=new Array,a=new Array,s=new tt,i=e.resource,l=xe.parse(i.version||"1.0","wosr");xt.validate(l);const n=i.model.name,u=i.model.geometries,c=i.materialDefinitions??{},m=e.textures;let h=0;const y=new Map;for(let d=0;d<u.length;d++){const g=u[d];if(!dt(g))continue;const T=gt(g),w=g.params.vertexAttributes,p=[],x=f=>{if(g.params.topology==="PerAttributeArray")return null;const v=g.params.faces;for(const b in v)if(b===f)return v[b].values;return null},L=w[_.POSITION],C=L.values.length/L.valuesPerElement;for(const f in w){const v=w[f],b=v.values,R=x(f)??ye(C);p.push([f,new P(b,R,v.valuesPerElement,!0)])}const S=T.texture,M=m&&m[S];if(M&&!y.has(S)){const{image:f,parameters:v}=M,b=new de(f,v);r.push(b),y.set(S,b)}const N=y.get(S),U=N?N.id:void 0,E=T.material;let I=s.get(E,S);if(I==null){const f=c[E.slice(E.lastIndexOf("/")+1)].params;f.transparency===1&&(f.transparency=0);const v=M&&M.alphaChannelUsage,b=f.transparency>0||v==="transparency"||v==="maskAndTransparency",R=M?be(M.alphaChannelUsage):void 0,J={ambient:Y(f.diffuse),diffuse:Y(f.diffuse),opacity:1-(f.transparency||0),transparent:b,textureAlphaMode:R,textureAlphaCutoff:.33,textureId:U,doubleSided:!0,cullFace:X.None,colorMixMode:f.externalColorMixMode||"tint",textureAlphaPremultiplied:M?.parameters.preMultiplyAlpha??!1};t?.materialParameters&&Object.assign(J,t.materialParameters),I=new q(J,t),s.set(E,S,I)}a.push(I);const O=new fe(I,p);h+=p.find(f=>f[0]===_.POSITION)?.[1]?.indices.length??0,o.push(O)}return{engineResources:[{name:n,stageResources:{textures:r,materials:a,geometries:o},pivotOffset:i.model.pivotOffset,numberOfVertices:h,lodThreshold:null}],referenceBoundingBox:ht(o)}}function ht(e){const t=ie();return e.forEach(o=>{const r=o.boundingInfo;r!=null&&(F(t,r.bbMin),F(t,r.bbMax))}),t}async function yt(e,t){const o=new Array;for(const s in e){const i=e[s],l=i.images[0].data;if(!l){B().warn("Externally referenced texture data is not yet supported");continue}const n=i.encoding+";base64,"+l,u="/textureDefinitions/"+s,c=i.channels==="rgba"?i.alphaChannelUsage||"transparency":"none",m={noUnpackFlip:!0,wrap:{s:se.REPEAT,t:se.REPEAT},preMultiplyAlpha:be(c)!==A.Opaque},h=t?.disableTextures?Promise.resolve(null):rt(n,t);o.push(h.then(y=>({refId:u,image:y,parameters:m,alphaChannelUsage:c})))}const r=await Promise.all(o),a={};for(const s of r)a[s.refId]=s;return a}function be(e){switch(e){case"mask":return A.Mask;case"maskAndTransparency":return A.MaskBlend;case"none":return A.Opaque;default:return A.Blend}}function gt(e){const t=e.params;return{id:1,material:t.material,texture:t.texture,region:t.texture}}const xt=new xe(1,2,"wosr");function Tt(e,t){Q(e.typedBuffer,t.typedBuffer,e.typedBufferStride,t.typedBufferStride)}function Q(e,t,o=2,r=o){const a=t.length/2;let s=0,i=0;if(!ve(t)||Re(t)){for(let n=0;n<a;++n)e[s]=t[i],e[s+1]=t[i+1],s+=o,i+=r;return}const l=Ae(t);if(Me(t))for(let n=0;n<a;++n)e[s]=Math.max(t[i]/l,-1),e[s+1]=Math.max(t[i+1]/l,-1),s+=o,i+=r;else for(let n=0;n<a;++n)e[s]=t[i]/l,e[s+1]=t[i+1]/l,s+=o,i+=r}function bt(e,t,o,r){const a=e.typedBuffer,s=e.typedBufferStride,i=r?.count??e.count;let l=(r?.dstIndex??0)*s;for(let n=0;n<i;++n)a[l]=t,a[l+1]=o,l+=s}Object.freeze(Object.defineProperty({__proto__:null,fill:bt,normalizeIntegerBuffer:Q,normalizeIntegerBufferView:Tt},Symbol.toStringTag,{value:"Module"}));let wt=class{constructor(e){this.data=e,this.type="encoded-mesh-texture",this.encoding=ge.KTX2_ENCODING}};function z(e){return e?.type==="encoded-mesh-texture"}async function Or(e){const t=new Blob([e]),o=await t.text();return JSON.parse(o)}async function _r(e,t){if(t===ge.KTX2_ENCODING)return new wt(e);const o=new Blob([e],{type:t});let r=URL.createObjectURL(o);switch(t){case"image/jpeg":r+="#.jpg";break;case"image/png":r+="#.png"}const a=new Image;if($e("esri-iPhone"))return new Promise((s,i)=>{const l=()=>{u(),s(a)},n=c=>{u(),i(c)},u=()=>{URL.revokeObjectURL(r),a.removeEventListener("load",l),a.removeEventListener("error",n)};a.addEventListener("load",l),a.addEventListener("error",n),a.src=r});try{a.src=r,await a.decode()}catch{console.warn("Failed decoding HTMLImageElement")}return URL.revokeObjectURL(r),a}function vt(e,t){switch(t){case V.TRIANGLES:return Rt(e);case V.TRIANGLE_STRIP:return At(e);case V.TRIANGLE_FAN:return Mt(e)}}function Rt(e){return typeof e=="number"?ye(e):Oe(e)?new Uint16Array(e):e}function At(e){const t=typeof e=="number"?e:e.length;if(t<3)return[];const o=t-2,r=Je(3*o);if(typeof e=="number"){let a=0;for(let s=0;s<o;s+=1)s%2==0?(r[a++]=s,r[a++]=s+1,r[a++]=s+2):(r[a++]=s+1,r[a++]=s,r[a++]=s+2)}else{let a=0;for(let s=0;s<o;s+=1)s%2==0?(r[a++]=e[s],r[a++]=e[s+1],r[a++]=e[s+2]):(r[a++]=e[s+1],r[a++]=e[s],r[a++]=e[s+2])}return r}function Mt(e){const t=typeof e=="number"?e:e.length;if(t<3)return new Uint16Array(0);const o=t-2,r=o<=65536?new Uint16Array(3*o):new Uint32Array(3*o);if(typeof e=="number"){let l=0;for(let n=0;n<o;++n)r[l++]=0,r[l++]=n+1,r[l++]=n+2;return r}const a=e[0];let s=e[1],i=0;for(let l=0;l<o;++l){const n=e[l+2];r[i++]=a,r[i++]=s,r[i++]=n,s=n}return r}function j(e){if(e==null)return null;const t=e.offset!=null?e.offset:Ye,o=e.rotation!=null?e.rotation:0,r=e.scale!=null?e.scale:Ze,a=G(1,0,0,0,1,0,t[0],t[1],1),s=G(Math.cos(o),-Math.sin(o),0,Math.sin(o),Math.cos(o),0,0,0,1),i=G(r[0],0,0,0,r[1],0,0,0,1),l=me();return Z(l,s,i),Z(l,a,l),l}class Bt{constructor(){this.geometries=new Array,this.materials=new Array,this.textures=new Array}}class St{constructor(t,o,r){this.name=t,this.lodThreshold=o,this.pivotOffset=r,this.stageResources=new Bt,this.numberOfVertices=0}}async function It(e,t){const o=we(Pe(e));if(o.fileType==="wosr"){const m=await(t.cache?t.cache.loadWOSR(o.url,t):ct(o.url,t)),{engineResources:h,referenceBoundingBox:y}=pt(m,t);return{lods:h,referenceBoundingBox:y,isEsriSymbolResource:!1,isWosr:!0}}let r;if(t.cache)r=await t.cache.loadGLTF(o.url,t,!!t.usePBR);else{const{loadGLTF:m}=await Be(()=>import("./loader-hV6Mz7xG-DQHONgeH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51]),import.meta.url);r=await m(new it(t.streamDataRequester),o.url,t,t.usePBR)}const a=r.model.meta?.ESRI_proxyEllipsoid,s=r.meta.isEsriSymbolResource&&a!=null&&r.meta.ESRI_webstyle==="EsriRealisticTreesStyle";s&&!r.customMeta.esriTreeRendering&&(r.customMeta.esriTreeRendering=!0,Pt(r,a));const i=!!t.usePBR,l=r.meta.isEsriSymbolResource?{usePBR:i,isSchematic:!1,treeRendering:s,mrrFactors:nt}:{usePBR:i,isSchematic:!1,treeRendering:!1,mrrFactors:ot},n={...t.materialParameters,treeRendering:s},{engineResources:u,referenceBoundingBox:c}=Et(r,l,n,t,o.specifiedLodIndex);return{lods:u,referenceBoundingBox:c,isEsriSymbolResource:r.meta.isEsriSymbolResource,isWosr:!1}}function we(e){const t=e.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return t?{fileType:"gltf",url:t[1],specifiedLodIndex:t[4]!=null?Number(t[4]):null}:e.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:e,specifiedLodIndex:null}:{fileType:"unknown",url:e,specifiedLodIndex:null}}function Et(e,t,o,r,a){const s=e.model,i=new Array,l=new Map,n=new Map,u=s.lods.length,c=ie();return s.lods.forEach((m,h)=>{const y=r.skipHighLods===!0&&(u>1&&h===0||u>3&&h===1)||r.skipHighLods===!1&&a!=null&&h!==a;if(y&&h!==0)return;const d=new St(m.name,m.lodThreshold,[0,0,0]);m.parts.forEach(g=>{const T=y?new q({},r):Ot(s,g,d,t,o,l,n,r),{geometry:w,vertexCount:p}=_t(g,T??new q({},r)),x=w.boundingInfo;x!=null&&h===0&&(F(c,x.bbMin),F(c,x.bbMax)),T!=null&&(d.stageResources.geometries.push(w),d.numberOfVertices+=p)}),y||i.push(d)}),{engineResources:i,referenceBoundingBox:c}}function Ot(e,t,o,r,a,s,i,l){const n=e.materials.get(t.material);if(n==null)return null;const{normal:u,color:c,texCoord0:m,tangent:h}=t.attributes,y=t.material+(u?"_normal":"")+(c?"_color":"")+(m?"_texCoord0":"")+(h?"_tangent":""),d=t.attributes.texCoord0!=null,g=t.attributes.normal!=null,T=$t(n.alphaMode);if(!s.has(y)){if(d){const O=(f,v=!1)=>{if(f!=null&&!i.has(f)){const b=e.textures.get(f);if(b){const R=b.data;i.set(f,new de(z(R)?R.data:R,{...b.parameters,preMultiplyAlpha:!z(R)&&v,encoding:z(R)?R.encoding:void 0}))}}};O(n.colorTexture,T!==A.Opaque),O(n.normalTexture),O(n.occlusionTexture),O(n.emissiveTexture),O(n.metallicRoughnessTexture)}const p=1/ce,x=n.color[0]**p,L=n.color[1]**p,C=n.color[2]**p,S=n.emissiveFactor[0]**p,M=n.emissiveFactor[1]**p,N=n.emissiveFactor[2]**p,U=n.colorTexture!=null&&d?i.get(n.colorTexture):null,E=st(n),I=n.normalTextureTransform?.scale!=null?n.normalTextureTransform?.scale:Ne;s.set(y,new q({...r,transparent:T===A.Blend,customDepthTest:We.Lequal,textureAlphaMode:T,textureAlphaCutoff:n.alphaCutoff,diffuse:[x,L,C],ambient:[x,L,C],opacity:n.opacity,doubleSided:n.doubleSided,doubleSidedType:"winding-order",cullFace:n.doubleSided?X.None:X.Back,hasVertexColors:!!t.attributes.color,hasVertexTangents:!!t.attributes.tangent,normalType:g?ae.Attribute:ae.ScreenDerivative,castShadows:!0,receiveShadows:n.receiveShadows,receiveAmbientOcclusion:n.receiveAmbientOcclustion,textureId:U?.id,colorMixMode:n.colorMixMode,normalTextureId:n.normalTexture!=null&&d?i.get(n.normalTexture).id:void 0,textureAlphaPremultiplied:U!=null&&!!U.parameters.preMultiplyAlpha,occlusionTextureId:n.occlusionTexture!=null&&d?i.get(n.occlusionTexture).id:void 0,emissiveTextureId:n.emissiveTexture!=null&&d?i.get(n.emissiveTexture).id:void 0,metallicRoughnessTextureId:n.metallicRoughnessTexture!=null&&d?i.get(n.metallicRoughnessTexture).id:void 0,emissiveFactor:[S,M,N],mrrFactors:E?at:[n.metallicFactor,n.roughnessFactor,r.mrrFactors[2]],isSchematic:E,colorTextureTransformMatrix:j(n.colorTextureTransform),normalTextureTransformMatrix:j(n.normalTextureTransform),scale:[I[0],I[1]],occlusionTextureTransformMatrix:j(n.occlusionTextureTransform),emissiveTextureTransformMatrix:j(n.emissiveTextureTransform),metallicRoughnessTextureTransformMatrix:j(n.metallicRoughnessTextureTransform),...a},l))}const w=s.get(y);if(o.stageResources.materials.push(w),d){const p=x=>{x!=null&&o.stageResources.textures.push(i.get(x))};p(n.colorTexture),p(n.normalTexture),p(n.occlusionTexture),p(n.emissiveTexture),p(n.metallicRoughnessTexture)}return w}function _t(e,t){const o=e.attributes.position.count,r=vt(e.indices||o,e.primitiveType),a=k(3*o),{typedBuffer:s,typedBufferStride:i}=e.attributes.position;Ke(a,s,e.transform,3,i);const l=[[_.POSITION,new P(a,r,3,!0)]];if(e.attributes.normal!=null){const u=k(3*o),{typedBuffer:c,typedBufferStride:m}=e.attributes.normal;Le($,e.transform),He(u,c,$,3,m),W($)&&re(u,u),l.push([_.NORMAL,new P(u,r,3,!0)])}if(e.attributes.tangent!=null){const u=k(4*o),{typedBuffer:c,typedBufferStride:m}=e.attributes.tangent;Ue($,e.transform),Qe(u,c,$,4,m),W($)&&re(u,u,4),l.push([_.TANGENT,new P(u,r,4,!0)])}if(e.attributes.texCoord0!=null){const u=k(2*o),{typedBuffer:c,typedBufferStride:m}=e.attributes.texCoord0;Q(u,c,2,m),l.push([_.UV0,new P(u,r,2,!0)])}const n=e.attributes.color;if(n!=null){const u=new Uint8Array(4*o);n.elementCount===4?n instanceof pe?oe(u,n,1,255):(n instanceof Ge||n instanceof Ve)&&oe(u,n,1/255,255):(u.fill(255),n instanceof he?ne(u,n.typedBuffer,1,255,4,n.typedBufferStride):(e.attributes.color instanceof ze||e.attributes.color instanceof Xe)&&ne(u,n.typedBuffer,1/255,255,4,e.attributes.color.typedBufferStride)),l.push([_.COLOR,new P(u,r,4,!0)])}return{geometry:new fe(t,l),vertexCount:o}}const $=me();function $t(e){switch(e){case"BLEND":return A.Blend;case"MASK":return A.Mask;case"OPAQUE":case null:case void 0:return A.Opaque}}function Pt(e,t){for(let o=0;o<e.model.lods.length;++o){const r=e.model.lods[o];for(const a of r.parts){const s=a.attributes.normal;if(s==null)return;const i=a.attributes.position,l=i.count,n=D(),u=D(),c=D(),m=new Float32Array(4*l),h=new Float32Array(3*l),y=je(Ce(),a.transform);let d=0,g=0;for(let T=0;T<l;T++){i.getVec(T,u),s.getVec(T,n),ee(u,u,a.transform),ke(c,u,t.center),te(c,c,t.radius);const w=c[2],p=Fe(c),x=Math.min(.45+.55*p*p,1)**ce;te(c,c,t.radius),y!==null&&ee(c,c,y),qe(c,c),o+1!==e.model.lods.length&&e.model.lods.length>1&&De(c,c,n,w>-1?.2:Math.min(-4*w-3.8,1)),h[d]=c[0],h[d+1]=c[1],h[d+2]=c[2],d+=3,m[g]=x,m[g+1]=x,m[g+2]=x,m[g+3]=1,g+=4}a.attributes.normal=new he(h),a.attributes.color=new pe(m)}}}const $r=Object.freeze(Object.defineProperty({__proto__:null,fetch:It,parseUrl:we},Symbol.toStringTag,{value:"Module"}));export{It as Y,it as a,vt as b,Tt as c,$r as d,bt as l,z as n,_r as o,Or as r,j as s,wt as t};
