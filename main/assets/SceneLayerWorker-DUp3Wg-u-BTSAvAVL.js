const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./i3s-DqZ34uA9-DKJpATIb.js","./_commonjsHelpers-BITg13Vk-KnjfkSck.js","./projection-m8vi7Cxv-ByA_2Rez.js","./main-DK5A1thH.js","./main-BRDqyNC1.css","./projectMeshVertexPositions-CwAnO79z-BFwNazrE.js","./MeshLocalVertexSpace-DFCiKNRA-BLWX9O__.js","./vertexSpaceConversion-uj5jLCX_-Yj63RmyK.js","./mat3-DOnW3DjW-C3hbW9XY.js","./common-CYWrYyJl-E8-sukrT.js","./mat3f64-Dh9_zhFu-BIT-k8Dm.js","./mat4-BFStKTjU-BMLpTkEG.js","./mat4f64-BaJwL7tQ-k0uMm8LY.js","./vec32-BuqRmYBM-Docn8r6P.js","./spatialReferenceEllipsoidUtils-DlQOpWof-8b-0SJHm.js","./computeTranslationToOriginAndRotation-DwwrTl3S-JrOuDVP0.js","./projectPointToVector-CG1hALQu-BoURAVep.js","./meshVertexSpaceUtils-BwEbYR8F-D_1-zksg.js","./vec3-CRJiMrND-_4JodicD.js","./BufferView-BBCzkcZS-BKSq5J5y.js","./vec2-BnynUbeJ-CKtGJQAy.js","./vec42-D8CJyqHG-DnfLTeQH.js","./vec4-DcTMp5mq-dtE5kkDn.js"])))=>i.map(i=>d[i]);
import{ck as D,b0 as te,b as re,jE as oe,jF as ne,T as V,_ as R,iR as ie,at as se}from"./main-DK5A1thH.js";import{y as ae,d as fe}from"./MeshLocalVertexSpace-DFCiKNRA-BLWX9O__.js";import{z as ce,T as le}from"./vec3-CRJiMrND-_4JodicD.js";import"./workers-0oosFQiO-DY7A0yfU.js";import"./projection-m8vi7Cxv-ByA_2Rez.js";import"./projectVectorToVector-D0K_S4MR-BN7ztR9y.js";import"./vec4f64-CjUMzAyX-DPYbdAom.js";import"./sphere-Cj20syUS-P9gsXSIi.js";import"./mat4-BFStKTjU-BMLpTkEG.js";import"./mat4f64-BaJwL7tQ-k0uMm8LY.js";import"./vec32-BuqRmYBM-Docn8r6P.js";import"./Query-CxQYWcUQ-DdfiJ2tS.js";import{G as ue}from"./I3SBinaryReader-CyBOtojY-PLgBneKk.js";import{f as me}from"./edgeUtils-CjV7X0G9-DWarwTuC.js";import"./NormalAttribute.glsl-C9zbIKka-BQ-gxZja.js";import{i as de}from"./orientedBoundingBox-CTsjUkMw-DzdH9G5q.js";import"./Queue-B8H6jIv7-BD0bPSsY.js";import"./intl-DLmy-Li5-BP8VBpPh.js";import"./projectPointToVector-CG1hALQu-BoURAVep.js";import"./vec42-D8CJyqHG-DnfLTeQH.js";import"./common-CYWrYyJl-E8-sukrT.js";import"./mat3-DOnW3DjW-C3hbW9XY.js";import"./mat3f64-Dh9_zhFu-BIT-k8Dm.js";import"./plane-B_adY3_o-Ns1JnzfT.js";import"./quatf64-C16JxGFv-BKWK1F8U.js";import"./vec2f64-CEUyUoff-BBc0aQ6D.js";import"./Field-Cj6Pz3TI-Ca9WushU.js";import"./fieldType-VTpxE-EM-CxCafxk5.js";import"./TimeExtent-gZaEUVeW-DaDBMnur.js";import"./VertexAttribute-DFC3a3eR-BhmQtMsu.js";import"./floatRGBA-YJlz5IlR-B5_mu0Vq.js";import"./glsl-o28TenZV-B0eZUNn3.js";import"./ShaderOutput-C_OqLoo1-jp3zUBgm.js";import"./BindType-CKbZk6AG-Bqvzo9NX.js";import"./quat-D8L_R4I0-CsHvsQG-.js";import"./spatialReferenceEllipsoidUtils-DlQOpWof-8b-0SJHm.js";import"./computeTranslationToOriginAndRotation-DwwrTl3S-JrOuDVP0.js";import"./ViewingMode-CyR_b1T8-_s7_Gbsk.js";D();var B;async function bt(e,t,r,s,n,f,a,c){const u=[];for(const m of t)if(m&&n.includes(m.name)){const d=`${e}/nodes/${r}/attributes/${m.key}/0`;u.push({url:d,storageInfo:m})}const S=await Promise.allSettled(u.map(m=>re(m.url,{responseType:"array-buffer",query:{...a,token:f},signal:c?.signal}).then(d=>ue(m.storageInfo,d.data)))),y=[];for(const m of s){const d={};for(let h=0;h<S.length;h++){const b=S[h];if(b.status==="fulfilled"){const l=b.value;d[u[h].storageInfo.name]=ye(l,m)}}y.push(d)}return y}(function(e){e[e.OUTSIDE=0]="OUTSIDE",e[e.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE",e[e.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE",e[e.INSIDE=3]="INSIDE"})(B||(B={}));const pe=-32768,he=-2147483648;function ye(e,t){if(!e)return null;const r=e[t];return oe(e)?r===pe?null:r:ne(e)?r===he?null:r:r!=r?null:r}me({color:[0,0,0,0],opacity:0}),D(),D(),new de,new Array(72);var A,$;(function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"})(A||(A={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}($||($={}));function be(){return P||(P=new Promise(e=>R(()=>import("./i3s-DqZ34uA9-DKJpATIb.js"),__vite__mapDeps([0,1]),import.meta.url).then(t=>t.i).then(({default:t})=>{const r=t({locateFile:Ee,onRuntimeInitialized:()=>e(r)});delete r.then})).catch(e=>{throw e})),P}function Ee(e){return se(`esri/libs/i3s/${e}`)}let P;class ge{constructor(t,r,s,n,f,a){this.layout=t,this.interleavedVertexData=r,this.indices=s,this.hasColors=n,this.hasModifications=f,this.positionData=a}}let _e=class{constructor(e,t,r,s,n,f,a){this.componentOffsets=e,this.featureIds=t,this.anchorIds=r,this.anchors=s,this.transformedGeometry=n,this.globalTrafo=f,this.obb=a}};new te({deallocator:null});var H,I,z,Y,G;(function(e){e[e.Unmodified=0]="Unmodified",e[e.Culled=1]="Culled",e[e.NotChecked=2]="NotChecked"})(H||(H={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked"}(I||(I={})),function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached"}(z||(z={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"}(Y||(Y={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf"}(G||(G={}));async function we(e){o=await T();const t=[e.geometryBuffer];return{result:q(o,e,t),transferList:t}}async function Se(e){o=await T();const t=[e.geometryBuffer],{geometryBuffer:r}=e,s=r.byteLength,n=o._malloc(s),f=new Uint8Array(o.HEAPU8.buffer,n,s);f.set(new Uint8Array(r));const a=o.dracoDecompressPointCloudData(n,f.byteLength);if(o._free(n),a.error.length>0)throw new Error(`i3s.wasm: ${a.error}`);const c=a.featureIds?.length>0?a.featureIds.slice():null,u=a.positions.slice();return c&&t.push(c.buffer),t.push(u.buffer),{result:{positions:u,featureIds:c},transferList:t}}async function Ie(e){await T(),K(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}}async function Te(e){await T(),J(e)}async function Ne(e){o=await T(),o.setLegacySchema(e.context,e.jsonSchema)}async function Re(e){const{localMatrix:t,origin:r,positions:s,vertexSpace:n}=e,f=V.fromJSON(e.inSpatialReference),a=V.fromJSON(e.outSpatialReference);let c;const[{projectBuffer:u},{initializeProjection:S}]=await Promise.all([R(()=>import("./projection-m8vi7Cxv-ByA_2Rez.js"),__vite__mapDeps([2,3,4]),import.meta.url).then(l=>l.p),R(()=>import("./projection-m8vi7Cxv-ByA_2Rez.js"),__vite__mapDeps([2,3,4]),import.meta.url).then(l=>l.g)]);await S(f,a);const y=[0,0,0];if(!u(r,f,0,y,a,0))throw new Error("Failed to project");if(n.type==="georeferenced"&&n.origin==null){if(c=new Float64Array(s.length),!u(s,f,0,c,a,0,c.length/3))throw new Error("Failed to project")}else{const l=n.type==="georeferenced"?ae.fromJSON(n):fe.fromJSON(n),{projectMeshVertexPositions:p}=await R(async()=>{const{projectMeshVertexPositions:g}=await import("./projectMeshVertexPositions-CwAnO79z-BFwNazrE.js");return{projectMeshVertexPositions:g}},__vite__mapDeps([5,2,3,4,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22]),import.meta.url),E=p({vertexAttributes:{position:s},transform:t?{localMatrix:t}:void 0,vertexSpace:l,spatialReference:f},a);if(!E)throw new Error("Failed to project");c=E}const m=c.length,[d,h,b]=y;for(let l=0;l<m;l+=3)c[l]-=d,c[l+1]-=h,c[l+2]-=b;return{result:{projected:c,original:s,projectedOrigin:y},transferList:[c.buffer,s.buffer]}}async function Ae({normalMatrix:e,normals:t}){const r=new Float32Array(t.length);return ce(r,t,e),ie(e)&&le(r,r),{result:{transformed:r,original:t},transferList:[r.buffer,t.buffer]}}function Le(e){Q(e)}let Oe,o;function J(e){if(!o)return;const t=e.modifications,r=o._malloc(8*t.length),s=new Float64Array(o.HEAPU8.buffer,r,t.length);for(let n=0;n<t.length;++n)s[n]=t[n];o.setModifications(e.context,r,t.length,e.isGeodetic),o._free(r)}function q(e,t,r){const{context:s,globalTrafo:n,mbs:f,obbData:a,elevationOffset:c,geometryBuffer:u,geometryDescriptor:S,indexToVertexProjector:y,vertexToRenderProjector:m}=t,d=e._malloc(u.byteLength),h=33,b=e._malloc(h*Float64Array.BYTES_PER_ELEMENT),l=new Uint8Array(e.HEAPU8.buffer,d,u.byteLength);l.set(new Uint8Array(u));const p=new Float64Array(e.HEAPU8.buffer,b,h);N(p,[NaN,NaN,NaN]);let E=p.byteOffset+3*p.BYTES_PER_ELEMENT,g=new Float64Array(p.buffer,E);N(g,n),E+=16*p.BYTES_PER_ELEMENT,g=new Float64Array(p.buffer,E),N(g,f),E+=4*p.BYTES_PER_ELEMENT,a&&(g=new Float64Array(p.buffer,E),N(g,a));const U=S,W={isDraco:!1,isLegacy:!1,color:t.layouts.some(_=>_.some(w=>w.name==="color")),normal:t.needNormals&&t.layouts.some(_=>_.some(w=>w.name==="normalCompressed")),uv0:t.layouts.some(_=>_.some(w=>w.name==="uv0")),uvRegion:t.layouts.some(_=>_.some(w=>w.name==="uvRegion")),featureIndex:U.featureIndex},i=e.process(s,!!t.obbData,d,l.byteLength,U,W,b,c,y,m,t.normalReferenceFrame);if(e._free(b),e._free(d),i.error.length>0)throw new Error(`i3s.wasm: ${i.error}`);if(i.discarded)return null;const L=i.componentOffsets.length>0?i.componentOffsets.slice():null,O=i.featureIds.length>0?i.featureIds.slice():null,X=i.anchorIds.length>0?Array.from(i.anchorIds):null,Z=i.anchors.length>0?Array.from(i.anchors):null,C=i.interleavedVertedData.slice().buffer,v=i.indicesType===A.Int16?new Uint16Array(i.indices.buffer,i.indices.byteOffset,i.indices.byteLength/2).slice():new Uint32Array(i.indices.buffer,i.indices.byteOffset,i.indices.byteLength/4).slice(),F=i.positions.slice(),{buffer:x,byteOffset:M,byteLength:j}=i.positionIndices,k=i.positionIndicesType===A.Int16?new Uint16Array(x,M,j/2).slice():new Uint32Array(x,M,j/4).slice(),ee=new ge(t.layouts[0],C,v,i.hasColors,i.hasModifications,{data:F,indices:k});return O&&r.push(O.buffer),L&&r.push(L.buffer),r.push(C),r.push(v.buffer),r.push(F.buffer),r.push(k.buffer),new _e(L,O,X,Z,ee,n,i.obb)}function Pe(e){return e===0?I.Unmodified:e===1?I.PotentiallyModified:e===2?I.Culled:I.Unknown}function K(e){if(!o)return;const{context:t,buffer:r}=e,s=o._malloc(r.byteLength),n=r.byteLength/Float64Array.BYTES_PER_ELEMENT,f=new Float64Array(o.HEAPU8.buffer,s,n),a=new Float64Array(r);f.set(a),o.filterOBBs(t,s,n),a.set(f),o._free(s)}function Q(e){o&&o.destroy(e)===0&&(o=null)}function N(e,t){for(let r=0;r<t.length;++r)e[r]=t[r]}async function De(){o||await T()}async function T(){return o||(o=await(Oe??=be())),o}const Ue={transform:(e,t)=>o&&q(o,e,t),destroy:Q},Et=Object.freeze(Object.defineProperty({__proto__:null,destroyContext:Le,dracoDecompressPointCloudData:Se,filterObbsForModifications:Ie,filterObbsForModificationsSync:K,initialize:De,interpretObbModificationResults:Pe,process:we,project:Re,setLegacySchema:Ne,setModifications:Te,setModificationsSync:J,test:Ue,transformNormals:Ae},Symbol.toStringTag,{value:"Module"}));export{Et as S,bt as V};
