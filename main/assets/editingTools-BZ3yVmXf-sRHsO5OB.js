const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./calcite-button-Cm9_TJei-dPLwGZxZ.js","./themeUtils-YjM7iIiX-DZ9GcGxR.js","./main-BNyfiy7F.js","./main-D5KWG6F_.css","./uuid-Dj9mdEVg-BaKSCiyT.js","./form-CRSw616T-B1dA5eCp.js","./dom-N58V0tYi-DBU3jlah.js","./interactive-DqhNilgd-Dj_fIdvW.js","./label-Dys24PJn-BCewo2Re.js","./component-CWGf1hug-BASJpoEG.js","./loadable-DbNDKH4r-O2Y_gWwJ.js","./locale-Cn_GDVD_-B8TXdvbN.js","./key-CZySMiwx-kmS7VeUz.js","./observers-BigwqTsw-BI3LiKWE.js","./t9n-C_hcZMZJ-aTFxHa69.js","./icon-BXFbBbop-CelgKw2K.js","./loader-Ch7Jr16w-WdjL0rk_.js","./guid-Dls486Er-CBh637k4.js","./calcite-icon-laqhdRBY-Cuc8vfVM.js","./calcite-input-BKRd7MCS-CXqyw1UG.js","./input2-eOtqu-iO-DYU-ODhZ.js","./calcite-dropdown-CLrG397W-TblasQ4g.js","./floating-ui-DKFFlLv3-Cr6hVbEQ.js","./debounce-27Hmkkyg-Th7bw3mg.js","./openCloseComponent-BGQ6h7vg-BlyGhxb8.js","./calcite-dropdown-item-DpLfv4A0-BCgCnIta.js","./resources3-Duvedxls-DbbvfBW6.js","./calcite-dropdown-group-0sIPwaDd-DZwZpiwm.js"])))=>i.map(i=>d[i]);
import{v as a,S as c,i as x,ar as _i,eF as pi,eD as Ne,w as C,dU as g,i8 as ye,aq as ki,J as ue,I as Ce,ah as $,ax as ke,aA as dt,aL as es,aF as Il,av as Us,L as di,k8 as So,as as $s,i1 as Hs,ay as Ll,e8 as Po,bi as It,a2 as W,j as tt,dM as Gl,P as is,b9 as ns,G as Mr,aY as Ns,aC as Qe,p as vi,l as De,eC as Dl,fl as li,e as kr,m as fi,aO as Gn,f3 as Dn,eB as zl,ag as ss,aw as Mo,dN as Ul,dW as fn,j_ as $l,k9 as Hl,dK as Nl,b7 as Fl,ka as Zl,dX as Bl,h$ as Wl,kb as Cr,hq as Fe,D as Yl,kc as Xl,_ as Lt,bt as ko,$ as ql,az as jl,bx as Rr,dV as Fs,b as Kl,kd as Ql,bp as Vr,aW as os,al as Ar,ke as Jl,kf as Co,f4 as ze,B as Or,bj as Ir,au as Lr,hZ as pe,bo as Gr,i9 as zn,d$ as tc,an as ec,a3 as Dr,r as ic,kg as nc,kh as Ze,ki as sc,kj as oc,kk as rc,kl as Ro,km as ac,jw as zr,il as lc,aG as Ur,ae as cc,ih as hc,b1 as uc,kn as pc,i3 as Vo,o as Un,i4 as dc,cG as Ci,dR as Zs,ko as Bs,h_ as Ao,hh as fc,dQ as gc,dS as mc,dP as yc,kp as _c}from"./main-BNyfiy7F.js";import{i as q,j as Ws,A as vc,l as Be,S as _e,y as qt,M as sn,m as Wt,x as xc,g as bc,b as $n,v as Oo,I as $r,f as Hr,d as wc,E as Tc,P as Ec,O as on,T as Sc,z as Pc,h as Mc,D as Io}from"./vec2-tHZ6OaOy-xCj1obDt.js";import{o as G,_ as kc,e as de,u as Cc,m as Rc,s as Vc}from"./vec2f64-CeODonrJ-CkkJCdRC.js";import{S as Ac,R as Oc}from"./enums-CpSG_SL3-BMD3Tb1v.js";import{n as Ys,p as xt,f as Ic}from"./projectVectorToVector-sIYLNlex-DY9AOu3z.js";import{x as Lc,f as Nr,m as gn,y as Gc,P as Dc,w as zc,I as Uc,g as $c,Z as Lo}from"./elevationInfoUtils-mOZsPH2J-C7nRRD3e.js";import{N as z,O as rs,L as fe,b as xi,l as le,j as ut,X as Pe,r as Et,R as H,p as Hc,k as pt,v as Fr,y as Z,S as Ot,A as rt,g as ge,w as Go,_ as N,T as We,W as Do,G as as,H as zo}from"./vec32-D9GsKZ1t-DrP3-XI8.js";import{i as Zr}from"./UpdatingHandles-CUu3u1ms-BIdeZn6a.js";import Xs from"./GraphicsLayer-DfeGaYc1-BM86BvdL.js";import{O as bi,u as rn,E as mn,D as yn,P as Br,h as Nc,c as Fc}from"./geodesicUtils-B8mFUfTk-7A9dqACd.js";import{simplify as Zc,distance as Bc,geodesicArea as Wc,geodesicLength as Wr}from"./geometryEngine-CdPoFSE4-DjClQaAm.js";import{U as Yc}from"./Tile-D75RMC64-C5dNrHl8.js";import{T as Xc,P as Yr,J as qc,Q as we,_ as Xr,u as Uo,O as jc}from"./MapView-BGOJJ8ch-Dje0kJEZ.js";import{Y as Kc,L as Qc}from"./quat-BODLR7mS-B-O_MWJ2.js";import{e as $o}from"./quatf64-C16JxGFv-BKWK1F8U.js";import{s as Jc,N as Ye,L as Kt,K as te,P as qs,U as Qt,Q as th,x as _n,D as ft,c as Dt,F as qr,W as eh,m as ih,S as vn,u as nh,b as sh,R as oh,Y as rh,Z as ah,q as lh,G as ch,J as hh,j as uh,A as ph,C as dh,H as fh}from"./ReactiveSet-QxEZenFW-joW0_per.js";import{y as gh,w as mh,A as yh,p as _h,O as vh}from"./vec42-D8CJyqHG-DnfLTeQH.js";import{o as jr,e as Hn,c as xh}from"./vec4f64-hf2nxvhQ-CaAr8PTM.js";import{i as bh}from"./projectBuffer-CvCBvJ6W-D_rxfrjt.js";import{y as at,_ as js,w as Ae,D as Ks,N as Ue,g as Kr,B as Ri,$ as Qr,P as ls,c as ii,e as wh,l as Ho,j as Nn,G as Jr,a as Th,O as Eh}from"./plane-Dt8R0KeE-CtJ6wTaI.js";import{U as Sh,z as Ph,k as Mh,w as kh,F as Ch}from"./sphere-BenPORjV-DrrOs2TP.js";import{n as wi}from"./common-CYWrYyJl-E8-sukrT.js";import{c as ta,o as Qs}from"./Cyclical-C_9rKUUQ-Cik2Fc52.js";import"./MeshTransform-C--IG09w-oFswJeL8.js";import{t as Rh}from"./meshVertexSpaceUtils-B4l_Zo0M-Cv6MwaZr.js";import{_ as cs,H as Vh,z as Ah,R as Vi,P as v,F as wt,$ as Oh,k as Js}from"./themeUtils-YjM7iIiX-DZ9GcGxR.js";import{r as Ih}from"./uuid-Dj9mdEVg-BaKSCiyT.js";import{m as Lh}from"./earcut-XDcq3zAf-BcwyrT7l.js";import{S as Gh}from"./triangle-hqU-Tc1X-B_6bKeok.js";import{m as Dh,x as zh}from"./spatialReferenceEllipsoidUtils-DUrKTvup-DXGO1-_n.js";import{P as Uh}from"./diffUtils-Cz3Fi8Xb-CinLCnvf.js";import{l as Ti}from"./ViewingMode-CyR_b1T8-_s7_Gbsk.js";import{K as Xe,N as ea,J as $h}from"./projection-BA9M1R7d-CFfzn5H_.js";import"./MeshLocalVertexSpace-BqgocsoS-CYE6PjYi.js";import{t as Hh}from"./compilerUtils-CV1QYWI8-KRXpwzek.js";import{i as ia,f as na}from"./Scheduler-B7UX7Wr5-CQ_fDN4C.js";import"./Query-BrwMGK8U-CCzP1I20.js";import{q as Nh}from"./ElevationInfo-yv2-9tj6-CnPfGa7M.js";import{u as No}from"./cimSymbolUtils-CKIzBgMU-xcmLHsBV.js";import{p as Fh}from"./projectPointToVector-B2UUY9SE-DgK2hde-.js";import{z as Zh}from"./drapedUtils-BZ1SGPtE-DgDqIFKW.js";import{W as Fo}from"./colorUtils-Cthpxcks-CzGrSln-.js";import{h as Ei,M as Qi,N as xn}from"./boundedPlane-DlvE0eNx-Bls_2bZd.js";import"./GraphicsCollection-CWTXNZOX-byIc4Plz.js";import"./Layer-ChoECxvZ-D_sywEJS.js";import"./TimeExtent-Cn0Jofqr-BUf77X_H.js";import"./BlendLayer-D1WkSmwP-DKefN4B5.js";import"./jsonUtils-wIllKWI4-CNPg1u5I.js";import"./parser-DyDJ-rlI-Ce49-Im9.js";import"./mat4f32-CiZjBg9k-CUm34GoR.js";import"./mat4-DX7gBViE-C5DXQzdb.js";import"./ScaleRangeLayer-Bz0DcnvM-DCWD9cwD.js";import"./lengthUtils-DKpMe5qR-CSpyMgzR.js";import"./geometryEngineBase-DueYg7ux-CCeespPx.js";import"./_commonjsHelpers-BITg13Vk-KnjfkSck.js";import"./hydrated-CplJC1Fs-PZuElzpW.js";import"./TileKey-C5IL-JBr-ByQCsag0.js";import"./QueueProcessor-DbfV9fLy-DadPOwoA.js";import"./workers-PiCjreoO-CoeFUD7p.js";import"./ReactiveMap-CFk6jPfN-_i2hUtfB.js";import"./signal-CETehA7D-CUOb3AUy.js";import"./quickselect-DHTstthl-Ds_Aj0x5.js";import"./CollectionFlattener-DkHuHn5E-C_QlZM3K.js";import"./TileInfo-CWIRDhZl-BRtXiUT7.js";import"./TileKey-B_6qmYK--BtZdR-Xy.js";import"./Map-1zd11DKO-B85vIrPb.js";import"./Basemap-BEqqSTw9-CurKl591.js";import"./loadAll-e978YItg-DoFxIH1Y.js";import"./PortalItem-CctGdnxF-DED2in5u.js";import"./writeUtils-D5qlLkwk-CuyRnth2.js";import"./TablesMixin-C8RojhYs-BRoxMySi.js";import"./HeightModelInfo-C5vFqzyF-CIiLczyn.js";import"./arcgisLayerUrl-HNYh8jvG-CarWcTLX.js";import"./normalizeUtils-Bxmy9MNI-DBdQVIGZ.js";import"./normalizeUtilsCommon-CRJlkfEA-Dnie3PBL.js";import"./utils-9sQxfkoa-CCu3H0rb.js";import"./utils-Bq23Xwmj-B8kwi51K.js";import"./mat3-CC4Foazl-BWjyqE2v.js";import"./vec2f32-CVhmN3Me-DxoqVD7C.js";import"./unitBezier-CGtWxaCq-BRwEDigF.js";import"./definitions-DJSdSb77-DkoRHaVx.js";import"./enums-DBi1-Mm2-CUS1pvQe.js";import"./Texture-BCt2hphT-B3fQk9VU.js";import"./imageUtils-BA2D6Uf1-N776nea8.js";import"./capabilities-agoTWNzb-CtsNgRyk.js";import"./Version-CoKzbupV-BQe52sIu.js";import"./ColorBackground-gVZldRLm-DM8-Hp0N.js";import"./Field-C6hA1tZj-cd1zkCNB.js";import"./fieldType-CD2CL2hr-C1DvAoGt.js";import"./mat3f64-Dh9_zhFu-BIT-k8Dm.js";import"./ByteSizeUnit-DL8UhsB0-B2-AmVRx.js";import"./mat4f64-Dn1WEGBx-C99QVUMW.js";import"./lineSegment-CcqvCARM-C3px7yN-.js";import"./utils-SPbpQbmm-Bi_GIGH0.js";function gi(e,t){return e===t||e!=null&&t!=null&&Qe(e.spatialReference,t.spatialReference)&&e.x===t.x&&e.y===t.y&&e.z===t.z&&e.m===t.m}function Fn(e,t,i){return e===t||e!=null&&t!=null&&Qe(e.spatialReference,t.spatialReference)&&li(e.x,t.x,i)&&li(e.y,t.y,i)&&li(e.z??0,t.z??0,i)&&li(e.m??0,t.m??0,i)}function Bh(e){return"declaredClass"in e}function sa(e,t){if(!e)return null;let i;return Bh(e)?e.clone():(i=Ys(e.x,e.y,e.z,e.spatialReference),e.hasM&&(i.m=e.m,i.hasM=!0),i)}var Zo;function oa(e,t,i){return j(e,t,i)}function j(e=0,t=0,i=0){return pe(e,t,i)}function ve(e,t,i){return pe(e,t,i)}function qe(e){const[t,i,n]=e;return e.length>3?[t,i,n,e[3]]:[t,i,n]}function to(e,t,i,n=j()){return n[0]=e.x,n[1]=e.y,n[2]=e.z??0,t==null||(t.type==="2d"?n[2]=0:n[2]=Dc(t,e,i,gn)??0),n}function Wh(e,t,{z:i,m:n},s,o){const{spatialReference:r,elevationInfo:l}=s;let h;i==null&&n==null?h=void 0:t==null||t.type==="2d"?h=i??void 0:h=zc(t,e,r,gn,l)??0;const[u,p]=e;return o?Ic(o,u,p,h,r):o=Ys(u,p,h,r),n!=null&&(o.m=n,o.hasM=!0),o}(function(e){e[e.NONE=0]="NONE",e[e.TARGET=1]="TARGET"})(Zo||(Zo={}));let St=class extends kr{constructor(){super(...arguments),this.enabled=!0}};a([c({type:Boolean})],St.prototype,"enabled",void 0),St=a([x("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],St);let V=class extends kr{constructor(e){super(e),this.lineSnapper=new St,this.parallelLineSnapper=new St,this.rightAngleSnapper=new St,this.rightAngleTriangleSnapper=new St,this.shortLineThreshold=15,this.distance=5,this.pointThreshold=1e-6,this.intersectionParallelLineThreshold=1e-6,this.parallelLineThreshold=1e-6,this.verticalLineThresholdMeters=.3,this.touchSensitivityMultiplier=1.5,this.pointOnLineThreshold=1e-6,this.orange=new _i([255,127,0]),this.orangeTransparent=new _i([255,127,0,.5]),this.lineHintWidthReference=3,this.lineHintWidthTarget=3,this.lineHintFadedExtensions=.3,this.parallelLineHintWidth=2,this.parallelLineHintLength=24,this.parallelLineHintOffset=1.5,this.rightAngleHintSize=24,this.rightAngleHintOutlineSize=1.5,this.satisfiesConstraintScreenThreshold=1}};a([c({type:St,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"lineSnapper",void 0),a([c({type:St,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"parallelLineSnapper",void 0),a([c({type:St,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"rightAngleSnapper",void 0),a([c({type:St,constructOnly:!0,nonNullable:!0,json:{write:!0}})],V.prototype,"rightAngleTriangleSnapper",void 0),a([c({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],V.prototype,"shortLineThreshold",void 0),a([c({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],V.prototype,"distance",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"pointThreshold",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"intersectionParallelLineThreshold",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"parallelLineThreshold",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],V.prototype,"verticalLineThresholdMeters",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"touchSensitivityMultiplier",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],V.prototype,"pointOnLineThreshold",void 0),a([c({type:_i,nonNullable:!0})],V.prototype,"orange",void 0),a([c({type:_i,nonNullable:!0})],V.prototype,"orangeTransparent",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"lineHintWidthReference",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"lineHintWidthTarget",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],V.prototype,"lineHintFadedExtensions",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],V.prototype,"parallelLineHintWidth",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],V.prototype,"parallelLineHintLength",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],V.prototype,"parallelLineHintOffset",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],V.prototype,"rightAngleHintSize",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],V.prototype,"rightAngleHintOutlineSize",void 0),a([c({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],V.prototype,"satisfiesConstraintScreenThreshold",void 0),V=a([x("esri.views.interactive.snapping.Settings.Defaults")],V);const Zn=new V;var je;(function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"})(je||(je={}));let Ai=class{constructor(e,t){this.isDraped=e,this.domain=t}},Yh=class ra extends Ai{constructor(t,i,n=je.ALL){super(i,n),this.intersectionPoint=t}equals(t){return t instanceof ra&&H(this.intersectionPoint,t.intersectionPoint)}},Xh=class aa extends Ai{constructor(t,i,n,s,o=je.ALL,r=!0,l=!0){super(s,o),this.type=t,this.lineStart=i,this.lineEnd=n,this.fadeLeft=r,this.fadeRight=l}equals(t){return t instanceof aa&&this.type===t.type&&H(this.lineStart,t.lineStart)&&H(this.lineEnd,t.lineEnd)&&this.fadeLeft===t.fadeLeft&&this.fadeRight===t.fadeRight}get length(){return ge(this.lineStart,this.lineEnd)}},qh=class la extends Ai{constructor(t,i,n,s=je.ALL){super(n,s),this.lineStart=t,this.lineEnd=i}equals(t){return t instanceof la&&H(this.lineStart,t.lineStart)&&H(this.lineEnd,t.lineEnd)}},jh=class ca extends Ai{constructor(t,i,n){super(i,n),this.point=t}equals(t){return t instanceof ca&&H(this.point,t.point)}},Kh=class ha extends Ai{constructor(t,i,n,s,o=je.ALL){super(s,o),this.previousVertex=t,this.centerVertex=i,this.nextVertex=n}equals(t){return t instanceof ha&&H(this.previousVertex,t.previousVertex)&&H(this.centerVertex,t.centerVertex)&&H(this.nextVertex,t.nextVertex)}},Qh=class{draw(e,t){const i=Jh(e),n=this.sortUniqueHints(i),s=[];for(const o of n)o instanceof Yh&&s.push(this.visualizeIntersectionPoint(o,t)),o instanceof Xh&&s.push(this.visualizeLine(o,t)),o instanceof qh&&s.push(this.visualizeParallelSign(o,t)),o instanceof Kh&&s.push(this.visualizeRightAngleQuad(o,t)),o instanceof jh&&s.push(this.visualizePoint(o,t));return Gr(s)}sortUniqueHints(e){return e}};function Jh(e){const t=[];for(const i of e){let n=!0;for(const s of t)if(i.equals(s)){n=!1;break}n&&t.push(i)}return t}let tu=class extends Qh{constructor(e){super(),this._graphicsLayer=e,this._symbolPairingsByType=new Map}visualizeIntersectionPoint(e,t){return this._visualizeSnappingIndicator(new C({x:e.intersectionPoint[0],y:e.intersectionPoint[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("intersectionPoint",t.view.effectiveTheme.accentColor))}visualizePoint(e,t){return this._visualizeSnappingIndicator(new C({x:e.point[0],y:e.point[1],spatialReference:t.spatialReference}),this._getOrCreateSymbol("point",t.view.effectiveTheme.accentColor))}visualizeLine(e,t){return this._visualizeSnappingIndicator(new fi({paths:[[[...e.lineStart],[...e.lineEnd]]],spatialReference:Gn(ue,t.spatialReference)}),this._getOrCreateSymbol("line",t.view.effectiveTheme.accentColor))}visualizeParallelSign(e,t){return this._visualizeSnappingIndicator(new fi({paths:[[[...e.lineStart],[...e.lineEnd]]],spatialReference:Gn(ue,t.spatialReference)}),this._getOrCreateSymbol("parallelSign",t.view.effectiveTheme.accentColor))}visualizeRightAngleQuad(e,t){const i=G(),n=G(),s=g();q(i,e.centerVertex,e.previousVertex),q(n,e.nextVertex,e.previousVertex),vc(s,i,n);const o=`rightAngleQuad${s[2]<0?45:225}`;return this._visualizeSnappingIndicator(new fi({paths:[[[...e.previousVertex],[...e.centerVertex],[...e.nextVertex]]],spatialReference:Gn(ue,t.spatialReference)}),this._getOrCreateSymbol(o,t.view.effectiveTheme.accentColor))}_visualizeSnappingIndicator(e,t){const i=new It({geometry:e,symbol:t});return this._graphicsLayer.add(i),W(()=>{this._graphicsLayer.remove(i)})}_getOrCreateSymbol(e,t){const i=this._symbolPairingsByType;return i.get(e)?.color!==t&&i.set(e,{color:t,symbol:eu(e,t)}),i.get(e).symbol}};function eu(e,t){const i=[...t.toRgb(),255*t.a];switch(e){case"point":return new Ne({outline:{width:.5,color:[0,0,0,1]},size:10,color:t});case"intersectionPoint":return new Ne({outline:new zl({width:1.5,color:t}),size:15,color:[0,0,0,0]});case"line":return new pi({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:Ac.Butt,joinStyle:Oc.Round,miterLimit:10,width:Dn(Zn.lineHintWidthTarget),color:i}]}}});case"parallelSign":return new pi({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,1.5],[7,1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:1,z:0},anchorPointUnits:"Relative",size:5,markerPlacement:{type:"CIMMarkerPlacementOnLine",placePerPart:!0,angleToLine:!0,relativeTo:"LineMiddle"},frame:{xmin:-5,ymin:-1.5,xmax:5,ymax:1.5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[7,0],[-7,0],[-7,-1.5],[7,-1.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:i}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}});case"rightAngleQuad45":case"rightAngleQuad225":{const n=e==="rightAngleQuad45"?45:225;return new pi({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:.5,y:.5,z:0},anchorPointUnits:"Relative",size:Dn(Zn.rightAngleHintSize),rotation:n,markerPlacement:{type:"CIMMarkerPlacementOnVertices",placePerPart:!0,angleToLine:!0,placeOnEndPoints:!1},frame:{xmin:-5,ymin:-5,xmax:5,ymax:5},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{paths:[[[5,-5],[-5,-5],[-5,5],[5,5],[5,-5]]]},symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:Dn(Zn.rightAngleHintOutlineSize),color:i},{type:"CIMSolidFill",enable:!0,color:[...t.toRgb(),255*t.a*.4]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0}]}}})}}}const iu=new pi({data:{type:"CIMSymbolReference",symbol:{type:"CIMLineSymbol",symbolLayers:[{type:"CIMSolidStroke",effects:[{type:"CIMGeometricEffectDashes",dashTemplate:[3.75,3.75],lineDashEnding:"HalfPattern",controlPointEnding:"NoConstraint"}],enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:1.6,color:[255,255,255,255]},{type:"CIMSolidStroke",enable:!0,capStyle:"Butt",joinStyle:"Round",miterLimit:10,width:2,color:[0,0,0,255]}]}}}),nu=new Ne({style:"circle",size:6,color:[127,127,127,1],outline:{color:[50,50,50],width:1}}),su=new Ne({style:"circle",size:6,color:[255,127,0,1],outline:{color:[50,50,50],width:1}});var ht;(function(e){e[e.NeverApplied=0]="NeverApplied",e[e.Applied=1]="Applied",e[e.Undone=2]="Undone"})(ht||(ht={}));var Gt;(function(e){e.UndoRedoUpdating="UndoRedoUpdating",e.UndoInvalidError="UndoInvalidError",e.RedoInvalidError="RedoInvalidError",e.ApplyInvalidError="ApplyInvalidError"})(Gt||(Gt={}));const bn={[Gt.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[Gt.UndoInvalidError]:"There are no items to Undo",[Gt.RedoInvalidError]:"There are no items to Redo",[Gt.ApplyInvalidError]:"Cannot apply an item that is already applied"};let ni=class extends Error{constructor(){super(bn[Gt.UndoRedoUpdating]),this.type="undo-redo-updating-error"}},hs=class extends Error{constructor(){super(bn[Gt.UndoInvalidError]),this.type="undo-redo-undo-error"}},Bo=class extends Error{constructor(){super(bn[Gt.RedoInvalidError]),this.type="undo-redo-redo-error"}},ou=class extends Error{constructor(){super(bn[Gt.ApplyInvalidError]),this.type="undo-redo-apply-error"}};var Xt;(function(e){e[e.Apply=0]="Apply",e[e.Undo=1]="Undo",e[e.Redo=2]="Redo"})(Xt||(Xt={}));let Di=class extends tt{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=ht.NeverApplied}get canUndo(){return this.status===ht.Applied}get canRedo(){return this.status===ht.Undone}async executeUndoRedoOperation(e){switch(e){case Xt.Apply:if(this.status!==ht.NeverApplied)throw new ou;return await this.apply(),void(this.status=ht.Applied);case Xt.Undo:if(this.status!==ht.Applied)throw new hs;return await this.undo(),void(this.status=ht.Undone);case Xt.Redo:if(this.status!==ht.Undone)throw new hs;return await this.redo(),void(this.status=ht.Applied)}}};a([c()],Di.prototype,"name",void 0),a([c()],Di.prototype,"tag",void 0),Di=a([x("esri.undoredo.UndoableOperation")],Di);let Ct=class extends tt{constructor(){super(...arguments),this._stack=new ss,this._stackPosition=-1,this._updatingHandles=new Zr}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(e=>e.destroy())}_drainStack(){this._stack.drain(e=>e.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new hs;if(this.updating)throw new ni;const e=this._stack.getItemAt(this._stackPosition);e&&await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(Xt.Undo),--this._stackPosition,e.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Bo;if(this.updating)throw new ni;const e=this._stack.getItemAt(this._stackPosition+1);if(!e)throw new Bo;await this._updatingHandles.addPromise((async()=>{await e.executeUndoRedoOperation(Xt.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(e){if(this.updating)throw new ni;await this._updatingHandles.addPromise((async()=>{e.status===ht.NeverApplied&&await e.executeUndoRedoOperation(Xt.Apply),e.canUndo?(this._stack.splice(this._stackPosition+1,0,e),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(t=>t.destroy()),this._stackPosition=-1)})())}async add(e){if(this.updating)throw new ni;await this._updatingHandles.addPromise((async()=>{e.status===ht.NeverApplied&&await e.executeUndoRedoOperation(Xt.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),e.canUndo?(this._stack.push(e),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(e,t=!1){if(this.updating&&!t)return;await Mo(()=>!this.updating);const i=new ss;for(let n=0;n<this._stack.length;n++){const s=this._stack.getItemAt(n);s&&(s.tag===e?(s.destroy(),n===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(s))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(e=!1){if(this.updating&&!e)throw new ni;await Mo(()=>!this.updating),this._drainStack()}};a([c()],Ct.prototype,"_stack",void 0),a([c()],Ct.prototype,"_stackPosition",void 0),a([c()],Ct.prototype,"updating",null),a([c({readOnly:!0})],Ct.prototype,"canUndo",null),a([c({readOnly:!0})],Ct.prototype,"hasUndo",null),a([c({readOnly:!0})],Ct.prototype,"canRedo",null),a([c({readOnly:!0})],Ct.prototype,"hasRedo",null),Ct=a([x("esri.UndoRedo")],Ct);function eo(){return uc()}function ru(){return Ul()}function Si(e,t){const i=[];e=(e=(e=e.replaceAll(/[\u00B0\u00BA]/g,"^")).replaceAll("′","'")).replaceAll("″",'"');const n=cu(t);return pc.dmsToGeog(n,1,[e],i)?new C(i[0][0],i[0][1],ue.WGS84):null}function au(e){return e&&eo()?Ze(e)??Si(`0° 0' 0" N | ${e}`)?.longitude??Si(`0 | ${e}`)?.longitude??null:null}function lu(e){return e&&eo()?Ze(e)??Si(`${e} | 0° 0' 0" E`)?.latitude??Si(`${e} | 0`)?.latitude??null:null}function cu(e){let t=null;if(e||(e=ue.WGS84),e.wkid){if(t=Vo.geogcs(e.wkid),!t)throw new Un("coordinate-formatter:invalid-spatial-reference","wkid is not valid")}else{if(!e.wkt2&&!e.wkt)throw new Un("coordinate-formatter:invalid-spatial-reference","wkid and wkt are missing");if(t=Vo.fromString(dc.PE_TYPE_GEOGCS,e.wkt2||e.wkt),!t)throw new Un("coordinate-formatter:invalid-spatial-reference","wkt is not valid")}return t}let hu=class{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}};var us;let se=us=class extends De{constructor(e){super(e),this.center=null,this.geodesic=!1,this.numberOfPoints=60,this.radius=1e3,this.radiusUnit="meters"}initialize(){const e=this.center,t=this.numberOfPoints;if(this.hasZ=e?.hasZ??!1,this.rings.length!==0||!e)return;const i=fn(this.radius,this.radiusUnit,"meters"),n=e.spatialReference;let s,o="geographic";if(n.isWebMercator?o="webMercator":((n.wkid&&$l[n.wkid])!=null||(n.wkt2||n.wkt)&&Hl(n.wkt2||n.wkt))&&(o="projected"),this.geodesic){let r;switch(o){case"webMercator":r=Nl(e);break;case"projected":console.error("Creating a geodesic circle requires the center to be specified in web mercator or geographic coordinate system");break;case"geographic":r=e}s=this._createGeodesicCircle(r,i,t),o==="webMercator"&&(s=Fl(s))}else{let r;o==="webMercator"||o==="projected"?r=i/Zl(e.spatialReference):o==="geographic"&&(r=Bl(i,"meters",Wl(e.spatialReference).radius)),s=this._createPlanarCircle(e,r,t)}this.spatialReference=s.spatialReference,this.addRing(s.rings[0])}clone(){const{center:e,numberOfPoints:t,radius:i,radiusUnit:n,geodesic:s}=this;return new us({center:e?.clone(),numberOfPoints:t,radius:i,radiusUnit:n,geodesic:s})}_createGeodesicCircle(e,t,i){let n=0;const s=[];for(;n<360;){const o=[0,0],r=[e.x,e.y];bi(o,r,n,t,ue.WGS84),this.hasZ&&o.push(e.z),s.push(o),n+=360/i}return s.push(s[0]),new De({rings:[s]})}_createPlanarCircle(e,t,i){const n=[],s=2*Math.PI/i;for(let o=0;o<i;++o){const r=s*o,l=[e.x+Math.cos(-r)*t,e.y+Math.sin(-r)*t];this.hasZ&&l.push(e.z),n.push(l)}return n.push(n[0]),new De({spatialReference:e.spatialReference,rings:[n]})}};a([c({type:C})],se.prototype,"center",void 0),a([c()],se.prototype,"geodesic",void 0),a([c()],se.prototype,"numberOfPoints",void 0),a([c()],se.prototype,"radius",void 0),a([c()],se.prototype,"radiusUnit",void 0),se=us=a([x("esri.geometry.Circle")],se);const uu=se;function an(e,t,i=null){return i!=null?[e,t,i]:[e,t]}function k(e,t,i=null){return i!=null?{x:e,y:t,z:i}:{x:e,y:t}}let ua=class{constructor(e){this.spatialReference=e}mapToLocalMultiple(e){return e.map(t=>this.mapToLocal(t)).filter(ki)}get doUnnormalization(){return!1}},pu=class extends ua{constructor(e,t,i=null){super(t),this._defaultZ=i,this.transform=Uo(),this.transformInv=Uo(),this.transform=jc(e),Yc(this.transformInv,this.transform)}makeMapPoint(e,t){return an(e,t,this._defaultZ)}mapToLocal(e){return k(this.transform[0]*e[0]+this.transform[2]*e[1]+this.transform[4],this.transform[1]*e[0]+this.transform[3]*e[1]+this.transform[5])}localToMap(e){return an(this.transformInv[0]*e.x+this.transformInv[2]*e.y+this.transformInv[4],this.transformInv[1]*e.x+this.transformInv[3]*e.y+this.transformInv[5],this._defaultZ)}},du=class extends ua{constructor(e,t){super(e.spatialReference),this.view=e,this.defaultZ=null,this.pWS=g(),this.tangentFrameUpWS=g(),this.tangentFrameRightWS=g(),this.tangentFrameForwardWS=g(),this.localFrameRightWS=g(),this.localFrameUpWS=g(),this.worldToLocalTransform=$o(),this.localToWorldTransform=$o(),this.scale=1,this.scale=e.resolution,this.referenceMapPoint=t,this.defaultZ=t.hasZ?t.z:null;const i=e.state.camera.viewRight;this.view.renderCoordsHelper.toRenderCoords(this.referenceMapPoint,this.pWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,zn.X,this.tangentFrameRightWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,zn.Y,this.tangentFrameUpWS),this.view.renderCoordsHelper.worldBasisAtPosition(this.pWS,zn.Z,this.tangentFrameForwardWS);const n=g();fe(n,this.tangentFrameForwardWS,Z(i,this.tangentFrameForwardWS)),Et(this.localFrameRightWS,i,n),le(this.localFrameRightWS,this.localFrameRightWS),Ot(this.localFrameUpWS,this.tangentFrameForwardWS,this.localFrameRightWS),Kc(this.worldToLocalTransform,this.localFrameRightWS,this.tangentFrameRightWS),Qc(this.localToWorldTransform,this.worldToLocalTransform)}get doUnnormalization(){return this.view.viewingMode==="global"}makeMapPoint(e,t){return an(e,t,this.defaultZ)}mapToLocal(e){const t=g();this.view.renderCoordsHelper.toRenderCoords(new C({x:e[0],y:e[1],spatialReference:this.spatialReference}),t),Go(t,t,this.worldToLocalTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new C({spatialReference:this.view.spatialReference}));return i!=null?k(i.x/this.scale,i.y/this.scale):null}localToMap(e){const t=g();this.view.renderCoordsHelper.toRenderCoords(new C({x:e.x*this.scale,y:e.y*this.scale,spatialReference:this.spatialReference}),t),Go(t,t,this.localToWorldTransform);const i=this.view.renderCoordsHelper.fromRenderCoords(t,new C({spatialReference:this.view.spatialReference}));return i!=null?an(i.x,i.y,this.defaultZ):null}};function fu(e,t){if(e.type==="2d")return new pu(e.state.transform,e.spatialReference,t.length>2?t[2]:null);if(e.type==="3d"){const i=t.length>2?new C({x:t[0],y:t[1],z:t[2],spatialReference:e.spatialReference}):new C({x:t[0],y:t[1],spatialReference:e.spatialReference});return new du(e,i)}return null}function Me(e,t){const i=new C({x:e[0],y:e[1],spatialReference:t});return e.length>2&&(i.z=e[2]),i}function gu(e,t){return new Mr({points:e,spatialReference:t})}function Wo(e,t,i){const n=new fi({paths:e,spatialReference:t});return i&&Cr(n),n}function Oi(e,t,i,n=!0){const s=is(e);s.forEach(r=>{const l=r[0],h=r[r.length-1];Fe(l,h)&&r.length!==1||r.push(r[0])});let o=new De({rings:s,spatialReference:t});return o.rings.forEach(r=>{Yl(r)||r.reverse()}),i&&Cr(o),n&&o.isSelfIntersecting&&Ns(t)&&(o=Zc(o)),o}function Yo(e,t,i){const n=t.mapToLocalMultiple(e),s=[],o={x:n[0].x,y:n[0].y},r={x:n[1].x,y:n[1].y},l=Math.round(r.x-o.x),h=Math.round(r.y-o.y),u=Math.max(Math.abs(l),Math.abs(h));if(i){const p={x:o.x+u,y:o.y+u},d={x:o.x-u,y:o.y-u};s.push(k(p.x,d.y),k(d.x,d.y),k(d.x,p.y),k(p.x,p.y))}else{const p={x:l>0?o.x+u:o.x-u,y:h>0?o.y+u:o.y-u};s.push(k(o.x,o.y),k(p.x,o.y),k(p.x,p.y),k(o.x,p.y))}return pa(Oi([s.map(p=>t.localToMap(p)).filter(ki)],t.spatialReference,t.doUnnormalization,!0),s,t)}function mu(e,t,i){let n=t.mapToLocalMultiple(e);if(n.length===1){const l=n[0];n=[k(l.x-48,l.y+48),k(l.x+48,l.y-48),k(l.x+48,l.y-48),k(l.x-48,l.y+48)]}const s=[],o={x:n[0].x,y:n[0].y},r={x:n[1].x,y:n[1].y};if(i){const l=Math.round(r.x-o.x),h=Math.round(r.y-o.y);s.push(k(o.x-l,o.y-h),k(r.x,o.y-h),k(r.x,r.y),k(o.x-l,r.y))}else s.push(k(o.x,o.y),k(r.x,o.y),k(r.x,r.y),k(o.x,r.y));return pa(Oi([s.map(l=>t.localToMap(l)).filter(ki)],t.spatialReference,t.doUnnormalization,!0),s,t)}function pa(e,t,i){const n=zi(t[3],t[2],i),s=zi(t[1],t[2],i),o=zi(t[0],t[1],i),r=zi(t[0],t[3],i);return{geometry:e,midpoints:n!=null&&s!=null&&o!=null&&r!=null?{top:n,right:s,bottom:o,left:r}:null}}function zi(e,t,i){Re[0]=e.x,Re[1]=e.y,Re[2]=0,Ve[0]=t.x,Ve[1]=t.y,Ve[2]=0,Pe(Re,Re,Ve,.5),Ui.x=Re[0],Ui.y=Ve[1],Ui.z=Ve[2];const n=i.localToMap(Ui);return n!=null?Me(n,i.spatialReference):null}const Ui=k(0,0,0),Re=g(),Ve=g();function Xo(e,t,i,n){const s=t.mapToLocalMultiple(e);let o=null,r=null;if(i)o=s[0],r=s[1];else{const _=s[0],y=s[1],w=Math.round(y.x-_.x),b=Math.round(y.y-_.y),S=Math.max(Math.abs(w),Math.abs(b));o=k(w>0?_.x+S/2:_.x-S/2,b>0?_.y+S/2:_.y-S/2),r=k(Math.abs(w)>Math.abs(b)?o.x-S/2:o.x,Math.abs(w)>Math.abs(b)?o.y:o.y-S/2)}const l=t.localToMap(o),h=t.localToMap(r);if(l==null||h==null)return null;t.doUnnormalization&&Xl([[l,h]],t.spatialReference);const u=Me(l,t.spatialReference),p=Me(h,t.spatialReference),d=vi(t.spatialReference);let m=0;if(Ns(t.spatialReference))m=d*Bc(u,p,null);else{const _=o.x-r.x,y=o.y-r.y;m=d*Math.sqrt(_*_+y*y)*1}const f=new uu({center:u,radius:m,radiusUnit:"meters",spatialReference:t.spatialReference});return{geometry:Oi(f.rings,f.spatialReference,!1),center:u,edge:p}}function yu(e,t,i){const n=t.mapToLocalMultiple(e),s=n[0],o=n[1],r=Math.round(o.x-s.x),l=Math.round(o.y-s.y),h=k(i?s.x:s.x+r/2,i?s.y:s.y+l/2),u=i?r:r/2,p=i?l:l/2,d=60,m=[],f=2*Math.PI/d;function _(Y){const gt=Math.cos(Y),lt=Math.sin(Y);return k(u*gt+h.x,p*lt+h.y)}for(let Y=0;Y<d;Y++)m.push(_(Y*f));m.push(m[0]);const{spatialReference:y,doUnnormalization:w}=t,b=Oi([m.map(Y=>t.localToMap(Y)).filter(ki)],y,w,!1),S=t.localToMap(_(Math.PI/2)),I=t.localToMap(_(0)),K=t.localToMap(_(-Math.PI/2)),et=t.localToMap(_(Math.PI));return{geometry:b,midpoints:S!=null&&I!=null&&K!=null&&et!=null?{top:Me(S,y),right:Me(I,y),bottom:Me(K,y),left:Me(et,y)}:null}}function io(e,t){switch(e){case"point":case"multipoint":return _u();case"polyline":return vu(t);case"polygon":return xu(t);default:return}}function _u(e){return"point"}function vu(e){return(e!=null&&e.type==="polyline"&&e.paths.length?e.paths[0].length:0)<2?"polylineZeroVertices":"polylineOneVertex"}function xu(e){const t=e!=null&&e.type==="polygon"&&e.rings.length?e.rings[0].length:0;return t<3?"polylineZeroVertices":t<4?"polygonOneVertex":"polygonTwoVertices"}function bu(e,t){const i=e?.geometry;if(!e||i?.type!=="mesh"||!t)return;const{renderCoordsHelper:n,elevationProvider:s}=t,{camera:o}=t.state,{extent:r}=i,{center:l,spatialReference:h}=r,u=vi(h),p=Fs(h),d=vi(n.spatialReference),m=r.width*u,f=r.height*p,_=(r.zmax??0)*p,y=_-(r.zmin??0)*p,w=Math.max(m,f,y)/d,{x:b,y:S}=l,I=l.z??0;N($i,b,S,I),n.toRenderCoords($i,h,$i);const K=w/o.computeScreenPixelSizeAt($i);if(K>o.width*Tu)return"meshTooClose";if(K<wu)return"meshTooFar";const et=Uc(e),{absoluteZ:Y}=$c(b,S,_,h,t,et);return Y<(s.getElevation(b,S,I,h,"ground")??0)*p+y*Eu?"meshUnderground":"mesh"}const wu=20,Tu=1,Eu=.1,$i=g();function Bn(e,t){return e[0]*t[1]-e[1]*t[0]}function Su(e,t){const i=e.start,n=e.end,s=t.start,o=t.end,r=q(da,n,i),l=q(fa,o,s),h=Bn(r,l);if(Math.abs(h)<=Mu)return[];const u=q(ga,i,s),p=Bn(l,u)/h,d=Bn(r,u)/h;if(p>=0){if(d>=0||t.type===O.LINE)return[qt(ln,i,r,p)]}else if(e.type===O.LINE&&(d>=0||t.type===O.LINE))return[qt(ln,i,r,p)];return[]}function Pu(e,t,i){const n=[],s=q(da,e.end,e.start),o=q(fa,e.start,t),r=Be(s),l=2*_e(s,o),h=l*l-4*r*(Be(o)-i*i);if(h===0){const u=-l/(2*r);(e.type===O.LINE||u>=0)&&n.push(qt(ln,e.start,s,u))}else if(h>0){const u=Math.sqrt(h),p=(-l+u)/(2*r);(e.type===O.LINE||p>=0)&&n.push(qt(ln,e.start,s,p));const d=(-l-u)/(2*r);(e.type===O.LINE||d>=0)&&n.push(qt(ga,e.start,s,d))}return n}var O;(function(e){e[e.RAY=0]="RAY",e[e.LINE=1]="LINE"})(O||(O={}));const Mu=1e-6,da=G(),fa=G(),ga=G(),ln=G();function no({start:e,end:t,type:i},n,s){const o=[],r=q(Ii,t,e),l=q(wn,e,n),h=Be(r),u=2*_e(r,l),p=u*u-4*h*(Be(l)-s*s);if(p===0){const d=-u/(2*h);(i===bt.PLANE||d>=0)&&o.push(qt(G(),e,r,d))}else if(p>0){const d=Math.sqrt(p),m=(-u+d)/(2*h);(i===bt.PLANE||m>=0)&&o.push(qt(G(),e,r,m));const f=(-u-d)/(2*h);(i===bt.PLANE||f>=0)&&o.push(qt(G(),e,r,f))}return o}function ma(e,t){const i=e.start,n=e.end,s=q(Ii,n,i),o=N(En,-s[1],s[0],0),r=t.start,l=t.end,h=pt(oo,l,r),u=Z(h,o),p=N(Ea,i[0],i[1],0),d=pt(Sa,p,r),m=Z(d,o),f=wi();if(Math.abs(u)<f)return[];const _=z(Pa,r,h,m/u);if(t.type===O.RAY){const y=pt(ps,_,r);if(Z(y,h)<-f)return[]}if(e.type===bt.HALF_PLANE){const y=Sc(wn,_,i);if(_e(y,s)<-f)return[]}return[ye(_)]}function ku(e,t){return Ru(cn(ro,t[2],e),t)}function ya(e,t){return wa(cn(ro,0,e),cn(Iu,0,t)).map(([i,n])=>de(i,n))}function _a(e,t,i){return xa(e,cn(ro,e[2],t),i)}function va(e,t,i,n=g()){const s=q(Ii,e,t),o=Mc(s);return qt(n,t,s,o===0?1:i/o),n[2]=e[2],n}function xa(e,{start:t,end:i,type:n},s=g()){const o=pt(Tn,e,t),r=pt(En,i,t),l=Z(o,r)/Z(r,r);return z(s,t,r,n===O.RAY?Math.max(l,0):l)}const Cu=(()=>{const e=g(),t=g(),i=g();return({start:n,end:s},{center:o,radius:r,normal:l,slicePlane:h})=>{const u=Ri(o,l,Ou);if(R(ls(u,n),0)&&R(ls(u,s),0)){Qr(l,e,t);const d=(_,y)=>(Et(i,y,o),Wt(_,Z(i,e),Z(i,t)),_),m=Pu({start:d(Ii,n),end:d(wn,s),type:O.LINE},Vc,r),f=[];for(const[_,y]of m){const w=rt(g(),o);z(w,w,e,_),z(w,w,t,y),h&&!me(h,w)||f.push(w)}return f}const p=g();return js(u,n,s,p)?!R(ge(p,o),r)||h&&!me(h,p)?[]:[p]:[]}})();function ba({start:e,end:t,type:i},n,s){const o=[],r=Et(Tn,t,e),l=q(wn,e,n),h=Be(r),u=2*_e(r,l),p=u*u-4*h*(Be(l)-s*s);if(p===0){const d=-u/(2*h);(i===O.LINE||d>=0)&&o.push(z(g(),e,r,d))}else if(p>0){const d=Math.sqrt(p),m=(-u+d)/(2*h);(i===O.LINE||m>=0)&&o.push(z(g(),e,r,m));const f=(-u-d)/(2*h);(i===O.LINE||f>=0)&&o.push(z(g(),e,r,f))}return o}function wa(e,t){const i=e.start,n=e.end,s=t.start,o=t.end,r=pt(Tn,n,i),l=pt(En,o,s),h=pt(oo,s,i),u=Ot(Ea,r,l);if(!R(Z(h,u),0))return[];const p=as(u);if(R(p,0))return[];const d=Ot(Sa,h,l),m=Z(d,u)/p,f=z(Pa,i,r,m);if(e.type===O.RAY){const _=pt(ps,f,i);if(Z(r,_)<-wi())return[]}if(t.type===O.RAY){const _=pt(ps,f,s);if(Z(l,_)<-wi())return[]}return[ye(f)]}function Ru({start:e,end:t,type:i},n){const s=pt(Tn,n,e),o=pt(En,t,e),r=Ot(oo,o,s),l=as(r)/as(o),h=wi();if(l<h)switch(i){case O.LINE:return[ye(n)];case O.RAY:return Z(o,s)<-h?[]:[ye(n)]}return[]}function so(e,t,i,n){const[s,o]=e,[r,l]=i,h=r-s,u=l-o,p=h*h+u*u,d=Math.sqrt(p);if(d>t+n)return[];if(d<Math.abs(t-n))return[];if(R(d,0)&&R(t,n))return[];const m=(t*t-n*n+p)/(2*d),f=Math.sqrt(t*t-m*m),_=f*u/d,y=f*h/d,[w,b]=$r(Ii,e,i,m/d);return R(_,y)?[de(w,b)]:[de(w+_,b-y),de(w-_,b+y)]}function cn(e,t,{start:i,end:n,type:s}){return N(e.start,i[0],i[1],t),N(e.end,n[0],n[1],t),e.type=Au[s],e}function Ta(e,t){return R(e[2],t[2])}function R(e,t){return li(Math.abs(e-t),0,wi())}function Vu(e,t){return t.filter(i=>me(e,i))}function me(e,t){return Kr(e,t)}var bt;(function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"})(bt||(bt={}));const Au={[bt.PLANE]:O.LINE,[bt.HALF_PLANE]:O.RAY},Ii=G(),wn=G(),Tn=g(),En=g(),oo=g(),Ea=g(),Sa=g(),Pa=g(),ps=g(),Ou=at(),ro={start:g(),end:g(),type:O.LINE},Iu={start:g(),end:g(),type:O.LINE};class Tt{intersect(t){return $t(this,t)}closestPoints(t){return[this.closestTo(t)]}}class Je extends Tt{constructor(t){super(),this.point=t}equals(t){return this===t||vt(t)&&H(this.point,t.point)}closestTo(){return qe(this.point)}}class ao extends Tt{constructor(t,i,n){super(),this.start=t,this.end=i,this.lineLike={start:t,end:i,type:n}}equals(t){return this===t||Rt(t)&&this.lineLike.type===t.lineLike.type&&H(this.start,t.start)&&H(this.end,t.end)}closestTo(t){const i=j();return xa(t,this.lineLike,i),i}}class Ma extends ao{constructor(t,i){super(t,i,O.LINE)}}class Lu extends ao{constructor(t,i){super(t,i,O.RAY)}}class ka extends Tt{constructor(t){super(),this.constraints=t}equals(t){return this===t||ds(t)&&Fe(this.constraints,t.constraints,(i,n)=>i.equals(n))}closestTo(t){let i,n=1/0;for(const s of this.constraints){const o=s.closestTo(t),r=Hc(t,o);r<n&&(n=r,i=o)}return qe(i??t)}closestPoints(t){return this.constraints.flatMap(i=>i===this?[]:i.closestPoints(t))}}class Ca extends Tt{constructor(t,i){super(),this.center=t,this.radius=i}equals(t){return this===t||At(t)&&this.center[0]===t.center[0]&&this.center[1]===t.center[1]&&this.radius===t.radius}closestTo(t){const i=j();return va(t,this.center,this.radius,i),i}}class lo extends Tt{constructor(t,i){super(),this.center=t,this.radius=i}equals(t){return this===t||Nt(t)&&H(this.center,t.center)&&this.radius===t.radius}closestTo(t){const i=j();return va(t,this.center,this.radius,i),i[2]=this.center[2],i}asCircle(){return new co(qe(this.center),this.radius,ve(0,0,1))}}class co extends Tt{constructor(t,i,n,s=void 0){super(),this.center=t,this.radius=i,this.normal=n,this.slicePlane=s}equals(t){return this===t||oe(t)&&H(this.center,t.center)&&H(this.normal,t.normal)&&this.radius===t.radius}closestTo(t){const{center:i,radius:n}=this;Ks(this.getPlane(Gu),t,Wn);const s=pt(Wn,Wn,i),o=Fr(s);if(R(o,0))return qe(t);const r=n/Math.sqrt(o),l=j();z(l,i,s,r);const{slicePlane:h}=this;return h&&!me(h,l)?uo(h,this)?.closestTo(t)??qe(t):l}getPlane(t=at()){return Ri(this.center,this.normal,t)}}const Wn=g(),Gu=at();class Ra extends Tt{constructor(t){super(),this.z=t}equals(t){return this===t||Ht(t)&&this.z===t.z}closestTo(t){return ve(t[0],t[1],this.z)}getPlane(t=at()){return N(qo,0,0,this.z),Ri(qo,Hs,t)}}const qo=g();class Va extends Tt{constructor(t,i,n){super(),this.start=t,this.end=i,this.planeLike={start:t,end:i,type:n}}equals(t){return this===t||Vt(t)&&this.planeLike.type===t.planeLike.type&&H(this.start,t.start)&&H(this.end,t.end)}closestTo(t){const i=j();return _a(t,this.planeLike,i),i}closestEndTo(t){const{start:i,end:n}=this.planeLike;return Math.sign(_e(q(Du,n,i),q(zu,t,i)))>0?this.end:this.start}getPlane(t=at()){const i=rt(jo,this.end);return i[2]+=1,Jr(this.start,this.end,i,t)}getSlicePlane(t=at()){const{start:i,end:n,type:s}=this.planeLike;if(s===bt.PLANE)return;const o=N(jo,i[0],i[1],0),r=N(Ko,n[0],n[1],0),l=Et(Ko,r,o);return Ri(o,l,t),t}}const Du=G(),zu=G(),jo=g(),Ko=g();class Uu extends Va{constructor(t,i){super(t,i,bt.HALF_PLANE)}}class $u extends Tt{constructor(t,i){super(),this.sphere=Ph(t,i)}equals(t){return this===t||Ft(t)&&Mh(this.sphere,t.sphere)}closestTo(t){const i=j();return kh(this.sphere,t,i),i}get center(){return Ch(this.sphere)}get radius(){return this.sphere[3]}}class Hu extends Tt{constructor(t,i,n){super(),this.start=t,this.end=i,this.getZ=n,this.planeLike={start:t,end:i,type:bt.PLANE}}equals(t){return this===t||hn(t)&&H(this.start,t.start)&&H(this.end,t.end)&&this.getZ===t.getZ}closestTo(t){return Bu(this,t)}addIfOnTheGround(t,i){for(const n of i){const s=this.getZ(n[0],n[1])??0;R(n[2],s)&&(n[2]=s,t.push(n))}}}class ho extends Tt{constructor(t,i,n){super(),this._x=t,this._y=i,this._z=n}equals(t){return this===t||ap(t)&&this._x===t._x&&this._y===t._y&&this._z===t._z}closestTo([t,i,n]){return oa(this._x??t,this._y??i,this._z??n)}}class Aa extends Tt{constructor(t,i,n,s,o){super(),this._origin=t,this._spatialReference=i,this._distanceMeters=n,this._z=s,this._directionDegrees=o}equals(t){return this===t||rp(t)&&Io(this._origin,t._origin)&&this._spatialReference===t._spatialReference&&this._distanceMeters===t._distanceMeters&&this._z===t._z&&this._directionDegrees===t._directionDegrees}closestTo([t,i,n]){return Wt(si,t,i),Io(si,this._origin)||this._applyDirectionAndDistance(si),oa(si[0],si[1],this._z??n)}_applyDirectionAndDistance(t){if(this._directionDegrees!=null&&this._distanceMeters!=null)bi(t,this._origin,this._directionDegrees,this._distanceMeters,this._spatialReference);else if(this._directionDegrees!=null)Fu(t,this._origin,this._directionDegrees,t,this._spatialReference);else if(this._distanceMeters!=null){const{azimuth:i}=mn(Nu,this._origin,t,this._spatialReference);bi(t,this._origin,i??0,this._distanceMeters,this._spatialReference)}}}const si=[0,0],Nu=new yn;function Fu(e,t,i,n,s){let{azimuth:o,distance:r}=mn(Zu,t,n,s);o??=0;let l=r*Math.cos((o-i)*bh);l=Math.max(0,l),bi(e,t,i,l,s)}const Zu=new yn;function Bu(e,t){const i=j();return _a(t,e.planeLike,i),i[2]=e.getZ(i[0],i[1])??Ia,i}function $t(e,t){if(ds(e)){const i=[];for(const n of e.constraints){const s=n.intersect(t);s&&i.push(s)}return Li(i)}if(ds(t))return $t(t,e);if(hn(e))return Qo(e,t);if(hn(t))return Qo(t,e);if(vt(e)){const{point:i}=e;if(vt(t))return H(i,t.point)?e:void 0;const n=t.closestTo(i);return We(n,i)?e:void 0}if(Rt(e)){if(vt(t))return $t(t,e);if(Rt(t))return Pt(wa(e.lineLike,t.lineLike));if(Ht(t))return Wu(e,t);if(Vt(t))return Pt(ma(t.planeLike,e.lineLike));if(At(t))return Pt(ba(e.lineLike,t.center,t.radius));if(oe(t))return Pt(Cu(e.lineLike,t));if(Nt(t))return Yu(e,t);if(Ft(t))return Xu(e,t)}else if(Ht(e)){if(vt(t)||Rt(t))return $t(t,e);if(Ht(t))return qu(e,t);if(Vt(t))return ju(e,t);if(At(t))return Ku(e,t);if(oe(t))return Ju(e,t);if(Nt(t))return Qu(e,t);if(Ft(t))return tp(e,t)}else if(Vt(e)){if(vt(t)||Rt(t)||Ht(t))return $t(t,e);if(Vt(t))return Yn(ya(e.planeLike,t.planeLike));if(At(t))return Yn(no(e.planeLike,t.center,t.radius));if(oe(t))return ip(e,t);if(Nt(t))return ep(e,t);if(Ft(t))return np(e,t)}else if(At(e)){if(vt(t)||Rt(t)||Ht(t)||Vt(t))return $t(t,e);if(At(t))return Yn(so(e.center,e.radius,t.center,t.radius));if(oe(t))return;if(Nt(t))return sp(e,t);if(Ft(t))return}else if(oe(e)){if(vt(t)||Rt(t)||Ht(t)||Vt(t)||At(t))return $t(t,e);if(oe(t))return;if(Nt(t))return t.asCircle(),void 0;if(Ft(t))return}else if(Nt(e)){if(vt(t)||Rt(t)||Ht(t)||Vt(t)||At(t)||oe(t))return $t(t,e);if(Nt(t))return op(t,e);if(Ft(t))return}else if(Ft(e)){if(vt(t)||Rt(t)||Ht(t)||Vt(t)||At(t)||Nt(t))return $t(t,e);if(Ft(t))return}}const Wu=(()=>{const e=at();return(t,i)=>{const{start:n,end:s}=t;if(Ta(n,s)&&R(n[2],i.z))return t;const o=j();return js(i.getPlane(e),n,s,o)?new Je(o):void 0}})();function Yu({lineLike:e},{center:t,radius:i}){const n=t[2];return Pt(ba(e,t,i).filter(s=>R(s[2],n)))}function Xu({lineLike:e},{sphere:t}){return Pt(Sh(t,e.start,e.end))}const uo=(()=>{const e=jr(),t=g(),i=g();return(n,s,o)=>{const{normal:r,center:l,radius:h}=s;Qr(r,t,i);const u=Ue(n),p=h*Z(u,t),d=h*Z(u,i);gh(e,l[0],l[1],l[2],1);const m=mh(n,e),f=Math.hypot(p,d),_=R(f,0);if(R(ls(n,l),0)){if(_)return s;if(R(h,0))return!o||me(o,l)?new Je(qe(l)):void 0;Ot(t,u,r),le(t,t);const Y=new Array,gt=ye(l);z(gt,gt,t,h),o&&!me(o,gt)||Y.push(gt);const lt=ye(l);return z(lt,lt,t,-h),o&&!me(o,lt)||Y.push(lt),Pt(Y)}if(_)return;const y=-m/f;if(Math.abs(y)>1||R(y,1))return;const w=Math.atan(p/d),b=tc(y)-w,S=Math.PI-b,I=new Array,K=g();z(K,l,t,h*Math.cos(b)),z(K,K,i,h*Math.sin(b)),I.push(K);const et=g();return z(et,l,t,h*Math.cos(S)),z(et,et,i,h*Math.sin(S)),I.push(et),Pt(o?Vu(o,I):I)}})();function qu(e,t){return R(e.z,t.z)?e:void 0}function ju({z:e},{planeLike:t}){const[i,n]=t.start,[s,o]=t.end,r=ve(i,n,e),l=ve(s,o,e);return t.type===bt.PLANE?new Ma(r,l):new Lu(r,l)}function Ku(e,t){const[i,n]=t.center;return new lo(ve(i,n,e.z),t.radius)}function Qu(e,t){return R(t.center[2],e.z)?t:void 0}const Ju=(()=>{const e=at();return(t,i)=>uo(t.getPlane(e),i,i.slicePlane)})();function tp(e,{center:t,radius:i}){const n=Math.abs(t[2]-e.z);if(n>i&&!R(n,i))return;const s=ve(t[0],t[1],e.z),o=Math.sqrt(i**2-n**2);return R(o,0)?void 0:new lo(s,o)}const ep=(()=>{const e=at();return(t,{center:i,radius:n})=>{const s=no(t.planeLike,i,n),o=i[2];t.getSlicePlane(e);const r=new Array;for(const[l,h]of s){const u=[l,h,o];me(e,u)&&r.push(u)}return Pt(r)}})(),ip=(()=>{const e=at(),t=at();return(i,n)=>uo(i.getPlane(e),n,i.getSlicePlane(t))})(),np=(()=>{const e=at();return(t,{center:i,radius:n})=>{const s=t.getPlane(e),o=Ae(s,i),r=Math.abs(o);if(r>n&&!R(r,n))return;const l=Math.sqrt(n**2-o**2);if(R(l,0)){const p=j();return Ks(s,i,p),new Je(p)}const h=j(),u=ye(Ue(s));return z(h,i,u,o),new co(h,l,u,t.getSlicePlane())}})();function sp(e,t){const i=sn(e.center,t.center);return R(i,0)&&R(e.radius,t.radius)?t:Oa(so(e.center,e.radius,t.center,t.radius),t.center[2])}function op(e,t){if(!Ta(e.center,t.center))return;const i=sn(e.center,t.center);return R(i,0)&&R(e.radius,t.radius)?e:Oa(so(e.center,e.radius,t.center,t.radius),e.center[2])}function Qo(e,t){const{planeLike:i,getZ:n}=e,s=new Array;if(vt(t))e.addIfOnTheGround(s,ku(i,t.point));else if(Rt(t))e.addIfOnTheGround(s,ma(i,t.lineLike));else if(At(t))for(const[o,r]of no(i,t.center,t.radius)){const l=n(o,r);l!=null&&s.push(pe(o,r,l))}else if(Vt(t)||hn(t))for(const[o,r]of ya(i,t.planeLike)){const l=n(o,r)??Ia;s.push(pe(o,r,l))}return Pt(s)}function Yn(e){return Li(e.map(([t,i])=>{const n=ve(t,i,0),s=ve(t,i,1);return new Ma(n,s)}))}function Pt(e){return Li(e.map(t=>t?new Je(t):void 0))}function Oa(e,t){return Pt(e.map(([i,n])=>[i,n,t]))}function Li(e){if(e.length!==0)return e.length===1?e[0]??void 0:new ka(e.filter(ki))}function ds(e){return e instanceof ka}function vt(e){return e instanceof Je}function Rt(e){return e instanceof ao}function Ht(e){return e instanceof Ra}function Vt(e){return e instanceof Va}function At(e){return e instanceof Ca}function Nt(e){return e instanceof lo}function oe(e){return e instanceof co}function Ft(e){return e instanceof $u}function hn(e){return e instanceof Hu}function rp(e){return e instanceof Aa}function ap(e){return e instanceof ho}const Ia=0;var A;function po(e,t){if(e==null||t==null)return;const i=fs(e,t);return i!=null?Dt(i,"radians","geographic"):void 0}(function(e){e.Absolute="absolute",e.Relative="relative",e.RelativeBilateral="relative-bilateral"})(A||(A={}));const fs=(()=>{const e=g(),t=g();return(i,n)=>(N(e,i.x,i.y,i.z??0),N(t,n.x,n.y,n.z??0),lp(e,t,i.spatialReference,n.spatialReference))})(),lp=(()=>{const e=G(),t=g(),i=g();return(n,s,o,r)=>{if(H(n,s))return;const l=rn(o),h=rn(r);if(l&&h&&Qe(l,h)&&xt(n,o,t,l)&&xt(s,r,i,h)){const{azimuth:p}=mn(pp,t,i,l);return p!=null?fn(p,"degrees","radians"):void 0}e[0]=s[0]-n[0],e[1]=s[1]-n[1];let u=Pc(Rc,e);return e[0]<0&&(u=dp-u),u}})();function cp(e,t,i,n=A.Absolute){if(t&&i)switch(n){case A.Absolute:return po(t,i);case A.Relative:return un(Jo(e,t,i),A.Relative);case A.RelativeBilateral:return un(Jo(e,t,i),A.RelativeBilateral)}}function Jo(e,t,i){if(!e||!t||!i)return;const n=fs(e,t),s=fs(t,i);return n!=null&&s!=null?Dt(s-n,"radians","geographic"):void 0}function un(e,t){if(e!=null)switch(t){case A.Absolute:return gs(e);case A.Relative:{const i=Mt(e);let n=tr.normalize(i,0,!0);return n===-180&&(n=180),Dt(n,"degrees","geographic")}case A.RelativeBilateral:{const i=Mt(e),n=Math.abs(tr.normalize(i,0,!0));return Dt(n,"degrees","geographic")}}}function gs(e){const t=Mt(e),i=fp.normalize(t,0,!0);return Dt(i,"degrees","geographic")}const hp=(()=>{const e=g();return(t,i,n,s,o,r="geodesic")=>{rt(e,i);const l=Mt(o);if(r==="geodesic"){const f=rn(n);if(f&&xt(e,n,e,f))return bi(t,e,l,s,f),t[2]=i[2],!!xt(t,f,t,n)}const h=qr(l,"geographic","arithmetic"),u=fn(h,"degrees","radians"),p=i[0]+s*Math.cos(u),d=i[1]+s*Math.sin(u),m=i[2];return N(t,p,d,m),!0}})();function Mt(e){if(e!=null)return qr(up(e),e.rotationType,"geographic")}function up(e){return fn(e.value,e.unit,"degrees")}const pp=new yn,dp=2*Math.PI,fp=ta,tr=new Qs(-180,180);function gp(e,t,i,n,s,o){let r="geodesic",l=rn(i);const h=j();return to(e,t,n,h),h[2]=0,l&&xt(h,i,h,l)||(r="euclidean",l=i),{mode:r,view:t,elevationInfo:n,hasZ:s,directionMode:o,spatialReference:e.spatialReference,measurementSR:l,origin:h}}function mp(e,t,i){if(t==null||e==null)return;const n=Bs(i.measurementSR);if(n==null)return;const s=Sn(e,i);if(s==null)return;const o=_n(t,n);return new Ca(s,o)}function yp(e,t,i,n){if(i==null||e==null)return;const s=Sn(e,n);if(s==null)return;const o=Mt(i),r=10,l=u=>{if(u==null)return;const p=j(),d=Dt(u,"degrees","geographic");return hp(p,s,n.measurementSR,r,d,n.mode)?new Uu(s,p):void 0},h=()=>{if(t!=null&&e!=null)return Mt(po(t,e))};switch(n.directionMode){case A.Absolute:return l(o);case A.Relative:{const u=h();return u==null?void 0:l(u+o)}case A.RelativeBilateral:{const u=h();return u==null?void 0:Li([l(u+o),l(u-o)])}}}function La(e,t){const i=Pn(e,t);return i!=null?new Ra(i):void 0}function Ga(e,t,i){const{context:n,longitude:s,latitude:o,direction:r,distance:l,elevation:h}=i;if(s!=null||o!=null||l!=null||h!=null||r!=null){if(s!=null||o!=null){const u=Mt(s),p=Mt(o),d=Pn(h,n);return new ho(u,p,d)}return _p(e,t,i)}}function _p(e,t,{context:i,direction:n,distance:s,elevation:o}){if(t==null)return La(o,i);const{view:r,elevationInfo:l,measurementSR:h}=i,u=to(t,r,l);if(!h||!xt(u,t.spatialReference,er,h))return;const[p,d]=er,m=s!=null?_n(s,"meters"):void 0,f=Mt(n),_=Pn(o,i),y=b=>{const S=new Aa([p,d],h,m,_,b);return m==null||b==null||_==null&&i.hasZ?S:new Je(S.closestTo(u))};if(f==null)return y(void 0);const w=()=>{if(e!=null&&t!=null)return Mt(po(e,t))};switch(i.directionMode){case A.Absolute:return y(f);case A.Relative:{const b=w();return b==null?void 0:y(b+f)}case A.RelativeBilateral:{const b=w();return b==null?void 0:Li([y(b+f),y(b-f)])}}}function vp(e){return e.context.mode==="geodesic"?Ga(null,null,e):Da(e)}function xp(e,t,i){const{context:n,x:s,y:o,distance:r,direction:l,elevation:h}=i;return n.mode==="geodesic"?Ga(t,e,i):s!=null||o!=null?Da(i):bp([mp(e,r,n),yp(e,t,l,n),La(h,n)])}function Da({x:e,y:t,elevation:i,context:n}){Hi.x=e?.value??0,Hi.y=t?.value??0,Hi.spatialReference=n.spatialReference;const s=Sn(Hi,n,Ep);return new ho(e!=null&&s!=null?s[0]:void 0,t!=null&&s!=null?s[1]:void 0,Pn(i,n))}function bp(e){let t;for(const i of e)i&&(t=t?.intersect(i)??i);return t}function Sn(e,t,i=j()){const{view:n,elevationInfo:s,measurementSR:o,origin:r,mode:l}=t;if(to(e,n,s,i),xt(i,e.spatialReference,i,o))return l!=="geodesic"&&Et(i,i,r),i}function wp(e,t,i,n){const{view:s,measurementSR:o,spatialReference:r,origin:l,mode:h}=i;if(h==="geodesic"?rt(oi,e):ut(oi,e,l),xt(oi,o,oi,r))return Wh(oi,s,t,i,n)}function Pn(e,t){return Tp(e,t)?.value??void 0}function Tp(e,{view:t,origin:i,elevationInfo:n,hasZ:s,measurementSR:o}){if(e==null||!s)return;const r=zr(o);if(r==null)return;const[l,h]=i,u=_n(e,r),p=t?.type==="3d"?Nr(t,l,h,u,o,n):u;return p!=null?ft(p,r):void 0}const er=j(),Ep=j(),oi=j(),Hi=Ys(0,0,0,ue.WGS84),Sp="z",Pp="r",ir={toggle:"Control"},$e={enterInputMode:"Tab",commit:"Enter",discard:"Escape",next:"Tab"},kt={moveUp:{key:"ArrowUp",modifier:"Shift",repeats:!0},moveDown:{key:"ArrowDown",modifier:"Shift",repeats:!0},moveLeft:{key:"ArrowLeft",modifier:"Shift",repeats:!0},moveRight:{key:"ArrowRight",modifier:"Shift",repeats:!0},scaleUp:{key:"+",modifier:"Shift"},scaleDown:{key:"-",modifier:"Shift"},factorModifier:{key:Yr,continuePropagation:!0},toggleOpacity:"t",preserveAspectRatio:{key:"Shift",continuePropagation:!0},rotateIncrements:{key:"Shift",continuePropagation:!0},undo:Sp,redo:Pp};let Mp=class{constructor(){this._bindings=new Map}add(e,t){return this.addToggle(e,i=>{i.type==="key-down"&&t(i)})}addToggle(e,t){const i=kp.fromDefinition(e,t),n=ec(this._bindings,i.key,()=>[]);return n.push(i),W(()=>Dr(n,i))}register(e,t=Xr.WIDGET){return Gr([e.on("key-down",i=>this.dispatch(e.inputManager,i),t),e.on("key-up",i=>this.dispatch(e.inputManager,i),t)])}dispatch(e,t){const i=t.key,n=this._bindings.get(i);if(n)for(const s of n)s.process(e,t)}},kp=class ms{constructor(t,i,n,s,o){this.key=t,this.modifiers=i,this.repeats=n,this.continuePropagation=s,this.callback=o}process(t,i){if(!(i.key!==this.key||"repeat"in i&&i.repeat&&!this.repeats)){for(const n of this.modifiers)if(!t.isModifierKeyDown(n))return;this.continuePropagation||i.stopPropagation(),this.callback(i)}}static fromDefinition(t,i){if(typeof t=="string")return new ms(t,[],!1,!1,i);const{key:n,modifier:s,repeats:o,continuePropagation:r}=t;return new ms(n,s?Array.isArray(s)?s:[s]:[],!!o,!!r,i)}};const Q="esri-tooltip",Cp=`${Q}-content`,Rp=`${Q}-content--input`,Vp=`${Q}-content__header`,Ap=`${Q}-content__header__spacer`,nr=`${Q}-content__header__actions`,za=`${Q}-draw-header-actions`,Op=`${Q}-table`,Ip=`${Q}-help-message`,Lp=`${Q}-help-message__text`,Gp=`${Q}-help-message__icon`,Ni=`${Q}-field`,Fi={base:Ni,inputMode:`${Ni}--input`,title:`${Ni}__title`,value:`${Ni}__value`};let U=class extends Vi{constructor(){super(...arguments),this.hidden=!1,this.mode="feedback"}render(){return v("div",{class:this.classes({[Fi.base]:!0,[Fi.inputMode]:this.mode==="input"})},v("div",{class:Fi.title,key:"title"},this.title),v("div",{class:Fi.value,key:"value"},this.value))}};a([c()],U.prototype,"hidden",void 0),a([c()],U.prototype,"mode",void 0),a([c()],U.prototype,"title",void 0),a([c()],U.prototype,"value",void 0),U=a([x("esri.views.interactive.tooltip.components.TooltipField")],U);const Dp={base:`${Q}-value-by-value`};let Yt=class extends Vi{constructor(){super(...arguments),this.divider="×"}render(){return v("div",{class:Dp.base},v("span",null,this.left),v("span",null,this.divider),v("span",null,this.right))}};a([c()],Yt.prototype,"left",void 0),a([c()],Yt.prototype,"divider",void 0),a([c()],Yt.prototype,"right",void 0),Yt=a([x("esri.views.interactive.tooltip.components.ValueByValue")],Yt);function ys(e){let t,i,n=[],s=!1;function o(...r){return s&&t===this&&zp(r,n)||(i=e.apply(this,r),t=this,n=r,s=!0),i}return o}function zp(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function sr(e){const t="metric";if(e==null)return t;const i=e.map,n=(i&&"portalItem"in i?i.portalItem?.portal:null)??ic.getDefault();switch(n.user?.units??n.units){case t:return t;case"english":return"imperial"}return nc(e.spatialReference)??t}function fo(e,t,i,n=2,s="abbr"){return nh(e,te(t,i).value,i,n,s)}function Ua(e,t,i,n=2,s="abbr"){return sh(e,te(t,i).value,i,n,s)}function Up(e,t,i=2,n="abbr"){return oh(e,t.value,t.unit,i,n)}function $p(e,t,i=2,n="abbr"){return rh(e,t.value,t.unit,i,n)}function Hp(e,t,i=2,n="abbr"){return ah(e,t.value,t.unit,i,n)}function Np(e,t,i=2,n="abbr"){return lh(e,t.value,t.unit,i,n)}function Fp(e,t,i=2,n="abbr"){return ch(e,t.value,t.unit,i,n)}function Zp(e,t,i=2,n="abbr"){return hh(e,t.value,t.unit,i,n)}function Bp(e,t,i=2,n="abbr"){return uh(e,t.value,t.unit,i,n)}function Wp(e,t,i=2,n="abbr"){return ph(e,t.value,t.unit,i,n)}function Yp(e,t,i=2,n="abbr"){return dh(e,t.value,t.unit,i,n)}function Xp(e,t,i=2,n="abbr"){return fh(e,t.value,t.unit,i,n)}function Mn(e,t,i,n=ta,s=!0){return eh(e.value,e.unit,e.rotationType,t,i,n,s)}function or(e,t,i,n,s="abbr"){switch(n=n??2,i){case"imperial":return Zp(e,t,n,s);case"metric":return Up(e,t,n,s);default:return fo(e,t,i,n,s)}}function qp(e,t,i,n=2,s="abbr"){switch(i){case"imperial":return Bp(e,t,n,s);case"metric":return $p(e,t,n,s);default:return Ua(e,t,i,n,s)}}function jp(e,t,i,n=2,s="abbr"){switch(i){case"imperial":return Wp(e,t,n,s);case"metric":return Hp(e,t,n,s);default:return fo(e,t,i,n,s)}}function Kp(e,t,i,n=2,s="abbr"){switch(i){case"imperial":return Yp(e,t,n,s);case"metric":return Np(e,t,n,s);default:return Ua(e,t,i,n,s)}}function Qp(e,t,i,n=2,s="abbr"){switch(i){case"imperial":return Xp(e,t,n,s);case"metric":return Fp(e,t,n,s);default:return fo(e,t,i,n,s)}}const kn=1,$a=6;function Jp(e,t){return{angleRelative:td,direction:ed,directionRelative:id,directionRelativeBilateral:nd,latitudeDecimalDegrees:od,longitudeDecimalDegrees:sd,area:(i,n)=>Qp(e,i,n??t.area),length:(i,n,s)=>or(e,i,n??t.length,s),lengthRelative:(i,n)=>qp(e,i,n??t.length),totalLength:(i,n)=>or(e,i,n??t.length),verticalLength:(i,n)=>jp(e,i,n??t.verticalLength),verticalLengthRelative:(i,n)=>Kp(e,i,n??t.verticalLength),percentage:ld,scalar:Fa,scale:cd}}function td(e){return Ci(e,{signDisplay:"exceptZero",...go(kn)})}function ed(e){return Mn(e,e.rotationType,kn)}function id(e){const t=Mt(e);return Ci(t,{style:"unit",unitDisplay:"narrow",unit:"degree",signDisplay:t>0?"never":"exceptZero",...go(kn)})}function nd(e){return Mn(e,e.rotationType,kn)}function sd(e){return Ha(e,Wa)}function od(e){return Ha(e,Ya)}function rd(e){return Na(e,Wa)}function ad(e){return Na(e,Ya)}function Ha(e,t){return Mn(te(e,"degrees"),"geographic",$a,t,!1)}function Na(e,t){const i=t.normalize(te(e,"degrees").value,void 0,!1);return Fa(Qt(i),$a)}function ld(e){return Ci(e.value,{style:"percent"})}function cd(e){return Ci(e,{style:"percent",maximumFractionDigits:0})}function Fa(e,t){return Ci(e.value,go(t))}function go(e){return{minimumFractionDigits:e,maximumFractionDigits:e}}function xe({createQuantity:e,sanitize:t}){return(i,n)=>{if(i==null)return null;t&&(i=t(i));const s=Ze(i);return s==null?null:e(s,n)}}function Za(e){return e.replaceAll(/[*^~°º]/g,"")}const hd=e=>{let t=`[-+]?[0-9${e.thousands}]+`;return e.decimal!==""&&(t+=`${e.decimal}[0-9]+`),new RegExp(`^(${t}\\s*)${e.separator}(\\s*${t})$`,"i")},ud=" ",Ba=[];for(const e of[",","\\|","\\s+"])for(const t of["\\.",",",""])for(const i of["",",","\\.",ud,"\\s+"])e!==t&&e!==i&&t!==i&&Ba.push({separator:e,decimal:t,thousands:i,pattern:hd({decimal:t,thousands:i,separator:e})});function pd(e){for(const{decimal:t,thousands:i,pattern:n}of Ba){n.lastIndex=0;const s=e.match(n);if(!s)continue;const o=Ze(rr(s[1],t,i)),r=Ze(rr(s[2],t,i));if(o!=null&&r!=null)return{x:Qt(o),y:Qt(r)}}return null}function rr(e,t,i){let n=e.replaceAll(/[\s+]/g,"");return i!==""&&(n=n.replaceAll(i,"")),t!==""&&(n=n.replaceAll(t,".")),n}function dd(e){if(!e||Ze(e)!=null||!eo())return null;const t=Si(e),i=Ke(t?.latitude),n=Ke(t?.longitude);return n!=null&&i!=null?{latitude:i,longitude:n}:null}function fd(e){return Ke(au(e))}function gd(e){return Ke(lu(e))}function Ke(e){return e!=null?Dt(e,"degrees","geographic"):null}const Wa=new Qs(-180,180),Ya=new Qs(-90,90),Xn=Symbol("dragHandles");let E=class extends Vi{constructor(){super(...arguments),this._focusAbortController=new AbortController,this._transitionInfo=null,this._mode="feedback",this._getFormatters=ys(Jp),this._onHeaderPointerDown=e=>{const t=e.target;t instanceof HTMLElement&&t?.tagName?.toLowerCase()!=="calcite-button"&&(this.removeHandles(Xn),t.setPointerCapture(e.pointerId),this.tooltip.onDragStart(e.clientX,e.clientY),this.addHandles([di(t,"pointermove",({clientX:i,clientY:n})=>{this.tooltip.onDrag(i,n)}),di(t,["pointerup","pointercancel"],i=>{this.removeHandles(Xn),t.releasePointerCapture(e.pointerId),this.tooltip.onDragEnd()}),di(t,"touchstart",i=>i.preventDefault())],Xn))},this._onDiscard=()=>{this.destroyed||(this.tooltip.emit("discard"),this.info.clearInputValues(),this.exitInputMode())},this._onCommit=(e,t)=>{if(this.destroyed)return;if(this.tooltip.emit("commit",{type:t}),t==="commit-and-exit")return void this.exitInputMode();if(t==="commit-on-blur")return;const i=this._getFocusableElements(),n=i.length,s=i.indexOf(e);if(s===-1)return void this.exitInputMode();const o=((s+(t==="commit-and-next"?1:-1))%n+n)%n;Zi(i.at(o))},this._onKeyDown=e=>{switch(e.code){case $e.next:return this._onNextKey(e);case $e.discard:return e.stopPropagation(),this._onDiscard()}}}get mode(){return this._mode}get _displayUnits(){const{displayUnits:e}=this.info.sketchOptions.values,t=sr(this.tooltip.view);return{length:e.length??t,verticalLength:e.verticalLength??t,area:e.area??t}}get _inputUnitInfos(){const e=this._messagesUnits,t=l=>({unit:l,abbreviation:ih(e,l,"abbr")}),{inputUnits:i}=this.info.sketchOptions.values,n=sr(this.tooltip.view),s=i.length??n,o=i.verticalLength??n,r=i.area??n;return{length:t(sc(s)),verticalLength:t(oc(o)),area:t(rc(r)),angle:t("degrees")}}get _formatters(){return this._getFormatters(this._messagesUnits,this._displayUnits)}get fieldContext(){return{formatters:this._formatters,inputUnitInfos:this._inputUnitInfos,messages:this._messagesTooltip,sketchOptions:this.info.sketchOptions,onCommit:this._onCommit,onDiscard:this._onDiscard}}render(){const{visibleElements:e}=this.info.sketchOptions.tooltips,t=this._renderedContent,i=this._renderedActions,n=this._renderedHelpMessage,s=t.length>0,o=s||!!n,r=this.mode==="input";return v("div",{class:Oh(Cp,r&&Rp),onkeydown:this._onKeyDown,tabIndex:-1},r&&o&&e.header?v("div",{class:Vp,"data-testid":"tooltip-header",key:"header",onpointerdown:this._onHeaderPointerDown},v("calcite-button",{appearance:"transparent","data-testid":"tooltip-back-button",iconFlipRtl:"both",iconStart:"chevron-left",key:"discard-button",kind:"neutral",onclick:this._onDiscard,scale:"s",tabIndex:-1}),i.length>0?v(wt,null,v("div",{class:Ap,key:"spacer"}),v("div",{class:nr,key:"actions"},i)):null):null,s?v("div",{class:Op,key:"content"},...t):null,n)}destroy(){this._focusAbortController.abort(),this._transitionInfo?.transition.skipTransition()}_renderActions(){return null}loadDependencies(){return Js({button:()=>Lt(()=>import("./calcite-button-Cm9_TJei-dPLwGZxZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url),icon:()=>Lt(()=>import("./calcite-icon-laqhdRBY-Cuc8vfVM.js"),__vite__mapDeps([18,15,1,2,3,4,6,13]),import.meta.url),input:()=>Lt(()=>import("./calcite-input-BKRd7MCS-CXqyw1UG.js"),__vite__mapDeps([19,20,1,2,3,4,6,5,7,12,8,9,10,11,13,14,15]),import.meta.url)})}async enterInputMode(e,t){try{await this._transitionTo("input",t),await this._focusField(e)}catch(i){ko(i)}}async exitInputMode({focusOnView:e=!0}={}){try{const{container:t,info:i}=this;i.clearInputValues();const n=e?t?.closest(".esri-view")?.querySelector(".esri-view-surface"):null;await this._transitionTo("feedback"),n instanceof HTMLElement&&n.focus()}catch(t){ko(t)}}_onNextKey(e){const t=this._getFocusableElements(),i=t.at(0),n=t.at(-1);i&&n&&(e.shiftKey?document.activeElement===i&&(e.preventDefault(),e.stopPropagation(),Zi(n)):document.activeElement===n&&(e.preventDefault(),e.stopPropagation(),Zi(i)))}get _renderedContent(){return ar(this._renderContent())}get _renderedActions(){return ar(this._renderActions())}get _renderedHelpMessage(){const{sketchOptions:e,visibleElements:t}=this.info;if(!t.helpMessage)return null;const i=e.tooltips.helpMessage??this._defaultHelpMessage;if(!i)return null;const n=e.tooltips.helpMessageIcon??"information";return v("div",{class:Ip,key:"help-message"},n?v("calcite-icon",{class:Gp,icon:n,scale:"s"}):null,v("div",{class:Lp},i))}get _defaultHelpMessage(){const{helpMessage:e,viewType:t}=this.info;if(e==null)return null;const i=t==="3d"?"helpMessages3d":"helpMessages2d";return this._messagesTooltip?.sketch?.[i]?.[e]}async _focusField(e){this._focusAbortController?.abort(),this._focusAbortController=new AbortController;const{signal:t}=this._focusAbortController;await this._waitForInputs(),ql(t);const i=this._getFocusableInputs(),n=e?i.find(s=>s.getAttribute("data-field-name")===e):i.at(0);await Zi(n)}async _transitionTo(e,t){if(this._mode===e&&!this._transitionInfo)return;if(this._transitionInfo?.mode===e)return this._transitionInfo.transition.finished;this._transitionInfo?.transition.skipTransition();const i=async()=>{this.destroyed||(this._mode=e,await Ro(),this.destroyed||(this.renderNow(),await Ro(),this.destroyed||t?.()))};if(!this.domNode?.firstChild||!document.startViewTransition||qc())return void await i();this.autoRenderingEnabled=!1;const n=this._transitionInfo={transition:document.startViewTransition(async()=>{this.destroyed||n!==this._transitionInfo||(this.autoRenderingEnabled=!0,await i())}),mode:e};try{await n.transition.finished}finally{n===this._transitionInfo&&(this._transitionInfo=null)}}async _waitForInputs(){const e=()=>Array.from(this.domNode?.querySelectorAll("calcite-input")??[]);for(;e().length===0;)await jl(md);await Rr()}_getFocusableInputs(){return Array.from(this.domNode?.querySelectorAll("calcite-input:not([read-only]):not([disabled])")??[])}_getFocusableElements(){const e=this.domNode?.querySelector(`.${za}`);return[...Array.from(e?.querySelectorAll(`.${nr} calcite-button:not([disabled])`)??[]),...this._getFocusableInputs()]}};async function Zi(e){await e?.setFocus()}function ar(e){return(Array.isArray(e)?e:[e]).flat(10).filter(t=>!!t)}a([cs("esri/core/t9n/Units"),c()],E.prototype,"_messagesUnits",void 0),a([cs("esri/views/interactive/tooltip/t9n/Tooltip"),c()],E.prototype,"_messagesTooltip",void 0),a([c()],E.prototype,"info",void 0),a([c()],E.prototype,"tooltip",void 0),a([c()],E.prototype,"_mode",void 0),a([c()],E.prototype,"mode",null),a([c()],E.prototype,"_displayUnits",null),a([c()],E.prototype,"_inputUnitInfos",null),a([c()],E.prototype,"_formatters",null),a([c()],E.prototype,"fieldContext",null),a([c()],E.prototype,"_renderedContent",null),a([c()],E.prototype,"_renderedActions",null),a([c()],E.prototype,"_renderedHelpMessage",null),a([c()],E.prototype,"_defaultHelpMessage",null),E=a([x("esri.views.interactive.tooltip.content.TooltipContent")],E);const md=20;let _s=class extends E{_renderContent(){const{area:e,radius:t,xSize:i,ySize:n,visibleElements:s}=this.info,o=this._messagesTooltip.sketch,r=this._formatters;return v(wt,null,s.radius&&t!=null?v(U,{title:o.radius,value:r.length(t)}):null,s.size&&i!=null&&n!=null?v(U,{title:o.size,value:v(Yt,{left:r.length(i),right:r.length(n)})}):null,s.area?v(U,{title:o.area,value:r.area(e)}):null)}};_s=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawCircle")],_s);const ct=`${Q}-editable-field`,st={base:ct,inputMode:`${ct}--input`,feedbackMode:`${ct}--feedback`,readOnly:`${ct}--read-only`,locked:`${ct}--locked`,title:`${ct}__title`,value:`${ct}__value`,valueContent:`${ct}__value__content`,valueContentReadOnly:`${ct}__value__content--read-only`,lockIcon:`${ct}__lock-icon`,input:`${ct}__input`,inputSuffix:`${ct}__input-suffix`,button:`${ct}__button`},qn={lock:"lock",unlock:"unlock"};let yt=class extends Vi{constructor(){super(...arguments),this._input=null,this._lock=null,this._onLockClick=()=>{this.field.toggleLock(this.context)},this._onLockAfterCreate=e=>{this._lock=e},this._onLockAfterRemoved=()=>{this._lock=null},this._onKeyDown=e=>{e.key===$e.discard&&this.mode==="input"&&this._input&&this.context.onDiscard(this._input)},this._onInputKeyDown=e=>{const t=this._input;if(t)switch(e.key){case $e.commit:return this.field.onCommit("commit-and-exit",t,this.context);case $e.next:{e.preventDefault(),e.stopPropagation();const i=e.shiftKey?"commit-and-previous":"commit-and-next";return this.field.onCommit(i,t,this.context)}}},this._onInput=e=>{this.field.onInput(e.target.value)},this._onInputBlur=e=>{const t=this._input;t&&e.relatedTarget!==this._lock&&this.field.onCommit("commit-on-blur",t,this.context)},this._selectText=()=>{const e=()=>{this._input===document.activeElement&&this._input?.selectText()};e(),Rr().then(e)},this._onAfterCreate=e=>{this._input=e,e.addEventListener("paste",this._onPaste),e.addEventListener("beforeinput",this._onBeforeInput)},this._onAfterRemoved=e=>{e.removeEventListener("paste",this._onPaste),e.removeEventListener("beforeinput",this._onBeforeInput)},this._onPaste=e=>{const t=e.clipboardData?.getData("text");t&&this.field.parse(t,this.context)!=null&&(e.stopPropagation(),this.field.onInput(t))},this._onBeforeInput=e=>{(e.inputType==="historyUndo"||e.inputType==="historyRedo")&&!this.field.dirty&&e.preventDefault()}}initialize(){this.addHandles($(()=>this._rawDisplayValue,()=>{const{committed:e,inputValue:t}=this.field;e||t||this._input!==document.activeElement||this._selectText()}))}loadDependencies(){return Js({button:()=>Lt(()=>import("./calcite-button-Cm9_TJei-dPLwGZxZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url),icon:()=>Lt(()=>import("./calcite-icon-laqhdRBY-Cuc8vfVM.js"),__vite__mapDeps([18,15,1,2,3,4,6,13]),import.meta.url),input:()=>Lt(()=>import("./calcite-input-BKRd7MCS-CXqyw1UG.js"),__vite__mapDeps([19,20,1,2,3,4,6,5,7,12,8,9,10,11,13,14,15]),import.meta.url)})}render(){const{field:e,mode:t}=this,i=t==="input",{locked:n,readOnly:s}=e;return v("div",{class:this.classes({[st.base]:!0,[st.feedbackMode]:t==="feedback",[st.inputMode]:t==="input",[st.locked]:n,[st.readOnly]:s})},v("div",{class:st.title,key:"title"},this._title),v("div",{class:st.value,key:"value",onkeydown:this._onKeyDown},i?this._renderValueInputMode():this._renderValueFeedbackMode()))}get _formattedValue(){return this.field.getFormattedValue(this.context)||lr}get _rawDisplayValue(){return this.field.getRawDisplayValue(this.context)}get _suffix(){return this.field.getSuffix(this.context)}get _title(){const{title:e}=this.field;return typeof e=="string"?e:e(this.context)}_renderValueFeedbackMode(){return v(wt,null,v("div",{class:st.valueContent,key:"value-feedback"},this._formattedValue),this.field.locked&&this.mode!=="input"?v("calcite-icon",{class:st.lockIcon,icon:qn.lock,key:"icon",scale:"s"}):null)}_renderValueInputMode(){return this.field.readOnly?this._renderValueReadOnly():this._renderValueWritable()}_renderValueReadOnly(){return v("div",{class:this.classes(st.valueContent,st.valueContentReadOnly),key:"value-read-only"},this._formattedValue)}_renderValueWritable(){const{field:e}=this,{name:t,invalid:i,locked:n}=e,s=this.context?.messages.sketch??{},o=n?s.unlockConstraint:s.lockConstraint;return v(wt,null,v("calcite-input",{afterCreate:this._onAfterCreate,afterRemoved:this._onAfterRemoved,class:st.input,"data-field-name":t,"data-testid":`tooltip-field-${t}`,key:"input",onblur:this._onInputBlur,onfocus:this._selectText,onkeydown:this._onInputKeyDown,scale:"s",status:i?"invalid":"idle",type:"text",value:this._rawDisplayValue??lr,onCalciteInputInput:this._onInput}),v("div",{class:st.inputSuffix,key:"suffix"},this._suffix),e.lockable?v("calcite-button",{afterCreate:this._onLockAfterCreate,afterRemoved:this._onLockAfterRemoved,alignment:"center",appearance:"transparent",class:st.button,"data-testid":`tooltip-field-${t}-lock`,iconStart:n?qn.lock:qn.unlock,key:"lock",kind:"neutral",label:o,onclick:this._onLockClick,scale:"s",tabIndex:-1,title:o}):v("div",{key:"lock-empty"}))}};a([c()],yt.prototype,"field",void 0),a([c()],yt.prototype,"context",void 0),a([c()],yt.prototype,"mode",void 0),a([c()],yt.prototype,"_input",void 0),a([c()],yt.prototype,"_lock",void 0),a([c()],yt.prototype,"_formattedValue",null),a([c()],yt.prototype,"_rawDisplayValue",null),a([c()],yt.prototype,"_suffix",null),a([c()],yt.prototype,"_title",null),yt=a([x("esri.views.interactive.tooltip.components.TooltipEditableField")],yt);const lr="—";function ee(e){const t=e.fields.filter(i=>i?.visible===!0);return t.length===0?null:v(wt,null,t.map(i=>v(yt,{context:e.context,field:i,key:i.id,mode:e.mode})))}let vs=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return v(ee,{context:e,fields:[n.coordinates?t.effectiveX:void 0,n.coordinates?t.effectiveY:void 0,n.elevation?t.elevation:void 0,n.orientation?t.orientation:void 0,n.scale?t.scale:void 0],mode:i})}};vs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawMesh")],vs);let xs=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{elevation:n,visibleElements:s}=t;return v(ee,{context:e,fields:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0,s.elevation?n:void 0],mode:i})}};xs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPoint")],xs);const jn={absolute:"absolute-direction",relative:"relative-direction"};let Ee=class extends Vi{constructor(e){super(e),this.visibleElements={}}render(){return v("div",{class:za},this._isElementVisible("direction")?v(yd,{messages:this.messages,sketchOptions:this.sketchOptions}):null)}loadDependencies(){return Js({button:()=>Lt(()=>import("./calcite-button-Cm9_TJei-dPLwGZxZ.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),import.meta.url),dropdown:()=>Lt(()=>import("./calcite-dropdown-CLrG397W-TblasQ4g.js"),__vite__mapDeps([21,1,2,3,4,6,22,23,17,7,12,10,13,24]),import.meta.url),"dropdown-item":()=>Lt(()=>import("./calcite-dropdown-item-DpLfv4A0-BCgCnIta.js"),__vite__mapDeps([25,1,2,3,4,6,10,9,7,26,15,13]),import.meta.url),"dropdown-group":()=>Lt(()=>import("./calcite-dropdown-group-0sIPwaDd-DZwZpiwm.js"),__vite__mapDeps([27,1,2,3,4,13,26]),import.meta.url)})}_isElementVisible(e){return this.visibleElements?.[e]??this.sketchOptions.tooltips.visibleElements[e]}};function yd(e){const{directionMode:t}=e.sketchOptions.values,i=e.messages?.sketch,n=i?.directionModeSelect?.title,s="absolute",o="relative";return v("calcite-dropdown",{key:"direction-mode",placement:"bottom-end",scale:"s",widthScale:"s",onCalciteDropdownSelect:r=>{const l=r.target.selectedItems?.[0]?.getAttribute("data-mode");e.sketchOptions.values.directionMode=l??"absolute"}},v("calcite-button",{alignment:"end",appearance:"transparent",iconStart:jn[t],kind:"neutral",label:n,scale:"s",slot:"trigger",title:n}),v("calcite-dropdown-group",{selectionMode:"single"},v("calcite-dropdown-item",{"data-mode":o,"data-testid":"tooltip-direction-mode-relative",iconStart:jn.relative,key:"relative",selected:t===o},i?.directionModeSelect?.relative),v("calcite-dropdown-item",{"data-mode":s,"data-testid":"tooltip-direction-mode-absolute",iconStart:jn.absolute,key:"absolute",selected:t===s},i?.directionModeSelect?.absolute)))}a([cs("esri/views/interactive/tooltip/t9n/Tooltip"),c()],Ee.prototype,"messages",void 0),a([c()],Ee.prototype,"sketchOptions",void 0),a([c()],Ee.prototype,"visibleElements",void 0),Ee=a([x("esri.views.interactive.tooltip.components.DrawHeaderActions")],Ee);let bs=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{xyMode:n,visibleElements:s}=t;return v(ee,{context:e,fields:[...n==="direction-distance"?[s.direction?t.direction:void 0,s.distance?t.distance:void 0]:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0],s.elevation?t.elevation:void 0,s.area?t.area:void 0],mode:i})}_renderActions(){const{xyMode:e,sketchOptions:t}=this.info;return v(Ee,{sketchOptions:t,visibleElements:{direction:e==="direction-distance"}})}};bs=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPolygon")],bs);let ws=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{xyMode:n,visibleElements:s}=t;return v(ee,{context:e,fields:[...n==="direction-distance"?[s.direction?t.direction:void 0,s.distance?t.distance:void 0]:[s.coordinates?t.effectiveX:void 0,s.coordinates?t.effectiveY:void 0],s.elevation?t.elevation:void 0,s.totalLength?t.totalLength:void 0],mode:i})}_renderActions(){const{xyMode:e,sketchOptions:t}=this.info;return v(Ee,{sketchOptions:t,visibleElements:{direction:e==="direction-distance"}})}};ws=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawPolyline")],ws);let Ts=class extends E{_renderContent(){const{area:e,xSize:t,ySize:i,visibleElements:n}=this.info,s=this._messagesTooltip.sketch,o=this._formatters;return v(wt,null,n.size&&t!=null&&i!=null?v(U,{title:s.size,value:v(Yt,{left:o.length(t),right:o.length(i)})}):null,n.area?v(U,{title:s.area,value:o.area(e)}):null)}};Ts=a([x("esri.views.interactive.tooltip.content.TooltipContentDrawRectangle")],Ts);let Es=class extends E{_renderContent(){const{angle:e,visibleElements:t}=this.info,i=this._messagesTooltip.sketch;return v(wt,null,t.rotation?v(U,{title:i.rotation,value:this._formatters.angleRelative(e)}):null)}};Es=a([x("esri.views.interactive.tooltip.content.TooltipContentExtentRotate")],Es);let Ss=class extends E{_renderContent(){const e=this.info,{visibleElements:t}=e,i=this._messagesTooltip.sketch,n=this._formatters;return v(wt,null,t.size?v(U,{title:i.size,value:v(Yt,{left:n.length(e.xSize),right:n.length(e.ySize)})}):null,t.scale?v(U,{title:i.scale,value:v(Yt,{left:n.scale(e.xScale),right:n.scale(e.yScale)})}):null)}};Ss=a([x("esri.views.interactive.tooltip.content.TooltipContentExtentScale")],Ss);let Ps=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return v(ee,{context:e,fields:[n.coordinates?t.effectiveX:void 0,n.coordinates?t.effectiveY:void 0,n.elevation?t.elevation:void 0],mode:i})}};Ps=a([x("esri.views.interactive.tooltip.content.TooltipContentMovePoint")],Ps);let Ms=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return v(ee,{context:e,fields:[n.distance?t.distance:void 0,n.area?t.area:void 0,n.totalLength?t.totalLength:void 0],mode:i})}};Ms=a([x("esri.views.interactive.tooltip.content.TooltipContentReshapeEdgeOffset")],Ms);let ks=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return v(ee,{context:e,fields:[n.coordinates?t.effectiveX:void 0,n.coordinates?t.effectiveY:void 0,n.elevation?t.elevation:void 0,n.area&&t.geometryType==="polygon"?t.area:null,n.totalLength&&t.geometryType==="polyline"?t.totalLength:null],mode:i})}};ks=a([x("esri.views.interactive.tooltip.content.TooltipContentSelectedVertex")],ks);let Cs=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return v(ee,{context:e,fields:[n.coordinates?t.effectiveX:void 0,n.coordinates?t.effectiveY:void 0,n.elevation?t.elevation:void 0,n.orientation?t.orientation:void 0,n.scale?t.scale:void 0],mode:i})}};Cs=a([x("esri.views.interactive.tooltip.content.TooltipContentTransformMesh")],Cs);let Rs=class extends E{_renderContent(){const{fieldContext:e,info:t,mode:i}=this,{visibleElements:n}=t;return v(ee,{context:e,fields:[n.coordinates?t.effectiveX:void 0,n.coordinates?t.effectiveY:void 0,n.elevation?t.elevation:void 0,n.orientation?t.orientation:void 0,n.size?t.size:void 0],mode:i})}};Rs=a([x("esri.views.interactive.tooltip.content.TooltipContentTransformPoint")],Rs);let Vs=class extends E{_renderContent(){const{info:e}=this,{visibleElements:t}=e,i=this._messagesTooltip.sketch,n=this._formatters;return v(wt,null,t.distance?v(U,{title:i.distance,value:n.length(e.distance)}):null)}};Vs=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslate")],Vs);let As=class extends E{_renderContent(){const{distance:e,elevation:t,area:i,totalLength:n,visibleElements:s}=this.info,o=this._messagesTooltip.sketch,r=this._formatters;return v(wt,null,s.distance?v(U,{title:o.distance,value:r.length(e)}):null,s.elevation&&t?.actual!=null?v(U,{title:o.elevation,value:r.verticalLength(t.actual)}):null,s.area&&i!=null?v(U,{title:o.area,value:r.area(i)}):null,s.totalLength&&n!=null?v(U,{title:o.totalLength,value:r.length(n)}):null)}};As=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateVertex")],As);let Os=class extends E{_renderContent(){const{info:e}=this,{visibleElements:t}=e,i=this._messagesTooltip.sketch,n=this._formatters;return v(wt,null,t.distance?v(U,{title:i.distance,value:n.length(e.distance)}):null)}};Os=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateXY")],Os);let Is=class extends E{_renderContent(){const{info:e}=this,{visibleElements:t}=e,i=this._messagesTooltip.sketch;return v(wt,null,t.distance?v(U,{title:i.distance,value:this._formatters.verticalLengthRelative(e.distance)}):null)}};Is=a([x("esri.views.interactive.tooltip.content.TooltipContentTranslateZ")],Is);function _d(e,t){if(t==null)return null;const i=document.createElement("div");switch(t.type){case"draw-point":return new xs({tooltip:e,info:t,container:i});case"draw-polygon":return new bs({tooltip:e,info:t,container:i});case"draw-polyline":return new ws({tooltip:e,info:t,container:i});case"draw-mesh":return new vs({tooltip:e,info:t,container:i});case"draw-rectangle":return new Ts({tooltip:e,info:t,container:i});case"draw-circle":return new _s({tooltip:e,info:t,container:i});case"extent-rotate":return new Es({tooltip:e,info:t,container:i});case"extent-scale":return new Ss({tooltip:e,info:t,container:i});case"move-point":return new Ps({tooltip:e,info:t,container:i});case"selected-vertex":return new ks({tooltip:e,info:t,container:i});case"transform-point":return new Rs({tooltip:e,info:t,container:i});case"transform-mesh":return new Cs({tooltip:e,info:t,container:i});case"translate":return new Vs({tooltip:e,info:t,container:i});case"translate-vertex":return new As({tooltip:e,info:t,container:i});case"translate-z":return new Is({tooltip:e,info:t,container:i});case"translate-xy":return new Os({tooltip:e,info:t,container:i});case"reshape-edge-offset":return new Ms({tooltip:e,info:t,container:i})}}const ci={base:`${Q}`,ltr:`${Q}--ltr`,rtl:`${Q}--rtl`,debug:`${Q}--debug`},vd=20,xd=16,bd="bottom-end";let F=class extends Ce.EventedAccessor{constructor(e){super(e),this.info=null,this.options=null,this.position=null,this.content=null,this._focused=!1,this.outerContainer=document.createElement("div"),this.debug=!1,this._lastPosition=null,this._rtl=!1,this._prevXY=[0,0]}initialize(){const{outerContainer:e}=this;this.addHandles([$(()=>this.view.overlay?.surface,t=>{e.remove(),t?.appendChild(e),this._rtl=Vh(t)},ke),$(()=>this.info,(t,i)=>{if(this.content!=null&&t!=null&&i!=null&&t.type===i.type)this.content.info=t;else{dt(this.content);const n=_d(this,t);n?(this.content=n,n.container&&e.appendChild(n.container),this.exitInputMode()):this.content=null}},ke),$(()=>({container:this.outerContainer,style:this._outerContainerStyle}),({container:t,style:i})=>{Object.assign(t.style,i)},es),$(()=>({outerContainer:this.outerContainer,placement:this.effectivePlacement,effectiveOffset:this._effectiveOffset,rtl:this._rtl,debug:this.debug}),({outerContainer:t,placement:i,effectiveOffset:n,rtl:s,debug:o})=>{const{classList:r}=t;r.add(ci.base),r.toggle(ci.rtl,s),r.toggle(ci.ltr,!s),r.toggle(ci.debug,o),this.outerContainer.style.setProperty("--offset",`${n}px`),Ah(t),Ed(t,i)},es),Il(()=>this.mode==="feedback",()=>{this.position=null,this._clearOverride("effectivePlacement")},Us),di(this.outerContainer,"paste",t=>{this.emit("paste",t)}),di(this.outerContainer,["focusin","focusout"],()=>{setTimeout(()=>{this._focused=this.content?.container?.contains(document.activeElement)??!1})})])}destroy(){this.info=null,this.content=dt(this.content),this.outerContainer.remove()}get mode(){return this.content?.mode??"feedback"}get focused(){return this._focused}get visible(){return this._outerContainerStyle.display!=="none"}get contentContainer(){return this.content?.container}get effectivePlacement(){const e=this.options?.placement;return e==="auto"?"bottom-end":e??bd}get _screenPoint(){const{inputManager:e}=this.view;return e?.multiTouchActive?null:e?.latestPointerLocation}get _effectiveOffset(){return this.options?.offset??vd}get _outerContainerStyle(){const e=this.position??this._screenPoint;return this._lastPosition=So(e),e!=null&&this.content!=null?{display:"block",transform:`translate(${Math.round(e.x)}px, ${Math.round(e.y)}px)`}:{display:"none",transform:"none"}}clear(){this.info=null}async enterInputMode(e){const t=this.position??this._lastPosition??this._screenPoint,i=this.position=So(t),{effectivePlacement:n}=this;this._override("effectivePlacement",n);const s=()=>{i&&(this.position=wd(this.contentContainer,i,this._effectiveOffset,this.view),Object.assign(this.outerContainer.style,this._outerContainerStyle))};await this.content?.enterInputMode(e,s)}async exitInputMode(e){await this.content?.exitInputMode(e)}onDragStart(e,t){this._prevXY=[e,t]}onDrag(e,t){const i=e-this._prevXY[0],n=t-this._prevXY[1];this._prevXY=[e,t];const{position:s}=this;if(s){const{view:o}=this,r=e-o.position[0],l=t-o.position[1];if(r<0||r>o.width||l<0||l>o.height-xd)return;this.position=$s(s.x+i,s.y+n)}}onDragEnd(){this._prevXY=[0,0]}};function wd(e,t,i,n){if(!e||!n.container)return t;const s=e.getBoundingClientRect(),{left:o,top:r}=n.container.getBoundingClientRect();let{x:l,y:h}=t;const u=s.left-o-i;u<0&&(l-=u);const p=s.right-o+i-n.width;p>0&&(l-=p);const d=s.top-r-i;d<0&&(h-=d);const m=s.bottom-r+i-n.height;return m>0&&(h-=m),$s(l,h)}a([c({nonNullable:!0})],F.prototype,"view",void 0),a([c()],F.prototype,"info",void 0),a([c()],F.prototype,"options",void 0),a([c()],F.prototype,"position",void 0),a([c()],F.prototype,"content",void 0),a([c({readOnly:!0})],F.prototype,"mode",null),a([c()],F.prototype,"_focused",void 0),a([c({readOnly:!0})],F.prototype,"focused",null),a([c({readOnly:!0})],F.prototype,"outerContainer",void 0),a([c({readOnly:!0})],F.prototype,"contentContainer",null),a([c({readOnly:!0})],F.prototype,"effectivePlacement",null),a([c()],F.prototype,"debug",void 0),a([c()],F.prototype,"_lastPosition",void 0),a([c()],F.prototype,"_screenPoint",null),a([c()],F.prototype,"_rtl",void 0),a([c()],F.prototype,"_effectiveOffset",null),a([c()],F.prototype,"_outerContainerStyle",null),F=a([x("esri.views.interactive.Tooltip")],F);const Td=["top","bottom","leading","trailing"].flatMap(e=>[Ji(`${e}-start`),Ji(e),Ji(`${e}-end`)]);function Ji(e){return`${ci.base}--${e}`}function Ed({classList:e},t){Td.forEach(i=>e.remove(i)),e.add(Ji(t))}const Sd=F;function Pd(e){const t=new Sd(e());return t.addHandles($(()=>e(),({view:i,options:n,info:s})=>{t.view=i,n!==void 0&&(t.options=n),s!==void 0&&(t.info=s)})),t}function Md(e,t){const i=Rh(t.vertexSpace),{scale:n,orientation:s}=e,{transform:o}=t,r=kd(o);i&&r!=null?(s.actual=Dt(r,"degrees","arithmetic"),s.visible=!0):(s.actual=null,s.visible=!1),i?(n.actual=Qt(Vd(o)),n.visible=!0):(n.actual=null,n.visible=!1)}function kd(e){if(!e)return 0;const t=Cd(e.rotationAxis);return t!=null?t*e.rotationAngle:null}function Cd(e){return We(e,Hs)?1:We(e,Rd)?-1:null}const Rd=rs(g(),Hs);function Vd(e){return e?Math.max(...e.scale):1}function Ad(e,t){return!(e.type!=="key-down"||e.key!==$e.enterInputMode||!t||!Od(t.info))&&(t.enterInputMode(),e.preventDefault(),e.stopPropagation(),!0)}function Od(e){const t=e?.sketchOptions;if(!t)return!1;const{inputEnabled:i,visibleElements:n}=t.tooltips;return i&&e.editableFields.some(({name:s})=>s==="x"||s==="y"?n.coordinates:n[s])===!0}function Id(e,t,i){if(!t||!("geographic"in t))return;const n=e.clipboardData?.getData("text");if(!n)return;const s=o=>{e.stopPropagation(),e.preventDefault(),o()};if(t.geographic){const o=dd(n);o&&s(()=>{t.longitude.applyValue(o.longitude),t.latitude.applyValue(o.latitude)})}else{const o=pd(n);o&&s(()=>{t.x.applyValue(o.x),t.y.applyValue(o.y)})}}let ot=class extends tt{constructor(e){super(e),this.helpMessage=void 0,this.viewType=void 0}get visibleElements(){return this.sketchOptions.tooltips.visibleElements}get allFields(){return[]}get editableFields(){return this.allFields.filter(e=>e.visible&&!e.readOnly)}clearInputValues(){this.allFields.forEach(e=>e.clearInputValue())}};a([c()],ot.prototype,"sketchOptions",void 0),a([c()],ot.prototype,"visibleElements",null),a([c()],ot.prototype,"helpMessage",void 0),a([c()],ot.prototype,"viewType",void 0),a([c()],ot.prototype,"allFields",null),a([c()],ot.prototype,"editableFields",null),ot=a([x("esri.views.interactive.tooltip.infos.SketchTooltipInfo")],ot);let Zt=class extends ot{constructor(e){super(e),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=Ye}get allFields(){return[]}};a([c()],Zt.prototype,"type",void 0),a([c()],Zt.prototype,"radius",void 0),a([c()],Zt.prototype,"xSize",void 0),a([c()],Zt.prototype,"ySize",void 0),a([c()],Zt.prototype,"area",void 0),a([c()],Zt.prototype,"allFields",null),Zt=a([x("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],Zt);let M=class extends tt{constructor(e){super(e),this.actual=null,this.lockable=!0,this.id=Ih(),this.inputValue=null,this.readOnly=!1,this.suffix=null,this.visible=!0,this.invalid=!1,this.unlockOnVertexPlacement=!0}get committed(){return this.lockable?this._get("committed"):null}set committed(e){this.lockable&&this._set("committed",e)}get dirty(){return this.inputValue!=null}get locked(){return this.lockable&&this.committed!=null}onInput(e){this.inputValue=e}onCommit(e,t,i){this.lockable?this._onCommitLockable(e,i):this._onCommitNonLockable(i),this.invalid&&e==="commit-and-exit"||i.onCommit(t,e)}_onCommitLockable(e,t){const{inputValue:i,locked:n}=this;n&&Bi(i)?this.unlock():(e==="commit-and-exit"&&!n||i!=null)&&this._parseInputAndLock(t)}_onCommitNonLockable(e){const{inputValue:t}=this;Bi(t)?this.setActual(null):t!=null&&this._parseInputAndSetActual(e)}applyValue(e){this.lockable?this.lock(e):this.setActual(e)}clearInputValue(){this.inputValue=null,this.invalid=!1}setActual(e){this.actual=e,this.clearInputValue()}lock(e){this.lockable&&(this.committed=e??this.actual,this.clearInputValue())}unlock(){this.lockable&&(this.committed=null,this.clearInputValue())}toggleLock(e){this.lockable&&(this.locked?this.unlock():this._parseInputAndLock(e))}getSuffix(e){const{suffix:t}=this;return typeof t=="function"?t(e):t}getFormattedValue(e){const{actual:t,committed:i,format:n}=this;return i!=null?n(i,e):t!=null?n(t,e):null}getRawDisplayValue(e){const{actual:t,committed:i,inputValue:n}=this;return n??(this.lockable&&i!=null?this.formatForInputMode(i,e):t!=null?this.formatForInputMode(t,e):null)}_parseInputAndSetActual(e){const{inputValue:t}=this;if(t==null||Bi(t))return this.setActual(null);const i=this.parse(t,e);i!=null?this.setActual(i):this.invalid=!0}_parseInputAndLock(e){const{inputValue:t,actual:i}=this;if(Bi(t))return this.unlock();if(t==null)return this.lock(i);const n=this.parse(t,e);n!=null?this.lock(n):this.invalid=!0}};function Bi(e){return e!=null&&e.trim()===""}a([c()],M.prototype,"actual",void 0),a([c()],M.prototype,"committed",null),a([c()],M.prototype,"dirty",null),a([c()],M.prototype,"format",void 0),a([c()],M.prototype,"formatForInputMode",void 0),a([c()],M.prototype,"lockable",void 0),a([c()],M.prototype,"locked",null),a([c()],M.prototype,"id",void 0),a([c()],M.prototype,"inputValue",void 0),a([c()],M.prototype,"name",void 0),a([c()],M.prototype,"parse",void 0),a([c()],M.prototype,"readOnly",void 0),a([c()],M.prototype,"suffix",void 0),a([c()],M.prototype,"title",void 0),a([c()],M.prototype,"visible",void 0),a([c()],M.prototype,"invalid",void 0),a([c()],M.prototype,"unlockOnVertexPlacement",void 0),M=a([x("esri.views.interactive.tooltip.fields.TooltipField")],M);let tn=class extends M{constructor(e){super(e),this.showAsZ=!1}normalizeCtorArgs(e){const t=i=>i.inputUnitInfos.verticalLength.unit;return{name:"elevation",actual:Kt,parse:xe({createQuantity:(i,n)=>ft(i,t(n))}),format:(i,n)=>n.formatters.verticalLength(i),formatForInputMode:(i,n)=>n.formatters.scalar(te(i,t(n))),suffix:i=>i.inputUnitInfos.verticalLength.abbreviation,title:i=>i.messages.sketch[this.showAsZ?"z":"elevation"],unlockOnVertexPlacement:!1,...e}}};a([c()],tn.prototype,"showAsZ",void 0),tn=a([x("esri.views.interactive.tooltip.fields.TooltipFieldElevation")],tn);let en=class extends M{constructor(e){super(e),this.precision=1}normalizeCtorArgs(e){const t=i=>i.inputUnitInfos.angle.unit;return{name:"orientation",actual:null,parse:xe({createQuantity:(i,n)=>Dt(i,t(n),"geographic"),sanitize:Za}),format:i=>{const n=gs(i);return Mn(n,"geographic",this.precision)},formatForInputMode:(i,n)=>{const s=gs(i);return n.formatters.scalar(s)},suffix:i=>i.inputUnitInfos.angle.abbreviation,title:i=>i.messages.sketch.orientation,...e}}};a([c()],en.prototype,"precision",void 0),en=a([x("esri.views.interactive.tooltip.fields.TooltipFieldOrientation")],en);let Kn=class extends M{constructor(e){super(e),this.precision=null}normalizeCtorArgs(e){const t=i=>i.inputUnitInfos.length.unit;return{name:"size",actual:null,parse:xe({createQuantity:(i,n)=>ft(i,t(n))}),format:(i,n)=>n.formatters.length(i),formatForInputMode:(i,n)=>n.formatters.scalar(te(i,t(n))),suffix:i=>i.inputUnitInfos.length.abbreviation,title:i=>i.messages.sketch.size,...e}}};a([c()],Kn.prototype,"precision",void 0),Kn=a([x("esri.views.interactive.tooltip.fields.TooltipFieldSize")],Kn);function Xa(e){const t=n=>n.inputUnitInfos.angle.unit,i=n=>n.sketchOptions.values.effectiveDirectionMode;return new M({name:"direction",actual:qs,parse:xe({createQuantity:(n,s)=>Dt(n,t(s),"geographic"),sanitize:Za}),format:(n,s)=>{const o=i(s),r=un(n,o);switch(o){case A.Absolute:return s.formatters.direction(r);case A.Relative:return s.formatters.directionRelative(r);case A.RelativeBilateral:return s.formatters.directionRelativeBilateral(r)}},formatForInputMode:(n,s)=>{const o=un(n,i(s));return s.formatters.scalar(te(o,t(s)))},suffix:n=>n.inputUnitInfos.angle.abbreviation,title:n=>{const s=i(n),{absolute:o,relative:r}=n.messages.sketch.direction;switch(s){case A.Absolute:return o;case A.Relative:case A.RelativeBilateral:return r}},...e})}function qa(e){const t=i=>i.inputUnitInfos.length.unit;return new M({name:"distance",actual:Kt,parse:xe({createQuantity:(i,n)=>ft(Math.max(i,0),t(n))}),format:(i,n)=>n.formatters.length(i),formatForInputMode:(i,n)=>n.formatters.scalar(te(i,t(n))),suffix:i=>i.inputUnitInfos.length.abbreviation,title:i=>i.messages.sketch.distance,...e})}function Ld(e){return qa({format:(t,i)=>i.formatters.totalLength(t),title:t=>t.messages.sketch.totalLength,readOnly:!0,...e})}function ja(e){return qa({...e})}function Gd(e){return new tn(e)}function Dd(e){return new en(e)}function zd(e){return mo("scale",{name:"scale",actual:null,parse:xe({createQuantity:t=>Qt(Math.abs(t))}),...e})}function Ud(e){const t=i=>i.inputUnitInfos.area.unit;return new M({name:"area",actual:Ye,parse:xe({createQuantity:(i,n)=>vn(i,t(n))}),format:(i,n)=>n.formatters.area(i),formatForInputMode:(i,n)=>n.formatters.scalar(te(i,t(n))),suffix:i=>i.inputUnitInfos.area.abbreviation,title:i=>i.messages.sketch.area,readOnly:!0,...e})}function $d(e){return new M({name:"x",actual:qs,parse:fd,format:(t,i)=>i.formatters.longitudeDecimalDegrees(t),formatForInputMode:t=>rd(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.longitude,...e})}function Hd(e){return new M({name:"y",actual:qs,parse:gd,format:(t,i)=>i.formatters.latitudeDecimalDegrees(t),formatForInputMode:t=>ad(t),suffix:t=>t.inputUnitInfos.angle.abbreviation,title:t=>t.messages.sketch.latitude,...e})}function Nd(e){return mo("x",{name:"x",...e})}function Fd(e){return mo("y",{name:"y",...e})}function mo(e,t){return new M({actual:Qt(0),parse:xe({createQuantity:i=>Qt(i)}),format:(i,n)=>n.formatters.scalar(i),formatForInputMode:(i,n)=>n.formatters.scalar(i),title:i=>i.messages.sketch[e],...t})}function Zd(e){return Br(e)||Zs(e)}function yo(e,t,i,...n){return Br(e)?t.apply(void 0,n):Zs(e)?i.apply(void 0,n):null}const Cn=e=>{let t=class extends e{constructor(){super(...arguments),this.longitude=$d(),this.latitude=Hd(),this.x=Nd(),this.y=Fd(),this.elevation=Gd(),this.geographic=!1}get effectiveX(){return this.geographic?this.longitude:this.x}get effectiveY(){return this.geographic?this.latitude:this.y}get key(){return{longitude:this.longitude.actual,latitude:this.latitude.actual,x:this.x.actual,y:this.y.actual,elevation:this.elevation.actual,geographic:this.geographic}}setLocationFromPoint(i,n=i?.spatialReference){if(this.geographic=!!n&&Zd(n),i==null)return this._setActualLonLat(null,null),void this._setActualXY(null,null);if(this.geographic){const s=ac(i,Bd);this._setActualLonLat(Ke(s?.[0]),Ke(s?.[1]))}else this._setActualXY(Qt(i.x),Qt(i.y))}_setActualLonLat(i,n){this.longitude.actual=i,this.latitude.actual=n}_setActualXY(i,n){this.x.actual=i,this.y.actual=n}};return a([c()],t.prototype,"geographic",void 0),a([c()],t.prototype,"effectiveX",null),a([c()],t.prototype,"effectiveY",null),a([c()],t.prototype,"key",null),t=a([x("esri.views.interactive.tooltip.infos.TooltipInfoWithCoordinates")],t),t},Bd=[0,0];let hi=class extends Cn(ot){constructor(e){super(e),this.type="draw-mesh",this.orientation=Dd({lockable:!1}),this.scale=zd({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};a([c()],hi.prototype,"helpMessage",void 0),a([c()],hi.prototype,"allFields",null),hi=a([x("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],hi);let ui=class extends Cn(ot){constructor(e){super(e),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};a([c()],ui.prototype,"helpMessage",void 0),a([c()],ui.prototype,"allFields",null),ui=a([x("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],ui);let Oe=class extends Cn(ot){constructor(e){super(e),this.type="draw-polygon",this.direction=Xa(),this.distance=ja(),this.area=Ud(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};a([c()],Oe.prototype,"xyMode",void 0),a([c()],Oe.prototype,"helpMessage",void 0),a([c()],Oe.prototype,"allFields",null),Oe=a([x("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],Oe);let Ie=class extends Cn(ot){constructor(e){super(e),this.type="draw-polyline",this.direction=Xa(),this.distance=ja(),this.totalLength=Ld(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};a([c()],Ie.prototype,"helpMessage",void 0),a([c()],Ie.prototype,"xyMode",void 0),a([c()],Ie.prototype,"allFields",null),Ie=a([x("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],Ie);let re=class extends ot{constructor(e){super(e),this.type="draw-rectangle",this.xSize=Kt,this.ySize=Kt,this.area=Ye}get allFields(){return[]}};a([c()],re.prototype,"type",void 0),a([c()],re.prototype,"xSize",void 0),a([c()],re.prototype,"ySize",void 0),a([c()],re.prototype,"area",void 0),a([c()],re.prototype,"allFields",null),re=a([x("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],re);function _o(e){return fc(e)?gc(e)||Zs(e)||mc(e)||yc(e)?Dh:e:zh(e)}function Wd(e,t=vo()){return Yd(e,t,!1)}function Yd(e,t,i=e.hasZ){const n=_o(e.spatialReference),s=_c(n);if(s==null)return null;const o=(l,h)=>!(h.length<2)&&(N(l,h[0],h[1],i&&h[2]||0),!0);let r=0;for(const l of e.rings){const h=l.length;if(h<3)continue;const{positionsWorldCoords:u}=t;for(;u.length<h;)u.push(g());const p=Xd,d=N(qd,0,0,0),m=1/h;for(let y=0;y<h;y++){if(!o(p,l[y])||!xt(p,e.spatialReference,u[y],n))return null;z(d,d,u[y],m)}const f=Jr(u[0],u[1],d,Th());if(Fr(Ue(f))===0)continue;for(let y=0;y<h;y++)Eh(f,d,u[y],u[y]);const _=jd(u);for(let y=0;y<_.length;y+=3)r+=Gh(u[_[y]],u[_[y+1]],u[_[y+2]])}return vn(r,s)}const Xd=g(),qd=g();function vo(){return{positionsWorldCoords:[]}}function jd(e){return Lh(Kd(e),[],2)}function Kd(e){const t=new Float64Array(2*e.length);for(let i=0;i<e.length;++i){const n=e[i],s=2*i;t[s]=n[0],t[s+1]=n[1]}return t}function Qd(e){const{spatialReference:t}=e;return yo(t,Jd,tf,e)}function Jd(e){return vn(Math.abs(Nc([e],"square-meters")[0]),"square-meters")}function tf(e){try{return vn(Math.abs(Wc(e,"square-meters")),"square-meters")}catch{return null}}function ef(e,t,i=vo()){return Qd(e)??Wd(e,i)}function Ka(e,t=vo()){return ef(e,"on-the-ground",t)}var jt;function nf(e){return sf(e,jt.Horizontal)}function sf(e,t){const{hasZ:i,spatialReference:n}=e,s=_o(n);let o=0;const r=Bs(s);if(r==null)return null;const l=t===jt.Direct?af:Ja;for(const h of e.paths){if(h.length<2)continue;const u=h.length-1;for(let p=0;p<u;++p){const d=h[p];ce[0]=d[0],ce[1]=d[1],ce[2]=i?d[2]:0;const m=h[p+1];he[0]=m[0],he[1]=m[1],he[2]=i?m[2]:0;const f=l(ce,he,n);if(f==null)return null;o+=f.value}}return ft(o,r)}function of(e,t){const{spatialReference:i}=e;return Qe(i,t.spatialReference)?(ce[0]=e.x,ce[1]=e.y,ce[2]=e.hasZ?e.z:0,he[0]=t.x,he[1]=t.y,he[2]=t.hasZ?t.z:0,Ja(ce,he,i)):null}function rf(e){return e!=null?Qa(e.hasZ?e.z:0,e.spatialReference):null}function Qa(e,t){const i=zr(t);return i!=null?ft(e??0,i):null}function af(e,t,i){const n=tl(e,t,i,jt.Direct);return n!=null?ft(n.direct,n.unit):null}function Ja(e,t,i){const n=tl(e,t,i,jt.Horizontal);return n!=null?ft(n.horizontal,n.unit):null}function tl(e,t,i,n){const s=_o(i),o=Bs(s);if(o==null)return null;const r=t[2]-e[2];if(n===jt.Vertical)return{verticalSigned:r,unit:o};if(!xt(e,i,Qn,s)||!xt(t,i,Wi,s))return null;if(n===jt.Direct)return{direct:ge(Wi,Qn),unit:o};if(N(Yi,e[0],e[1],t[2]),!xt(Yi,i,Yi,s))return null;const l=ge(Yi,Wi);return n===jt.Horizontal?{horizontal:l,unit:o}:{direct:ge(Wi,Qn),horizontal:l,vertical:Math.abs(r),unit:o}}(function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"})(jt||(jt={}));const ce=g(),he=g(),Qn=g(),Wi=g(),Yi=g();function lf(e){const{spatialReference:t}=e;return yo(t,df,ff,e)}function cf(e,t){if(!Qe(e.spatialReference,t.spatialReference))return null;const{spatialReference:i}=e;return Xi[0]=e.x,Xi[1]=e.y,Xi[2]=e.hasZ?e.z:0,qi[0]=t.x,qi[1]=t.y,qi[2]=t.hasZ?t.z:0,hf(Xi,qi,i)}function hf(e,t,i){return yo(i,uf,pf,e,t,i)}function uf(e,t,i){return ft(mn(mf,e,t,i).distance,"meters")}function pf(e,t,i){return ft(Wr(gf(e,t,i),"meters"),"meters")}function df(e){return ft(Fc([e],"meters")[0],"meters")}function ff(e){return ft(Wr(e,"meters"),"meters")}function gf(e,t,i){return{type:"polyline",spatialReference:i,paths:[[[...e],[...t]]]}}const mf=new yn,Xi=g(),qi=g();function yf(e){return lf(e)??nf(e)}function Rn(e,t){return cf(e,t)??of(e,t)}function _f(e,t){return{point:new ui({sketchOptions:t,viewType:e}),polyline:new Ie({sketchOptions:t,viewType:e}),polygon:new Oe({sketchOptions:t,viewType:e}),mesh:new hi({sketchOptions:t,viewType:e}),rectangle:new re({sketchOptions:t}),circle:new Zt({sketchOptions:t})}}function cr(e){const{directionOptions:t,geometryType:i,sketchOptions:n,tooltipInfos:s}=e,o=l=>{const h=Vn(e).mode,u=s[l].elevation;h==="relative-to-ground"||h==="relative-to-scene"||h==="on-the-ground"?u.lock(bo(e)):u.unlock()},r=l=>{if(t){const h=s[l].direction;h.committed=t.angle,h.unlockOnVertexPlacement=!1,n.values.directionMode=t.mode}};switch(i){case"polygon":case"polyline":o(i),r(i);break;case"point":case"mesh":o(i)}}function vf(e,t){const{drawOperation:i,view:n}=t,s=xo(t),o=Vn(t);if(n.type==="2d"||!e||o.mode!=="absolute-height"||i?.numCommittedVertices!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[r,l,h]=e,u=Vf(r,l,h,o,t);u!=null&&s.elevation.lock(u)}function hr(e){xo(e)?.allFields.forEach(t=>{t.unlockOnVertexPlacement&&t.unlock()})}function xo({geometryType:e,graphic:t,tooltipInfos:i}){return e==="multipoint"||t?.geometry?.type!==xf[e]?null:i[e]}const xf={point:"point",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon"};function bf(e,t){switch(e?.type){case"draw-point":wf(e,t);break;case"draw-polyline":Ef(e,t);break;case"draw-polygon":Sf(e,t);break;case"draw-rectangle":Mf(e,t);break;case"draw-circle":kf(e,t);break;case"draw-mesh":Tf(e,t)}}function wf(e,t){const i=t.graphic?.geometry;i?.type==="point"&&(el(e,i,t),e.helpMessage=io("point",i))}function Tf(e,t){const{graphic:i,view:n}=t,s=i?.geometry;n.type!=="3d"||s&&s.type!=="mesh"||(el(e,s?.origin,t),s&&Md(e,s),e.helpMessage=bu(i,n))}function el(e,t,i){const{drawOperation:n,view:s,sketchOptions:o}=i,{cursorVertex:r}=n;if(e.sketchOptions=o,e.viewType=s.type,e.setLocationFromPoint(t,ti(i)),nl(e.elevation,i),!r)return void(n.constraints=void 0);const l=r;n.constraints={context:al(l,i),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:null,direction:null}}function Ef(e,t){const{createOperationGeometry:i,drawOperation:n}=t,s=i!=null?i.full:null;s&&s.type!=="polyline"||(il(e,t),e.totalLength.actual=n.lastVertex?(s?yf(s):null)??Kt:null,e.helpMessage=io("polyline",s))}function Sf(e,t){const{createOperationGeometry:i,drawOperation:n}=t,s=i!=null?i.full:null;s&&s.type!=="polygon"||(il(e,t),e.area.actual=n.lastVertex?(s?Ka(s):null)??Ye:null,e.helpMessage=io("polygon",s))}function il(e,t){const{drawOperation:i,sketchOptions:n,view:s}=t,{cursorVertex:o,lastVertex:r,secondToLastVertex:l}=i,h=n.values.effectiveDirectionMode;e.sketchOptions=n,e.viewType=s.type;const u=r&&o?Rn(r,o)??Kt:null;if(e.distance.actual=u,e.distance.readOnly=r==null,e.direction.actual=null,e.direction.readOnly=!0,r&&o&&(h==="absolute"||l)){const m=cp(l,r,o,h);e.direction.actual=m??th,e.direction.readOnly=!1}e.setLocationFromPoint(o,ti(t)),nl(e.elevation,t);const p=Pf(r,t);e.xyMode=p,e.direction.visible=p==="direction-distance",e.distance.visible=p==="direction-distance",e.effectiveX.visible=p==="coordinates",e.effectiveY.visible=p==="coordinates";const d=o??r;i.constraints=d?{context:al(d,t),x:e.x.committed,y:e.y.committed,longitude:e.longitude.committed,latitude:e.latitude.committed,elevation:e.elevation.committed,distance:e.distance.committed,direction:e.direction.committed}:void 0}function Pf(e,{sketchOptions:t}){const i=t.tooltips.xyMode;return i==="auto"?e?"direction-distance":"coordinates":i}function Mf(e,t){e.sketchOptions=t.sketchOptions,e.xSize=ol(t),e.ySize=rl(t),e.area=sl(t)}function kf(e,t){const{forceUniformSize:i,sketchOptions:n}=t;e.sketchOptions=n,e.radius=i?Cf(t):null,e.xSize=i?null:ol(t),e.ySize=i?null:rl(t),e.area=sl(t)}function nl(e,t){const{drawOperation:i}=t,n=i?.cursorVertex??i?.lastVertex;e.actual=rf(n)??bo(t),e.visible=i.hasZ,e.readOnly=!1,e.showAsZ=!0}function sl(e){const t=e.createOperationGeometry?.full;return t?.type!=="polygon"?Ye:Ka(t)??Ye}function ol(e){const t=e.createOperationGeometry?.rectangle?.midpoints;return(t!=null?Rn(t.left,t.right):null)??Kt}function rl(e){const t=e.createOperationGeometry?.rectangle?.midpoints;return(t!=null?Rn(t.top,t.bottom):null)??Kt}function Cf({createOperationGeometry:e}){return(e?.circle?.center!=null&&e.circle.edge!=null?Rn(e.circle.center,e.circle.edge):null)??Kt}function Rf(e){const{geometryType:t,tooltipInfos:i}=e;switch(t){case"point":case"mesh":case"polyline":case"polygon":{const n=i[t].elevation.committed;return n?_n(n,"meters")/Fs(ti(e)):void 0}default:return}}function Vf(e,t,i,n,s){const{view:o,drawOperation:r}=s;if(o.type!=="3d"||!r)return;i??=0;const l=ti(s),h=Vn(s),u=Nr(o,e,t,i,l,h,n);return Qa(u,l)??bo(s)}function Vn(e){return e.drawOperation.elevationInfo??gn}function ti(e){return e.drawOperation.coordinateHelper.spatialReference}function bo(e){const t=Fs(ti(e));return ft(e.defaultZ*t,"meters")}function al(e,t){return gp(e,t.view,ti(t),Vn(t),t.drawOperation.coordinateHelper.hasZ(),t.sketchOptions.values.effectiveDirectionMode)}var Se;(function(e){e[e.WhenToolEditable=0]="WhenToolEditable",e[e.WhenToolNotEditable=1]="WhenToolNotEditable",e[e.Always=2]="Always"})(Se||(Se={}));let Af=class{constructor(){this._isToolEditable=!0,this._manipulators=new ss,this._resourceContexts={manipulator3D:{}},this._attached=!1}set isToolEditable(e){this._isToolEditable=e}get length(){return this._manipulators.length}add(e,t=Se.WhenToolEditable){this.addMany([e],t)}addMany(e,t=Se.WhenToolEditable){for(const i of e){const n={manipulator:i,visibilityPredicate:t,attached:!1};this._manipulators.add(n),this._attached&&this._updateManipulatorAttachment(n)}}remove(e){for(let t=0;t<this._manipulators.length;t++)if(this._manipulators.at(t).manipulator===e){const i=this._manipulators.splice(t,1)[0];this._detachManipulator(i);break}}removeAll(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._manipulators.removeAll()}attach(){this._manipulators.forEach(e=>{this._updateManipulatorAttachment(e)}),this._attached=!0}detach(){this._manipulators.forEach(e=>{this._detachManipulator(e)}),this._attached=!1}destroy(){this.detach(),this._manipulators.forEach(({manipulator:e})=>e.destroy()),this._manipulators.destroy(),this._resourceContexts=null}on(e,t){return this._manipulators.on(e,i=>{t(i)})}forEach(e){for(const t of this._manipulators.items)e(t)}some(e){return this._manipulators.items.some(e)}toArray(){const e=[];return this.forEach(t=>e.push(t.manipulator)),e}intersect(e,t){let i=null,n=Number.MAX_VALUE;return this._manipulators.forEach(({manipulator:s,attached:o})=>{if(!o||!s.interactive)return;const r=s.intersectionDistance(e,t);r!=null&&r<n&&(n=r,i=s)}),i}_updateManipulatorAttachment(e){this._isManipulatorItemVisible(e)?this._attachManipulator(e):this._detachManipulator(e)}_attachManipulator(e){e.attached||(e.manipulator.attach&&e.manipulator.attach(this._resourceContexts),e.attached=!0)}_detachManipulator(e){if(!e.attached)return;const t=e.manipulator;t.grabbing=!1,t.dragging=!1,t.hovering=!1,t.selected=!1,t.detach&&t.detach(this._resourceContexts),e.attached=!1}_isManipulatorItemVisible(e){return e.visibilityPredicate===Se.Always||(this._isToolEditable?e.visibilityPredicate===Se.WhenToolEditable:e.visibilityPredicate===Se.WhenToolNotEditable)}},B=class extends tt{constructor(e){super(e),this.manipulators=new Af,this.automaticManipulatorSelection=!0,this.hasGrabbedManipulators=!1,this.hasHoveredManipulators=!1,this.firstGrabbedManipulator=null,this.created=!1,this.removeIncompleteOnCancel=!0,this._editableFlags=new Map([[we.MANAGER,!0],[we.USER,!0]]),this._creationFinishedResolver=Kl()}get active(){return this.view!=null&&this.view.activeTool===this}set visible(e){this._get("visible")!==e&&(this._set("visible",e),this._syncVisible())}get editable(){return this.getEditableFlag(we.USER)}set editable(e){this.setEditableFlag(we.USER,e)}get updating(){return!1}get cursor(){return null}get hasFocusedManipulators(){return this.hasGrabbedManipulators||this.hasHoveredManipulators}destroy(){this.manipulators.destroy(),this._set("view",null)}onAdd(){this._syncVisible()}activate(){this.view!=null&&(this.view.focus(),this.onActivate())}deactivate(){this.onDeactivate()}handleInputEvent(e){this.onInputEvent(e)}handleInputEventAfter(e){this.onInputEventAfter(e)}setEditableFlag(e,t){this._editableFlags.set(e,t),this.manipulators.isToolEditable=this.internallyEditable,this._updateManipulatorAttachment(),e===we.USER&&this.notifyChange("editable"),this.onEditableChange(),this.onManipulatorSelectionChanged()}getEditableFlag(e){return this._editableFlags.get(e)??!1}endDrag(){const e=this.view.inputManager.latestPointerLocation;if(!e)return;let t=!1;this.manipulators.forEach(({manipulator:i})=>{i.dragging&&(t=!0,i.events.emit("drag",{action:"end",start:e,screenPoint:e}))}),t&&(this.view.toolViewManager.activeTool=null)}whenCreated(){return this._creationFinishedResolver.promise}onManipulatorSelectionChanged(){}onActivate(){}onDeactivate(){}onShow(){}onHide(){}onEditableChange(){}onInputEvent(e){}onInputEventAfter(e){}get internallyEditable(){return this.getEditableFlag(we.USER)&&this.getEditableFlag(we.MANAGER)}finishToolCreation(){this.created||this._creationFinishedResolver.resolve(this),this._set("created",!0)}_syncVisible(){if(this.initialized){if(this.visible)this._show();else if(this._hide(),this.active)return void(this.view.activeTool=null)}}_show(){this._updateManipulatorAttachment(),this.onShow()}_hide(){this._updateManipulatorAttachment(),this.onHide()}_updateManipulatorAttachment(){this.visible?this.manipulators.attach():this.manipulators.detach()}};a([c({constructOnly:!0})],B.prototype,"view",void 0),a([c({readOnly:!0})],B.prototype,"active",null),a([c({value:!0})],B.prototype,"visible",null),a([c({value:!0})],B.prototype,"editable",null),a([c({readOnly:!0})],B.prototype,"manipulators",void 0),a([c({readOnly:!0})],B.prototype,"updating",null),a([c()],B.prototype,"cursor",null),a([c({readOnly:!0})],B.prototype,"automaticManipulatorSelection",void 0),a([c()],B.prototype,"hasFocusedManipulators",null),a([c()],B.prototype,"hasGrabbedManipulators",void 0),a([c()],B.prototype,"hasHoveredManipulators",void 0),a([c()],B.prototype,"firstGrabbedManipulator",void 0),a([c({readOnly:!0})],B.prototype,"created",void 0),a([c({readOnly:!0})],B.prototype,"removeIncompleteOnCancel",void 0),B=a([x("esri.views.interactive.InteractiveToolBase")],B);let nn=class extends tt{constructor(e){super(e),this.enabled=!1}};a([c({type:Boolean,nonNullable:!0})],nn.prototype,"enabled",void 0),nn=a([x("esri.views.interactive.sketch.SketchLabelOptions")],nn);const An=nn;let mi=class extends tt{constructor(e){super(e),this.mode="absolute-height"}toJSON(){return{mode:this.mode}}};a([c({type:String,nonNullable:!0})],mi.prototype,"mode",void 0),mi=a([x("esri.views.interactive.sketch.SketchTooltipElevationOptions")],mi);let J=class extends tt{constructor(e){super(e),this.area=!0,this.coordinates=!0,this.direction=!0,this.distance=!0,this.elevation=!0,this.header=!0,this.helpMessage=!1,this.orientation=!0,this.radius=!0,this.rotation=!0,this.scale=!0,this.size=!0,this.totalLength=!0}};a([c({type:Boolean,nonNullable:!0})],J.prototype,"area",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"coordinates",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"direction",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"distance",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"elevation",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"header",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"helpMessage",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"orientation",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"radius",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"rotation",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"scale",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"size",void 0),a([c({type:Boolean,nonNullable:!0})],J.prototype,"totalLength",void 0),J=a([x("esri.views.interactive.sketch.SketchTooltipVisibleElements")],J);const ll=J;let it=class extends tt{constructor(e){super(e),this.enabled=!1,this.forceEnabled=!1,this.helpMessage=null,this.helpMessageIcon=null,this.inputEnabled=!0,this.elevation=new mi,this.placement="auto",this.offset=null,this.visibleElements=new ll,this.visualVariables=null,this.xyMode="auto"}get effectiveEnabled(){return this.forceEnabled||this.enabled}};a([c({type:Boolean,nonNullable:!0})],it.prototype,"enabled",void 0),a([c()],it.prototype,"forceEnabled",void 0),a([c()],it.prototype,"effectiveEnabled",null),a([c()],it.prototype,"helpMessage",void 0),a([c()],it.prototype,"helpMessageIcon",void 0),a([c({type:Boolean,nonNullable:!0})],it.prototype,"inputEnabled",void 0),a([c({type:mi,nonNullable:!0})],it.prototype,"elevation",void 0),a([c()],it.prototype,"placement",void 0),a([c()],it.prototype,"offset",void 0),a([c({type:ll,nonNullable:!0})],it.prototype,"visibleElements",void 0),a([c()],it.prototype,"visualVariables",void 0),a([c()],it.prototype,"xyMode",void 0),it=a([x("esri.views.interactive.sketch.SketchTooltipOptions")],it);const cl=it;let Le=class extends tt{constructor(e){super(e),this.length=null,this.verticalLength=null,this.area=null}};a([c()],Le.prototype,"length",void 0),a([c()],Le.prototype,"verticalLength",void 0),a([c()],Le.prototype,"area",void 0),Le=a([x("esri.views.interactive.sketch.Units")],Le);const pn=Le;let ae=class extends tt{constructor(e){super(e),this.directionMode="relative",this.relativeDirectionIsBilateral=!1}get effectiveDirectionMode(){switch(this.directionMode){case"relative":return this.relativeDirectionIsBilateral?A.RelativeBilateral:A.Relative;case"absolute":return A.Absolute}}get displayUnits(){return this._get("displayUnits")??new pn}set displayUnits(e){this._set("displayUnits",e)}get inputUnits(){return this._get("inputUnits")??new pn}set inputUnits(e){this._set("inputUnits",e)}};a([c({type:String,nonNullable:!0})],ae.prototype,"directionMode",void 0),a([c({type:Boolean,nonNullable:!0})],ae.prototype,"relativeDirectionIsBilateral",void 0),a([c()],ae.prototype,"effectiveDirectionMode",null),a([c({type:pn,nonNullable:!0})],ae.prototype,"displayUnits",null),a([c({type:pn,nonNullable:!0})],ae.prototype,"inputUnits",null),ae=a([x("esri.views.interactive.sketch.SketchValueOptions")],ae);const hl=ae;let Ge=class extends tt{constructor(e){super(e),this.labels=new An,this.tooltips=new cl,this.values=new hl}};a([c({nonNullable:!0,type:An})],Ge.prototype,"labels",void 0),a([c({nonNullable:!0,type:cl})],Ge.prototype,"tooltips",void 0),a([c({nonNullable:!0,type:hl})],Ge.prototype,"values",void 0),Ge=a([x("esri.views.interactive.sketch.SketchOptions")],Ge);const ul=Ge;let P=class extends Ce.EventedMixin(B){constructor(e){super(e),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new ul}initialize(){const{view:e}=this;this.internalGraphicsLayer=new Xs({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const t=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=_f(e.type,this.sketchOptions);const i=Pd(()=>({view:e,options:this.sketchOptions.tooltips}));this.tooltip=i,cr(this._tooltipsContext),this._coordinateFormatterLoadTask=Ll(()=>ru()),this.addHandles([t.on("vertex-add",n=>this.onVertexAdd(n)),t.on("vertex-remove",n=>this.onVertexRemove(n)),t.on("vertex-update",n=>this.onVertexUpdate(n)),t.on("cursor-update",n=>this.onCursorUpdate(n)),t.on("cursor-remove",()=>this._updateGraphic()),t.on("complete",n=>this.onComplete(n)),this._coordinateFormatterLoadTask,i.on("paste",n=>Id(n,this.activeTooltipInfo)),$(()=>this.cursor,n=>{t.cursor=n},ke),Po(()=>{const{activeTooltipInfo:n,sketchOptions:s}=this;bf(n,this._tooltipsContext),i.info=s.tooltips.effectiveEnabled?n:null}),Po(()=>{t.constraintZ=Rf(this._tooltipsContext)},Us)]),this.finishToolCreation()}destroy(){this.drawOperation=dt(this.drawOperation),this.tooltip=dt(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=dt(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(e){this._set("centered",e),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(e){this._set("cursor",e)}set enabled(e){this.drawOperation.interactive=e,this._set("enabled",e)}set forceUniformSize(e){this._set("forceUniformSize",e),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(e){this._set("graphicSymbol",e),this._graphic!=null&&(this._graphic.symbol=e)}set mode(e){const t=this.drawOperation;t&&(t.drawingMode=e),this._set("mode",e)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:e,map:t}}=this;return e==="2d"&&t&&"undoRedo"in t&&t.undoRedo instanceof Ct?t.undoRedo:null}set undoRedo(e){this._override("undoRedo",e)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(e){this.destroyed||Ad(e,this.tooltip)||this.drawOperation.onInputEvent(e)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&cr(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(mt.outline),this.removeHandles(mt.regularVertices),this.removeHandles(mt.activeVertex),this.removeHandles(mt.activeEdge),this.removeHandles(Jn)}_createOrUpdateGraphic(e){if(this._graphic!=null)return this.updateGraphicGeometry(e),this._graphic;const t=new It({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=t,this.updateGraphicGeometry(e),this.internalGraphicsLayer.add(t),this.addHandles(this.initializeGraphic(t)),this.notifyChange("graphic"),this.addHandles(W(()=>{this.internalGraphicsLayer.remove(t),this._graphic===t&&(this._graphic=null)}),Jn),t}updateGraphicGeometry(e){this._graphic.geometry=e}_getCreateOperationGeometry(e={operationComplete:!1}){if(this.drawOperation==null)return;const{coordinateHelper:t,view:i,visualizationCursorVertex:n,lastVertex:s,committedVertices:o,geometryIncludingUncommittedVertices:r,numCommittedVertices:l}=this.drawOperation;if(!(l>0||n!=null))return;const h=e.operationComplete?o:r,u=h.length,p=n!=null?t.pointToArray(n):null,d=this._drawSpatialReference,m=i.type==="3d"&&i.viewingMode==="global",f=new hu;f.committedVertices=o,f.cursorVertex=p;const{geometryType:_}=this;switch(_){case"point":case"mesh":f.full=t.arrayToPoint(h[0]);break;case"multipoint":f.full=u>0?gu(h,d):null;break;case"polyline":case"polygon":u>0&&(f.full=_==="polygon"?Oi([h],d,m,!0):Wo([h],d,m),f.cursorEdge=p!=null&&s&&!gi(n,s)?Wo([[p,t.pointToArray(s)]],d,m):null,f.outline=u>1?f.full:null);break;case"circle":case"rectangle":{if(f.committedVertices=f.cursorVertex=null,!u)break;const y=fu(i,h[0]),w=h[0],b=y.makeMapPoint(w[0]+If*i.resolution,w[1]);_==="circle"?u===1&&e.operationComplete?f.circle=Xo([w,b],y,!0):u===2&&(this.forceUniformSize?f.circle=Xo(h,y,this.centered):f.rectangle=yu(h,y,this.centered)):u===1&&e.operationComplete?f.rectangle=Yo([w,b],y,!0):u===2&&(f.rectangle=this.forceUniformSize?Yo(h,y,this.centered):mu(h,y,this.centered)),f.full=f.circle!=null?f.circle.geometry:f.rectangle?.geometry,f.outline=f.full?.type==="polygon"?f.full:null;break}default:return null}return f}initializeGraphic(e){return W()}onComplete(e){if(!this.drawOperation)return;this._updateGraphic();let t=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(t=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:t,...e})}onCursorUpdate(e){this._updateGraphic(),this.emit("cursor-update",e)}onDeactivate(){const{drawOperation:e}=this;e&&(e.isCompleted||e.cancel())}onOutlineChanged(e){return W()}onCursorEdgeChanged(e){return W()}onVertexAdd(e){hr(this._tooltipsContext),this._updateGraphic(),vf(e.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",e)}onVertexRemove(e){hr(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",e)}onVertexUpdate(e){this._updateGraphic(),this.emit("vertex-update",e)}_updateGraphic(){const e=this._getCreateOperationGeometry();this._createOperationGeometry=e,e!=null?(e.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(e.cursorEdge),mt.activeEdge):this.removeHandles(mt.activeEdge),e.outline!=null?this.addHandles(this.onOutlineChanged(e.outline),mt.outline):this.removeHandles(mt.outline),e.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(e.committedVertices),mt.regularVertices):this.removeHandles(mt.regularVertices),e.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(e.cursorVertex),mt.activeVertex):this.removeHandles(mt.activeVertex),e.full!=null?this._createOrUpdateGraphic(e.full):this.removeHandles(Jn)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?xo(this._tooltipsContext):null}};a([c()],P.prototype,"_coordinateFormatterLoadTask",void 0),a([c()],P.prototype,"_createOperationGeometry",void 0),a([c()],P.prototype,"_tooltipsContext",null),a([c({value:!0})],P.prototype,"centered",null),a([c()],P.prototype,"cursor",null),a([c({nonNullable:!0})],P.prototype,"defaultZ",void 0),a([c({constructOnly:!0})],P.prototype,"directionOptions",void 0),a([c()],P.prototype,"drawOperation",void 0),a([c({value:!0})],P.prototype,"enabled",null),a([c({value:!0})],P.prototype,"forceUniformSize",null),a([c({constructOnly:!0})],P.prototype,"geometryType",void 0),a([c()],P.prototype,"graphic",null),a([c({constructOnly:!0})],P.prototype,"graphicProperties",void 0),a([c()],P.prototype,"graphicSymbol",null),a([c({constructOnly:!0})],P.prototype,"hasZ",void 0),a([c({constructOnly:!0})],P.prototype,"geometryToPlace",void 0),a([c()],P.prototype,"mode",null),a([c()],P.prototype,"snappingManager",void 0),a([c()],P.prototype,"snapToScene",void 0),a([c()],P.prototype,"tooltip",void 0),a([c()],P.prototype,"tooltipInfos",void 0),a([c({constructOnly:!0,type:ul})],P.prototype,"sketchOptions",void 0),a([c()],P.prototype,"updating",null),a([c({constructOnly:!0,nonNullable:!0})],P.prototype,"view",void 0),a([c({constructOnly:!0})],P.prototype,"undoRedo",null),a([c()],P.prototype,"activeTooltipInfo",null),P=a([x("esri.views.draw.DrawGraphicTool")],P);const Jn=Symbol("create-operation-graphic"),mt={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function Of(e){switch(e){case"point":case"polyline":case"polygon":case"multipoint":return e;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const If=48,pl="click";let Lf=class{constructor({consumesClicks:e,grabbableForEvent:t}){this.events=new Ce,this.interactive=!0,this.selectable=!1,this.cursor=null,this.grabbable=!0,this.consumesClicks=e,this.grabbableForEvent=t}destroy(){}intersectionDistance(e,t){return 0}attach(){}detach(){}onElevationChange(){}onViewChange(){}};var D;(function(e){e[e.Z=0]="Z",e[e.M=1]="M"})(D||(D={}));let Gf=class{constructor(e){this.spatialReference=e}createVector(){return this._tag(G())}pointToVector(e){return this._tag(de(e.x,e.y))}arrayToVector(e){return this._tag(de(e[0],e[1]))}vectorToArray(e){return[e[0],e[1]]}pointToArray(e){return[e.x,e.y]}vectorToPoint(e,t=new C){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new C){return t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=void 0,t.m=void 0,t.hasZ=!1,t.hasM=!1,t.spatialReference=this.spatialReference,t}lerp(e,t,i,n){return $r(n,e,t,i)}addDelta(e,t,i){e[0]+=t,e[1]+=i}distance(e,t){return Hr(e,t)}getZ(e,t=void 0){return t}hasZ(){return!1}getM(e,t=void 0){return t}hasM(){return!1}clone(e){return this._tag(Cc(e))}copy(e,t){return wc(t,e)}fromXYZ(e){return this._tag(de(e[0],e[1]))}toXYZ(e,t=g()){return N(t,e[0],e[1],0)}pointToXYZ(e,t=g()){return N(t,e.x,e.y,0)}equals(e,t){return Tc(e,t)}_tag(e){return e}};class ur{constructor(t,i){this._valueType=t,this.spatialReference=i}createVector(){return this._tag(g())}pointToVector(t){return this._tag(pe(t.x,t.y,this._valueType===D.Z?t.z:t.m))}arrayToVector(t){return this._tag(pe(t[0],t[1],t[2]||0))}vectorToArray(t){return[t[0],t[1],t[2]]}pointToArray(t){return this._valueType===D.Z?[t.x,t.y,t.z]:[t.x,t.y,t.m]}vectorToPoint(t,i=new C){return i.x=t[0],i.y=t[1],i.z=this._valueType===D.Z?t[2]:void 0,i.m=this._valueType===D.M?t[2]:void 0,i.spatialReference=this.spatialReference,i}arrayToPoint(t,i=new C){return i.x=t[0],i.y=t[1],i.z=this._valueType===D.Z?t[2]:void 0,i.m=this._valueType===D.M?t[2]:void 0,i.spatialReference=this.spatialReference,i}vectorToDehydratedPoint(t,i){if(!t)return;i??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"};const n=this._valueType===D.Z,s=this._valueType===D.M;return i.x=t[0],i.y=t[1],i.z=n?t[2]:void 0,i.m=s?t[2]:void 0,i.hasZ=n,i.hasM=s,i.spatialReference=this.spatialReference,i}lerp(t,i,n,s){return Pe(s,t,i,n)}addDelta(t,i,n,s){t[0]+=i,t[1]+=n,this._valueType===D.Z&&(t[2]+=s)}distance(t,i){return this._valueType===D.Z?ge(t,i):Hr(t,i)}getZ(t,i=void 0){return this._valueType===D.Z?t[2]:i}hasZ(){return this._valueType===D.Z}getM(t,i=void 0){return this._valueType===D.M?t[2]:i}hasM(){return this._valueType===D.M}clone(t){return this._tag(lc(t))}copy(t,i){return rt(i,t)}fromXYZ(t,i=0,n=0){return this._tag(pe(t[0],t[1],this._valueType===D.Z?t.length>2?t[2]:i:n))}toXYZ(t,i=g()){return N(i,t[0],t[1],this._valueType===D.Z?t[2]:0)}pointToXYZ(t,i=g()){return N(i,t.x,t.y,this._valueType===D.Z?t.z??0:0)}equals(t,i){return We(t,i)}_tag(t){return t}}let Df=class{constructor(e){this.spatialReference=e}createVector(){return this._tag(jr())}pointToVector(e){return this._tag(Hn(e.x,e.y,e.z,e.m))}arrayToVector(e){return this._tag(Hn(e[0],e[1],e[2]||0,e[3]||0))}vectorToArray(e){return[e[0],e[1],e[2],e[3]]}pointToArray(e){return[e.x,e.y,e.z,e.m]}vectorToPoint(e,t=new C){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}arrayToPoint(e,t=new C){return t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.spatialReference=this.spatialReference,t}vectorToDehydratedPoint(e,t){if(e)return t??={x:void 0,y:void 0,z:void 0,m:void 0,hasZ:void 0,hasM:void 0,spatialReference:void 0,type:"point"},t.x=e[0],t.y=e[1],t.z=e[2],t.m=e[3],t.hasZ=!0,t.hasM=!0,t.spatialReference=this.spatialReference,t}lerp(e,t,i,n){return yh(n,e,t,i)}addDelta(e,t,i,n){e[0]+=t,e[1]+=i,e[2]+=n}distance(e,t){return ge(e,t)}getZ(e){return e[2]}hasZ(){return!0}getM(e){return e[3]}hasM(){return!0}clone(e){return this._tag(xh(e))}copy(e,t){return _h(t,e)}fromXYZ(e,t=0,i=0){return this._tag(Hn(e[0],e[1],e.length>2?e[2]:t,i))}toXYZ(e,t=g()){return N(t,e[0],e[1],e[2])}pointToXYZ(e,t=g()){return N(t,e.x,e.y,e.z??0)}equals(e,t){return vh(e,t)}_tag(e){return e}};function dl(e,t,i){return e&&t?new Df(i):t?new ur(D.M,i):e?new ur(D.Z,i):new Gf(i)}function zf(e,t){if(!t.supported)return;let i=1/0,n=-1/0;const s=t.upperBoundX-t.lowerBoundX;e.forEach(r=>{let l=r.pos[0];for(;l<t.lowerBoundX;)l+=s;for(;l>t.upperBoundX;)l-=s;i=Math.min(i,l),n=Math.max(n,l),r.pos[0]=l});const o=n-i;s-o<o&&e.forEach(r=>{r.pos[0]<0&&(r.pos[0]+=s)})}function Uf(e,t){const i=Ur(e);return t===Ti.Global&&i?{supported:!0,lowerBoundX:i.valid[0],upperBoundX:i.valid[1]}:{supported:!1,lowerBoundX:null,upperBoundX:null}}let Gi=class{constructor(e){this.component=e,this.leftEdge=null,this.rightEdge=null,this.type="vertex",this.index=null}get pos(){return this._pos}set pos(e){this._pos=e,this.component.unnormalizeVertexPositions()}};class Jt{constructor(t,i,n){this.component=t,this.leftVertex=i,this.rightVertex=n,this.type="edge",i.rightEdge=this,n.leftEdge=this}}class On{constructor(t,i){this._spatialReference=t,this._viewingMode=i,this.vertices=[],this.edges=[],this.index=null}unnormalizeVertexPositions(){this.vertices.length<=1||zf(this.vertices,Uf(this._spatialReference,this._viewingMode))}updateVertexIndex(t,i){if(this.vertices.length===0)return;const n=this.vertices[0];let s=null,o=t,r=i;do s=o,s.index=r++,o=s.rightEdge?s.rightEdge.rightVertex:null;while(o!=null&&o!==n);s.leftEdge&&s!==this.vertices[this.vertices.length-1]&&this.swapVertices(this.vertices.indexOf(s),this.vertices.length-1)}getFirstVertex(){return this.vertices.at(0)}getLastVertex(){return this.vertices.at(-1)}isClosed(){return this.vertices.length>2&&this.vertices[0].leftEdge!==null}swapVertices(t,i){const n=this.vertices[t];this.vertices[t]=this.vertices[i],this.vertices[i]=n}iterateVertices(t){if(this.vertices.length===0)return;const i=this.vertices[0];let n=i;do t(n,n.index),n=n.rightEdge!=null?n.rightEdge.rightVertex:null;while(n!==i&&n!=null)}}let dn=class fl extends Ce{constructor(t,i){super(),this.type=t,this.coordinateHelper=i,this._geometry=null,this._dirty=!0,this.components=[]}get geometry(){if(this._dirty){switch(this.type){case"point":this._geometry=this._toPoint();break;case"polyline":this._geometry=this._toPolyline();break;case"polygon":this._geometry=this._toPolygon();break;case"mesh":break;default:Hh(this.type)}this._dirty=!1}return this._geometry}get spatialReference(){return this.coordinateHelper.spatialReference}get allVertices(){return Array.from(this.iterateVertices())}*iterateVertices(){for(const t of this.components)for(const i of t.vertices)yield i}notifyChanges(t){this._dirty=!0,this.emit("change",t)}_toPoint(){return this.components.length===0||this.components[0].vertices.length===0?null:this.coordinateHelper.vectorToPoint(this.components[0].vertices[0].pos)}_toPolyline(){const t=[],i=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const s=[];let o=n.vertices.find(l=>l.leftEdge==null);const r=o;do s.push(i(o.pos)),o=o.rightEdge?o.rightEdge.rightVertex:null;while(o&&o!==r);t.push(s)}return new fi({paths:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}_toPolygon(){const t=[],i=this.coordinateHelper.vectorToArray;for(const n of this.components){if(n.vertices.length<1)continue;const s=[],o=n.vertices[0];let r=o;const l=r;do s.push(i(r.pos)),r=r.rightEdge!=null?r.rightEdge.rightVertex:null;while(r&&r!==l);n.isClosed()&&s.push(i(o.pos)),t.push(s)}return new De({rings:t,spatialReference:this.spatialReference,hasZ:this.coordinateHelper.hasZ(),hasM:this.coordinateHelper.hasM()})}static fromGeometry(t,i){const n=t.spatialReference,s=dl(t.hasZ,t.hasM,n),o=new fl(t.type,s);switch(t.type){case"polygon":$f(o,t,i);break;case"polyline":Hf(o,t,i);break;case"point":pr(o,t,i);break;case"mesh":pr(o,t.origin,i),o._geometry=t,o._dirty=!1}return o}};function $f(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,o=t.rings;for(let r=0;r<o.length;++r){const l=o[r],h=new On(n,i);h.index=r;const u=l.length>2&&Fe(l[0],l[l.length-1]),p=u?l.length-1:l.length;for(let m=0;m<p;++m){const f=s.arrayToVector(l[m]),_=new Gi(h);h.vertices.push(_),_.pos=f,_.index=m}const d=h.vertices.length-1;for(let m=0;m<d;++m){const f=h.vertices[m],_=h.vertices[m+1],y=new Jt(h,f,_);h.edges.push(y)}if(u){const m=new Jt(h,h.vertices[h.vertices.length-1],h.vertices[0]);h.edges.push(m)}e.components.push(h)}}function Hf(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,o=t.paths;for(let r=0;r<o.length;++r){const l=o[r],h=new On(n,i);h.index=r;const u=l.length;for(let d=0;d<u;++d){const m=s.arrayToVector(l[d]),f=new Gi(h);h.vertices.push(f),f.pos=m,f.index=d}const p=h.vertices.length-1;for(let d=0;d<p;++d){const m=h.vertices[d],f=h.vertices[d+1],_=new Jt(h,m,f);h.edges.push(_)}e.components.push(h)}}function pr(e,t,i){const n=t.spatialReference,s=e.coordinateHelper,o=new On(n,i);o.index=0;const r=new Gi(o);r.index=0,r.pos=s.pointToVector(t),o.vertices.push(r),e.components.push(o)}function ri(e){return e.type==="mesh"}var L;(function(e){e[e.NEW_STEP=0]="NEW_STEP",e[e.ACCUMULATE_STEPS=1]="ACCUMULATE_STEPS"})(L||(L={}));let Nf=class{constructor(e,t,i){this._editGeometry=e,this._component=t,this._pos=i,this._addedVertex=null,this._originalEdge=null,this._left=null,this._right=null}apply(){let e="redo";this._addedVertex==null&&(e="apply",this._addedVertex=new Gi(this._component));const t=this._component.getLastVertex();if(t==null)this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._addedVertex.index=0;else{let i=null;t.rightEdge&&(this._originalEdge=t.rightEdge,i=this._originalEdge.rightVertex,this._component.edges.splice(this._component.edges.indexOf(this._originalEdge),1)),this._component.vertices.push(this._addedVertex),this._addedVertex.pos=this._pos,this._left==null&&(this._left=new Jt(this._component,t,this._addedVertex)),this._component.edges.push(this._left),t.rightEdge=this._left,this._originalEdge!=null&&i!=null&&(this._right==null&&(this._right=new Jt(this._component,this._addedVertex,i)),this._component.edges.push(this._right),i.leftEdge=this._right),this._component.updateVertexIndex(this._addedVertex,t.index+1)}this._editGeometry.notifyChanges({operation:e,addedVertices:[this._addedVertex]})}undo(){this._addedVertex!=null&&(this._component.vertices.splice(this._component.vertices.indexOf(this._addedVertex),1),this._left!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._left),1),this._left.leftVertex.rightEdge=null),this._right!=null&&(this._component.edges.splice(this._component.edges.indexOf(this._right),1),this._right.rightVertex.leftEdge=null),this._originalEdge!=null&&(this._component.edges.push(this._originalEdge),this._originalEdge.leftVertex.rightEdge=this._originalEdge,this._originalEdge.rightVertex.leftEdge=this._originalEdge),this._left!=null?this._component.updateVertexIndex(this._left.leftVertex,this._left.leftVertex.index):this._component.updateVertexIndex(this._addedVertex,0),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this._addedVertex]}))}accumulate(){return!1}},gl=class ml{constructor(t,i,n){this._editGeometry=t,this._vertices=i,this.operation=n,this._undone=!1}apply(){this._vertices.forEach(t=>this.operation.apply(t)),this._editGeometry.components.forEach(t=>t.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:this._undone?"redo":"apply",updatedVertices:this._vertices})}undo(){this._vertices.forEach(t=>this.operation.undo(t)),this._editGeometry.notifyChanges({operation:"undo",updatedVertices:this._vertices}),this._undone=!0}canAccumulate(t){if(this._undone||t._vertices.length!==this._vertices.length)return!1;for(let i=0;i<t._vertices.length;++i)if(t._vertices[i]!==this._vertices[i])return!1;return this.operation.canAccumulate(t.operation)}accumulate(t){return!!(t instanceof ml&&this.canAccumulate(t))&&(this._vertices.forEach(i=>this.operation.accumulate(i,t.operation)),this.operation.accumulateParams(t.operation),this._editGeometry.components.forEach(i=>i.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:"apply",updatedVertices:this._vertices}),!0)}};var nt;(function(e){e[e.CUMULATIVE=0]="CUMULATIVE",e[e.REPLACE=1]="REPLACE"})(nt||(nt={}));let Ff=class{constructor(e,t,i=0){this._editGeometry=e,this._vertices=t,this._minNumberOfVertices=i,this.removedVertices=null}apply(){let e="redo";if(this.removedVertices==null){const t=this.removedVertices=[];this._vertices.forEach(i=>{const n=this._removeVertex(i);n!=null&&t.push(n)}),e="apply"}else this.removedVertices.forEach(t=>{this._removeVertex(t.removedVertex)});this._editGeometry.notifyChanges({operation:e,removedVertices:this._vertices})}undo(){this.removedVertices?.forEach(e=>{this._undoRemoveVertex(e)}),this._editGeometry.notifyChanges({operation:"undo",addedVertices:this._vertices})}accumulate(){return!1}_removeVertex(e){const t=e.component;if(t.vertices.length<=this._minNumberOfVertices)return null;const i={removedVertex:e,createdEdge:null},n=e.leftEdge,s=e.rightEdge;return t.vertices.splice(t.vertices.indexOf(e),1),n&&(t.edges.splice(t.edges.indexOf(n),1),n.leftVertex.rightEdge=null),s&&(t.edges.splice(t.edges.indexOf(s),1),s.rightVertex.leftEdge=null),e.index===0&&s&&this._vertices.length>0&&t.swapVertices(t.vertices.indexOf(s.rightVertex),0),n&&s&&(i.createdEdge=new Jt(t,n.leftVertex,s.rightVertex),t.edges.push(i.createdEdge)),s&&t.updateVertexIndex(s.rightVertex,s.rightVertex.index-1),i}_undoRemoveVertex(e){const t=e.removedVertex,i=e.removedVertex.component,n=t.leftEdge,s=t.rightEdge;e.createdEdge&&i.edges.splice(i.edges.indexOf(e.createdEdge),1),i.vertices.push(t),n&&(i.edges.push(n),n.leftVertex.rightEdge=n),s&&(i.edges.push(s),s.rightVertex.leftEdge=s),i.updateVertexIndex(t,t.index)}},Zf=class{constructor(e,t,i){this._editGeometry=e,this._edge=t,this._t=i,this.createdVertex=null,this._left=null,this._right=null}apply(){let e="redo";const t=this._edge,i=t.component,n=t.leftVertex,s=t.rightVertex;i.edges.splice(i.edges.indexOf(t),1),this.createdVertex==null&&(e="apply",this.createdVertex=new Gi(t.component)),i.vertices.push(this.createdVertex),this.createdVertex.pos=this._editGeometry.coordinateHelper.lerp(t.leftVertex.pos,t.rightVertex.pos,this._t,this._editGeometry.coordinateHelper.createVector()),this._left==null&&(this._left=new Jt(i,n,this.createdVertex)),this._left.leftVertex.leftEdge?i.edges.push(this._left):i.edges.unshift(this._left),n.rightEdge=this._left,this._right==null&&(this._right=new Jt(i,this.createdVertex,s)),i.edges.push(this._right),s.leftEdge=this._right,i.updateVertexIndex(this.createdVertex,n.index+1),this._editGeometry.notifyChanges({operation:e,addedVertices:[this.createdVertex]})}undo(){if(this.createdVertex==null||this._left==null||this._right==null)return null;const e=this._edge,t=e.component,i=this.createdVertex.leftEdge,n=this.createdVertex.rightEdge,s=i?.leftVertex,o=n?.rightVertex;t.vertices.splice(t.vertices.indexOf(this.createdVertex),1),t.edges.splice(t.edges.indexOf(this._left),1),t.edges.splice(t.edges.indexOf(this._right),1),this._edge.leftVertex.leftEdge?t.edges.push(this._edge):t.edges.unshift(this._edge),s&&(s.rightEdge=e),o&&(o.leftEdge=e),s&&t.updateVertexIndex(s,s.index),this._editGeometry.notifyChanges({operation:"undo",removedVertices:[this.createdVertex]})}accumulate(){return!1}},Bf=class yl{constructor(t,i,n){this._editGeometry=t,this._vertex=i,this._pos=n}apply(){const t=this._originalPosition==null;t&&(this._originalPosition=this._vertex.pos),this._apply(t?"apply":"redo")}undo(){this._vertex.pos=this._originalPosition,this._editGeometry.notifyChanges({operation:"undo",updatedVertices:[this._vertex]})}accumulate(t){return t instanceof yl&&t._vertex===this._vertex&&(this._pos=t._pos,this._apply("apply"),!0)}_apply(t){this._vertex.pos=this._pos,this._editGeometry.components.forEach(i=>i.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:[this._vertex]})}},Wf=class{constructor(e,t){this._editGeometry=e,this._component=t,this._createdEdge=null}apply(){let e="redo";if(this._createdEdge==null){e="apply";const t=this._component.getFirstVertex(),i=this._component.getLastVertex();if(this._component.isClosed()||this._component.vertices.length<3||t==null||i==null)return;this._createdEdge=new Jt(this._component,i,t)}this._createdEdge.leftVertex.rightEdge=this._createdEdge,this._createdEdge.rightVertex.leftEdge=this._createdEdge,this._component.edges.push(this._createdEdge),this._editGeometry.notifyChanges({operation:e})}undo(){this._createdEdge!=null&&(Dr(this._component.edges,this._createdEdge),this._createdEdge.leftVertex.rightEdge=null,this._createdEdge.rightVertex.leftEdge=null,this._editGeometry.notifyChanges({operation:"undo"}))}accumulate(){return!1}},dr=class _l{constructor(t,i,n,s){this._editGeometry=t,this.dx=i,this.dy=n,this.dz=s,this._firstTime=!0}apply(){const t=this._firstTime?"apply":"redo";this._firstTime=!1,this._apply(t,this.dx,this.dy,this.dz)}undo(){this._apply("undo",-this.dx,-this.dy,-this.dz)}accumulate(t){const i=this._editGeometry.geometry;return t instanceof _l&&t._editGeometry.geometry===i&&(this._apply("apply",t.dx,t.dy,t.dz),this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz,!0)}_apply(t,i,n,s){const o=this._editGeometry.geometry;o.offset(i,n,s);const r=this._editGeometry.components[0].getFirstVertex();if(!r)return;const l=this._editGeometry.coordinateHelper;r.pos=l.pointToVector(o.origin),this._editGeometry.notifyChanges({operation:t,updatedVertices:[r]})}},vl=class xl{constructor(t,i,n,s){this._helper=t,this.dx=i,this.dy=n,this.dz=s}_move(t,i,n,s){this._helper.addDelta(t.pos,i,n,s)}apply(t){this._move(t,this.dx,this.dy,this.dz)}undo(t){this._move(t,-this.dx,-this.dy,-this.dz)}canAccumulate(t){return t instanceof xl}accumulate(t,i){this._move(t,i.dx,i.dy,i.dz)}accumulateParams(t){this.dx+=t.dx,this.dy+=t.dy,this.dz+=t.dz}},Yf=class Ls{get plane(){return this._plane}get requiresSplitEdgeLeft(){return!this._left.isOriginalDirection}get requiresSplitEdgeRight(){return!this._right.isOriginalDirection}get edgeDirection(){return this._edgeDirection}constructor(t,i,n,s=0,o=yi.IMMEDIATE){this._helper=t,this._planeType=i,this._edge=n,this.distance=s,this._plane=at(),this._offsetPlane=at(),this._minDistance=-1/0,this._maxDistance=1/0,this._selectedArrow=1,o===yi.IMMEDIATE&&this._initialize()}_initialize(){this._initializeNeighbors(),this._initializePlane(),this._initializeDistanceConstraints()}_initializeNeighbors(){const t=this._toXYZ(this._edge.leftVertex.pos),i=this._toXYZ(this._edge.leftVertex.leftEdge?.leftVertex?.pos),n=this._toXYZ(this._edge.rightVertex.pos),s=this._toXYZ(this._edge.rightVertex.rightEdge?.rightVertex?.pos);this._edgeDirection=Do(g(),t,n),i?(this._left=this._computeNeighbor(t,i,this._edgeDirection),this._right=this._computeNeighbor(n,s,this._edgeDirection,this._left)):(this._right=this._computeNeighbor(n,s,this._edgeDirection),this._left=this._computeNeighbor(t,i,this._edgeDirection,this._right))}_toXYZ(t){return t!=null?this._helper.toXYZ(t):null}_pointToXYZ(t){return this._toXYZ(this._helper.pointToVector(t))}_computeNeighbor(t,i,n,s){const o=g();if(i){Do(o,t,i);const r=!this._passesBisectingAngleThreshold(o,n);return{start:t,end:i,direction:r?this._bisectVectorsPerpendicular(n,o):o,isOriginalDirection:!r}}return this._helper.hasZ()?s&&(Ot(o,n,s.direction),Ot(o,o,n),le(o,o),Math.sign(o[1])!==Math.sign(n[0])&&fe(o,o,-1)):N(o,-n[1],n[0],0),{start:t,end:i,direction:o,isOriginalDirection:!0}}_passesBisectingAngleThreshold(t,i){const n=Math.abs(wh(i,t));return n>=fr&&n<=Math.PI-fr}_bisectVectorsPerpendicular(t,i){const n=Z(t,i)<0?t:rs(g(),t),s=Math.abs(Z(n,i));if(!(s<gr||s>1-gr))return this._bisectDirection(n,i);const o=Ot(g(),n,[0,0,1]);return le(o,o)}_bisectDirection(t,i){const n=ut(g(),t,i);return le(n,n)}_initializePlane(){const t=this._computeNormalDirection(this._left),i=this._computeNormalDirection(this._right);Z(t,i)<0&&rs(i,i),Ri(this._left.start,this._bisectDirection(t,i),this._plane)}_computeNormalDirection(t){const i=Ot(g(),t.direction,this._edgeDirection);le(i,i);const n=Ot(g(),this._edgeDirection,i);return this._planeType===Gs.XY&&(n[2]=0),le(n,n)}_initializeDistanceConstraints(){this._left.end==null||this.requiresSplitEdgeLeft||this._updateDistanceConstraint(Ae(this._plane,this._left.end)),this._right.end==null||this.requiresSplitEdgeRight||this._updateDistanceConstraint(Ae(this._plane,this._right.end)),this._updateIntersectDistanceConstraint(this._plane)}_updateDistanceConstraint(t){t<=0&&(this._minDistance=Math.max(this._minDistance,t)),t>=0&&(this._maxDistance=Math.min(this._maxDistance,t))}_updateIntersectDistanceConstraint(t){const i=Ue(t),n=this._edgeDirection,s=ut(g(),this._left.start,this._left.direction),o=ut(g(),this._right.start,this._right.direction),r=this._pointInBasis2D(G(),i,n,this._left.start),l=this._pointInBasis2D(G(),i,n,s),h=this._pointInBasis2D(G(),i,n,this._right.start),u=this._pointInBasis2D(G(),i,n,o),[p]=Su({start:l,end:r,type:O.LINE},{start:u,end:h,type:O.LINE});if(!p)return;const d=q(G(),r,l);Ws(d,d);const m=q(G(),p,l),f=_e(d,m),_=ut(g(),s,fe(g(),this._left.direction,-f)),y=Ae(t,_);this._updateDistanceConstraint(y)}_pointInBasis2D(t,i,n,s){return t[0]=Ho(i,s),t[1]=Ho(n,s),t}_offset(t,i){Number.isFinite(this._minDistance)&&(i=Math.max(this._minDistance,i)),Number.isFinite(this._maxDistance)&&(i=Math.min(this._maxDistance,i)),Nn(this._offsetPlane,this._plane),this._offsetPlane[3]-=i;const n=(o,r,l)=>r!=null&&js(this._offsetPlane,o,ut(g(),o,r),l),s=g();(t===this._edge.leftVertex?n(this._left.start,this._left.direction,s):n(this._right.start,this._right.direction,s))&&this._helper.copy(this._helper.fromXYZ(s,void 0,this._helper.getM(t.pos)),t.pos)}selectArrowFromStartPoint(t){this._selectedArrow=Kr(this.plane,this._pointToXYZ(t))?1:-1}get selectedArrow(){return this._selectedArrow}signedDistanceToPoint(t){return Ae(this.plane,this._pointToXYZ(t))}clampedStartAndEnd(t){const i=this._helper.toXYZ(this._helper.pointToVector(t)),n=Ks(this._plane,i,g()),s=Ae(this._plane,i),o=cc(s,this._minDistance,this._maxDistance);return Pe(i,n,i,o/s),{start:n,end:i}}apply(t){this._offset(t,this.distance)}undo(t){this._offset(t,0)}canAccumulate(t){return t instanceof Ls&&this._edge.leftVertex.index===t._edge.leftVertex.index&&this._edge.rightVertex.index===t._edge.rightVertex.index&&this._edge.component===t._edge.component&&this._maybeEqualsVec3(this._left.direction,t._left.direction)&&this._maybeEqualsVec3(this._right.direction,t._right.direction)&&We(Ue(this._plane),Ue(t._plane))}accumulate(t,i){const n=this._plane[3]-i._plane[3]+i.distance;this._offset(t,n)}accumulateParams(t){const i=t.distance-t._plane[3];this.distance=i+this._plane[3]}clone(){const t=new Ls(this._helper,this._planeType,this._edge,this.distance,yi.DEFERRED);return Nn(t._plane,this._plane),Nn(t._offsetPlane,this._offsetPlane),t._maxDistance=this._maxDistance,t._minDistance=this._minDistance,t._left=this._cloneNeighbor(this._left),t._right=this._cloneNeighbor(this._right),t._edgeDirection=rt(g(),this._edgeDirection),t}_maybeEqualsVec3(t,i){return t==null&&i==null||t!=null&&i!=null&&We(t,i)}_cloneNeighbor({start:t,end:i,direction:n,isOriginalDirection:s}){return{start:rt(g(),t),end:i!=null?rt(g(),i):null,direction:rt(g(),n),isOriginalDirection:s}}};const fr=Ir(15),gr=.001;var Gs,yi;(function(e){e[e.XYZ=0]="XYZ",e[e.XY=1]="XY"})(Gs||(Gs={})),function(e){e[e.IMMEDIATE=0]="IMMEDIATE",e[e.DEFERRED=1]="DEFERRED"}(yi||(yi={}));let bl=class wl{constructor(t,i,n=nt.CUMULATIVE){this.origin=t,this.angle=i,this._accumulationType=n}_rotate(t,i){Ec(t.pos,t.pos,this.origin,i)}apply(t){this._rotate(t,this.angle)}undo(t){this._rotate(t,-this.angle)}canAccumulate(t){return t instanceof wl&&Fe(this.origin,t.origin)}accumulate(t,i){const n=i._accumulationType===nt.REPLACE;this._rotate(t,n?i.angle-this.angle:i.angle)}accumulateParams(t){const i=t._accumulationType===nt.REPLACE;this.angle=i?t.angle:this.angle+t.angle}};class In{constructor(t,i,n,s,o=nt.CUMULATIVE){this.origin=t,this.axis1=i,this.factor1=n,this.factor2=s,this._accumulationType=o,this.axis2=de(i[1],-i[0])}_scale(t,i,n){on(t.pos,t.pos,this.origin,this.axis1,i),on(t.pos,t.pos,this.origin,this.axis2,n)}apply(t){this._scale(t,this.factor1,this.factor2)}undo(t){this._scale(t,1/this.factor1,1/this.factor2)}canAccumulate(t){return t instanceof In&&Fe(this.origin,t.origin)&&Fe(this.axis1,t.axis1)}accumulate(t,i){i._accumulationType===nt.REPLACE?this._scale(t,i.factor1/this.factor1,i.factor2/this.factor2):this._scale(t,i.factor1,i.factor2)}accumulateParams(t){const i=t._accumulationType===nt.REPLACE;this.factor1=i?t.factor1:this.factor1*t.factor1,this.factor2=i?t.factor2:this.factor2*t.factor2}}let Xf=class Tl{constructor(t,i){this._editGeometry=t,this._newPositions=i}apply(){const t=this._originalPositions==null?"apply":"redo";if(!this._originalPositions){const i=this._editGeometry.coordinateHelper;this._originalPositions=this._editGeometry.allVertices.map(n=>i.clone(n.pos))}this._apply(t,this._newPositions)}undo(){this._originalPositions&&this._apply("undo",this._originalPositions)}accumulate(t){return t instanceof Tl&&(this._newPositions=t._newPositions,this._apply("apply",this._newPositions),!0)}_apply(t,i){const n=this._editGeometry.coordinateHelper,s=this._editGeometry.allVertices;for(let o=0;o<s.length;o++)n.copy(i[o],s[o].pos);this._editGeometry.components.forEach(o=>o.unnormalizeVertexPositions()),this._editGeometry.notifyChanges({operation:t,updatedVertices:s})}};var El;const qf=Symbol();let jf=class{constructor(e){this._operations=[],this._closed=!1,this[El]=!0,e&&(this._operations=e,this._closed=!0)}close(){this._closed=!0}apply(){for(const e of this._operations)e.apply()}undo(){for(let e=this._operations.length-1;e>=0;e--)this._operations[e].undo()}accumulate(e){if(this._closed)return!1;const t=this._operations.length?this._operations[this._operations.length-1]:null;return t&&t.accumulate(e)||(this._operations.push(e),e.apply()),!0}};El=qf;let wo=class Sl extends Ce{constructor(t,i){super(),this.data=t,this.viewingMode=i,this._undoStack=[],this._redoStack=[],this._listener=this.data.on("change",n=>{n.addedVertices&&this.emit("vertex-add",{type:"vertex-add",vertices:n.addedVertices,operation:n.operation}),n.removedVertices&&this.emit("vertex-remove",{type:"vertex-remove",vertices:n.removedVertices,operation:n.operation}),n.updatedVertices&&this.emit("vertex-update",{type:"vertex-update",vertices:n.updatedVertices,operation:n.operation})})}destroy(){this._listener.remove()}splitEdge(t,i){return this._apply(new Zf(this.data,t,i))}updateVertices(t,i,n=L.ACCUMULATE_STEPS){return this._apply(new gl(this.data,t,i),n)}move(t,i,n,s=L.ACCUMULATE_STEPS){return ri(this.data)?this._apply(new dr(this.data,t,i,n),s):this.moveVertices(this.data.allVertices,t,i,n,s)}moveVertices(t,i,n,s,o=L.ACCUMULATE_STEPS){return ri(this.data)?this._apply(new dr(this.data,i,n,s),o):this.updateVertices(t,new vl(this.data.coordinateHelper,i,n,s),o)}scale(t,i,n,s,o=L.ACCUMULATE_STEPS,r=nt.CUMULATIVE){return this.scaleVertices(this.data.allVertices,t,i,n,s,o,r)}scaleVertices(t,i,n,s,o,r=L.ACCUMULATE_STEPS,l=nt.CUMULATIVE){return this.updateVertices(t,new In(i,n,s,o,l),r)}rotate(t,i,n=L.ACCUMULATE_STEPS,s=nt.CUMULATIVE){return this.rotateVertices(this.data.allVertices,t,i,n,s)}rotateVertices(t,i,n,s=L.ACCUMULATE_STEPS,o=nt.CUMULATIVE){return this.updateVertices(t,new bl(i,n,o),s)}removeVertices(t){return this._apply(new Ff(this.data,t,this._minNumVerticesPerType))}appendVertex(t){return this.data.components.length===0?null:this._apply(new Nf(this.data,this.data.components[0],t))}setVertexPosition(t,i){return this._apply(new Bf(this.data,t,i))}offsetEdge(t,i,n,s=L.ACCUMULATE_STEPS){return this.updateVertices([i.leftVertex,i.rightVertex],new Yf(this.data.coordinateHelper,t,i,n),s)}trySetGeometry(t,i=L.ACCUMULATE_STEPS){const{data:n}=this,{coordinateHelper:s}=n;if(n.type!==t.type||!n.spatialReference.equals(t.spatialReference)||s.hasZ()!==t.hasZ||s.hasM()!==t.hasM||!Ql(n.geometry,t)||ri(n))return;const o=Array.from(dn.fromGeometry(t,this.viewingMode).iterateVertices(),r=>r.pos);return this.setVertexPositions(o,i)}setVertexPositions(t,i=L.ACCUMULATE_STEPS){return this._apply(new Xf(this.data,t),i)}createResetState(){if(ri(this.data))return this._createResetStateMesh();const t=this.data.geometry.clone();return W(()=>this.trySetGeometry(t))}closeComponent(t){return this.data.components.includes(t)?this._apply(new Wf(this.data,t)):null}canRemoveVertex(t){return t.vertices.length>this._minNumVerticesPerType}createUndoGroup(){const t=new jf;return this._apply(t),W(()=>t.close())}undo(){if(this._undoStack.length>0){const t=this._undoStack.pop();return t.undo(),this._redoStack.push(t),t}return null}redo(){if(this._redoStack.length>0){const t=this._redoStack.pop();return t.apply(),this._undoStack.push(t),t}return null}get canUndo(){return this._undoStack.length>0}get canRedo(){return this._redoStack.length>0}get lastOperation(){return this._undoStack.length>0?this._undoStack[this._undoStack.length-1]:null}get _minNumVerticesPerType(){switch(this.data.type){case"point":return 1;case"polyline":return 2;case"polygon":return 3;default:return 0}}_apply(t,i=L.ACCUMULATE_STEPS){return i!==L.NEW_STEP&&this.lastOperation!=null&&this.lastOperation.accumulate(t)||(t.apply(),this._undoStack.push(t),this._redoStack=[]),t}_createResetStateMesh(){if(!ri(this.data))return W();const t=this.data.geometry,{vertexSpace:i}=t;if(i.origin){const s=ye(i.origin);return W(()=>{t.vertexSpace.origin=s})}const n=t.vertexAttributes.clonePositional();return W(()=>{t.vertexAttributes=n,t.vertexAttributesChanged()})}static fromGeometry(t,i){return new Sl(dn.fromGeometry(t,i),i)}};function Kf(e,t){let i=null,n=null;return s=>{if(s.action==="cancel")return void(n!=null&&(n.execute({action:"cancel"}),i=null,n=null));const o={action:s.action,screenStart:s.start,screenEnd:s.screenPoint};s.action==="start"&&i==null&&(i=new Pi,n=new Pi,t(e,i,n,s.pointerType,o)),i?.execute(o),s.action==="end"&&i!=null&&(i=null,n=null)}}function He(e,t){return e.events.on("drag",Kf(e,t))}function To(e,t=null,i){let n=null;const s=t==null||e.spatialReference?.equals(t)?r=>r:r=>r!=null?Xe(r,t):r,o={exclude:[],...i};return r=>{if(r.action==="start"&&(n=s(e.toMap(r.screenStart,o))),n==null)return null;const l=s(e.toMap(r.screenEnd,o));return l!=null?{...r,mapStart:n,mapEnd:l}:null}}const Qf=()=>{};let Pi=class Pl{constructor(){this.execute=Qf}next(t,i=new Pl){return t!=null&&(this.execute=n=>{const s=t(n);s!=null&&i.execute(s)}),i}};function Jf(e,t,i=[]){if(e.type==="2d")return s=>s;let n=null;return s=>{s.action==="start"&&(n=e.toMap(s.screenStart,{exclude:i}),n!=null&&(n.z=Lo(n,e,t)));const o=e.toMap(s.screenEnd,{exclude:i});o!=null&&(o.z=Lo(o,e,t));const r=n!=null&&o!=null?{sceneStart:n,sceneEnd:o}:null;return{...s,scenePoints:r}}}let Ds=class{constructor(e){this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.drawConstraints=null,this.editGeometryOperations=e.editGeometryOperations,this.elevationInfo=e.elevationInfo,this.pointer=e.pointer,this.vertexHandle=e.vertexHandle,this.excludeFeature=e.excludeFeature,this.feature=e.feature,this.visualizer=e.visualizer,this.selfSnappingZ=e.selfSnappingZ,this.drawConstraints=e.drawConstraints}get coordinateHelper(){return this.editGeometryOperations.data.coordinateHelper}get spatialReference(){return this.coordinateHelper.spatialReference}};function tg({predicate:e=()=>!0,snappingManager:t,snappingContext:i,updatingHandles:n,useZ:s=!0}){const o=new Pi;if(t==null)return{snappingStep:[mr,o],cancelSnapping:mr};let r,l=null,h=null,u=null;const p=()=>{l=os(l),t.doneSnapping(),h?.frameTask.remove(),h=null,r=Ar(r),u=null},d=eg(t,s,o);let m=null,f=null,_=null;return{snappingStep:[y=>{if(!e(y))return y;const{action:w}=y;if(w==="start"){const{info:b}=y,S=ig(t.view);if(h=ng(i,y,S),h.context.selfSnappingZ=null,!s&&b!=null){const I=og(i.coordinateHelper,b.handle.component);I!=null&&(h.context.selfSnappingZ={value:I,elevationInfo:i.elevationInfo??gn})}}if(h!=null){const{context:b,originalScenePos:S,originalPos:I}=h,{mapEnd:K,mapStart:et,scenePoints:Y}=y,gt=Ml(I,zs(K,et)),lt=zs(et,I),ei={...y,action:"update"},zt=h.context,ie=sg(S,Y),be=t.update({point:gt,scenePoint:ie,context:b});if(_=be,kl(K,be,lt,s),m=gt,f=ie,w!=="end"){const{frameTask:Ln}=h;l==null&&(l=new AbortController),u=Ol=>{n.addPromise(ns(d({frameTask:Ln,event:ei,context:zt,point:gt,scenePoint:ie,delta:lt,getLastState:()=>({point:m,scenePoint:f,updatePoint:Ol.forceUpdate?null:_})},l.signal)))},u({forceUpdate:!1}),r==null&&(r=$(()=>t.options.effectiveEnabled,()=>u?.({forceUpdate:!0})))}}return w==="end"&&p(),y},o],cancelSnapping:y=>(p(),y)}}function eg(e,t,i){return Vr(async({frameTask:n,point:s,scenePoint:o,context:r,event:l,delta:h,getLastState:u},p)=>{const d=await n.schedule(()=>e.snap({point:s,scenePoint:o,context:r,signal:p}),p);if(d.valid){let m=await n.schedule(()=>d.apply(),p);const f=u();f.point!=null&&s!==f.point&&(m=e.update({point:f.point,scenePoint:f.scenePoint,context:r})),f.updatePoint!=null&&gi(m,f.updatePoint)||(kl(l.mapEnd,m,h,t),i.execute(l))}})}function ig(e){return e.type==="3d"?e.resourceController.scheduler.registerTask(ia.SNAPPING):na}function ng(e,t,i){return{context:new Ds({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:t.info!=null?t.info.handle:null,excludeFeature:e.excludeFeature,feature:e.feature,visualizer:e.visualizer}),originalPos:t.snapOrigin!=null?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:t.scenePoints!=null?t.scenePoints.sceneStart:null,frameTask:i}}function Ml(e,[t,i,n]){const s=sa(e);return s.x+=t,s.y+=i,s.hasZ&&(s.z+=n),s}function sg(e,t){return e==null||t==null?null:Ml(e,zs(t.sceneEnd,t.sceneStart))}function zs(e,t){const i=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,i]}function kl(e,t,[i,n,s],o){e.x=t.x+i,e.y=t.y+n,o&&e.hasZ&&t.hasZ&&(e.z=t.z+s)}function og(e,t){if(!e.hasZ())return null;const i=t.vertices;let n=null;for(const s of i){const o=e.getZ(s.pos);if(n!=null&&o!=null&&Math.abs(o-n)>1e-6)return null;n==null&&(n=o)}return n}function mr(e){return e}let Te=class extends tt{constructor(e){super(e),this.constrainResult=t=>t,this._snapPoints=null,this._frameTask=null,this._abortController=null,this._stagedPoint=null,this._snap=Vr(async(t,i,n,s)=>{const o=this._frameTask;if(o==null)return;const r=await o.schedule(()=>i.snap({...t,context:n,signal:s}),s);r.valid&&await o.schedule(()=>{this.stagedPoint=r.apply(),t!==this._snapPoints&&this._snapPoints!=null&&(this.stagedPoint=i.update({...this._snapPoints,context:n}))},s)})}get stagedPoint(){return this._stagedPoint}set stagedPoint(e){this._stagedPoint=this.constrainResult(e)}initialize(){const e=this.view.type==="3d"?this.view?.resourceController?.scheduler:null;this._frameTask=e!=null?e.registerTask(ia.SNAPPING):na}destroy(){this._abortController=os(this._abortController),this._frameTask=Ar(this._frameTask)}update(e,t,i){this._snapPoints=e;const{point:n,scenePoint:s}=e,o=t.update({point:n,scenePoint:s,context:i});return this.stagedPoint=o,o}async snap(e,t,i){const{point:n,scenePoint:s}=e;return this.stagedPoint=t.update({point:n,scenePoint:s,context:i}),this._snapPoints=e,this._abortController==null&&(this._abortController=new AbortController),this._snap(e,t,i,this._abortController.signal)}async snapAgainNearPreviousMapPoint(e,t){this._snapPoints!=null&&await this.snap(this._snapPoints,e,t)}abort(){this._abortController=os(this._abortController),this._snapPoints=null}};a([c({constructOnly:!0})],Te.prototype,"view",void 0),a([c()],Te.prototype,"stagedPoint",null),a([c()],Te.prototype,"constrainResult",void 0),a([c()],Te.prototype,"_stagedPoint",void 0),Te=a([x("esri.views.interactive.snapping.SnappingOperation")],Te);var yr;(function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"})(yr||(yr={}));const _r=Symbol("snapping-toggle");function rg(e,t=()=>{}){const i=$(()=>({view:e.view,snappingOptions:e.snappingOptions}),({view:n,snappingOptions:s})=>{if(e.removeHandles(_r),!n||!s)return;const o=Xr.TOOL,r=[n.on("key-down",l=>{l.key!==ir.toggle||l.repeat||(s.enabledToggled=!0,t())},o),n.on("key-up",l=>{l.key===ir.toggle&&(s.enabledToggled=!1,t())},o),n.on("pointer-move",l=>{const h=l.native.ctrlKey;s.enabledToggled!==h&&(s.enabledToggled=h,t())},o)];e.addHandles(r,_r)},ke);e.addHandles(i)}const ag="crosshair",lg="progress",vr=Symbol(),xr=Symbol();let T=class extends Ce.EventedMixin(tt){constructor(e){super(e),this._createOperationCompleted=!1,this._hideDefaultCursor=!1,this._pointerDownStates=new Jc,this._stagedScreenPoint=null,this._stagedPointerType=null,this._updatingHandles=new Zr,this._stagedPointerId=null,this.constraintsEnabled=!1,this.constraints=void 0,this._getPointConstraint=ys(vp),this._getPolylineOrPolygonConstraint=ys(xp),this.constraintZ=null,this.defaultZ=null,this.isDraped=!0,this.labelOptions=new An,this.cursor=null,this.loading=!1,this.snapToSceneEnabled=null,this.firstVertex=null,this.lastVertex=null,this.secondToLastVertex=null,e.elevationInfo==null&&(this.elevationInfo=Lc(!!e.hasZ))}initialize(){const{geometryType:e,view:t}=this,i=t.spatialReference,n="viewingMode"in t.state?t.state.viewingMode:Ti.Local,s=e==="segment"||e==="multipoint"?"polyline":e;this.coordinateHelper=dl(this.hasZ,this.hasM,i),this._editGeometryOperations=new wo(new dn(s,this.coordinateHelper),n),this._snappingOperation=new Te({view:t}),this.addHandles([$(()=>({stagedPoint:this._snappingOperation.stagedPoint,constraint:this._constraint}),({stagedPoint:l,constraint:h},u)=>{const{snappingOptions:p}=this;if(p&&(p.forceDisabled=h!=null&&vt(h)),u!=null&&l===u.stagedPoint&&h!==u.constraint)return this._onKeyboardBasedChange();this._processCursor(l??this._screenToMap(this._stagedScreenPoint))},{equals:(l,h)=>l.stagedPoint===h.stagedPoint&&Gl(l.constraint,h.constraint)}),$(()=>this.view.viewpoint,(l,h)=>{l&&h&&Uh(l,h)&&this._onKeyboardBasedChange()})]),this._activeComponent=new On(i,n),this._editGeometryOperations.data.components.push(this._activeComponent);const o=this.segmentLabels;o!=null&&(o.context={view:t,editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,labelOptions:this.labelOptions},this.addHandles($(()=>this.labelOptions.enabled,l=>{o.visible=l},ke))),this.addHandles(this._editGeometryOperations.on(["vertex-add","vertex-update","vertex-remove"],l=>{const h=l.vertices.map(f=>({componentIndex:0,vertexIndex:f.index,coordinates:this.coordinateHelper.vectorToArray(f.pos)})),u=h.map(f=>f.coordinates),p=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getFirstVertex()?.pos)??null;gi(p,this.firstVertex)||(this.firstVertex=p);const d=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.getLastVertex()?.pos)??null;gi(d,this.lastVertex)||(this.lastVertex=d);const m=this.coordinateHelper.vectorToDehydratedPoint(this._activeComponent.edges.at(-1)?.leftVertex?.pos)??null;switch(gi(m,this.secondToLastVertex)||(this.secondToLastVertex=m),this._processCursor(this.cursorVertex),l.type){case"vertex-add":this.emit(l.type,{...l,added:u,vertices:h});break;case"vertex-update":this.emit(l.type,{...l,updated:u,vertices:h});break;case"vertex-remove":this.emit(l.type,{...l,removed:u,vertices:h})}}));const r=this._manipulator=new Lf({consumesClicks:!1,grabbableForEvent:l=>this.drawingMode!=="click"||l.pointerType==="touch"&&this._snappingEnabled&&this._pointerDownStates.size===1});this.manipulators.add(r),r.grabbable=e!=="point",this.addHandles([r.events.on("immediate-click",l=>this._onImmediateClick(l)),r.events.on("immediate-double-click",l=>this._onImmediateDoubleClick(l)),$(()=>this.drawingMode,()=>{this.removeHandles(vr),this.addHandles(this._createManipulatorDragPipeline(r),vr)},ke),$(()=>({effectiveCursor:this.effectiveCursor}),({effectiveCursor:l})=>{r.cursor=l},ke)]),rg(this,()=>{const l=this.view.inputManager.latestPointerType??"mouse",h=this._getSnappingContext(l);if(this.snappingManager!=null){const u=this._snappingOperation.snapAgainNearPreviousMapPoint(this.snappingManager,h);this._updatingHandles.addPromise(ns(u))}})}destroy(){dt(this.segmentLabels),dt(this._snappingOperation),this._editGeometryOperations=dt(this._editGeometryOperations),this._updatingHandles.destroy()}get _isDragging(){const{_stagedPointerId:e,_manipulator:t}=this;return e!=null&&this._pointerDownStates.has(e)||t.grabbing||!t.interactive}get _snappingEnabled(){return this.snappingManager!=null&&this.snappingManager.options.effectiveEnabled}get _requiresScenePoint(){const e=this._updateAndGetEffectiveDrawSurface();return this.view.type==="3d"&&this.drawSurface!==e}get canRedo(){return this._editGeometryOperations.canRedo}get canUndo(){return this._editGeometryOperations.canUndo}get committedVertices(){return this._activeComponent.vertices.map(e=>this.coordinateHelper.vectorToArray(e.pos))}get _constraint(){const{constraints:e,constraintsEnabled:t}=this;if(e&&t)switch(this.geometryType){case"point":return this._getPointConstraint(e);case"polygon":case"polyline":return this._getPolylineOrPolygonConstraint(this.lastVertex,this.secondToLastVertex,e)}}set drawingMode(e){this._set("drawingMode",e??pl)}get effectiveCursor(){return this.loading?lg:this._hideDefaultCursor?null:this.cursor||ag}get interactive(){return this._manipulator.interactive}set interactive(e){this._manipulator.interactive=e}get isCompleted(){return this._createOperationCompleted}get numCommittedVertices(){return this._activeComponent.vertices.length}get snappingOptions(){return this.snappingManager!=null?this.snappingManager.options:null}get cursorVertex(){return this._get("cursorVertex")}get visualizationCursorVertex(){return this._stagedPointerType==="mouse"?this.cursorVertex:null}get committableVertex(){const{cursorVertex:e,lastVertex:t,firstVertex:i,geometryType:n}=this;return n==="polygon"&&Fn(e,i)||Fn(e,t)?null:e}get updating(){return this._updatingHandles.updating}get geometryIncludingUncommittedVertices(){const{committedVertices:e,committableVertex:t,coordinateHelper:i}=this,n=e.slice();return t!=null&&n.push(i.pointToArray(t)),n}cancel(){this.complete({aborted:!0})}commitStagedVertex(){this._snappingOperation.abort();const{committableVertex:e}=this;e!=null&&this._editGeometryOperations.appendVertex(this.coordinateHelper.pointToVector(e))}complete(e){const t=e?.aborted||!1;this._snappingOperation.abort(),this.snappingManager?.doneSnapping();const{geometryType:i,numCommittedVertices:n}=this,s=i==="multipoint"&&n===0||i==="polyline"&&n<2||i==="polygon"&&n<3;i!=="segment"&&i!=="point"||this.commitStagedVertex(),this._createOperationCompleted=!s,(this.isCompleted||t)&&(this._stagedScreenPoint=null,this._stagedPointerId=null,this._stagedPointerType=null,this._processCursor(null),this.emit("complete",{vertices:this.committedVertices.map((o,r)=>({componentIndex:0,vertexIndex:r,coordinates:o})),aborted:t,type:"complete"}))}onInputEvent(e){switch(e.type){case"pointer-down":this._pointerDownStates.add(e.pointerId);break;case"pointer-up":this._pointerDownStates.delete(e.pointerId)}switch(e.type){case"pointer-move":return this._onPointerMove(e);case"hold":return this._onHold(e)}}redo(){this._editGeometryOperations.redo()}undo(){this.snappingManager!=null&&this.snappingManager.doneSnapping(),this._editGeometryOperations.undo()}_processCursor(e){const t=is(this.cursorVertex),i=is(e),n=i&&(this._updateAndGetEffectiveDrawSurface()?.constrainZ(i)??i),s=this._snapToClosingVertex(n),o=this._applyConstraints(s);Fn(t,o)||(this._set("cursorVertex",o),this.segmentLabels?.set("stagedVertex",o!=null?this.coordinateHelper.pointToVector(o):null),o==null||this._stagedPointerType!=="mouse"?this.emit("cursor-remove"):this.emit("cursor-update",{updated:null,vertices:[{componentIndex:0,vertexIndex:this._activeComponent.vertices.length,coordinates:this.coordinateHelper.pointToArray(o)}],operation:"apply",type:"vertex-update"}))}_snapToClosingVertex(e){if(e==null||this._isDragging||this.geometryType!=="polygon"||this.numCommittedVertices<=2)return e;const t=this._mapToScreen(e);if(!t)return e;const i=this._activeComponent;return this._vertexWithinPointerDistance(i.vertices[0].pos,t)?this.firstVertex:this._vertexWithinPointerDistance(i.vertices.at(-1).pos,t)?this.lastVertex:e}_createManipulatorDragPipeline(e){switch(this.drawingMode){case"click":return this._createManipulatorDragPipelineClick(e);case"freehand":return this._createManipulatorDragPipelineFreehand(e);case"hybrid":return this._createManipulatorDragPipelineHybrid(e)}}_createManipulatorDragPipelineClick(e){return He(e,(t,i,n,s)=>{const o=s==="touch"&&this._snappingEnabled;if(this.isCompleted||!o)return;const{snappingStep:r,cancelSnapping:l}=tg({predicate:()=>o,snappingManager:this.snappingManager,snappingContext:new Ds({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,feature:this.graphic,pointer:s,visualizer:this.snappingVisualizer,drawConstraints:this.constraints}),updatingHandles:this._updatingHandles,useZ:!this._requiresScenePoint});n=n.next(h=>(o&&this.snappingManager!=null&&this.snappingManager.doneSnapping(),h)).next(l),i.next(this._screenToMapDragEventStep()).next(h=>(h.action==="start"&&(this._processCursor(h.mapStart),(this.geometryType==="segment"||o&&!this.numCommittedVertices)&&this.commitStagedVertex()),h)).next(Jf(this.view,this.elevationInfo)).next(...r).next(h=>(o&&(this._processCursor(h.mapEnd),h.action==="end"&&this.commitStagedVertex()),h)).next(h=>(h.action==="end"&&(this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()),h))})}_createManipulatorDragPipelineFreehand(e){return He(e,(t,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this._snappingOperation.abort(),this.committableVertex==null&&this._processCursor(n.mapStart),this.geometryType==="segment"&&this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this._processCursor(n.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this.complete()}return n})})}_createManipulatorDragPipelineHybrid(e){return He(e,(t,i)=>{this.isCompleted||i.next(this._screenToMapDragEventStep()).next(n=>(n.action==="start"&&(this._snappingOperation.abort(),this.addHandles(this._editGeometryOperations.createUndoGroup(),xr),this._processCursor(n.mapStart),this.commitStagedVertex()),n)).next(n=>{switch(n.action){case"start":case"update":this._processCursor(n.mapEnd),this.geometryType!=="polygon"&&this.geometryType!=="polyline"||this.commitStagedVertex();break;case"end":this._stagedPointerType!=="mouse"&&this._snappingOperation.abort(),this.removeHandles(xr),this.geometryType!=="segment"&&this.geometryType!=="point"||this.complete()}return n})})}get _drawAtFixedElevation(){const{constraintsEnabled:e,constraintZ:t,geometryType:i,numCommittedVertices:n}=this;return e?t!=null||i==="segment"&&n>0:(i==="segment"||i==="polygon")&&n>0}_updateAndGetEffectiveDrawSurface(){const{constraintsEnabled:e,coordinateHelper:t,drawSurface:i,elevationDrawSurface:n,snapToSceneEnabled:s}=this;if(n==null)return i;if(!this.hasZ)return n.defaultZ=null,n;const o=this.elevationInfo?.mode;let r=this.defaultZ,l=e||o==="absolute-height";return s!=null&&(l=s),o==="on-the-ground"&&(l=!1),this._drawAtFixedElevation&&(r=(e?this.constraintZ:null)??t.getZ(this._activeComponent.vertices[0].pos),l=!1),l?i:(n.defaultZ=r,n)}_mapToScreen(e){return this._updateAndGetEffectiveDrawSurface()?.mapToScreen(e)}_onHold(e){this._snappingOperation.abort(),this.drawingMode==="click"&&e.pointerType==="touch"&&this._snappingEnabled&&this._processCursor(e.mapPoint),e.stopPropagation()}_onImmediateClick(e){if(!(e.pointerType==="mouse"&&e.button===2||this._manipulator.dragging))try{const{drawingMode:t,geometryType:i}=this;this._stagedPointerType=e.pointerType,this._stagedScreenPoint=e.screenPoint;const n=this._screenToMap(e.screenPoint);if(n==null||n==null||t==="freehand"&&i!=="point")return;if(this._snappingEnabled&&this.cursorVertex!=null||this._processCursor(n),this.committableVertex==null)return void this.complete();this.commitStagedVertex(),e.pointerType!=="mouse"&&this._processCursor(null),(t==="freehand"||i==="point"||i==="segment"&&this.numCommittedVertices===2||i==="segment"&&t==="hybrid"&&this.numCommittedVertices===1)&&this.complete()}finally{e.stopPropagation()}}_onImmediateDoubleClick(e){this._manipulator.dragging||this.geometryType==="point"||(this.complete(),e.stopPropagation())}_onPointerMove(e){const t=$s(e.x,e.y);this._stagedScreenPoint=t,this._stagedPointerType=e.pointerType,this._stagedPointerId=e.pointerId,this._isDragging?this._snappingOperation.abort():(e.stopPropagation(),this._processCursorMovementRelativeToSurface(t,e.pointerType))}_onKeyboardBasedChange(){this._stagedPointerType==="mouse"&&this._stagedScreenPoint&&this._stagedPointerId!=null&&!this._isDragging?this._processCursorMovementRelativeToSurface(this._stagedScreenPoint,this._stagedPointerType):this._snappingOperation.abort()}_processCursorMovementRelativeToSurface(e,t){const i=this._snappingOperation,n=this._screenToMap(e),s=this._requiresScenePoint?this.drawSurface?.screenToMap(e):null;if(n==null)return this._hideDefaultCursor=!0,this._processCursor(null),void i.abort();this._hideDefaultCursor=!1;const o=this.snappingManager;if(o==null)return this._processCursor(n),void i.abort();const r=this._getSnappingContext(t);this._updatingHandles.addPromise(ns(i.snap({point:n,scenePoint:s},o,r)))}_applyConstraints(e){const{_constraint:t,constraints:i}=this;if(!e||!i||!t)return e;const{context:n}=i,s=Sn(e,n),o=s?t.closestTo(s):void 0;if(!o)return e;const r=wp(o,e,n),l=this.view.type==="2d"||n.elevationInfo.mode!=="absolute-height";return r!=null&&l&&this.constraintZ!=null&&this.hasZ&&(r.z=this.constraintZ),r}_screenToMap(e){return e?this._updateAndGetEffectiveDrawSurface()?.screenToMap(e):null}_screenToMapDragEventStep(){let e=null;return t=>{if(t.action==="start"&&(e=this._screenToMap(t.screenStart)),e==null)return null;const i=this._screenToMap(t.screenEnd);return i!=null?{...t,mapStart:e,mapEnd:i}:null}}_vertexWithinPointerDistance(e,t){const i=this._mapToScreen(this.coordinateHelper.vectorToDehydratedPoint(e));return i!=null&&cg(i,t,25)}_getSnappingContext(e){const t=this._drawAtFixedElevation?this.elevationDrawSurface?.defaultZ:null;return new Ds({editGeometryOperations:this._editGeometryOperations,elevationInfo:this.elevationInfo,pointer:e,feature:this.graphic,visualizer:this.snappingVisualizer,selfSnappingZ:t!=null?{value:t,elevationInfo:this.elevationInfo}:null,drawConstraints:this.constraints})}};function cg(e,t,i){const n=e.x-t.x,s=e.y-t.y;return n*n+s*s<=i}a([c()],T.prototype,"_hideDefaultCursor",void 0),a([c()],T.prototype,"_stagedPointerId",void 0),a([c()],T.prototype,"_isDragging",null),a([c()],T.prototype,"_snappingOperation",void 0),a([c()],T.prototype,"_snappingEnabled",null),a([c({constructOnly:!0})],T.prototype,"graphic",void 0),a([c()],T.prototype,"constraintsEnabled",void 0),a([c()],T.prototype,"constraints",void 0),a([c()],T.prototype,"_constraint",null),a([c()],T.prototype,"constraintZ",void 0),a([c()],T.prototype,"defaultZ",void 0),a([c()],T.prototype,"isDraped",void 0),a([c({value:pl})],T.prototype,"drawingMode",null),a([c({constructOnly:!0})],T.prototype,"elevationDrawSurface",void 0),a([c({constructOnly:!0})],T.prototype,"elevationInfo",void 0),a([c({constructOnly:!0,type:An})],T.prototype,"labelOptions",void 0),a([c({constructOnly:!0})],T.prototype,"geometryType",void 0),a([c({constructOnly:!0})],T.prototype,"hasM",void 0),a([c({constructOnly:!0})],T.prototype,"hasZ",void 0),a([c()],T.prototype,"cursor",void 0),a([c()],T.prototype,"effectiveCursor",null),a([c()],T.prototype,"loading",void 0),a([c({constructOnly:!0})],T.prototype,"manipulators",void 0),a([c({constructOnly:!0})],T.prototype,"drawSurface",void 0),a([c({constructOnly:!0})],T.prototype,"segmentLabels",void 0),a([c({constructOnly:!0})],T.prototype,"snappingManager",void 0),a([c({constructOnly:!0})],T.prototype,"snappingVisualizer",void 0),a([c()],T.prototype,"snapToSceneEnabled",void 0),a([c({readOnly:!0})],T.prototype,"cursorVertex",null),a([c({readOnly:!0})],T.prototype,"visualizationCursorVertex",null),a([c()],T.prototype,"committableVertex",null),a([c()],T.prototype,"firstVertex",void 0),a([c()],T.prototype,"lastVertex",void 0),a([c()],T.prototype,"secondToLastVertex",void 0),a([c()],T.prototype,"updating",null),a([c({constructOnly:!0})],T.prototype,"view",void 0),T=a([x("esri.views.draw.DrawOperation")],T);let hg=class{constructor(e,t=!1,i=0){this.view=e,this.hasZ=t,this.defaultZ=i,this.mapToScreen=n=>e.toScreen(n),this.screenToMap=t?n=>{const s=e.toMap(n);return s.z=i,s}:n=>e.toMap(n)}constrainZ(e){const{defaultZ:t}=this;return this.hasZ&&e.z!==t&&((e=sa(e)).z=t),e}};new ue;let ai=class extends P{constructor(e){super(e),this._visualElementGraphics={regularVertices:null,activeVertex:null,activeEdge:null},this.activeFillSymbol=null,this.type="draw-2d",this._visualElementSymbols={outline:e.activeLineSymbol??iu,regularVertices:e.regularVerticesSymbol??nu,activeVertex:e.activeVertexSymbol??su,fill:e.activeFillSymbol},e.activeVertexSymbol||this.addHandles($(()=>this.view?.effectiveTheme?.accentColor,t=>{if(!t)return;const i=this._visualElementSymbols.activeVertex.clone().set({color:t});this._visualElementGraphics.activeVertex?.set("symbol",i),this._visualElementSymbols={...this._visualElementSymbols,activeVertex:i}},es))}normalizeCtorArgs(e){const t={...e};return delete t.activeFillSymbol,delete t.activeVertexSymbol,delete t.regularVerticesSymbol,delete t.activeLineSymbol,t}initializeGraphic(e){return this._visualElementSymbols.fill!=null&&(e.symbol=this._visualElementSymbols.fill),this.internalGraphicsLayer.graphics.sort(ji),W()}makeDrawOperation(){const{defaultZ:e,hasZ:t,view:i}=this;return this._createOrUpdateGraphic(null),new T({view:i,manipulators:this.manipulators,geometryType:Of(this.geometryType),drawingMode:this.mode,hasZ:t,defaultZ:e,snapToSceneEnabled:this.snapToScene,drawSurface:new hg(i,t,e),hasM:!1,snappingManager:this.snappingManager,snappingVisualizer:new tu(this.internalGraphicsLayer),graphic:this.graphic,cursor:this.cursor,constraintsEnabled:!0})}onActiveVertexChanged(e){if(this.geometryType==="point")return W();const[t,i]=e,n=new C({x:t,y:i,spatialReference:this.view.spatialReference});return this._visualElementGraphics.activeVertex!=null?(this._visualElementGraphics.activeVertex.geometry=n,W()):(this._visualElementGraphics.activeVertex=new It({geometry:n,symbol:this._visualElementSymbols.activeVertex,attributes:{displayOrder:2}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeVertex),this.internalGraphicsLayer.graphics.sort(ji),W(()=>{this._visualElementGraphics.activeVertex!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeVertex),this._visualElementGraphics.activeVertex=dt(this._visualElementGraphics.activeVertex))}))}onCursorEdgeChanged(e){return this._visualElementGraphics.activeEdge!=null?(this._visualElementGraphics.activeEdge.geometry=e,W()):(this._visualElementGraphics.activeEdge=new It({geometry:e,symbol:this._visualElementSymbols.outline,attributes:{displayOrder:0}}),this.internalGraphicsLayer.add(this._visualElementGraphics.activeEdge),this.internalGraphicsLayer.graphics.sort(ji),W(()=>{this._visualElementGraphics.activeEdge!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.activeEdge),this._visualElementGraphics.activeEdge=dt(this._visualElementGraphics.activeEdge))}))}onRegularVerticesChanged(e){const t=new Mr({points:e,spatialReference:this.view.spatialReference});return this._visualElementGraphics.regularVertices!=null?(this._visualElementGraphics.regularVertices.geometry=t,W()):(this._visualElementGraphics.regularVertices=new It({geometry:t,symbol:this._visualElementSymbols.regularVertices,attributes:{displayOrder:1}}),this.internalGraphicsLayer.add(this._visualElementGraphics.regularVertices),this.internalGraphicsLayer.graphics.sort(ji),W(()=>{this._visualElementGraphics.regularVertices!=null&&(this.internalGraphicsLayer.remove(this._visualElementGraphics.regularVertices),this._visualElementGraphics.regularVertices=dt(this._visualElementGraphics.regularVertices))}))}};function ji(e,t){return(e.attributes?.displayOrder??-1/0)-(t.attributes?.displayOrder??-1/0)}a([c()],ai.prototype,"activeFillSymbol",void 0),a([c({readOnly:!0})],ai.prototype,"type",void 0),a([c({constructOnly:!0,nonNullable:!0})],ai.prototype,"view",void 0),ai=a([x("esri.views.2d.interactive.editingTools.draw.DrawGraphicTool2D")],ai);let Eo=class{get hovering(){return this.someManipulator(e=>e.hovering)}get grabbing(){return this.someManipulator(e=>e.grabbing)}get dragging(){return this.someManipulator(e=>e.dragging)}hasManipulator(e){return this.someManipulator(t=>t===e)}someManipulator(e){let t=!1;return this.forEachManipulator(i=>{!t&&e(i)&&(t=!0)}),t}};var Mi;(function(e){e[e.TRANSLATE_XY=0]="TRANSLATE_XY",e[e.SCALE=1]="SCALE",e[e.ROTATE=2]="ROTATE"})(Mi||(Mi={}));function Cl(e){let t=0,i=0,n=0;return e?(e.type==="cim"&&e.data.symbol&&"symbolLayers"in e.data.symbol&&e.data.symbol.symbolLayers&&e.data.symbol.symbolLayers.map(s=>{s.type==="CIMVectorMarker"&&s.anchorPoint&&(Math.abs(s.anchorPoint.x)>t&&(t=s.anchorPoint.x),Math.abs(s.anchorPoint.y)>i&&(i=s.anchorPoint.y),s.size!=null&&s.size>n&&(n=s.size))}),t=ze(t),i=ze(i),n=ze(n),{offsetX:t,offsetY:i,size:n}):{offsetX:t,offsetY:i,size:n}}let X=class extends tt{set graphic(e){this._circleCollisionCache=null,this._originalSymbol=e.symbol,this._set("graphic",e),this.attachSymbolChanged()}get elevationInfo(){const{layer:e}=this.graphic,t=e&&"elevationInfo"in e?e.elevationInfo:null,i=Gc(this.graphic),n=t?t.offset:0;return new Nh({mode:i,offset:n})}set focusedSymbol(e){e!==this._get("focusedSymbol")&&(this._set("focusedSymbol",e),this._updateGraphicSymbol(),this._circleCollisionCache=null)}grabbableForEvent(){return!0}set grabbing(e){e!==this._get("grabbing")&&(this._set("grabbing",e),this._updateGraphicSymbol())}set hovering(e){e!==this._get("hovering")&&(this._set("hovering",e),this._updateGraphicSymbol())}set selected(e){e!==this._get("selected")&&(this._set("selected",e),this._updateGraphicSymbol(),this.events.emit("select-changed",{action:e?"select":"deselect"}))}get _focused(){return this._get("hovering")||this._get("grabbing")}constructor(e){super(e),this.layer=null,this.interactive=!0,this.selectable=!1,this.grabbable=!0,this.dragging=!1,this.cursor=null,this.consumesClicks=!0,this.events=new Ce.EventEmitter,this._circleCollisionCache=null,this._graphicSymbolChangedHandle=null,this._originalSymbol=null}destroy(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this._set("view",null)}intersectionDistance(e){const t=this.graphic;if(t.visible===!1)return null;const i=t.geometry;if(i==null)return null;const n=this._get("focusedSymbol"),s=n??t.symbol;return this.view.type==="2d"?this._intersectDistance2D(this.view,e,i,s):this._intersectDistance3D(this.view,e,t)}attach(){this.attachSymbolChanged(),this.layer!=null&&this.layer.add(this.graphic)}detach(){this.detachSymbolChanged(),this._resetGraphicSymbol(),this.layer!=null&&this.layer.remove(this.graphic)}attachSymbolChanged(){this.detachSymbolChanged(),this._graphicSymbolChangedHandle=$(()=>this.graphic?.symbol,e=>{e!=null&&e!==this.focusedSymbol&&e!==this._originalSymbol&&(this._originalSymbol=e,this._focused&&this.focusedSymbol!=null&&(this.graphic.symbol=this.focusedSymbol))},Us)}detachSymbolChanged(){this._graphicSymbolChangedHandle!=null&&(this._graphicSymbolChangedHandle.remove(),this._graphicSymbolChangedHandle=null)}onElevationChange(){}onViewChange(){}_updateGraphicSymbol(){this.graphic.symbol=this._focused&&this.focusedSymbol!=null?this.focusedSymbol:this._originalSymbol}_resetGraphicSymbol(){this.graphic.symbol=this._originalSymbol}_intersectDistance2D(e,t,i,n){if((n=n||Jl(i))==null)return null;const s=1;let o=this._circleCollisionCache;if(i.type==="point"&&n.type==="cim"&&n.data.symbol?.type==="CIMPointSymbol"&&n.data.symbol.symbolLayers){const{offsetX:r,offsetY:l,size:h}=Cl(n),u=Co(t,wr),p=h/2,d=e.toScreen(i),m=d.x+r,f=d.y+l;return sn(u,[m,f])<p*p?s:null}if(i.type!=="point"||n.type!=="simple-marker")return Zh(t,i,e)?s:null;if(o==null||!o.originalPoint.equals(i)){const r=i,l=e.spatialReference;if($h(r.spatialReference,l)){const h=Xe(r,l);o={originalPoint:r.clone(),mapPoint:h,radiusPx:ze(n.size)},this._circleCollisionCache=o}}if(o!=null){const r=Co(t,wr),l=e.toScreen?.(o.mapPoint);if(!l)return null;const h=o.radiusPx,u=l.x+ze(n.xoffset),p=l.y-ze(n.yoffset);return sn(r,[u,p])<h*h?s:null}return null}_intersectDistance3D(e,t,i){const n=e.toMap(t,{include:[i]});return n&&Fh(n,br,e.renderSpatialReference)?ge(br,e.state.camera.eye):null}};a([c({constructOnly:!0,nonNullable:!0})],X.prototype,"graphic",null),a([c()],X.prototype,"elevationInfo",null),a([c({constructOnly:!0,nonNullable:!0})],X.prototype,"view",void 0),a([c({value:null})],X.prototype,"focusedSymbol",null),a([c({constructOnly:!0})],X.prototype,"layer",void 0),a([c()],X.prototype,"interactive",void 0),a([c()],X.prototype,"selectable",void 0),a([c()],X.prototype,"grabbable",void 0),a([c({value:!1})],X.prototype,"grabbing",null),a([c()],X.prototype,"dragging",void 0),a([c()],X.prototype,"hovering",null),a([c({value:!1})],X.prototype,"selected",null),a([c()],X.prototype,"cursor",void 0),X=a([x("esri.views.interactive.GraphicManipulator")],X);const br=g(),wr=hc();let Rl=class extends Eo{constructor(e){super(),this._view=e.view,this._tool=e.tool,this._graphic=e.graphic,this._manipulator=this._createManipulator(),this.forEachManipulator(t=>this._tool.manipulators.add(t))}destroy(){this.forEachManipulator(e=>{this._tool.manipulators.remove(e),e.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._graphic=null}forEachManipulator(e){e(this._manipulator,Mi.TRANSLATE_XY)}createDragPipeline(e,t){let i=null,n=null,s=0,o=0,r=0;const{offsetX:l,offsetY:h,size:u}=Cl(this._graphic.symbol);return He(this._manipulator,(p,d)=>{d.next(m=>{if(m.action==="start"){const f=e();i=f.editGeometryOperations,n=f.constraints}return m}).next(To(this._view)).next(m=>{const{x:f,y:_,z:y}=m.mapEnd;if(n&&(f+l<n.xmin||_+h-u<n.ymin||f+l>n.xmax||_+h-u>n.ymax))return m;(m.action==="start"||s===0&&o===0&&r===0)&&(s=m.mapStart.x,o=m.mapStart.y,r=m.mapStart.z);const w=f-s,b=_-o,S=y-r;s=f,o=_,r=y;const I=m.action==="start"?L.NEW_STEP:L.ACCUMULATE_STEPS,K=i.move(w,b,S,I);return t(m,K),m})})}_createManipulator(){const e=this._view,t=this._graphic;return new X({view:e,graphic:t,selectable:!0,cursor:"move"})}};const Ut={up:"ArrowUp",down:"ArrowDown",left:"ArrowLeft",right:"ArrowRight",toggleOpacity:"t",shift:"Shift",primaryKey:Yr},ug=1,pg=10,Tr=new _i("#009af2");let Bt=class extends B{constructor(e){super(e),this._isOpacityToggled=!1,this._isModifierActive=!1,this._factor=1,this._initialControlPoints=null,this._graphicsLayer=new Xs({internal:!0,listMode:"hide",visible:!1,effect:"drop-shadow(0px, 0px, 3px)"}),this._undoStack=[],this._redoStack=[],this._sharedUndoStack=[],this._sharedRedoStack=[],this._highlightHandle=null,this.activeHandle=0,this.type="reshape"}initialize(){this._initialize()}destroy(){const{map:e}=this.view;this._controlPointManipulations.forEach(t=>t.destroy()),this._controlPointEditGeometryOperations.forEach(t=>t.destroy()),e.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=dt(this._graphicsLayer),this._georeference=null,this._controlPointGraphics=null,this._controlPointManipulations=null,this._graphicsLayer=null,this._controlPointEditGeometryOperations=null,this._undoStack=null,this._redoStack=null,this._initialControlPoints=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _hasValidSpatialReference(){return Ns(this.view.spatialReference)}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){const e=this._undoStack[this._undoStack.length-1];return e!=null&&this._controlPointEditGeometryOperations[e].canUndo}canRedo(){const e=this._redoStack[this._redoStack.length-1];return e!=null&&this._controlPointEditGeometryOperations[e].canRedo}undo(){if(this._undoStack.length>0){const e=this._undoStack.pop();this._controlPointEditGeometryOperations[e].undo(),this.updateGraphics(),this._redoStack.push(e)}}redo(){if(this._redoStack.length>0){const e=this._redoStack.pop();this._controlPointEditGeometryOperations[e].redo(),this.updateGraphics(),this._undoStack.push(e)}}refresh(){const{mediaElement:e}=this;if(e.georeference==null)return;const t=e.georeference;t.type==="control-points"&&t.coords!=null&&(this._georeference=t,this._georeference.controlPoints.forEach(({mapPoint:i},n)=>{const s=this._controlPointEditGeometryOperations[n],o=s.data.components[0].vertices[0];s.setVertexPosition(o,s.data.coordinateHelper.pointToVector(i))}),this.updateGraphics())}reset(){this._georeference.controlPoints=this._initialControlPoints,this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const e=this._georeference,t=e.controlPoints,i=t[0].mapPoint.spatialReference,n=this._hasValidSpatialReference;this._georeference.controlPoints=this._controlPointEditGeometryOperations.map((s,o)=>{const r=s.data.geometry;return this._controlPointGraphics[o].geometry=r,{mapPoint:Xe(r,i),sourcePoint:n?t[o].sourcePoint:e.toSource(r)}})}updateActiveHandle(e){if(this.activeHandle===e)return;const t=this._controlPointGraphics[this.activeHandle].symbol.clone();No(t,this.view.effectiveTheme.accentColor),this._controlPointGraphics[this.activeHandle].symbol=t;const i=this._controlPointGraphics[e].symbol.clone();No(i,Tr),this._controlPointGraphics[e].symbol=i,this.activeHandle=e,this.view.surface===document.activeElement&&this.highlightActiveHandle()}async highlightActiveHandle(){this.removeHighlightActiveHandle();const e=await this.view.whenLayerView(this._graphicsLayer);this._highlightHandle=e.highlight(this._controlPointGraphics[this.activeHandle])}removeHighlightActiveHandle(){this._highlightHandle&&this._highlightHandle.remove()}setSharedUndoStack(e){this._sharedUndoStack=e}setSharedRedoStack(e){this._sharedRedoStack=e}async _initialize(){const{view:e,mediaElement:t}=this;if(t.georeference==null)return;const i=t.georeference;i.type==="control-points"&&i.coords!=null&&(this._georeference=i,this._initialControlPoints=this._georeference.controlPoints,e.map.addMany([this._graphicsLayer]),e.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._controlPointEditGeometryOperations=this._georeference.controlPoints.map(({mapPoint:n})=>wo.fromGeometry(Xe(n,e.spatialReference),Ti.Local)),this._controlPointGraphics=this._controlPointEditGeometryOperations.map((n,s)=>new It({symbol:new pi({data:{type:"CIMSymbolReference",symbol:{type:"CIMPointSymbol",symbolLayers:[{type:"CIMVectorMarker",enable:!0,colorLocked:!0,anchorPoint:{x:0,y:-15.75},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:9,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:84.3,ymax:84.3},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[83.2,32.5],[84.3,40.7],[83.8,48.9],[81.7,56.9],[78.1,64.3],[73,70.9],[66.9,76.4],[59.7,80.5],[51.9,83.2],[43.7,84.3],[35.4,83.8],[27.4,81.7],[20,78],[13.4,73],[7.9,66.8],[3.8,59.7],[1.1,51.9],[0,43.7],[.5,35.4],[2.6,27.4],[6.3,20],[11.3,13.4],[17.5,7.9],[24.7,3.8],[32.5,1.1],[39.8,.1],[47.1,.3],[54.3,1.8],[61.1,4.5],[67.4,8.4],[72.9,13.3],[77.4,19.1],[80.9,25.5],[83.2,32.5]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:[255,255,255,255]}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[84.3,0],[84.3,84.3],[0,84.3],[0,0]]]}},rotation:0},{type:"CIMVectorMarker",enable:!0,anchorPoint:{x:0,y:-11.25},anchorPointUnits:"Absolute",dominantSizeAxis3D:"Y",size:22.5,billboardMode3D:"FaceNearPlane",frame:{xmin:0,ymin:0,xmax:197.7,ymax:294.7},markerGraphics:[{type:"CIMMarkerGraphic",geometry:{rings:[[[98.9,0],[119.4,23.2],[139.4,49.3],[156.8,75.2],[171.2,100.8],[182.4,125.3],[190.6,148.8],[195.7,171.4],[197.7,192.9],[197.7,195.8],[197.7,200.3],[197.6,202.5],[197.5,204.8],[197.3,207.1],[197,209.4],[196.7,211.7],[196.4,214.1],[196,216.4],[195.5,218.7],[195,221.1],[194.4,223.4],[193.7,225.8],[193,228.1],[192.2,230.5],[191.4,232.8],[190.5,235.1],[189.5,237.5],[188.5,239.7],[187.4,242],[186.2,244.3],[185,246.5],[183.7,248.7],[182.4,250.9],[181,253.1],[179.5,255.2],[178,257.3],[176.4,259.4],[174.7,261.4],[173.1,263.3],[171.3,265.3],[169.5,267.2],[167.7,269],[165.8,270.8],[163.9,272.5],[161.9,274.2],[159.9,275.8],[157.8,277.4],[155.7,278.9],[153.6,280.4],[151.4,281.7],[149.2,283.1],[147,284.4],[144.8,285.6],[142.5,286.7],[140.3,287.8],[138,288.8],[135.7,289.8],[133.4,290.7],[131,291.5],[128.7,292.3],[126.4,293],[124,293.6],[121.7,294.2],[119.4,294.7],[117,295.2],[114.7,295.6],[112.4,296],[110.1,296.3],[107.8,296.5],[105.5,296.7],[103.3,296.8],[101.1,296.9],[98.8,296.9],[83.1,295.7],[67.8,292],[53.3,285.9],[39.9,277.5],[28.1,267.2],[18,255.1],[10,241.5],[4.2,226.9],[.9,211.5],[0,195.8],[.1,192.9],[2.1,171.4],[7.2,148.8],[15.4,125.3],[26.6,100.8],[41,75.2],[58.4,49.3],[78.4,23.2],[98.9,0]]]},symbol:{type:"CIMPolygonSymbol",symbolLayers:[{type:"CIMSolidFill",enable:!0,color:s===this.activeHandle?Tr.toArray():this.view.effectiveTheme.accentColor.toArray()}]}}],scaleSymbolsProportionally:!0,respectFrame:!0,clippingPath:{type:"CIMClippingPath",clippingType:"Intersect",path:{rings:[[[0,0],[197.7,0],[197.7,294.7],[0,294.7],[0,0]]]}},rotation:0}],haloSize:1,scaleX:1,angleAlignment:"Display",angle:0}}}),geometry:n.data.geometry})),this._graphicsLayer.graphics.addMany([...this._controlPointGraphics]),this._controlPointManipulations=this._controlPointGraphics.map(n=>new Rl({tool:this,view:e,graphic:n})),this.addHandles([...this._controlPointManipulations.map((n,s)=>n.createDragPipeline(this._getInfo.bind(this,s),(o,r)=>{o.action==="start"&&(this._undoStack.push(s),this._redoStack=[],this._sharedUndoStack.push({tool:this,operation:r}),this._sharedRedoStack.length=0),this.updateGraphics()})),$(()=>this.view.scale,()=>this.active?this.updateGraphics():null)]),this._controlPointManipulations.forEach((n,s)=>{const o=r=>{this.addHandles([r.events.on(["click","grab-changed"],l=>this.updateActiveHandle(s))])};n.forEachManipulator(o)}),this.addHandles([e.on("key-down",n=>{e.activeTool===this&&(n.key!==Ut.shift||n.repeat||(this._isModifierActive=!0,n.stopPropagation()),n.key!==Ut.toggleOpacity||n.repeat||(t.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled,n.stopPropagation()),n.key!==Ut.primaryKey||n.repeat||(this._factor=pg,n.stopPropagation()),this._isModifierActive&&(n.key===Ut.up&&(this._move(0,this._factor),n.stopPropagation()),n.key===Ut.down&&(this._move(0,-this._factor),n.stopPropagation()),n.key===Ut.left&&(this._move(-this._factor,0),n.stopPropagation()),n.key===Ut.right&&(this._move(this._factor,0),n.stopPropagation())))}),e.on("key-up",n=>{e.activeTool===this&&(n.key===Ut.shift&&(this._isModifierActive=!1,n.stopPropagation()),n.key===Ut.primaryKey&&(this._factor=ug,n.stopPropagation()))})]))}async _loadProjectionEngine(){const e=this._georeference.controlPoints[0].mapPoint;return ea(e.spatialReference,this.view.spatialReference)}_getInfo(e){return{editGeometryOperations:this._controlPointEditGeometryOperations[e],constraints:this._hasValidSpatialReference?null:{xmin:0,ymin:0,xmax:this._georeference.width,ymax:this._georeference.height}}}_move(e,t){const i=this._controlPointEditGeometryOperations[this.activeHandle].move(e*this.view.resolution,t*this.view.resolution,0,L.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0,this.updateGraphics()}};a([c()],Bt.prototype,"_hasValidSpatialReference",null),a([c()],Bt.prototype,"activeHandle",void 0),a([c({constructOnly:!0,nonNullable:!0})],Bt.prototype,"mediaElement",void 0),a([c({readOnly:!0})],Bt.prototype,"type",void 0),a([c({constructOnly:!0})],Bt.prototype,"view",void 0),Bt=a([x("esri.views.2d.interactive.editingTools.ControlPointsTransformTool")],Bt);function Vl(e,t){e.action==="start"?t.cursor="grabbing":t.cursor="grab"}class dg{constructor(){this._lastDragEvent=null,this.next=new Pi,this._enabled=!1}get enabled(){return this._enabled}set enabled(t){if(this._enabled!==t&&this._lastDragEvent!=null){const i={...this._lastDragEvent,action:"update"};t&&this._adjustScaleFactors(i),this.next.execute(i)}this._enabled=t}createDragEventPipelineStep(){return this._lastDragEvent=null,t=>(this._lastDragEvent=t.action!=="end"?{...t}:null,this._enabled&&this._adjustScaleFactors(t),t)}_adjustScaleFactors(t){const i=t.direction[0]!==0&&t.direction[1]!==0?Math.max(Math.abs(t.factor1),Math.abs(t.factor2)):t.direction[0]===0?Math.abs(t.factor2):Math.abs(t.factor1);t.factor1=t.factor1<0?-i:i,t.factor2=t.factor2<0?-i:i}}let fg=class{constructor(){this._lastDragEvent=null,this.next=new Pi,this._enabled=!1}get enabled(){return this._enabled}set enabled(e){if(this._enabled!==e&&this._lastDragEvent!=null){const t={...this._lastDragEvent,action:"update"};e&&this._adjustRotateAngle(t),this.next.execute(t)}this._enabled=e}createDragEventPipelineStep(){return this._lastDragEvent=null,e=>(this._lastDragEvent=e.action!=="end"?{...e}:null,this._enabled&&this._adjustRotateAngle(e),e)}_adjustRotateAngle(e){const t=Or(e.rotateAngle);e.rotateAngle=Ir(5*Math.round(t/5))}};function gg(e,t,i,n=!1){const s=Math.atan2(t.y-i.y,t.x-i.x)-Math.atan2(e.y-i.y,e.x-i.x),o=Math.atan2(Math.sin(s),Math.cos(s));return n?o:Or(o)}function Al(e,t){return mg(e,t,!1)}function mg(e,t,i){if(e instanceof gl){if(e.operation instanceof vl)return yg(e.operation,t,i),!0;if(e.operation instanceof bl)return _g(e.operation,t,i),!0;if(e.operation instanceof In)return vg(e.operation,t,i),!0}return!1}function yg(e,t,i=!1){const n=i?-1:1,s=pe(n*e.dx,n*e.dy,n*e.dz);ut(t.origin,t.origin,s),xn(t)}function _g(e,t,i=!1){const n=i?-e.angle:e.angle;zo(t.basis1,t.basis1,Ao,n),zo(t.basis2,t.basis2,Ao,n),xn(t)}function vg(e,t,i=!1){const n=i?1/e.factor1:e.factor1,s=i?1/e.factor2:e.factor2;fe(t.basis1,t.basis1,n),fe(t.basis2,t.basis2,s),on(t.origin,t.origin,e.origin,e.axis1,n),on(t.origin,t.origin,e.origin,e.axis2,s),xn(t)}function xg(e,t,i,n){n||(n=Ei());const s=Wt(ii.get(),e[1],-e[0]),o=Wt(ii.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=Wt(ii.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=ii.get();t.components.forEach(p=>p.vertices.forEach(({pos:d})=>{Wt(l,_e(e,d),_e(s,d)),xc(o,o,l),bc(r,r,l)}));const h=1e-6,u=Wt(ii.get(),r[0]-o[0]<h?i/2:0,r[1]-o[1]<h?i/2:0);return q(o,o,u),$n(r,r,u),Oo(n.basis1,e,(r[0]-o[0])/2),Oo(n.basis2,s,(r[1]-o[1])/2),Wt(n.origin,o[0]*e[0]+o[1]*s[0],o[0]*e[1]+o[1]*s[1]),$n(n.origin,n.origin,n.basis1),$n(n.origin,n.origin,n.basis2),xn(n),n}class bg extends Eo{constructor(t){super(),this._handles=new Lr,this._originCache=g(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._snapRotation=t.snapRotation,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",i=>Vl(i,this._manipulator))]),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this._handles.destroy(),this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._manipulator=null,this._snapRotation=null,this._graphic=null,this._handles=null,this._originCache=null}forEachManipulator(t){t(this._manipulator,Mi.ROTATE)}createDragPipeline(t,i){let n=null,s=null;return He(this._manipulator,(o,r)=>{r.next(l=>{if(l.action==="start"){o.cursor="grabbing";const h=t();n=h.plane,s=h.editGeometryOperations}return l}).next(To(this._view)).next(l=>({...l,rotateAngle:gg(l.mapStart,l.mapEnd,{x:n.origin[0],y:n.origin[1]},!0)})).next(this._snapRotation.createDragEventPipelineStep(),this._snapRotation.next).next(l=>{const h=rt(this._originCache,n.origin),u=l.action==="start"?L.NEW_STEP:L.ACCUMULATE_STEPS,p=s.rotate(h,l.rotateAngle,u,nt.REPLACE);return Al(p,n),i(l,p),l}).next(l=>(l.action==="end"&&(o.cursor="grab"),l))})}_createManipulator(){const t=this._view,i=this._graphic;return new X({view:t,graphic:i,selectable:!0,cursor:"grab"})}}const ts=10,Er=1e-6,wg=.3;function Sr(e){const t=xi(e.basis1),i=xi(e.basis2);return wg*Math.min(t,i)}class Tg extends Eo{constructor(t){super(),this._handles=new Lr,this._planeStart=Ei(),this._displayPlaneStart=Ei(),this._originCache=g(),this._axisCache=G(),this._renderStartCache=g(),this._renderEndCache=g(),this._resizeOriginCache=g(),this._view=t.view,this._tool=t.tool,this._graphic=t.graphic,this._direction=t.direction,this._preserveAspectRatio=t.preserveAspectRatio,this._manipulator=this._createManipulator(),this._handles.add([this._manipulator.events.on("grab-changed",i=>Vl(i,this._manipulator))]),this.forEachManipulator(i=>this._tool.manipulators.add(i))}destroy(){this._handles.destroy(),this.forEachManipulator(t=>{this._tool.manipulators.remove(t),t.destroy()}),this._tool=null,this._view=null,this._graphic=null,this._manipulator=null,this._direction=null,this._handles=null,this._planeStart=null,this._displayPlaneStart=null,this._originCache=null,this._axisCache=null,this._renderStartCache=null,this._renderEndCache=null,this._resizeOriginCache=null,this._preserveAspectRatio=null}forEachManipulator(t){t(this._manipulator,Mi.SCALE)}createDragPipeline(t,i){let n=null,s=null,o=null,r=0,l=null,h=null;const u=this._planeStart,p=this._displayPlaneStart,d=this._direction;return He(this._manipulator,(m,f)=>{f.next(_=>{if(_.action==="start"){m.cursor="grabbing";const y=t();n=y.plane,s=y.displayPlane,o=y.editGeometryOperations,r=ts*this._view.resolution,Qi(n,u),Qi(s,p);const w=Ur(o.data.spatialReference);l=w?w.valid[1]-w.valid[0]-3*ts*this._view.resolution:null}return _}).next(To(this._view)).next(_=>{const y=rt(this._renderStartCache,[_.mapStart.x,_.mapStart.y,0]),w=rt(this._renderEndCache,[_.mapEnd.x,_.mapEnd.y,0]),b=rt(this._resizeOriginCache,p.origin);z(b,b,p.basis1,-d[0]),z(b,b,p.basis2,-d[1]),Et(w,w,b),Et(y,y,b);const S=d[0]!==0&&d[1]!==0,I=Sr(p),K=Sr(s)/I,et=(lt,ei)=>{if(lt===0)return 1;let zt=xi(ei),ie=.5*lt*Z(ei,w)/zt;const be=ie<0?-1:1;S&&(ie+=(zt-.5*lt*Z(ei,y)/zt)*be*K);const Ln=zt<1.5*r?1:Er;return zt=Math.max(zt-r,Er),be>0&&(ie-=ts*this._view.resolution),be*Math.max(be*(ie/zt),Ln)},Y=et(d[0],p.basis1),gt=et(d[1],p.basis2);return{..._,direction:d,factor1:Y,factor2:gt}}).next(this._preserveAspectRatio.createDragEventPipelineStep(),this._preserveAspectRatio.next).next(_=>{const y=rt(this._originCache,u.origin);z(y,y,u.basis1,-d[0]),z(y,y,u.basis2,-d[1]);const w=Wt(this._axisCache,u.basis1[0],u.basis1[1]);Ws(w,w);const b=o.data.allVertices,S=_.action==="start"?L.NEW_STEP:L.ACCUMULATE_STEPS,I=o.scaleVertices(b,y,w,_.factor1,_.factor2,S,nt.REPLACE);return l&&l<o.data.geometry.extent.width&&h?o.updateVertices(b,h):(Qi(u,n),Al(I,n),h=I.operation,i(_,I)),_}).next(_=>(_.action==="end"&&(m.cursor="grab"),_))})}_createManipulator(){return new X({view:this._view,graphic:this._graphic,selectable:!0,cursor:"grab"})}}function Eg(e){return e?.type==="graphic"}function Sg(e){return e.find(Eg)??null}const Pg=80,Mg=10,kg=30,Cg=[[1,1],[1,-1],[-1,-1],[-1,1],[1,0],[0,-1],[-1,0],[0,1]],Pr=1,Rg=10;let _t=class extends B{constructor(e){super(e),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._planeCache=Ei(),this._displayPlaneCache=Ei(),this._mainAxisCache=G(),this._rotationHandleCache=g(),this._cornerA=g(),this._cornerB=g(),this._cornerC=g(),this._cornerD=g(),this._avgAB=g(),this._avgBC=g(),this._avgCD=g(),this._avgDA=g(),this._preserveAspectRatio=new dg,this._snapRotation=new fg,this._graphicsLayer=new Xs({internal:!0,listMode:"hide",visible:!1}),this._sharedUndoStack=[],this._sharedRedoStack=[],this._isOpacityToggled=!1,this._factor=Pr,this.preserveAspectRatio=null,this.snapRotation=null,this.type="transform"}initialize(){this._initialize()}destroy(){const{map:e}=this.view;this._dragManipulation.destroy(),this._rotateManipulation.destroy(),this._scaleManipulations.forEach(t=>t.destroy()),this._editGeometryOperations.destroy(),e.removeMany([this._graphicsLayer]),this._graphicsLayer.removeAll(),this._graphicsLayer=dt(this._graphicsLayer),this._initialControlPoints=null,this._initialGeometry=null,this._graphic=null,this._preserveAspectRatio=null,this._snapRotation=null,this._planeCache=null,this._displayPlaneCache=null,this._rotationHandleCache=null,this._mainAxisCache=null,this._cornerA=null,this._cornerB=null,this._cornerC=null,this._cornerD=null,this._avgAB=null,this._avgBC=null,this._avgCD=null,this._avgDA=null,this._sharedUndoStack=null,this._sharedRedoStack=null}get _plane(){const e=this._graphic.geometry;if(e==null)return null;const t=this._editGeometryOperations.data,i=t.components[0].edges[0],n=q(this._mainAxisCache,i.leftVertex.pos,i.rightVertex.pos);Ws(n,n);let s=Pg*this.view.resolution;const o=this.view.spatialReference;return Qe(o,e.spatialReference)&&(s*=vi(o)/vi(e.spatialReference)),xg(n,t,s,this._planeCache)}get _displayPlane(){const e=this._plane;if(!e)return null;const t=this._displayPlaneCache;Qi(e,t);const i=Mg*this.view.resolution;return fe(t.basis1,t.basis1,1+i/xi(t.basis1)),fe(t.basis2,t.basis2,1+i/xi(t.basis2)),t}get _backgroundGraphicGeometry(){const e=this._displayPlane;if(!e)return null;const t=this.view.spatialReference;return this._updateDisplayPlaneConrers(e),new De({spatialReference:t,rings:[[this._cornerA,this._cornerB,this._cornerC,this._cornerD,this._cornerA]]})}get _rotateGraphicGeometry(){const e=this._plane;if(!e)return null;const t=this._rotationHandleCache;return le(t,e.basis1),fe(t,t,kg*this.view.resolution),ut(t,t,e.origin),ut(t,t,e.basis1),new C({x:t[0],y:t[1],spatialReference:this.view.spatialReference})}get _scaleGraphicGeometries(){const e=this._displayPlane;if(!e)return[];const t=this.view.spatialReference;this._updateDisplayPlaneConrers(e);const{_cornerA:i,_cornerB:n,_cornerC:s,_cornerD:o}=this,r=Pe(this._avgAB,i,n,.5),l=Pe(this._avgBC,n,s,.5),h=Pe(this._avgCD,s,o,.5),u=Pe(this._avgDA,o,i,.5);return[new C({x:i[0],y:i[1],spatialReference:t}),new C({x:n[0],y:n[1],spatialReference:t}),new C({x:s[0],y:s[1],spatialReference:t}),new C({x:o[0],y:o[1],spatialReference:t}),new C({x:r[0],y:r[1],spatialReference:t}),new C({x:l[0],y:l[1],spatialReference:t}),new C({x:h[0],y:h[1],spatialReference:t}),new C({x:u[0],y:u[1],spatialReference:t})]}onActivate(){this.visible=!0}onDeactivate(){this.visible=!1}onShow(){this._graphicsLayer.visible=!0}onHide(){this._graphicsLayer.visible=!1}canUndo(){return this._editGeometryOperations.canUndo}canRedo(){return this._editGeometryOperations.canRedo}undo(){this._editGeometryOperations.undo(),this.updateGraphics()}redo(){this._editGeometryOperations.redo(),this.updateGraphics()}refresh(){const{view:e,target:t}=this,i="georeference"in t?t.georeference.coords:t.geometry,n=this._editGeometryOperations,s=n.data.components[0].vertices,o=dn.fromGeometry(Xe(i,e.spatialReference),Ti.Local).components[0].vertices;s.forEach((r,l)=>{n.setVertexPosition(r,o[l].pos)}),this.updateGraphics()}reset(){const{target:e}=this;if("georeference"in e){const t=e.georeference;t.type==="control-points"&&(t.controlPoints=this._initialControlPoints)}else e.geometry=this._initialGeometry;this.refresh(),this._sharedUndoStack.length=0,this._sharedRedoStack.length=0}updateGraphics(){const e=this._editGeometryOperations.data.geometry;"georeference"in this.target&&(this.target.georeference.coords=e),this._graphic.geometry=e,this._backgroundGraphic.geometry=this._backgroundGraphicGeometry,this._rotateGraphic.geometry=this._rotateGraphicGeometry,this._scaleGraphicGeometries.forEach((t,i)=>{this._scaleGraphics[i].geometry=t})}setSharedUndoStack(e){this._sharedUndoStack=e}setSharedRedoStack(e){this._sharedRedoStack=e}async _initialize(){const{view:e,target:t}=this;if("georeference"in t){const s=t.georeference;this._graphic=new It({geometry:s.coords}),this._initialControlPoints=s.type==="control-points"?s.controlPoints:null}else this._graphic=t,this._initialGeometry=t.geometry;e.map.addMany([this._graphicsLayer]),e.focus(),this.visible=!1,this.finishToolCreation(),await this._loadProjectionEngine(),this._editGeometryOperations=wo.fromGeometry(Xe(this._graphic.geometry,e.spatialReference),Ti.Local),this._backgroundGraphic=new It({symbol:new Dl({color:"transparent",outline:{type:"simple-line",color:e.effectiveTheme.accentColor,width:2}}),geometry:this._backgroundGraphicGeometry}),this._rotateGraphic=new It({symbol:new Ne({color:Fo(e.effectiveTheme.accentColor),outline:{type:"simple-line",color:e.effectiveTheme.accentColor,width:1}}),geometry:this._rotateGraphicGeometry}),this._scaleGraphics=this._scaleGraphicGeometries.map(s=>new It({symbol:new Ne({size:6,style:"square",color:Fo(e.effectiveTheme.accentColor),outline:{type:"simple-line",color:e.effectiveTheme.accentColor,width:1}}),geometry:s})),this._graphicsLayer.graphics.addMany([this._backgroundGraphic,this._rotateGraphic,...this._scaleGraphics]),this._dragManipulation=new Rl({tool:this,view:e,graphic:this._graphic}),this._rotateManipulation=new bg({tool:this,view:e,graphic:this._rotateGraphic,snapRotation:this._snapRotation}),this._scaleManipulations=this._scaleGraphics.map((s,o)=>new Tg({tool:this,view:e,graphic:s,direction:Cg[o],preserveAspectRatio:this._preserveAspectRatio})),this.addHandles([this._dragManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),this._rotateManipulation.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this)),...this._scaleManipulations.map(s=>s.createDragPipeline(this._getInfo.bind(this),this._updateGraphics.bind(this))),$(()=>this.view.scale,()=>this.active?this.updateGraphics():null),e.on("click",async s=>{if(e.activeTool!=null&&e.activeTool!==this)return;const o=Xc(s),r=[];e.map.allLayers.forEach(u=>{u.type!=="vector-tile"&&u.type!=="imagery"||r.push(u)});const l=await this.view.hitTest(o,{exclude:r}),h=l.results;if(h.length===0)e.activeTool=null;else{const u=Sg(l.results),p="georeference"in t,d=h.map(f=>f.type==="media"?f.element:null).filter(Boolean),m=new Set([...this._graphicsLayer.graphics,p?null:t].filter(Boolean));p&&d.includes(t)||u!=null&&m.has(u.graphic)?e.activeTool==null&&(e.activeTool=this):e.activeTool=null}})]);const i=s=>{this.addHandles(s.events.on("grab-changed",o=>{"georeference"in t&&(o.action==="start"?t.opacity*=.5:o.action==="end"&&(t.opacity*=2))}))};this._dragManipulation.forEachManipulator(i),this._rotateManipulation.forEachManipulator(i),this._scaleManipulations.forEach(s=>s.forEachManipulator(i));const n=new Mp;n.addToggle(kt.preserveAspectRatio,()=>{this.preserveAspectRatio==null&&(this._preserveAspectRatio.enabled=!this._preserveAspectRatio.enabled)}),n.addToggle(kt.rotateIncrements,()=>{this.snapRotation==null&&(this._snapRotation.enabled=!this._snapRotation.enabled)}),n.add(kt.toggleOpacity,()=>{"georeference"in t&&(t.opacity*=this._isOpacityToggled?2:.5,this._isOpacityToggled=!this._isOpacityToggled)}),n.addToggle(kt.factorModifier,s=>this._factor=s.type==="key-down"?Rg:Pr),n.add(kt.scaleUp,()=>this._scale(this._factor)),n.add(kt.scaleDown,()=>this._scale(-this._factor)),n.add(kt.moveUp,()=>this._move(0,this._factor)),n.add(kt.moveDown,()=>this._move(0,-this._factor)),n.add(kt.moveLeft,()=>this._move(-this._factor,0)),n.add(kt.moveRight,()=>this._move(this._factor,0)),this.addHandles([e.on("key-down",s=>{e.activeTool===this&&n.dispatch(e.inputManager,s)}),e.on("key-up",s=>{e.activeTool===this&&n.dispatch(e.inputManager,s)})])}async _loadProjectionEngine(){const e=this._graphic.geometry;return ea(e.spatialReference,this.view.spatialReference)}_updateDisplayPlaneConrers(e){const{basis1:t,basis2:i,origin:n}=e,s=this._cornerA;ut(s,n,t),ut(s,s,i);const o=this._cornerB;ut(o,n,t),Et(o,o,i);const r=this._cornerC;Et(r,n,t),Et(r,r,i);const l=this._cornerD;Et(l,n,t),ut(l,l,i)}_getInfo(){return{editGeometryOperations:this._editGeometryOperations,plane:this._plane,displayPlane:this._displayPlane}}_updateGraphics(e,t){e.action==="start"&&(this._sharedUndoStack.push({tool:this,operation:t}),this._sharedRedoStack.length=0),this.updateGraphics()}_scale(e){const t=this._editGeometryOperations,i=t.data.geometry.extent?.width,n=(i+e*this.view.resolution)/i,s=t.scale(this._plane.origin,kc,n,n,L.NEW_STEP,nt.REPLACE);this._sharedUndoStack.push({tool:this,operation:s}),this._sharedRedoStack.length=0,this.updateGraphics()}_move(e,t){const i=this._editGeometryOperations.move(e*this.view.resolution,t*this.view.resolution,0,L.NEW_STEP);this._sharedUndoStack.push({tool:this,operation:i}),this._sharedRedoStack.length=0,this.updateGraphics()}};a([c()],_t.prototype,"_plane",null),a([c()],_t.prototype,"_backgroundGraphicGeometry",null),a([c()],_t.prototype,"_rotateGraphicGeometry",null),a([c()],_t.prototype,"_scaleGraphicGeometries",null),a([c()],_t.prototype,"preserveAspectRatio",void 0),a([c()],_t.prototype,"snapRotation",void 0),a([c({constructOnly:!0,nonNullable:!0})],_t.prototype,"target",void 0),a([c({readOnly:!0})],_t.prototype,"type",void 0),a([c({constructOnly:!0})],_t.prototype,"view",void 0),_t=a([x("esri.views.2d.interactive.editingTools.TransformTool")],_t);const Ki={redo:"r",undo:"z"};let ne=class extends tt{constructor(e){super(e),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=[],this._sharedRedoStack=[],this._originalOpacity=null,this.activeHandle=0}initialize(){const{view:e,mediaElement:t,preserveAspectRatio:i,snapRotation:n,advancedMode:s}=this;this._originalOpacity=t.opacity,this._transformTool=new _t({target:t,view:e,preserveAspectRatio:i,snapRotation:n}),this._controlPointsTransformTool=new Bt({mediaElement:t,view:e}),this._advancedModeTransformTool=new Bt({mediaElement:s.mediaElement,view:s.view}),this._transformTool.setSharedUndoStack(this._sharedUndoStack),this._transformTool.setSharedRedoStack(this._sharedRedoStack),this._controlPointsTransformTool.setSharedUndoStack(this._sharedUndoStack),this._controlPointsTransformTool.setSharedRedoStack(this._sharedRedoStack),this._advancedModeTransformTool.setSharedUndoStack(this._sharedUndoStack),this._advancedModeTransformTool.setSharedRedoStack(this._sharedRedoStack);const o=t.georeference,r=s.mediaElement.georeference;s.view.tools.addMany([this._advancedModeTransformTool]),"controlPoints"in r&&"controlPoints"in o&&this.addHandles([s.view.on("key-down",l=>{l.key===Ki.undo&&this.canUndo()&&(this.undo(),l.stopPropagation()),l.key===Ki.redo&&this.canRedo()&&(this.redo(),l.stopPropagation())}),s.view.on("focus",async l=>{this._controlPointsTransformTool.removeHighlightActiveHandle(),this._advancedModeTransformTool.highlightActiveHandle()}),$(()=>r.controlPoints,l=>{o.controlPoints=l.map(({sourcePoint:h},u)=>({sourcePoint:h,mapPoint:o.controlPoints[u].mapPoint})),this._activeTool?.refresh()}),$(()=>this._controlPointsTransformTool.activeHandle,l=>{this._advancedModeTransformTool.updateActiveHandle(l),this.activeHandle=l}),$(()=>this._advancedModeTransformTool.activeHandle,l=>{this._controlPointsTransformTool.updateActiveHandle(l),this.activeHandle=l})]),this.addHandles([e.on("key-down",l=>{l.key===Ki.undo&&this.canUndo()&&(this.undo(),l.stopPropagation()),l.key===Ki.redo&&this.canRedo()&&(this.redo(),l.stopPropagation())}),e.on("focus",async l=>{this._advancedModeTransformTool.removeHighlightActiveHandle(),this._controlPointsTransformTool.highlightActiveHandle()})]),e.tools.addMany([this._transformTool,this._controlPointsTransformTool]),e.activeTool=this._transformTool,this._activeTool=this._transformTool,e.focus()}destroy(){this._transformTool?.destroy(),this._controlPointsTransformTool?.destroy(),this._transformTool=null,this._controlPointsTransformTool=null,this._advancedModeTransformTool=null,this._activeTool=null,this._sharedUndoStack=null,this._sharedRedoStack=null}canUndo(){return this._sharedUndoStack.length>0}canRedo(){return this._sharedRedoStack.length>0}undo(){if(this._sharedUndoStack.length>0){const{tool:e,operation:t}=this._sharedUndoStack.pop();e!==this._activeTool&&e.refresh(),t.undo(),e.updateGraphics(),this._sharedRedoStack.push({tool:e,operation:t}),this._activeTool!==e&&this._activeTool?.refresh()}}redo(){if(this._sharedRedoStack.length>0){const{tool:e,operation:t}=this._sharedRedoStack.pop();e!==this._activeTool&&e.refresh(),t.apply(),e.updateGraphics(),this._sharedUndoStack.push({tool:e,operation:t}),this._activeTool!==e&&this._activeTool?.refresh()}}refresh(){this._activeTool.refresh()}reset(){this._activeTool.reset(),this._advancedModeTransformTool.reset()}async enableAdvancedMode(){this.view.activeTool=this._controlPointsTransformTool,this._activeTool=this._controlPointsTransformTool,this._activeTool.refresh(),await this.advancedMode.view.when(),this.advancedMode.view.activeTool=this._advancedModeTransformTool,this._originalOpacity=this._controlPointsTransformTool.mediaElement.opacity,this._controlPointsTransformTool.mediaElement.opacity=.25*this._originalOpacity}disableAdvancedMode(){this.view.activeTool=this._transformTool,this._activeTool=this._transformTool,this._activeTool.refresh(),this.advancedMode.view.activeTool=null,this._controlPointsTransformTool.mediaElement.opacity=this._originalOpacity}};a([c()],ne.prototype,"activeHandle",void 0),a([c({constructOnly:!0})],ne.prototype,"advancedMode",void 0),a([c()],ne.prototype,"preserveAspectRatio",void 0),a([c()],ne.prototype,"snapRotation",void 0),a([c({constructOnly:!0,nonNullable:!0})],ne.prototype,"mediaElement",void 0),a([c({constructOnly:!0})],ne.prototype,"view",void 0),ne=a([x("esri.views.2d.interactive.editingTools.MediaTransformToolsWrapper")],ne);export{Bt as ControlPointsTransformTool,ai as DrawGraphicTool2D,ne as MediaTransformToolsWrapper,_t as TransformTool};
