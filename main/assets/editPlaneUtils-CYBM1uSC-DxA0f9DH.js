import{v as n,a as Ht,d9 as Nt,ai as Ft,c_ as at,aC as Q,ao as Lt,as as Z,I as r,t as k,b9 as xt,aa as lt,d8 as ct,cN as et,aG as $t,aj as Zt,gh as Dt,jw as pt,bc as dt,cE as jt}from"./main-DK5A1thH.js";import{i as Yt}from"./UpdatingHandles-DBzjq66S-DFpl8Tb3.js";import{B as qt,P as Bt,e as Wt,a as Xt,C as Qt,S as U,j as Jt,o as Kt,s as Y,V as te}from"./automaticLengthMeasurementUtils-BcfJmFU0-BkyAHWFv.js";import ee from"./GraphicsLayer-GkJJfSu5-BbhDMga4.js";import{n as ie,F as oe,L as ht,v as ne,T as ut,c as re,j as se,R as yt,d as ae,f as le,Z as ce,g as pe,h as de,i as he,k as ue}from"./index-CVKk0WAC-CetfXNu5.js";import{i as ye,y as L,m as T,d as ge,o as me}from"./quantityUtils-RaoZoCNH-DBxpP_Oi.js";import{T as bt,g as fe,u as ve,o as we,X as Oe,p as _e}from"./SketchViewModel-T2dNp9Tt-LN_5NyI-.js";import{A as Vt,P as K,H as gt,N as mt}from"./vec32-BuqRmYBM-Docn8r6P.js";import{S as $,Q as ke,q as xe,M as It,z as Tt,D as be,_ as Ve,W as Ut}from"./automaticAreaMeasurementUtils-Bz1iefP0-DxDYXAJJ.js";import{m as A,P as ft,x as Ie,g as Te,i as Ue,b as Pe,v as vt,T as wt}from"./vec2-BnynUbeJ-CKtGJQAy.js";import{h as Re,N as q}from"./boundedPlane-B6TkXVHT-y-1QO8ec.js";import{e as M}from"./plane-B_adY3_o-Ns1JnzfT.js";function E(t,e,i){if(t==null)return"noTool";switch(t){case"point":return Se();case"multipoint":return"multipoint";case"polyline":return Ce(e,i);case"polygon":return Ee(e,i);case"rectangle":case"circle":return Ge(e,i);default:return}}function Se(t){return"point"}function Ce(t,e){const i=t!=null&&t.type==="polyline"&&t.paths.length?t.paths[0].length:0;return e==="freehand"?i<2?"freehandStart":"freehandEnd":i<2?"polylineZeroVertices":"polylineOneVertex"}function Ee(t,e){const i=t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0;if(i<3)switch(e){case"freehand":return"freehandStart";case"hybrid":return"polygonZeroVerticesHybrid";default:return"polygonZeroVertices"}else if(i<4)return e==="freehand"?"freehandEnd":"polygonOneVertex";return"polygonTwoVertices"}function Ge(t,e){if((t!=null&&t.type==="polygon"&&t.rings.length?t.rings[0].length:0)<3)switch(e){case"freehand":return"freehandStart";case"click":return"shapeStartClick";default:return"shapeStartHybrid"}switch(e){case"freehand":return"freehandEnd";case"click":return"shapeEndClick";default:return"shapeEndHybrid"}}var g;(function(t){t[t.NeverApplied=0]="NeverApplied",t[t.Applied=1]="Applied",t[t.Undone=2]="Undone"})(g||(g={}));var _;(function(t){t.UndoRedoUpdating="UndoRedoUpdating",t.UndoInvalidError="UndoInvalidError",t.RedoInvalidError="RedoInvalidError",t.ApplyInvalidError="ApplyInvalidError"})(_||(_={}));const B={[_.UndoRedoUpdating]:"Cannot perform operation whilst undo redo is updating",[_.UndoInvalidError]:"There are no items to Undo",[_.RedoInvalidError]:"There are no items to Redo",[_.ApplyInvalidError]:"Cannot apply an item that is already applied"};class z extends Error{constructor(){super(B[_.UndoRedoUpdating]),this.type="undo-redo-updating-error"}}let tt=class extends Error{constructor(){super(B[_.UndoInvalidError]),this.type="undo-redo-undo-error"}};class Ot extends Error{constructor(){super(B[_.RedoInvalidError]),this.type="undo-redo-redo-error"}}class Ae extends Error{constructor(){super(B[_.ApplyInvalidError]),this.type="undo-redo-apply-error"}}var V;(function(t){t[t.Apply=0]="Apply",t[t.Undo=1]="Undo",t[t.Redo=2]="Redo"})(V||(V={}));let D=class extends xt{constructor(){super(...arguments),this.name="",this.tag=Symbol(),this.status=g.NeverApplied}get canUndo(){return this.status===g.Applied}get canRedo(){return this.status===g.Undone}async executeUndoRedoOperation(t){switch(t){case V.Apply:if(this.status!==g.NeverApplied)throw new Ae;return await this.apply(),void(this.status=g.Applied);case V.Undo:if(this.status!==g.Applied)throw new tt;return await this.undo(),void(this.status=g.Undone);case V.Redo:if(this.status!==g.Undone)throw new tt;return await this.redo(),void(this.status=g.Applied)}}};n([r()],D.prototype,"name",void 0),n([r()],D.prototype,"tag",void 0),D=n([k("esri.undoredo.UndoableOperation")],D);let w=class extends xt{constructor(){super(...arguments),this._stack=new lt,this._stackPosition=-1,this._updatingHandles=new Yt}get updating(){return this._updatingHandles.updating}get canUndo(){return this.hasUndo&&!this.updating}get hasUndo(){return this._stackPosition>=0}get canRedo(){return this.hasRedo&&!this.updating}get hasRedo(){return this._stackPosition<this._stack.length-1}_truncateForwardStack(){this._stack.splice(this._stackPosition+1,this._stack.length-this._stackPosition).forEach(t=>t.destroy())}_drainStack(){this._stack.drain(t=>t.destroy()),this._stackPosition=-1}async undo(){if(!this.hasUndo)throw new tt;if(this.updating)throw new z;const t=this._stack.getItemAt(this._stackPosition);t&&await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(V.Undo),--this._stackPosition,t.canRedo||this._truncateForwardStack()})())}async redo(){if(!this.hasRedo)throw new Ot;if(this.updating)throw new z;const t=this._stack.getItemAt(this._stackPosition+1);if(!t)throw new Ot;await this._updatingHandles.addPromise((async()=>{await t.executeUndoRedoOperation(V.Redo),++this._stackPosition})())}peekUndo(){if(this.canUndo)return this._stack.getItemAt(this._stackPosition)}peekRedo(){if(this.canRedo)return this._stack.getItemAt(this._stackPosition+1)}async inject(t){if(this.updating)throw new z;await this._updatingHandles.addPromise((async()=>{t.status===g.NeverApplied&&await t.executeUndoRedoOperation(V.Apply),t.canUndo?(this._stack.splice(this._stackPosition+1,0,t),this._stackPosition++):this._stackPosition>-1&&(this._stack.splice(0,this._stackPosition+1).forEach(e=>e.destroy()),this._stackPosition=-1)})())}async add(t){if(this.updating)throw new z;await this._updatingHandles.addPromise((async()=>{t.status===g.NeverApplied&&await t.executeUndoRedoOperation(V.Apply),this._stackPosition>=-1&&this._truncateForwardStack(),t.canUndo?(this._stack.push(t),this._stackPosition=this._stack.length-1):this._drainStack()})())}async removeTagged(t,e=!1){if(this.updating&&!e)return;await ct(()=>!this.updating);const i=new lt;for(let o=0;o<this._stack.length;o++){const s=this._stack.getItemAt(o);s&&(s.tag===t?(s.destroy(),o===this._stackPosition&&(this._stackPosition=i.length-1)):i.push(s))}this._stack=i,this._stackPosition>i.length-1&&(this._stackPosition=i.length-1)}async clear(t=!1){if(this.updating&&!t)throw new z;await ct(()=>!this.updating),this._drainStack()}};n([r()],w.prototype,"_stack",void 0),n([r()],w.prototype,"_stackPosition",void 0),n([r()],w.prototype,"updating",null),n([r({readOnly:!0})],w.prototype,"canUndo",null),n([r({readOnly:!0})],w.prototype,"hasUndo",null),n([r({readOnly:!0})],w.prototype,"canRedo",null),n([r({readOnly:!0})],w.prototype,"hasRedo",null),w=n([k("esri.UndoRedo")],w);class Me{constructor(){this.committedVertices=null,this.cursorVertex=null,this.full=null,this.outline=null,this.cursorEdge=null,this.circle=null,this.rectangle=null}}function ze(t,e){const i=t?.geometry;if(!t||i?.type!=="mesh"||!e)return;const{renderCoordsHelper:o,elevationProvider:s}=e,{camera:d}=e.state,{extent:a}=i,{center:h,spatialReference:l}=a,u=dt(l),y=et(l),m=dt(o.spatialReference),x=a.width*u,c=a.height*y,I=(a.zmax??0)*y,v=I-(a.zmin??0)*y,P=Math.max(x,c,v)/m,{x:R,y:X}=h,rt=h.z??0;Vt(j,R,X,rt),o.toRenderCoords(j,l,j);const st=P/d.computeScreenPixelSizeAt(j);if(st>d.width*Ne)return"meshTooClose";if(st<He)return"meshTooFar";const Mt=Oe(t),{absoluteZ:zt}=_e(R,X,I,l,e,Mt);return zt<(s.getElevation(R,X,rt,l,"ground")??0)*y+v*Fe?"meshUnderground":"mesh"}const He=20,Ne=1,Fe=.1,j=jt();let O=class extends U{constructor(t){super(t),this.type="draw-circle",this.radius=null,this.xSize=null,this.ySize=null,this.area=L}get allFields(){return[]}};n([r()],O.prototype,"type",void 0),n([r()],O.prototype,"radius",void 0),n([r()],O.prototype,"xSize",void 0),n([r()],O.prototype,"ySize",void 0),n([r()],O.prototype,"area",void 0),n([r()],O.prototype,"helpMessage",void 0),n([r()],O.prototype,"allFields",null),O=n([k("esri.views.interactive.tooltip.infos.DrawCircleTooltipInfo")],O);let H=class extends $(U){constructor(t){super(t),this.type="draw-mesh",this.orientation=ke({lockable:!1}),this.scale=xe({lockable:!1})}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation,this.orientation,this.scale]}};n([r()],H.prototype,"helpMessage",void 0),n([r()],H.prototype,"allFields",null),H=n([k("esri.views.interactive.tooltip.infos.DrawMeshTooltipInfo")],H);let N=class extends $(U){constructor(t){super(t),this.type="draw-multipoint"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],N.prototype,"helpMessage",void 0),n([r()],N.prototype,"allFields",null),N=n([k("esri.views.interactive.tooltip.infos.DrawMultipointTooltipInfo")],N);let F=class extends $(U){constructor(t){super(t),this.type="draw-point"}get allFields(){return[this.longitude,this.latitude,this.x,this.y,this.elevation]}};n([r()],F.prototype,"helpMessage",void 0),n([r()],F.prototype,"allFields",null),F=n([k("esri.views.interactive.tooltip.infos.DrawPointTooltipInfo")],F);let S=class extends $(U){constructor(t){super(t),this.type="draw-polygon",this.direction=It(),this.distance=Tt(),this.area=be(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.area]}};n([r()],S.prototype,"xyMode",void 0),n([r()],S.prototype,"helpMessage",void 0),n([r()],S.prototype,"allFields",null),S=n([k("esri.views.interactive.tooltip.infos.DrawPolygonTooltipInfo")],S);let C=class extends $(U){constructor(t){super(t),this.type="draw-polyline",this.direction=It(),this.distance=Tt(),this.totalLength=Ve(),this.xyMode="direction-distance"}get allFields(){return[this.direction,this.distance,this.longitude,this.latitude,this.x,this.y,this.elevation,this.totalLength]}};n([r()],C.prototype,"helpMessage",void 0),n([r()],C.prototype,"xyMode",void 0),n([r()],C.prototype,"allFields",null),C=n([k("esri.views.interactive.tooltip.infos.DrawPolylineTooltipInfo")],C);let b=class extends U{constructor(t){super(t),this.type="draw-rectangle",this.xSize=T,this.ySize=T,this.area=L}get allFields(){return[]}};n([r()],b.prototype,"type",void 0),n([r()],b.prototype,"xSize",void 0),n([r()],b.prototype,"ySize",void 0),n([r()],b.prototype,"area",void 0),n([r()],b.prototype,"helpMessage",void 0),n([r()],b.prototype,"allFields",null),b=n([k("esri.views.interactive.tooltip.infos.DrawRectangleTooltipInfo")],b);function Le(t,e){return{point:new F({sketchOptions:e,viewType:t}),multipoint:new N({sketchOptions:e,viewType:t}),polyline:new C({sketchOptions:e,viewType:t}),polygon:new S({sketchOptions:e,viewType:t}),mesh:new H({sketchOptions:e,viewType:t}),rectangle:new b({sketchOptions:e}),circle:new O({sketchOptions:e})}}function _t(t){const{directionOptions:e,geometryType:i,sketchOptions:o,tooltipInfos:s}=t,d=h=>{const l=W(t).mode,u=s[h].elevation;l==="relative-to-ground"||l==="relative-to-scene"||l==="on-the-ground"?u.lock(nt(t)):u.unlock()},a=h=>{if(e){const l=s[h].direction;l.committed=e.angle,l.unlockOnVertexPlacement=!1,o.values.directionMode=e.mode}};switch(i){case"polygon":case"polyline":d(i),a(i);break;case"point":case"mesh":d(i)}}function $e(t,e){const{drawOperation:i,view:o}=e,s=it(e),d=W(e);if(o.type==="2d"||!t||d.mode!=="absolute-height"||i?.numCommittedVertices!==1||!s||s.type!=="draw-polyline"&&s.type!=="draw-polygon"||s.elevation.locked)return;const[a,h,l]=t,u=ei(a,h,l,d,e);u!=null&&s.elevation.lock(u)}function kt(t){it(t)?.allFields.forEach(e=>{e.unlockOnVertexPlacement&&e.unlock()})}function it({geometryType:t,graphic:e,tooltipInfos:i}){return e?.geometry?.type!==Ze[t]?t==="circle"||t==="rectangle"?i[t]:null:i[t]}const Ze={point:"point",multipoint:"multipoint",mesh:"mesh",polyline:"polyline",polygon:"polygon",circle:"polygon",rectangle:"polygon",freehandPolygon:"polygon",freehandPolyline:"polyline"};function De(t,e){switch(t?.type){case"draw-point":je(t,e);break;case"draw-multipoint":Ye(t,e);break;case"draw-polyline":Be(t,e);break;case"draw-polygon":We(t,e);break;case"draw-rectangle":Qe(t,e);break;case"draw-circle":Je(t,e);break;case"draw-mesh":qe(t,e)}}function je(t,e){const i=e.graphic?.geometry;i?.type==="point"&&(ot(t,i,e),t.helpMessage=E("point",i,e.drawOperation.drawingMode))}function Ye(t,e){const i=e.graphic?.geometry;i?.type==="multipoint"&&(ot(t,i,e),t.helpMessage=E("multipoint",i,e.drawOperation.drawingMode))}function qe(t,e){const{graphic:i,view:o}=e,s=i?.geometry;o.type!=="3d"||s&&s.type!=="mesh"||(ot(t,s?.origin,e),s&&Jt(t,s),t.helpMessage=ze(i,o))}function ot(t,e,i){const{drawOperation:o,view:s,sketchOptions:d}=i,{cursorVertex:a}=o;t.sketchOptions=d,t.viewType=s.type;const h=e?.type==="multipoint"?e.getPoint(e.points.length-1):e;if(t.setLocationFromPoint(h,G(i)),Rt(t.elevation,i),!a)return void(o.constraints=void 0);const l=a;o.constraints={context:Gt(l,i),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:null,direction:null}}function Be(t,e){const{createOperationGeometry:i,drawOperation:o}=e,s=i!=null?i.full:null;s&&s.type!=="polyline"||(Pt(t,e),t.totalLength.actual=o.lastVertex?(s?Kt(s):null)??T:null,t.helpMessage=E("polyline",s,e.drawOperation.drawingMode))}function We(t,e){const{createOperationGeometry:i,drawOperation:o}=e,s=i!=null?i.full:null;s&&s.type!=="polygon"||(Pt(t,e),t.area.actual=o.lastVertex?(s?Ut(s):null)??L:null,t.helpMessage=E("polygon",s,e.drawOperation.drawingMode))}function Pt(t,e){const{drawOperation:i,sketchOptions:o,view:s}=e,{cursorVertex:d,lastVertex:a,secondToLastVertex:h}=i,l=o.values.effectiveDirectionMode;t.sketchOptions=o,t.viewType=s.type;const u=a&&d?Y(a,d)??T:null;if(t.distance.actual=u,t.distance.readOnly=a==null,t.direction.actual=null,t.direction.readOnly=!0,a&&d&&(l==="absolute"||h)){const x=we(h,a,d,l);t.direction.actual=x??ge,t.direction.readOnly=!1}t.setLocationFromPoint(d,G(e)),Rt(t.elevation,e);const y=Xe(a,e);t.xyMode=y,t.direction.visible=y==="direction-distance",t.distance.visible=y==="direction-distance",t.effectiveX.visible=y==="coordinates",t.effectiveY.visible=y==="coordinates";const m=d??a;i.constraints=m?{context:Gt(m,e),x:t.x.committed,y:t.y.committed,longitude:t.longitude.committed,latitude:t.latitude.committed,elevation:t.elevation.committed,distance:t.distance.committed,direction:t.direction.committed}:void 0}function Xe(t,{sketchOptions:e}){const i=e.tooltips.xyMode;return i==="auto"?t?"direction-distance":"coordinates":i}function Qe(t,e){t.sketchOptions=e.sketchOptions,t.xSize=Ct(e),t.ySize=Et(e),t.area=St(e),t.helpMessage=E("rectangle",e.graphic?.geometry,e.drawOperation.drawingMode)}function Je(t,e){const{forceUniformSize:i,sketchOptions:o}=e;t.sketchOptions=o,t.radius=i?Ke(e):null,t.xSize=i?null:Ct(e),t.ySize=i?null:Et(e),t.area=St(e),t.helpMessage=E("circle",e.graphic?.geometry,e.drawOperation.drawingMode)}function Rt(t,e){const{drawOperation:i}=e,o=i?.cursorVertex??i?.lastVertex;t.actual=te(o)??nt(e),t.visible=i.hasZ,t.readOnly=!1,t.showAsZ=!0}function St(t){const e=t.createOperationGeometry?.full;return e?.type!=="polygon"?L:Ut(e)??L}function Ct(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(e!=null?Y(e.left,e.right):null)??T}function Et(t){const e=t.createOperationGeometry?.rectangle?.midpoints;return(e!=null?Y(e.top,e.bottom):null)??T}function Ke({createOperationGeometry:t}){return(t?.circle?.center!=null&&t.circle.edge!=null?Y(t.circle.center,t.circle.edge):null)??T}function ti(t){const{geometryType:e,tooltipInfos:i}=t;switch(e){case"point":case"multipoint":case"mesh":case"polyline":case"polygon":{const o=i[e].elevation.committed;return o?me(o,"meters")/et(G(t)):void 0}default:return}}function ei(t,e,i,o,s){const{view:d,drawOperation:a}=s;if(d.type!=="3d"||!a)return;i??=0;const h=G(s),l=W(s),u=fe(d,t,e,i,h,l,o);return Xt(u,h)??nt(s)}function W(t){return t.drawOperation.elevationInfo??ve}function G(t){return t.drawOperation.coordinateHelper.spatialReference}function nt(t){const e=et(G(t));return ye(t.defaultZ*e,"meters")}function Gt(t,e){return ce(t,e.view,G(e),W(e),e.drawOperation.coordinateHelper.hasZ(),e.sketchOptions.values.effectiveDirectionMode)}let p=class extends Ht.EventedMixin(ie){constructor(t){super(t),this._graphic=null,this._coordinateFormatterLoadTask=null,this._createOperationGeometry=null,this.defaultZ=0,this.directionOptions=null,this.elevationLockOnVertexAddDisabled=!1,this.geometryType=null,this.hasZ=!0,this.geometryToPlace=null,this.snappingManager=null,this.snapToScene=!1,this.sketchOptions=new bt}initialize(){const{view:t}=this;this.internalGraphicsLayer=new ee({listMode:"hide",internal:!0}),this.view.map.layers.add(this.internalGraphicsLayer);const e=this.drawOperation=this.makeDrawOperation();this.tooltipInfos=Le(t.type,this.sketchOptions);const i=qt(()=>({view:t,options:this.sketchOptions.tooltips}));this.tooltip=i,_t(this._tooltipsContext),this._coordinateFormatterLoadTask=Nt(()=>Qt()),this.addHandles([e.on("vertex-add",o=>this.onVertexAdd(o)),e.on("vertex-remove",o=>this.onVertexRemove(o)),e.on("vertex-update",o=>this.onVertexUpdate(o)),e.on("cursor-update",o=>this.onCursorUpdate(o)),e.on("cursor-remove",()=>this._updateGraphic()),e.on("complete",o=>this.onComplete(o)),this._coordinateFormatterLoadTask,i.on("paste",o=>Bt(o,this.activeTooltipInfo)),Ft(()=>this.cursor,o=>{e.cursor=o},$t),at(()=>{const{activeTooltipInfo:o,sketchOptions:s}=this;De(o,this._tooltipsContext),i.info=s.tooltips.effectiveEnabled?o:null}),at(()=>{e.constraintZ=ti(this._tooltipsContext)},Zt)]),this.finishToolCreation()}destroy(){this.drawOperation=Q(this.drawOperation),this.tooltip=Q(this.tooltip),this._destroyAllVisualizations(),this.view.map.remove(this.internalGraphicsLayer),this.internalGraphicsLayer=Q(this.internalGraphicsLayer),this._set("view",null)}get _drawSpatialReference(){return this.drawOperation.coordinateHelper.spatialReference}get _tooltipsContext(){return{createOperationGeometry:this._createOperationGeometry,defaultZ:this.defaultZ,directionOptions:this.directionOptions,drawOperation:this.drawOperation,forceUniformSize:this.forceUniformSize,geometryType:this.geometryType,graphic:this.graphic,sketchOptions:this.sketchOptions,tooltipInfos:this.tooltipInfos,view:this.view}}get canRedo(){return this.drawOperation.canRedo}get canUndo(){return this.drawOperation.canUndo}set centered(t){this._set("centered",t),this._updateGraphic()}get cursor(){return this._get("cursor")}set cursor(t){this._set("cursor",t)}set enabled(t){this.drawOperation.interactive=t,this._set("enabled",t)}set forceUniformSize(t){this._set("forceUniformSize",t),this._updateGraphic()}get graphic(){return this._graphic}set graphicSymbol(t){this._set("graphicSymbol",t),this._graphic!=null&&(this._graphic.symbol=t)}set mode(t){const e=this.drawOperation;e&&(e.drawingMode=t),this._set("mode",t)}get updating(){return this.drawOperation?.updating??!1}get undoRedo(){const{view:{type:t,map:e}}=this;return t==="2d"&&e&&"undoRedo"in e&&e.undoRedo instanceof w?e.undoRedo:null}set undoRedo(t){this._override("undoRedo",t)}completeCreateOperation(){this.drawOperation.complete()}onInputEvent(t){this.destroyed||Wt(t,this.tooltip)||this.drawOperation.onInputEvent(t)}redo(){this.drawOperation.redo()}reset(){}undo(){this.drawOperation.undo(),this.drawOperation.numCommittedVertices===0&&_t(this._tooltipsContext)}_destroyAllVisualizations(){this.removeHandles(f.outline),this.removeHandles(f.regularVertices),this.removeHandles(f.activeVertex),this.removeHandles(f.activeEdge),this.removeHandles(J)}_createOrUpdateGraphic(t){if(this._graphic!=null)return this.updateGraphicGeometry(t),this._graphic;const e=new Lt({...this.graphicProperties,symbol:this.graphicSymbol});return this._graphic=e,this.updateGraphicGeometry(t),this.internalGraphicsLayer.add(e),this.addHandles(this.initializeGraphic(e)),this.notifyChange("graphic"),this.addHandles(Z(()=>{this.internalGraphicsLayer.remove(e),this._graphic===e&&(this._graphic=null)}),J),e}updateGraphicGeometry(t){this._graphic.geometry=t}_getCreateOperationGeometry(t={operationComplete:!1}){if(this.drawOperation==null)return;const{coordinateHelper:e,view:i,visualizationCursorVertex:o,lastVertex:s,committedVertices:d,geometryIncludingUncommittedVertices:a,numCommittedVertices:h}=this.drawOperation;if(!(h>0||o!=null))return;const l=t.operationComplete?d:a,u=l.length,y=o!=null?e.pointToArray(o):null,m=this._drawSpatialReference,x=i.type==="3d"&&i.viewingMode==="global",c=new Me;c.committedVertices=d,c.cursorVertex=y;const{geometryType:I}=this;switch(I){case"point":case"mesh":c.full=e.arrayToPoint(l[0]);break;case"multipoint":c.full=u>0?le(l,m):null;break;case"polyline":case"polygon":u>0&&(c.full=I==="polygon"?se([l],m,x,!0):yt([l],m,x),c.cursorEdge=y!=null&&s&&!ae(o,s)?yt([[y,e.pointToArray(s)]],m,x):null,c.outline=u>1?c.full:null);break;case"circle":case"rectangle":{if(c.committedVertices=c.cursorVertex=null,!u)break;const v=oe(i,l[0]),P=l[0],R=v.makeMapPoint(P[0]+ii*i.resolution,P[1]);I==="circle"?u===1&&t.operationComplete?c.circle=ht([P,R],v,!0):u===2&&(this.forceUniformSize?c.circle=ht(l,v,this.centered):c.rectangle=ne(l,v,this.centered)):u===1&&t.operationComplete?c.rectangle=ut([P,R],v,!0):u===2&&(c.rectangle=this.forceUniformSize?ut(l,v,this.centered):re(l,v,this.centered)),c.full=c.circle!=null?c.circle.geometry:c.rectangle?.geometry,c.outline=c.full?.type==="polygon"?c.full:null;break}default:return null}return c}initializeGraphic(t){return Z()}onComplete(t){if(!this.drawOperation)return;this._updateGraphic();let e=null;if(this.drawOperation.isCompleted){const i=this._getCreateOperationGeometry({operationComplete:!0});i!=null&&(e=this._createOrUpdateGraphic(i.full))}this._createOperationGeometry=null,this.emit("complete",{graphic:e,...t})}onCursorUpdate(t){this._updateGraphic(),this.emit("cursor-update",t)}onDeactivate(){const{drawOperation:t}=this;t&&(t.isCompleted||t.cancel())}onOutlineChanged(t){return Z()}onCursorEdgeChanged(t){return Z()}onVertexAdd(t){kt(this._tooltipsContext),this._updateGraphic(),this.elevationLockOnVertexAddDisabled||$e(t.vertices.at(0)?.coordinates,this._tooltipsContext),this.emit("vertex-add",t)}onVertexRemove(t){kt(this._tooltipsContext),this._updateGraphic(),this.emit("vertex-remove",t)}onVertexUpdate(t){this._updateGraphic(),this.emit("vertex-update",t)}_updateGraphic(){const t=this._getCreateOperationGeometry();this._createOperationGeometry=t,t!=null?(t.cursorEdge!=null?this.addHandles(this.onCursorEdgeChanged(t.cursorEdge),f.activeEdge):this.removeHandles(f.activeEdge),t.outline!=null?this.addHandles(this.onOutlineChanged(t.outline),f.outline):this.removeHandles(f.outline),t.committedVertices!=null?this.addHandles(this.onRegularVerticesChanged(t.committedVertices),f.regularVertices):this.removeHandles(f.regularVertices),t.cursorVertex!=null?this.addHandles(this.onActiveVertexChanged(t.cursorVertex),f.activeVertex):this.removeHandles(f.activeVertex),t.full!=null?this._createOrUpdateGraphic(t.full):this.removeHandles(J)):this._destroyAllVisualizations()}get activeTooltipInfo(){return this._coordinateFormatterLoadTask?.finished?it(this._tooltipsContext):null}};n([r()],p.prototype,"_coordinateFormatterLoadTask",void 0),n([r()],p.prototype,"_createOperationGeometry",void 0),n([r()],p.prototype,"_tooltipsContext",null),n([r({value:!0})],p.prototype,"centered",null),n([r()],p.prototype,"cursor",null),n([r({nonNullable:!0})],p.prototype,"defaultZ",void 0),n([r({constructOnly:!0})],p.prototype,"directionOptions",void 0),n([r()],p.prototype,"drawOperation",void 0),n([r()],p.prototype,"elevationLockOnVertexAddDisabled",void 0),n([r({value:!0})],p.prototype,"enabled",null),n([r({value:!0})],p.prototype,"forceUniformSize",null),n([r({constructOnly:!0})],p.prototype,"geometryType",void 0),n([r()],p.prototype,"graphic",null),n([r({constructOnly:!0})],p.prototype,"graphicProperties",void 0),n([r()],p.prototype,"graphicSymbol",null),n([r({constructOnly:!0})],p.prototype,"hasZ",void 0),n([r({constructOnly:!0})],p.prototype,"geometryToPlace",void 0),n([r()],p.prototype,"mode",null),n([r()],p.prototype,"snappingManager",void 0),n([r()],p.prototype,"snapToScene",void 0),n([r()],p.prototype,"tooltip",void 0),n([r()],p.prototype,"tooltipInfos",void 0),n([r({constructOnly:!0,type:bt})],p.prototype,"sketchOptions",void 0),n([r()],p.prototype,"updating",null),n([r({constructOnly:!0,nonNullable:!0})],p.prototype,"view",void 0),n([r({constructOnly:!0})],p.prototype,"undoRedo",null),n([r()],p.prototype,"activeTooltipInfo",null),p=n([k("esri.views.draw.DrawGraphicTool")],p);const J=Symbol("create-operation-graphic"),f={outline:Symbol("outline-visual"),regularVertices:Symbol("regular-vertices-visual"),activeVertex:Symbol("active-vertex-visual"),activeEdge:Symbol("active-edge-visual")};function vi(t){switch(t){case"point":case"polyline":case"polygon":case"multipoint":return t;case"circle":case"rectangle":return"segment";case"mesh":return"point"}}const ii=48;function wi(t,e){return At(t,e,!1)}function Oi(t,e){return At(t,e,!0)}function At(t,e,i){if(t instanceof pe){if(t.operation instanceof de)return oi(t.operation,e,i),!0;if(t.operation instanceof he)return ni(t.operation,e,i),!0;if(t.operation instanceof ue)return ri(t.operation,e,i),!0}return!1}function oi(t,e,i=!1){const o=i?-1:1,s=Dt(o*t.dx,o*t.dy,o*t.dz);K(e.origin,e.origin,s),q(e)}function ni(t,e,i=!1){const o=i?-t.angle:t.angle;gt(e.basis1,e.basis1,pt,o),gt(e.basis2,e.basis2,pt,o),q(e)}function ri(t,e,i=!1){const o=i?1/t.factor1:t.factor1,s=i?1/t.factor2:t.factor2;mt(e.basis1,e.basis1,o),mt(e.basis2,e.basis2,s),wt(e.origin,e.origin,t.origin,t.axis1,o),wt(e.origin,e.origin,t.origin,t.axis2,s),q(e)}function _i(t,e,i,o,s=!1){o||(o=Re());const d=A(M.get(),t[1],-t[0]),a=A(M.get(),Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),h=A(M.get(),Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),l=M.get(),u=e.allVertices;u.forEach(({pos:c})=>{A(l,ft(t,c),ft(d,c)),Ie(a,a,l),Te(h,h,l)});const y=1e-6,m=A(M.get(),h[0]-a[0]<y?i/2:0,h[1]-a[1]<y?i/2:0);Ue(a,a,m),Pe(h,h,m);const x=s?u.reduce((c,I)=>c+(I.pos[2]??0),0)/u.length:0;return vt(o.basis1,t,(h[0]-a[0])/2),vt(o.basis2,d,(h[1]-a[1])/2),Vt(o.origin,a[0]*t[0]+a[1]*d[0],a[0]*t[1]+a[1]*d[1],x),K(o.origin,o.origin,o.basis1),K(o.origin,o.origin,o.basis2),q(o),o}export{_i as c,vi as i,wi as n,p,Oi as r};
