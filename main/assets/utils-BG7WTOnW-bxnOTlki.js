import{io as u,aL as f,ip as y,iq as T,bt as d,ir as Z,bo as h,is as $,it as w,am as Q}from"./main-D7vwjMDX.js";import"./mat4f32-CiZjBg9k-CUm34GoR.js";import"./mat4-BFStKTjU-WrlKAspo.js";import"./intl-DLmy-Li5-l7mSy0H0.js";import{k as C}from"./timeZoneUtils-z3WjfjXQ-CLNspZbk.js";const M=",",D={years:365,months:30,days:1,hours:1/24,minutes:1/1440,seconds:1/86400,milliseconds:1/864e5},S=new Set(["integer","small-integer"]);let l=null;function N(e){return h(e)||$(e)||w(e)}async function E(e){const{field:n,field2:t,field3:s,normalizationField:a,valueExpression:r}=e;let i=[];if(r){if(!l){const{arcadeUtils:o}=await Q();l=o}i=l.extractFieldNames(r)}return n&&i.push(n),t&&i.push(t),s&&i.push(s),a&&i.push(a),i}function m(e){return String(e).padStart(2,"0")}function p(e,n,t){let s;return n==="date"||n==="number"?(n==="number"&&(e=new Date(e)),s=`TIMESTAMP'${t?e.getFullYear():e.getUTCFullYear()}-${m((t?e.getMonth():e.getUTCMonth())+1)}-${m(t?e.getDate():e.getUTCDate())} ${m(t?e.getHours():e.getUTCHours())}:${m(t?e.getMinutes():e.getUTCMinutes())}:${m(t?e.getSeconds():e.getUTCSeconds())}'`):s=e,s}function q(e,n,t,s){const{hasQueryEngine:a}=e,r=`(${p(t,g(e,t),a)} - ${p(n,g(e,n),a)})`;let i=D[s],o="/";return i<1&&(i=1/i,o="*"),{sqlExpression:i===1?r:`(${r} ${o} ${i})`,sqlWhere:null}}function g(e,n){if(n instanceof Date)return"date";if(typeof n=="number")return"number";if(typeof n=="string"){const t=e.getField(n);if(n.toLowerCase()==="<now>")return;if(h(t))return"field"}}function I(e,n){const t=n&&e.getField(n);return!!t&&S.has(t.type)}function k(e){return`cast(${e} as float)`}function z(e,n){const{format:t,timeZoneOptions:s,fieldType:a}=n??{};let r,i;if(s&&({timeZone:r,timeZoneName:i}=C(s.layerTimeZone,s.datesInUnknownTimezone,s.viewTimeZone,u(t||"short-date-short-time"),a)),typeof e=="string"&&isNaN(Date.parse(a==="time-only"?`1970-01-01T${e}Z`:e)))return e;switch(a){case"date-only":{const o=u(t||"short-date");return typeof e=="string"?Z(e,{...o}):f(e,{...o,timeZone:d})}case"time-only":{const o=u(t||"short-time");return typeof e=="string"?T(e,o):f(e,{...o,timeZone:d})}case"timestamp-offset":{if(!r&&typeof e=="string"&&new Date(e).toISOString()!==e)return e;const o=t||s?u(t||"short-date-short-time"):void 0,c=o?{...o,timeZone:r,timeZoneName:i}:void 0;return typeof e=="string"?y(e,c):f(e,c)}default:{const o=t||s?u(t||"short-date-short-time"):void 0;return f(typeof e=="string"?new Date(e):e,o?{...o,timeZone:r,timeZoneName:i}:void 0)}}}export{k as E,N as F,E as M,q as N,M as b,I as v,z as x};
