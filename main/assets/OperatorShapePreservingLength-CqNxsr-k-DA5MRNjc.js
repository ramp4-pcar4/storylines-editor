import{aV as H,c as Z,G as $,Z as k,s as K,v as S,Y as O}from"./Point2D-CaHJVGk1-JqvJXjLr.js";import{m as R,w as M,I as J,c as Q,R as W,u as ee,b as te,d as ne,H as se,X as P}from"./ProjectionTransformation-DQ4GElxa-BGYpULpC.js";import{Envelope2D as oe}from"./Envelope2D-DlBzXkgv-eKRxGysX.js";function V(){return{m_pGcs:new S,m_xyz:new P,m_factor:Number.NaN,m_geoLength:Number.NaN,setValues:re,setLength:ae,assign:ie}}function re(i,e,t,s){this.m_factor=i,this.m_pGcs.assign(e),this.m_xyz.assign(s),this.m_geoLength=t}function ae(i){this.m_geoLength=i}function ie(i){this.m_pGcs.assign(i.m_pGcs),this.m_xyz.assign(i.m_xyz),this.m_factor=i.m_factor,this.m_geoLength=i.m_geoLength}class ue{getOperatorType(){return 10315}supportsCurves(){return!0}accelerateGeometry(e,t,s){return!1}canAccelerateGeometry(e){return!1}_ExecuteShapePreservingLength(e,t,s,u,n){if(e.hasNonLinearSegments()&&(e=new R().execute(e,0,t.getTolerance(0),0,n)),t.isPannable()){let m=90,r=-90;if(s.getUnit().getUnitToBaseFactor()===1&&(m*=Math.PI/180,r*=Math.PI/180),t.getCoordinateSystemType()===2){let _=null;const o=[0,0,0,0];_=t.getPECoordSys(),o[0]=0,o[1]=m,o[2]=0,o[3]=r,M.geogToProj(_,2,o),m=o[1],r=o[3]}const g=new oe;e.queryEnvelope(g),g.ymin=r,g.ymax=m,e=new J().execute(e,g,t,n)}else{const m=t.getPCSHorizon();(e=new Q().execute(e,m,t,n))===m&&(e=e.clone())}return e.isEmpty()?0:this._ExecuteIterativeApproach(e,t,s,u,1,n)}_ExecuteIterativeApproach(e,t,s,u,n,m){const r=se();s.querySpheroidData(r);const g=r.majorSemiAxis,_=r.e2,o=s.getUnit().getUnitToBaseFactor(),b=40,C=H(V,b),w=Z(b,Number.NaN),f=V(),c=V();let y;const a=[0,0,0,0],U=t.getPECoordSys(),E=new S,v=new S,p=new S,l=new S,d=new S;let Y=0;const T=e.querySegmentIterator();for(;T.nextPath();)for(;T.hasNextSegment();){const z=T.nextSegment();E.assign(z.getStartXY()),v.assign(z.getEndXY()),t.getCoordinateSystemType()===2?(a[0]=E.x,a[1]=E.y,a[2]=v.x,a[3]=v.y,M.projToGeog(U,2,a),p.x=a[0]*o,p.y=a[1]*o,l.x=a[2]*o,l.y=a[3]*o):(p.setCoordsPoint2D(E),l.setCoordsPoint2D(v),p.scale(o),l.scale(o));const D=new P,I=new P;q(g,_,p,D),q(g,_,l,I);let x=L(g,D,I);f.setValues(0,p,Number.NaN,D),c.setValues(1,l,x,I),y=n,C[0].assign(c),w[0]=n;let h=0;for(;;){h>128&&O("iterations exceeded");const j=.5*(f.m_factor+c.m_factor),A=z.getCoord2D(j);t.getCoordinateSystemType()===2?(a[0]=A.x,a[1]=A.y,M.projToGeog(U,1,a),d.x=a[0]*o,d.y=a[1]*o):(d.setCoordsPoint2D(A),d.scale(o)),p.setCoordsPoint2D(f.m_pGcs),l.setCoordsPoint2D(c.m_pGcs);const G=new P;q(g,_,d,G);const X=L(g,f.m_xyz,G),B=L(g,c.m_xyz,G);x=c.m_geoLength,Number.isNaN(x)&&(x=L(g,f.m_xyz,c.m_xyz));const N=X+B,F=y===n&&N>=20&&Math.abs(N-x)>1e-8*(x+N);if(h+2<b&&(F||Math.abs(N-x)>0&&y>0))c.setLength(B),C[h].assign(c),c.setValues(j,d,X,G),C[++h].assign(c),F?(y=n,w[h]=n):(y--,w[h-1]=y,w[h]=y);else{if(Y+=N,h===0)break;f.assign(c),c.assign(C[--h]),y=w[h]}}}return Y}execute(e,t,s){if(t&&t.getCoordinateSystemType()!==0||$(""),e.isEmpty()||e.getDimension()<1)return 0;let u=null;const n=t.getGCS();n!==t&&(u=W(t,n,null));const m=e.getGeometryType();if(m===k.enumEnvelope){const r=new ee;return r.addEnvelope(e,!1),this._ExecuteShapePreservingLength(r,t,n,u,s)}if(K(m)){const r=new te;return r.addSegment(e,!0),this._ExecuteShapePreservingLength(r,t,n,u,s)}return this._ExecuteShapePreservingLength(e,t,n,u,s)}}function q(i,e,t,s){s.assign(ne(i,e,t))}function L(i,e,t){const s=i,u=new P;u.setSub(e,t);const n=u.length();return 2*s*Math.asin(n/(2*s))}export{ue as c};
