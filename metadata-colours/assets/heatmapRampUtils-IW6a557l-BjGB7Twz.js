const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./visualVariableUtils-BTS148WR-jjWVc4LX.js","./main-Ce4EWRDg.js","./main-DqH4NCYM.css","./lengthUtils-C61nRlXw-FSAXsLHN.js"])))=>i.map(i=>d[i]);
import{ad as c,_ as d,eJ as I,cz as C,a8 as E,J as V}from"./main-Ce4EWRDg.js";import{f as x}from"./utils-Dd8gTonD-B0YUQrG6.js";import{K as y,_ as U}from"./jsxFactory-Cua8zWVZ-CaT086WU.js";import{h as _}from"./TimeExtent-Cf2Pienb-BhGxfIDc.js";import{S as M}from"./intl-BAA1onnp-CLyuw8gc.js";import{M as R,E as N}from"./utils-CdIngiRE-B6w-2s6_.js";import{w as B}from"./typeUtils-CB2EGBWO-BKiqJKFV.js";function lt({level:t,class:e,...o},l){const n=w(t);return y(`h${n}`,{...o,"aria-level":String(n),class:U(x.heading,e),role:"heading"},l)}function w(t){return V(Math.ceil(t),1,6)}function nt(t,e=1){return w(t+e)}const O=/^-?(\d+)(\.(\d+))?$/i;function T(t,e){return t-e}function Q(t,e){let o,l;return o=Number(t.toFixed(e)),o<t?l=o+1/10**e:(l=o,o-=1/10**e),o=Number(o.toFixed(e)),l=Number(l.toFixed(e)),[o,l]}function F(t,e,o,l,n){const r=L(t,e,o,l),i=r.previous==null||r.previous<=n,a=r.next==null||r.next<=n;return i&&a||r.previous+r.next<=2*n}function v(t){const e=String(t),o=e.match(O);if(o?.[1])return{integer:o[1].split("").length,fractional:o[3]?o[3].split("").length:0};if(e.toLowerCase().includes("e")){const l=e.split("e"),n=l[0],r=l[1];if(n&&r){const i=Number(n);let a=Number(r);const s=a>0;s||(a=Math.abs(a));const u=v(i);return s?(u.integer+=a,a>u.fractional?u.fractional=0:u.fractional-=a):(u.fractional+=a,a>u.integer?u.integer=1:u.integer-=a),u}}return{integer:0,fractional:0}}function L(t,e,o,l){const n={previous:null,next:null};if(o!=null){const r=t-o,i=e-o-r;n.previous=Math.floor(Math.abs(100*i/r))}if(l!=null){const r=l-t,i=l-e-r;n.next=Math.floor(Math.abs(100*i/r))}return n}function rt(t,e={}){const o=t.slice(),{tolerance:l=2,strictBounds:n=!1,indexes:r=o.map((i,a)=>a)}=e;r.sort(T);for(let i=0;i<r.length;i++){const a=r[i],s=o[a],u=a===0?null:o[a-1],A=a===o.length-1?null:o[a+1],f=v(s).fractional;if(f){let m,p=0,g=!1;for(;p<=f&&!g;){const h=Q(s,p);m=n&&i===0?h[1]:h[0],g=F(s,m,u,A,l),p++}g&&(o[a]=m)}}return o}const S={maximumFractionDigits:20};function q(t){return M(t,S)}const K="<",D=">";function k(t,e,o,l){let n="";return e===0?n=`${K} `:e===o&&(n=`${D} `),n+(l?N(t,l):q(t))}const at=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII=","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII="];async function W(t){if(!("visualVariables"in t)||!t.visualVariables)return null;const e=t.visualVariables.find(i=>i.type==="color");if(!e)return null;let o=null,l=null;if(e.stops){if(e.stops.length===1)return e.stops[0].color;o=e.stops[0].value,l=e.stops[e.stops.length-1].value}const n=o!=null&&l!=null?o+(l-o)/2:0,{getColor:r}=await d(async()=>{const{getColor:i}=await import("./visualVariableUtils-BTS148WR-jjWVc4LX.js");return{getColor:i}},__vite__mapDeps([0,1,2,3]),import.meta.url).then(i=>i.b);return r(e,n)??null}async function it(t,e){const o=t.trailCap,l=t.trailWidth||1,n=e||await W(t)||t.color;return new I({cap:o,color:n,width:l})}function j(t,e){if(!e.field)return null;if("featureReduction"in t)switch(t.featureReduction?.type){case"cluster":case"binning":{const o=t.featureReduction.fields.find(({name:l})=>l.toLowerCase()===e.field.toLowerCase());return o&&"getField"in t?t.getField(o.onStatisticField):null}}return"getField"in t?t.getField?.(e.field):null}function G(t,e){const o="popupTemplate"in t?t.popupTemplate?.fieldInfos:null;if(o?.length&&e)return o.find(l=>l.fieldName?.toLowerCase()===e.toLowerCase())?.format?.dateFormat}function ut(t,e,o){const l=j(t,e);if(!l||!R(l)&&!C(l))return null;let n=G(t,l.name);if(!n&&l.type==="date"){let r=0,i=0;e.stops?(r=e.stops?.at(0)?.value??r,i=e.stops?.at(-1)?.value??i):"minDataValue"in e&&"maxDataValue"in e&&(r=e.minDataValue??r,i=e.maxDataValue??i),n=i-r>2*_.days?"short-date":"short-date-short-time"}return{fieldType:l.type,format:n,timeZoneOptions:{layerTimeZone:"preferredTimeZone"in t?t.preferredTimeZone:null,viewTimeZone:o,datesInUnknownTimezone:"datesInUnknownTimezone"in t&&t.datesInUnknownTimezone}}}function st(t,e){if("authoringInfo"in t)return t.authoringInfo?.visualVariables?.find(({theme:o})=>o===e)}const P=new c([64,64,64]);function b(t,e){const o=[],l=t.length-1;return t.length===5?o.push(0,2,4):o.push(0,l),t.map((n,r)=>o.includes(r)?k(n,r,l,e):null)}async function At(t,e,o){let l=!1,n=[],r=[];if(t.stops){const u=t.stops;n=u.map(A=>A.value),l=u.some(A=>!!A.label),l&&(r=u.map(A=>A.label))}const i=n[0],a=n[n.length-1];if(i==null&&a==null)return null;const s=l?null:b(n,o);return(await Promise.all(n.map(async(u,A)=>{const f=t.type==="opacity"?await z(u,t,e):(await d(()=>import("./visualVariableUtils-BTS148WR-jjWVc4LX.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(p=>p.b)).getColor(t,u),m=l?r[A]:s?.[A]??"";return f==null?null:{value:u,color:f,label:m}}))).filter(E).reverse()}async function z(t,e,o){const l=new c(o??P),n=(await d(()=>import("./visualVariableUtils-BTS148WR-jjWVc4LX.js"),__vite__mapDeps([0,1,2,3]),import.meta.url).then(r=>r.b)).getOpacity(e,t);return n!=null&&(l.a=n),l}function ct(t){let e=!1,o=[],l=[];o=t.map(a=>a.value),e=t.some(a=>!!a.label),e&&(l=t.map(a=>a.label??""));const n=o[0],r=o[o.length-1];if(n==null&&r==null)return null;const i=e?null:b(o);return o.map((a,s)=>({value:a,color:H(a,t),label:e?l[s]:i?.[s]??""})).reverse()}function H(t,e){const{startIndex:o,endIndex:l,weight:n}=Z(t,e);if(o===l)return e[o].color;const r=c.blendColors(e[o].color,e[l].color,n);return new c(r)}function Z(t,e){let o=0,l=e.length-1;return e.some((n,r)=>t<n.value?(l=r,!0):(o=r,!1)),{startIndex:o,endIndex:l,weight:(t-e[o].value)/(e[l].value-e[o].value)}}function ft(t,e){let o=[];if(t&&t.type==="multipart")t.colorRamps.reverse().forEach((l,n)=>{n===0?o.push({value:e.max,color:new c(l.toColor),label:"high"}):o.push({value:null,color:new c(l.toColor),label:""}),n===t.colorRamps.length-1?o.push({value:e.min,color:new c(l.fromColor),label:"low"}):o.push({value:null,color:new c(l.fromColor),label:""})});else{let l,n;t&&t.type==="algorithmic"?(l=t.fromColor,n=t.toColor):(l=[0,0,0,1],n=[255,255,255,1]),o=[{value:e.max,color:new c(n),label:"high"},{value:e.min,color:new c(l),label:"low"}]}return o}function mt(t){if(!t.colorStops)return[];const e=[...t.colorStops].filter(l=>l.color?.a>0);let o=e.length-1;if(e&&e[0]){const l=e[o];l&&l.ratio!==1&&(e.push(new B({ratio:1,color:l.color})),o++)}return e.map((l,n)=>{let r="";return n===0?r=t.legendOptions?.minLabel||"low":n===o&&(r=t.legendOptions?.maxLabel||"high"),{color:l.color,label:r,ratio:l.ratio}}).reverse()}export{k as C,rt as D,D as I,st as J,ut as P,lt as S,H as U,it as X,L as b,v as h,nt as j,At as n,ct as o,mt as r,ft as t,K as v,W as x,at as z};
